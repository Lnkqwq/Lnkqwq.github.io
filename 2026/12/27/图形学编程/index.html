<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>å›¾å½¢å­¦ç¼–ç¨‹ | Hexo</title><meta name="keywords" content="C++,å›¾å½¢å­¦"><meta name="description" content="å›¾åƒå¤„ç†&amp;çº¹ç†åŠ è½½  å›¾åƒæ–‡ä»¶æ ¼å¼  å›¾åƒä½æ•°ä¸åƒç´   ğŸ¯ æ ¸å¿ƒï¼šä½æ•° &#x3D; è°ƒè‰²ç›˜å¤§å° ä¸€ä¸ªåƒç´ å°±æ˜¯ä¸€ä¸ªæ ¼å­ï¼Œåªèƒ½æ¶‚ä¸€ç§é¢œè‰²ã€‚ ä½æ•°å†³å®šâ€œè¿™ç§é¢œè‰²å¯ä»¥ä»å¤šå°‘ç§é‡Œé€‰â€ã€‚  ğŸ“Š ä½æ•°å¯¹æ¯”è¡¨ ä½æ•° æ¯åƒç´ å­—èŠ‚ é¢œè‰²æ•°é‡       è°ƒè‰²ç›˜å¤§å°       æ•ˆæœ 8ä½  1å­—èŠ‚     256è‰²          256æ ¼      å¯è§è‰²å—ã€æ¸å˜è‰²å¸¦ 16ä½ 2å­—èŠ‚     65536è‰²">
<meta property="og:type" content="article">
<meta property="og:title" content="å›¾å½¢å­¦ç¼–ç¨‹">
<meta property="og:url" content="http://example.com/2026/12/27/%E5%9B%BE%E5%BD%A2%E5%AD%A6%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="å›¾åƒå¤„ç†&amp;çº¹ç†åŠ è½½  å›¾åƒæ–‡ä»¶æ ¼å¼  å›¾åƒä½æ•°ä¸åƒç´   ğŸ¯ æ ¸å¿ƒï¼šä½æ•° &#x3D; è°ƒè‰²ç›˜å¤§å° ä¸€ä¸ªåƒç´ å°±æ˜¯ä¸€ä¸ªæ ¼å­ï¼Œåªèƒ½æ¶‚ä¸€ç§é¢œè‰²ã€‚ ä½æ•°å†³å®šâ€œè¿™ç§é¢œè‰²å¯ä»¥ä»å¤šå°‘ç§é‡Œé€‰â€ã€‚  ğŸ“Š ä½æ•°å¯¹æ¯”è¡¨ ä½æ•° æ¯åƒç´ å­—èŠ‚ é¢œè‰²æ•°é‡       è°ƒè‰²ç›˜å¤§å°       æ•ˆæœ 8ä½  1å­—èŠ‚     256è‰²          256æ ¼      å¯è§è‰²å—ã€æ¸å˜è‰²å¸¦ 16ä½ 2å­—èŠ‚     65536è‰²">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2026-12-27T08:56:10.000Z">
<meta property="article:modified_time" content="2026-03-01T12:12:11.344Z">
<meta property="article:author" content="Lnk">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="å›¾å½¢å­¦">
<meta name="twitter:card" content="summary"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/BenderLight.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><meta name="page-config" content="{&quot;code_fold&quot;:null}"><script class="pjax-js">var config = {"root":"/","code_fold":15,"search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy"}};
var page_config = {
  code_fold: null
};
function updatePageConfig() {
  var newPageConfig = document.querySelector('meta[name="page-config"]');
  if (newPageConfig) {
    page_config = JSON.parse(newPageConfig.content);
  }
}
document.addEventListener('pjax:complete', function() { updatePageConfig(); });
updatePageConfig();</script><link type="text/css" rel="stylesheet" href="/lib/encrypt/hbe.style.css"><script src="//unpkg.com/mermaid@11.12.2/dist/mermaid.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
 menuSettings: {
   zoom: "None"
 },
 showMathMenu: false,
 jax: ["input/TeX","output/CommonHTML"],
 extensions: ["tex2jax.js"],
 TeX: {
   extensions: ["AMSmath.js","AMSsymbols.js"],
   equationNumbers: {
     autoNumber: "AMS"
   }
 },
 tex2jax: {
   inlineMath: [["\\(", "\\)"]],
   displayMath: [["\\[", "\\]"]]
 }
});</script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('/images/BK.PNG');
 --light-background: url('/images/BK.PNG');
 --theme-encrypt-confirm: 'confirm'
}</style><script defer src="/js/arknights.js"></script><script defer src="/js/search.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@11.12.2/dist/mermaid.esm.min.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
  menuSettings: {
    zoom: "None"
  },
  showMathMenu: false,
  jax: ["input/TeX","output/CommonHTML"],
  extensions: ["tex2jax.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js"],
    equationNumbers: {
      autoNumber: "AMS"
    }
  },
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]]
  }
});
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/lib/encrypt/hbe.js"></script><script async src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.vercount','meta[name=page-config]'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><script class="pjax-js">reset= () => {window.giscusSettings = {
 repo: 'Lnkqwq/Lnkqwq.github.io',
 repoId: 'R_kgDORZSSAA',
 category: '',
 categoryId: '',
 mapping: 'pathname',
 strict: '0',
 reactionsEnabled: '1',
 emitMetadata: '0',
 inputPosition: 'bottom',
 lang: 'zh-CN',
 crossorigin: 'anonymous' , loading: 'lazy'};window.giscusThemeConfig = { theme: 'preferred_color_scheme' };MathJax.Hub.Queue(["Typeset", MathJax.Hub]);document.querySelector('.lg-container')?.remove()
const postBg = document.querySelector('#post-bg');
if (postBg) lightGallery(postBg, {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.vercount','meta[name=page-config]'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>å›¾å½¢å­¦ç¼–ç¨‹</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2026-12-27T08:56:10.000Z" id="date"> 2026-12-27</time></div></span><br><span>Last Update: <div class="control"><time datetime="2026-03-01T12:12:11.344Z" id="updated"> 2026-03-01</time></div></span></div></div><hr><div id="post-content"><h1 id="å›¾åƒå¤„ç†çº¹ç†åŠ è½½"><a href="#å›¾åƒå¤„ç†çº¹ç†åŠ è½½" class="headerlink" title="å›¾åƒå¤„ç†çº¹ç†åŠ è½½"></a><a class="markdownIt-Anchor" href="#å›¾åƒå¤„ç†çº¹ç†åŠ è½½"></a> å›¾åƒå¤„ç†&amp;çº¹ç†åŠ è½½</h1>
<h2 id="å›¾åƒæ–‡ä»¶æ ¼å¼"><a href="#å›¾åƒæ–‡ä»¶æ ¼å¼" class="headerlink" title="å›¾åƒæ–‡ä»¶æ ¼å¼"></a><a class="markdownIt-Anchor" href="#å›¾åƒæ–‡ä»¶æ ¼å¼"></a> å›¾åƒæ–‡ä»¶æ ¼å¼</h2>
<h3 id="å›¾åƒä½æ•°ä¸åƒç´ "><a href="#å›¾åƒä½æ•°ä¸åƒç´ " class="headerlink" title="å›¾åƒä½æ•°ä¸åƒç´ "></a><a class="markdownIt-Anchor" href="#å›¾åƒä½æ•°ä¸åƒç´ "></a> å›¾åƒä½æ•°ä¸åƒç´ </h3>
<hr />
<p>ğŸ¯ æ ¸å¿ƒï¼šä½æ•° = è°ƒè‰²ç›˜å¤§å°</p>
<p>ä¸€ä¸ªåƒç´ å°±æ˜¯ä¸€ä¸ªæ ¼å­ï¼Œåªèƒ½æ¶‚ä¸€ç§é¢œè‰²ã€‚<br />
ä½æ•°å†³å®šâ€œè¿™ç§é¢œè‰²å¯ä»¥ä»å¤šå°‘ç§é‡Œé€‰â€ã€‚</p>
<hr />
<p>ğŸ“Š ä½æ•°å¯¹æ¯”è¡¨</p>
<p>ä½æ•° æ¯åƒç´ å­—èŠ‚ é¢œè‰²æ•°é‡       è°ƒè‰²ç›˜å¤§å°       æ•ˆæœ<br />
8ä½  1å­—èŠ‚     256è‰²          256æ ¼      å¯è§è‰²å—ã€æ¸å˜è‰²å¸¦<br />
16ä½ 2å­—èŠ‚     65536è‰²       6.5ä¸‡æ ¼      è€æ¸¸æˆï¼Œè½»å¾®è‰²å¸¦<br />
24ä½ 3å­—èŠ‚   1677ä¸‡è‰²        1677ä¸‡æ ¼      çœŸå½©è‰²ï¼Œå¹³æ»‘æ¸å˜<br />
32ä½ 4å­—èŠ‚  1677ä¸‡è‰²+é€æ˜åº¦  1677ä¸‡æ ¼+Alpha çœŸå½©è‰²+åŠé€æ˜</p>
<hr />
<p>ğŸ“ ä½æ•°æœ¬è´¨ï¼šåˆ‡åˆ†äº®åº¦</p>
<p>æŠŠ0-100%çš„äº®åº¦åˆ‡æˆå¤šå°‘ä»½ï¼š</p>
<p>ä½æ•° ä»½æ•°    å°é˜¶ç²—ç»†   ç”¨é€”<br />
1ä½  2ä»½     çº¯é»‘/çº¯ç™½ é»‘ç™½å›¾<br />
8ä½  256ä»½   è‚‰çœ¼æé™  JPGã€ç½‘é¡µ<br />
10ä½ 1024ä»½  ä¸“ä¸šæ˜¾ç¤ºå™¨  HDR<br />
12ä½ 4096ä»½  RAWæ ¼å¼  æ‘„å½±åæœŸ<br />
16ä½ 65536ä»½ æ— æŸç¼–è¾‘   PSä¿®å›¾</p>
<p>24ä½ = æ¯ä¸ªé€šé“8ä½ = 256çº§äº®åº¦ Ã— 3ä¸ªé€šé“<br />
ä¸æ˜¯1677ä¸‡ç§ç‹¬ç«‹çš„é¢œè‰²ï¼Œæ˜¯256çº§çº¢ Ã— 256çº§ç»¿ Ã— 256çº§è“çš„ç»„åˆã€‚</p>
<hr />
<p>ğŸ’ ä¸€å¥è¯ç²¾é«“</p>
<p>ä½æ•°ä¸æ˜¯å†³å®šâ€œæ¶‚å‡ æ¬¡é¢œè‰²â€ï¼Œæ˜¯å†³å®šâ€œè°ƒè‰²ç›˜é‡Œæœ‰å¤šå°‘æ ¼é¢œè‰²å¯é€‰â€ã€‚<br />
24ä½çš„1677ä¸‡è‰²ä¸æ˜¯ç‰©ç†å­˜åœ¨ï¼Œæ˜¯256Ã—256Ã—256çš„æ•°å­¦ç»„åˆã€‚</p>
<h3 id="bmp"><a href="#bmp" class="headerlink" title="bmp"></a><a class="markdownIt-Anchor" href="#bmp"></a> BMP</h3>
<h4 id="bmpæ˜¯ä»€ä¹ˆ"><a href="#bmpæ˜¯ä»€ä¹ˆ" class="headerlink" title="bmpæ˜¯ä»€ä¹ˆ"></a><a class="markdownIt-Anchor" href="#bmpæ˜¯ä»€ä¹ˆ"></a> BMPæ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p>BMP = Bitmap = ä½å›¾ = Windowsçš„äº²å„¿å­<br />
âœ… ä¸å‹ç¼© â†’ è¯»å‡ºæ¥å°±æ˜¯RGBæ•°ç»„<br />
âœ… ç»“æ„æç®€ â†’ 54å­—èŠ‚å¤´ + åƒç´ æ•°æ®<br />
âœ… 1990å¹´è‡³ä»Šæ²¡å˜è¿‡<br />
âŒ æ–‡ä»¶å·¨å¤§ â†’ ä¸€å¼ 4Kç…§ç‰‡å‡ ç™¾MB<br />
âŒ åªæœ‰WindowsåŸç”Ÿæ”¯æŒ<br />
â€‹</p>
<h4 id="æ–‡ä»¶ç»“æ„æ€»å…±å°±ä¸¤éƒ¨åˆ†"><a href="#æ–‡ä»¶ç»“æ„æ€»å…±å°±ä¸¤éƒ¨åˆ†" class="headerlink" title="æ–‡ä»¶ç»“æ„æ€»å…±å°±ä¸¤éƒ¨åˆ†"></a><a class="markdownIt-Anchor" href="#æ–‡ä»¶ç»“æ„æ€»å…±å°±ä¸¤éƒ¨åˆ†"></a> æ–‡ä»¶ç»“æ„ï¼ˆæ€»å…±å°±ä¸¤éƒ¨åˆ†ï¼‰</h4>
<p>BMPæ–‡ä»¶<br />
â”œâ”€â”€ æ–‡ä»¶å¤´ (14å­—èŠ‚) â€” ä½ æ˜¯è°ï¼Ÿ<br />
â”œâ”€â”€ ä¿¡æ¯å¤´ (40å­—èŠ‚) â€” ä½ å¤šå¤§ï¼Ÿ<br />
â””â”€â”€ åƒç´ æ•°æ® (XXXå­—èŠ‚) â€” ä½ çš„è‚‰ï¼<br />
â€‹<br />
2.1 æ–‡ä»¶å¤´ï¼ˆBITMAPFILEHEADERï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-type">char</span> signature[<span class="hljs-number">2</span>];      <span class="hljs-comment">// å›ºå®šä¸º &#x27;B&#x27; &#x27;M&#x27; (0x42 0x4D)</span><br>    <span class="hljs-type">int</span> fileSize;          <span class="hljs-comment">// æ•´ä¸ªæ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰</span><br>    <span class="hljs-type">int</span> reserved;          <span class="hljs-comment">// ä¿ç•™ï¼Œå¿…é¡»ä¸º0</span><br>    <span class="hljs-type">int</span> dataOffset;        <span class="hljs-comment">// åƒç´ æ•°æ®çš„èµ·å§‹ä½ç½®ï¼ˆé€šå¸¸54ï¼‰</span><br>&#125; BMPFileHeader;<br><br><span class="hljs-comment">// å¤§å°ï¼š2+4+4+4 = 14å­—èŠ‚</span><br><span class="hljs-comment">// æ³¨æ„ï¼šç»“æ„ä½“å¯èƒ½æœ‰å†…å­˜å¯¹é½ï¼Œä¸è¦ç›´æ¥freadï¼</span><br></code></pre></td></tr></table></figure>
<p>â€‹<br />
äºŒè¿›åˆ¶çœ‹ä¸€çœ¼ï¼š<br />
42 4D                  â†’ â€œBMâ€<br />
36 10 0E 00            â†’ æ–‡ä»¶å¤§å° = 0x000E1036 = 921654å­—èŠ‚<br />
00 00 00 00            â†’ ä¿ç•™<br />
36 00 00 00            â†’ æ•°æ®åç§» = 0x36 = 54å­—èŠ‚<br />
â€‹<br />
2.2 ä¿¡æ¯å¤´ï¼ˆBITMAPINFOHEADERï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-type">int</span> headerSize;        <span class="hljs-comment">// ä¿¡æ¯å¤´å¤§å° = 40</span><br>    <span class="hljs-type">int</span> width;            <span class="hljs-comment">// å›¾åƒå®½åº¦ï¼ˆåƒç´ ï¼‰</span><br>    <span class="hljs-type">int</span> height;           <span class="hljs-comment">// å›¾åƒé«˜åº¦ï¼ˆåƒç´ ï¼‰</span><br>    <span class="hljs-type">short</span> planes;         <span class="hljs-comment">// å›ºå®šä¸º1</span><br>    <span class="hljs-type">short</span> bitsPerPixel;   <span class="hljs-comment">// 24(RGB) æˆ– 32(RGBA) æˆ– 8(ç°åº¦)</span><br>    <span class="hljs-type">int</span> compression;      <span class="hljs-comment">// 0=ä¸å‹ç¼©ï¼Œ1=RLE8ï¼Œ2=RLE4</span><br>    <span class="hljs-type">int</span> imageSize;        <span class="hljs-comment">// åƒç´ æ•°æ®å¤§å°ï¼ˆå­—èŠ‚ï¼‰</span><br>    <span class="hljs-type">int</span> xPixelsPerMeter;  <span class="hljs-comment">// æ°´å¹³åˆ†è¾¨ç‡ï¼ˆé€šå¸¸0ï¼‰</span><br>    <span class="hljs-type">int</span> yPixelsPerMeter;  <span class="hljs-comment">// å‚ç›´åˆ†è¾¨ç‡ï¼ˆé€šå¸¸0ï¼‰</span><br>    <span class="hljs-type">int</span> colorsUsed;       <span class="hljs-comment">// è°ƒè‰²æ¿é¢œè‰²æ•°ï¼ˆ24ä½=0ï¼‰</span><br>    <span class="hljs-type">int</span> colorsImportant;  <span class="hljs-comment">// é‡è¦é¢œè‰²æ•°ï¼ˆ0=å…¨éƒ½é‡è¦ï¼‰</span><br>&#125; BMPInfoHeader;<br><br><span class="hljs-comment">// å¤§å°ï¼š40å­—èŠ‚</span><br>â€‹<br>å…³é”®å­—æ®µï¼š<br>å­—æ®µ å¸¸è§å€¼ å«ä¹‰<br>bitsPerPixel <span class="hljs-number">24</span> çœŸå½©è‰²ï¼ŒBGRæ ¼å¼<br>bitsPerPixel <span class="hljs-number">32</span> å¸¦Alphaï¼ŒBGRA<br>compression <span class="hljs-number">0</span> ä¸å‹ç¼©ï¼Œç›´æ¥è¯»<br>imageSize å®½Ã—é«˜Ã—<span class="hljs-number">3</span> <span class="hljs-number">24</span>ä½å›¾å¤§å°<br></code></pre></td></tr></table></figure>
<h4 id="åƒç´ æ•°æ®å¸ƒå±€å‘"><a href="#åƒç´ æ•°æ®å¸ƒå±€å‘" class="headerlink" title="åƒç´ æ•°æ®å¸ƒå±€å‘"></a><a class="markdownIt-Anchor" href="#åƒç´ æ•°æ®å¸ƒå±€å‘"></a> åƒç´ æ•°æ®å¸ƒå±€ï¼ˆå‘ï¼ï¼‰</h4>
<p>3.1 BGRé¡ºåºï¼ˆä¸æ˜¯RGBï¼ï¼‰<br />
// æ¯ä¸ªåƒç´ 3å­—èŠ‚ï¼Œé¡ºåºæ˜¯ï¼š<br />
[B] [G] [R]   â† BMPæ–‡ä»¶é‡Œè¿™æ ·å­˜<br />
[R] [G] [B]   â† OpenGLè¦è¿™æ ·</p>
<p>// å¿…é¡»äº¤æ¢ï¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; dataSize; i += <span class="hljs-number">3</span>) &#123;<br>    std::<span class="hljs-built_in">swap</span>(data[i], data[i + <span class="hljs-number">2</span>]);  <span class="hljs-comment">// B â†” R</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>â€‹<br />
3.2 è¡Œå¯¹é½ï¼ˆ4å­—èŠ‚å€æ•°ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// BMPæ¯è¡Œå¿…é¡»æ˜¯4çš„å€æ•°ï¼Œä¸å¤Ÿå°±è¡¥0</span><br>å®½åº¦ = <span class="hljs-number">3</span>åƒç´  â†’ <span class="hljs-number">3</span>Ã—<span class="hljs-number">3</span>=<span class="hljs-number">9</span>å­—èŠ‚ â†’ è¡¥åˆ°<span class="hljs-number">12</span>å­—èŠ‚<br><br><span class="hljs-comment">// è®¡ç®—å®é™…æ¯è¡Œå¤§å°ï¼š</span><br><span class="hljs-type">int</span> bytesPerRow = ((bitsPerPixel * width + <span class="hljs-number">31</span>) / <span class="hljs-number">32</span>) * <span class="hljs-number">4</span>;<br><span class="hljs-comment">// æˆ–ç®€å•ç‚¹ï¼š</span><br><span class="hljs-type">int</span> bytesPerRow = (width * <span class="hljs-number">3</span> + <span class="hljs-number">3</span>) &amp; ~<span class="hljs-number">3</span>;  <span class="hljs-comment">// å‘ä¸Šå–æ•´åˆ°4çš„å€æ•°</span><br><br><span class="hljs-comment">// è¯»æ•°æ®æ—¶è¦è·³è¿‡è¡¥çš„0ï¼</span><br></code></pre></td></tr></table></figure>
<p>â€‹<br />
3.3 åŸç‚¹ä½ç½®ï¼ˆå·¦ä¸‹è§’ï¼‰<br />
// height &gt; 0ï¼šå›¾åƒä»<strong>å·¦ä¸‹è§’</strong>å¼€å§‹å­˜<br />
ç¬¬ä¸€è¡Œ â†’ æœ€ä¸‹é¢ä¸€è¡Œ<br />
æœ€åä¸€è¡Œ â†’ æœ€ä¸Šé¢ä¸€è¡Œ</p>
<p>// OpenGLçº¹ç†åŸç‚¹åœ¨<strong>å·¦ä¸‹è§’</strong> â†’ æ­£å¥½åŒ¹é…ï¼<br />
// ä¸ç”¨ç¿»è½¬ï¼</p>
<p>// ä½†STBé»˜è®¤è¦ç¿»è½¬ï¼Œå› ä¸ºå®ƒä¹ æƒ¯å·¦ä¸Šè§’<br />
stbi_set_flip_vertically_on_load(true);  // BMPä¸éœ€è¦ï¼<br />
â€‹</p>
<h4 id="å®Œæ•´è¯»å–ä»£ç "><a href="#å®Œæ•´è¯»å–ä»£ç " class="headerlink" title="å®Œæ•´è¯»å–ä»£ç "></a><a class="markdownIt-Anchor" href="#å®Œæ•´è¯»å–ä»£ç "></a> å®Œæ•´è¯»å–ä»£ç </h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* <span class="hljs-title">loadBMP</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* path, <span class="hljs-type">int</span>&amp; width, <span class="hljs-type">int</span>&amp; height)</span> </span>&#123;<br>    <span class="hljs-function">std::ifstream <span class="hljs-title">file</span><span class="hljs-params">(path, std::ios::binary)</span></span>;<br>    <span class="hljs-keyword">if</span> (!file.<span class="hljs-built_in">is_open</span>()) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br><br>    <span class="hljs-comment">// 1. è¯»æ–‡ä»¶å¤´</span><br>    <span class="hljs-type">char</span> signature[<span class="hljs-number">2</span>];<br>    file.<span class="hljs-built_in">read</span>(signature, <span class="hljs-number">2</span>);<br>    <span class="hljs-keyword">if</span> (signature[<span class="hljs-number">0</span>] != <span class="hljs-string">&#x27;B&#x27;</span> || signature[<span class="hljs-number">1</span>] != <span class="hljs-string">&#x27;M&#x27;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br><br>    <span class="hljs-type">int</span> fileSize, dataOffset;<br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)&amp;fileSize, <span class="hljs-number">4</span>);<br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)&amp;fileSize, <span class="hljs-number">4</span>);  <span class="hljs-comment">// reservedï¼Œè·³è¿‡</span><br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)&amp;dataOffset, <span class="hljs-number">4</span>);<br><br>    <span class="hljs-comment">// 2. è¯»ä¿¡æ¯å¤´</span><br>    <span class="hljs-type">int</span> headerSize;<br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)&amp;headerSize, <span class="hljs-number">4</span>);<br><br>    <span class="hljs-type">short</span> planes, bitsPerPixel;<br>    <span class="hljs-type">int</span> compression, imageSize;<br><br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)&amp;width, <span class="hljs-number">4</span>);<br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)&amp;height, <span class="hljs-number">4</span>);<br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)&amp;planes, <span class="hljs-number">2</span>);<br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)&amp;bitsPerPixel, <span class="hljs-number">2</span>);<br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)&amp;compression, <span class="hljs-number">4</span>);<br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)&amp;imageSize, <span class="hljs-number">4</span>);<br><br>    <span class="hljs-comment">// 3. åªæ”¯æŒ24ä½ä¸å‹ç¼©BMP</span><br>    <span class="hljs-keyword">if</span> (bitsPerPixel != <span class="hljs-number">24</span> || compression != <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br><br>    <span class="hljs-comment">// 4. è·³è½¬åˆ°åƒç´ æ•°æ®</span><br>    file.<span class="hljs-built_in">seekg</span>(dataOffset, std::ios::beg);<br><br>    <span class="hljs-comment">// 5. è®¡ç®—å®é™…å¤§å°ï¼ˆè€ƒè™‘è¡Œå¯¹é½ï¼‰</span><br>    <span class="hljs-type">int</span> bytesPerRow = (width * <span class="hljs-number">3</span> + <span class="hljs-number">3</span>) &amp; ~<span class="hljs-number">3</span>;<br>    <span class="hljs-type">int</span> dataSize = bytesPerRow * <span class="hljs-built_in">abs</span>(height);<br><br>    <span class="hljs-function">std::vector&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>&gt; <span class="hljs-title">bmpData</span><span class="hljs-params">(dataSize)</span></span>;<br>    file.<span class="hljs-built_in">read</span>((<span class="hljs-type">char</span>*)bmpData.<span class="hljs-built_in">data</span>(), dataSize);<br><br>    <span class="hljs-comment">// 6. åˆ†é…OpenGLæ ¼å¼çš„å†…å­˜</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* glData = <span class="hljs-keyword">new</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>[width * height * <span class="hljs-number">3</span>];<br><br>    <span class="hljs-comment">// 7. å»æ‰è¡¥çš„0 + BGRè½¬RGB</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; <span class="hljs-built_in">abs</span>(height); y++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> x = <span class="hljs-number">0</span>; x &lt; width; x++) &#123;<br>            <span class="hljs-type">int</span> bmpIndex = y * bytesPerRow + x * <span class="hljs-number">3</span>;<br>            <span class="hljs-type">int</span> glIndex;<br><br>            <span class="hljs-comment">// å¤„ç†åŸç‚¹æ–¹å‘</span><br>            <span class="hljs-keyword">if</span> (height &gt; <span class="hljs-number">0</span>) &#123;  <span class="hljs-comment">// å·¦ä¸‹åŸç‚¹</span><br>                glIndex = (<span class="hljs-built_in">abs</span>(height) - <span class="hljs-number">1</span> - y) * width * <span class="hljs-number">3</span> + x * <span class="hljs-number">3</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;           <span class="hljs-comment">// å·¦ä¸ŠåŸç‚¹</span><br>                glIndex = y * width * <span class="hljs-number">3</span> + x * <span class="hljs-number">3</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// BGR â†’ RGB</span><br>            glData[glIndex + <span class="hljs-number">2</span>] = bmpData[bmpIndex + <span class="hljs-number">0</span>];  <span class="hljs-comment">// R â† B</span><br>            glData[glIndex + <span class="hljs-number">1</span>] = bmpData[bmpIndex + <span class="hljs-number">1</span>];  <span class="hljs-comment">// G â† G</span><br>            glData[glIndex + <span class="hljs-number">0</span>] = bmpData[bmpIndex + <span class="hljs-number">2</span>];  <span class="hljs-comment">// B â† R</span><br>        &#125;<br>    &#125;<br><br>    width = <span class="hljs-built_in">abs</span>(width);   <span class="hljs-comment">// å®½æ€»æ˜¯æ­£</span><br>    height = <span class="hljs-built_in">abs</span>(height); <span class="hljs-comment">// é«˜å–ç»å¯¹å€¼</span><br><br>    <span class="hljs-keyword">return</span> glData;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="openglä¸­ä½¿ç”¨"><a href="#openglä¸­ä½¿ç”¨" class="headerlink" title="openglä¸­ä½¿ç”¨"></a><a class="markdownIt-Anchor" href="#openglä¸­ä½¿ç”¨"></a> OpenGLä¸­ä½¿ç”¨</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. åŠ è½½BMP</span><br><span class="hljs-type">int</span> w, h;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* data = <span class="hljs-built_in">loadBMP</span>(<span class="hljs-string">&quot;earth.bmp&quot;</span>, w, h);<br><br><span class="hljs-comment">// 2. åˆ›å»ºçº¹ç†</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> texture;<br><span class="hljs-built_in">glGenTextures</span>(<span class="hljs-number">1</span>, &amp;texture);<br><span class="hljs-built_in">glBindTexture</span>(GL_TEXTURE_2D, texture);<br><br><span class="hljs-comment">// 3. ä¸Šä¼ æ•°æ®</span><br><span class="hljs-built_in">glTexImage2D</span>(GL_TEXTURE_2D, <span class="hljs-number">0</span>, GL_RGB, w, h, <span class="hljs-number">0</span>, GL_RGB, GL_UNSIGNED_BYTE, data);<br><br><span class="hljs-comment">// 4. è®¾ç½®å‚æ•°</span><br><span class="hljs-built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);<br><span class="hljs-built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);<br><br><span class="hljs-comment">// 5. é‡Šæ”¾å†…å­˜</span><br><span class="hljs-keyword">delete</span>[] data;<br></code></pre></td></tr></table></figure>
<h4 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a><a class="markdownIt-Anchor" href="#å¸¸è§é—®é¢˜"></a> å¸¸è§é—®é¢˜</h4>
<p>Q1ï¼šä¸ºä»€ä¹ˆè¯»å‡ºæ¥æ˜¯é¢ å€’çš„ï¼Ÿ<br />
Aï¼š BMPåŸç‚¹åœ¨å·¦ä¸‹è§’ï¼Œå¦‚æœä½ ä¹ æƒ¯å·¦ä¸Šè§’ï¼Œä¼šæ„Ÿè§‰åäº†ã€‚<br />
// è§£å†³æ–¹æ¡ˆï¼šè¯»çš„æ—¶å€™ç¿»è½¬Y</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">glIndex = (height - <span class="hljs-number">1</span> - y) * width * <span class="hljs-number">3</span> + x * <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>
<p>â€‹<br />
Q2ï¼šä¸ºä»€ä¹ˆé¢œè‰²ä¸å¯¹ï¼Ÿ<br />
Aï¼š BMPæ˜¯BGRï¼ŒOpenGLè¦RGBï¼Œå¿˜äº†äº¤æ¢ï¼<br />
// å¿…é¡»äº¤æ¢ï¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">glData[glIndex + <span class="hljs-number">0</span>] = bmpData[bmpIndex + <span class="hljs-number">2</span>];  <span class="hljs-comment">// R</span><br>glData[glIndex + <span class="hljs-number">1</span>] = bmpData[bmpIndex + <span class="hljs-number">1</span>];  <span class="hljs-comment">// G</span><br>glData[glIndex + <span class="hljs-number">2</span>] = bmpData[bmpIndex + <span class="hljs-number">0</span>];  <span class="hljs-comment">// B</span><br></code></pre></td></tr></table></figure>
<p>â€‹<br />
Q3ï¼šä¸ºä»€ä¹ˆæœ‰é»‘çº¿ï¼Ÿ<br />
Aï¼š æ¯è¡Œè¡¥çš„0æ²¡å»æ‰ï¼<br />
// BMPæ¯è¡Œ4å­—èŠ‚å¯¹é½ï¼Œç›´æ¥æŒ‰widthÃ—3è¯»ä¼šå¸¦ä¸Šè¡¥çš„0<br />
// å¿…é¡»ç”¨bytesPerRowä¸€è¡Œä¸€è¡Œè¯»</p>
<p>â€‹<br />
Q4ï¼š32ä½BMPå‘¢ï¼Ÿ<br />
Aï¼š åŸç†ä¸€æ ·ï¼Œæ¯åƒç´ 4å­—èŠ‚ï¼ˆBGRAï¼‰ï¼Œäº¤æ¢æˆRGBAã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glTexImage2D</span>(..., GL_RGBA, ...);<br></code></pre></td></tr></table></figure>
<h4 id="bmpåŸç‚¹ä¸é«˜åº¦å­—æ®µ"><a href="#bmpåŸç‚¹ä¸é«˜åº¦å­—æ®µ" class="headerlink" title="bmpåŸç‚¹ä¸é«˜åº¦å­—æ®µ"></a><a class="markdownIt-Anchor" href="#bmpåŸç‚¹ä¸é«˜åº¦å­—æ®µ"></a> BMPåŸç‚¹ä¸é«˜åº¦å­—æ®µ</h4>
<p>BMPæ–‡ä»¶å­˜å‚¨æœ¬è´¨<br />
BMPæ–‡ä»¶é‡Œåªæœ‰äºŒè¿›åˆ¶ï¼Œæ²¡æœ‰â€œè´Ÿå·â€<br />
æ–‡ä»¶åç§»  å­˜å‚¨çš„4å­—èŠ‚    è§£é‡Šä¸ºint    å«ä¹‰<br />
22-25   02 00 00 00   +2      é«˜åº¦2ï¼Œä»ä¸‹å¾€ä¸Šå­˜<br />
22-25   FE FF FF FF   -2      é«˜åº¦2ï¼Œä»ä¸Šå¾€ä¸‹å­˜<br />
è´Ÿå·ä¸å­˜åœ¨æ–‡ä»¶é‡Œï¼Œæ˜¯ä½ ç”¨æœ‰ç¬¦å·intè¯»å‡ºæ¥çš„ã€‚<br />
ä¸¤ä¸ªè¿‡ç¨‹ï¼ŒåŒä¸€å­—æ®µ<br />
1ï¸âƒ£ å­˜æ–‡ä»¶æ—¶ï¼ˆåˆ«äººå†™BMPï¼‰<br />
é«˜åº¦å€¼ åƒç´ é¡ºåº æ–‡ä»¶ç¬¬ä¸€è¡Œæ˜¯<br />
æ­£æ•° ä¸‹â†’ä¸Š åº•éƒ¨<br />
è´Ÿæ•° ä¸Šâ†’ä¸‹ é¡¶éƒ¨<br />
2ï¸âƒ£ è¯»æ–‡ä»¶æ—¶ï¼ˆä½ å†™loadBMPï¼‰<br />
è¯»åˆ°çš„é«˜åº¦ å«ä¹‰ ä½ éœ€è¦<br />
æ­£æ•° æ–‡ä»¶æ˜¯ä¸‹â†’ä¸Š ç¿»è½¬ï¼ˆå€’åºï¼‰<br />
è´Ÿæ•° æ–‡ä»¶æ˜¯ä¸Šâ†’ä¸‹ ä¸ç¿»è½¬ï¼ˆç›´æ¥æ”¾ï¼‰</p>
<h3 id="tga"><a href="#tga" class="headerlink" title="tga"></a><a class="markdownIt-Anchor" href="#tga"></a> TGA</h3>
<h4 id="tgaæ˜¯ä»€ä¹ˆ"><a href="#tgaæ˜¯ä»€ä¹ˆ" class="headerlink" title="tgaæ˜¯ä»€ä¹ˆ"></a><a class="markdownIt-Anchor" href="#tgaæ˜¯ä»€ä¹ˆ"></a> TGAæ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p>TGA = Truevision Graphics Adapter = å¡”åŠ æ ¼å¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">âœ… å¯ä»¥å‹ç¼©ï¼ˆRLEæ¸¸ç¨‹ç¼–ç ï¼‰<br>âœ… æ”¯æŒé€æ˜é€šé“ï¼ˆAlphaï¼‰<br>âœ… OpenGLæ•™ææœ€çˆ±<br>âœ… ç»“æ„æ¯”BMPä¹±ï¼Œä½†ä¾ç„¶ç®€å•<br>âŒ ç°ä»£åº”ç”¨å°‘ï¼ˆè¢«PNGå–ä»£ï¼‰<br>âŒ å­—èŠ‚åºæ··ä¹±ï¼ˆå…¨æ˜¯å°ç«¯ï¼‰<br></code></pre></td></tr></table></figure>
<hr />
<h4 id="æ–‡ä»¶ç»“æ„æ¯”bmpä¹±å¤šäº†"><a href="#æ–‡ä»¶ç»“æ„æ¯”bmpä¹±å¤šäº†" class="headerlink" title="æ–‡ä»¶ç»“æ„æ¯”bmpä¹±å¤šäº†"></a><a class="markdownIt-Anchor" href="#æ–‡ä»¶ç»“æ„æ¯”bmpä¹±å¤šäº†"></a> æ–‡ä»¶ç»“æ„ï¼ˆæ¯”BMPä¹±å¤šäº†ï¼‰</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">TGAæ–‡ä»¶<br>â”œâ”€â”€ æ–‡ä»¶å¤´ (18å­—èŠ‚) â€” åˆå°åˆä¹±<br>â”œâ”€â”€ å›¾åƒID (å¯é€‰)   â€” æè¿°ä¿¡æ¯<br>â”œâ”€â”€ è°ƒè‰²æ¿ (å¯é€‰)   â€” ç´¢å¼•é¢œè‰²<br>â””â”€â”€ åƒç´ æ•°æ®        â€” å¯èƒ½å‹ç¼©ï¼<br></code></pre></td></tr></table></figure>
<p>2.1 æ–‡ä»¶å¤´ï¼ˆ18å­—èŠ‚ï¼Œå…¨å°ç«¯ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack(push, 1)  <span class="hljs-comment">// å¼ºåˆ¶1å­—èŠ‚å¯¹é½ï¼</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-type">char</span> idLength;        <span class="hljs-comment">// å›¾åƒIDé•¿åº¦ (0-255)</span><br>    <span class="hljs-type">char</span> colorMapType;    <span class="hljs-comment">// è°ƒè‰²æ¿ç±»å‹ (0=æ— ï¼Œ1=æœ‰)</span><br>    <span class="hljs-type">char</span> imageType;       <span class="hljs-comment">// å›¾åƒç±»å‹ â­ æœ€é‡è¦ï¼</span><br><br>    <span class="hljs-comment">// è°ƒè‰²æ¿ä¿¡æ¯ï¼ˆå¦‚æœcolorMapType=1ï¼‰</span><br>    <span class="hljs-type">short</span> colorMapOffset; <span class="hljs-comment">// è°ƒè‰²æ¿èµ·å§‹ç´¢å¼•</span><br>    <span class="hljs-type">short</span> colorMapLength; <span class="hljs-comment">// è°ƒè‰²æ¿é¢œè‰²æ•°</span><br>    <span class="hljs-type">char</span> colorMapBits;    <span class="hljs-comment">// è°ƒè‰²æ¿ä½æ·±(16/24/32)</span><br><br>    <span class="hljs-comment">// å›¾åƒä¿¡æ¯</span><br>    <span class="hljs-type">short</span> xOrigin;        <span class="hljs-comment">// Xèµ·ç‚¹ï¼ˆé€šå¸¸0ï¼‰</span><br>    <span class="hljs-type">short</span> yOrigin;        <span class="hljs-comment">// Yèµ·ç‚¹ï¼ˆé€šå¸¸0ï¼‰</span><br>    <span class="hljs-type">short</span> width;          <span class="hljs-comment">// å®½åº¦ â­</span><br>    <span class="hljs-type">short</span> height;         <span class="hljs-comment">// é«˜åº¦ â­</span><br>    <span class="hljs-type">char</span> bitsPerPixel;    <span class="hljs-comment">// ä½æ·± â­ (24/32/8/16)</span><br>    <span class="hljs-type">char</span> descriptor;      <span class="hljs-comment">// æè¿°ç¬¦ â­ Alphaä½æ•° + åŸç‚¹æ–¹å‘</span><br>&#125; TGAHeader;<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> pack(pop)</span><br><br><span class="hljs-comment">// å¤§å°ï¼š1+1+1+2+2+1+2+2+2+2+1+1 = 18å­—èŠ‚</span><br></code></pre></td></tr></table></figure>
<p>2.2 imageTypeï¼ˆæ ¸å¿ƒï¼ï¼‰</p>
<p>å€¼ å«ä¹‰         å‹ç¼©   é¢œè‰²<br />
0 æ— å›¾åƒæ•°æ®      -     -<br />
1 è°ƒè‰²æ¿RGB     ä¸å‹ç¼© ç´¢å¼•è‰²<br />
2 çœŸå½©è‰²RGB     ä¸å‹ç¼© æœ€å¸¸ç”¨<br />
3 ç°åº¦å›¾        ä¸å‹ç¼© é»‘ç™½<br />
9 è°ƒè‰²æ¿RGB    RLEå‹ç¼© ç´¢å¼•è‰²<br />
10 çœŸå½©è‰²RGB   RLEå‹ç¼© ä¹Ÿå¾ˆå¸¸ç”¨<br />
11 ç°åº¦å›¾      RLEå‹ç¼© é»‘ç™½</p>
<hr />
<h4 id="ä¸å‹ç¼©tgatype-2æœ€ç®€å•"><a href="#ä¸å‹ç¼©tgatype-2æœ€ç®€å•" class="headerlink" title="ä¸å‹ç¼©tgatype-2æœ€ç®€å•"></a><a class="markdownIt-Anchor" href="#ä¸å‹ç¼©tgatype-2æœ€ç®€å•"></a> ä¸å‹ç¼©TGAï¼ˆType 2ï¼Œæœ€ç®€å•ï¼‰</h4>
<p>3.1 åƒç´ æ•°æ®å¸ƒå±€</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 24ä½RGBï¼šBGRé¡ºåºï¼ˆå’ŒBMPä¸€æ ·ï¼ï¼‰</span><br>[B] [G] [R]  [B] [G] [R] ...<br><br><span class="hljs-comment">// 32ä½RGBAï¼šBGRAé¡ºåº</span><br>[B] [G] [R] [A]  [B] [G] [R] [A] ...<br><br><span class="hljs-comment">// 16ä½RGBï¼šRGB 5:6:5ï¼ˆå°‘ç”¨ï¼‰</span><br><span class="hljs-comment">// 8ä½ç°åº¦ï¼šå•å­—èŠ‚</span><br></code></pre></td></tr></table></figure>
<p>3.2 åŸç‚¹æ–¹å‘ï¼ˆdescriptorä½5ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp">descriptor &amp; <span class="hljs-number">0x20</span>  <span class="hljs-comment">// ç¬¬5ä½ï¼ˆä»0å¼€å§‹ï¼‰</span><br><br><span class="hljs-comment">// 0 = å·¦ä¸‹åŸç‚¹ï¼ˆå’ŒBMPä¸€æ ·ï¼‰</span><br><span class="hljs-comment">// 1 = å·¦ä¸ŠåŸç‚¹ï¼ˆå’ŒPNGä¸€æ ·ï¼‰</span><br><br><span class="hljs-comment">// è¯»å–æ—¶å¤„ç†ï¼š</span><br><span class="hljs-type">bool</span> topLeft = (header.descriptor &amp; <span class="hljs-number">0x20</span>) != <span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span> (topLeft) &#123;<br>    <span class="hljs-comment">// éœ€è¦ç¿»è½¬Yï¼</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>3.3 Alphaä½æ•°ï¼ˆdescriptorä½4ä½ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> alphaBits = header.descriptor &amp; <span class="hljs-number">0x0F</span>;<br><span class="hljs-comment">// 24ä½å›¾ï¼šalphaBits = 0</span><br><span class="hljs-comment">// 32ä½å›¾ï¼šalphaBits = 8</span><br></code></pre></td></tr></table></figure>
<hr />
<h4 id="ä¸å‹ç¼©tgaè¯»å–ä»£ç type-2"><a href="#ä¸å‹ç¼©tgaè¯»å–ä»£ç type-2" class="headerlink" title="ä¸å‹ç¼©tgaè¯»å–ä»£ç type-2"></a><a class="markdownIt-Anchor" href="#ä¸å‹ç¼©tgaè¯»å–ä»£ç type-2"></a> ä¸å‹ç¼©TGAè¯»å–ä»£ç ï¼ˆType 2ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* <span class="hljs-title">loadUncompressedTGA</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* path, <span class="hljs-type">int</span>&amp; width, <span class="hljs-type">int</span>&amp; height, <span class="hljs-type">int</span>&amp; channels)</span> </span>&#123;<br>    FILE* file = <span class="hljs-built_in">fopen</span>(path, <span class="hljs-string">&quot;rb&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!file) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br><br>    <span class="hljs-comment">// 1. è¯»å¤´</span><br>    TGAHeader header;<br>    <span class="hljs-built_in">fread</span>(&amp;header, <span class="hljs-number">18</span>, <span class="hljs-number">1</span>, file);<br><br>    <span class="hljs-comment">// 2. åªå¤„ç†Type 2</span><br>    <span class="hljs-keyword">if</span> (header.imageType != <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-built_in">fclose</span>(file);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// 3. è·³è¿‡å›¾åƒIDï¼ˆå¦‚æœæœ‰ï¼‰</span><br>    <span class="hljs-keyword">if</span> (header.idLength &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">fseek</span>(file, header.idLength, SEEK_CUR);<br>    &#125;<br><br>    <span class="hljs-comment">// 4. è·³è¿‡è°ƒè‰²æ¿ï¼ˆå¦‚æœæœ‰ï¼‰</span><br>    <span class="hljs-keyword">if</span> (header.colorMapType == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-type">int</span> paletteSize = header.colorMapLength * (header.colorMapBits / <span class="hljs-number">8</span>);<br>        <span class="hljs-built_in">fseek</span>(file, paletteSize, SEEK_CUR);<br>    &#125;<br><br>    <span class="hljs-comment">// 5. è·å–å›¾åƒä¿¡æ¯</span><br>    width = header.width;<br>    height = header.height;<br>    channels = header.bitsPerPixel / <span class="hljs-number">8</span>;  <span class="hljs-comment">// 3æˆ–4</span><br><br>    <span class="hljs-comment">// 6. è¯»åƒç´ æ•°æ®</span><br>    <span class="hljs-type">int</span> dataSize = width * height * channels;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* data = <span class="hljs-keyword">new</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>[dataSize];<br>    <span class="hljs-built_in">fread</span>(data, dataSize, <span class="hljs-number">1</span>, file);<br>    <span class="hljs-built_in">fclose</span>(file);<br><br>    <span class="hljs-comment">// 7. BGR â†’ RGBï¼ˆOpenGLéœ€è¦ï¼‰</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; dataSize; i += channels) &#123;<br>        std::<span class="hljs-built_in">swap</span>(data[i], data[i + <span class="hljs-number">2</span>]);  <span class="hljs-comment">// B â†” R</span><br>    &#125;<br><br>    <span class="hljs-comment">// 8. å¤„ç†åŸç‚¹ï¼ˆTGAå¯èƒ½æ˜¯å·¦ä¸Šè§’ï¼‰</span><br>    <span class="hljs-type">bool</span> topLeft = (header.descriptor &amp; <span class="hljs-number">0x20</span>) != <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (topLeft) &#123;<br>        <span class="hljs-comment">// ç¿»è½¬Yè½´</span><br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* flipped = <span class="hljs-keyword">new</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>[dataSize];<br>        <span class="hljs-type">int</span> rowSize = width * channels;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) &#123;<br>            <span class="hljs-built_in">memcpy</span>(flipped + (height - <span class="hljs-number">1</span> - y) * rowSize,<br>                   data + y * rowSize,<br>                   rowSize);<br>        &#125;<br>        <span class="hljs-keyword">delete</span>[] data;<br>        data = flipped;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> data;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<hr />
<h4 id="rleå‹ç¼©tgatype-10é‡ç‚¹"><a href="#rleå‹ç¼©tgatype-10é‡ç‚¹" class="headerlink" title="rleå‹ç¼©tgatype-10é‡ç‚¹"></a><a class="markdownIt-Anchor" href="#rleå‹ç¼©tgatype-10é‡ç‚¹"></a> RLEå‹ç¼©TGAï¼ˆType 10ï¼Œé‡ç‚¹ï¼ï¼‰</h4>
<p>5.1 RLEåŸç†ï¼ˆæ¸¸ç¨‹ç¼–ç ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è¿ç»­ç›¸åŒçš„é¢œè‰² â†’ æ‰“åŒ…æˆ [æ ‡è®°][é¢œè‰²]</span><br><br><span class="hljs-comment">// åŸå§‹æ•°æ®ï¼š</span><br>[FF][FF][FF][<span class="hljs-number">00</span>][<span class="hljs-number">11</span>][<span class="hljs-number">22</span>][<span class="hljs-number">33</span>][<span class="hljs-number">44</span>][<span class="hljs-number">55</span>]...<br> è“   è“  è“   çº¢  ç»¿  è“   çº¢  ç»¿  è“ ...<br><br><span class="hljs-comment">// RLEå‹ç¼©åï¼š</span><br>[<span class="hljs-number">0x83</span>][FF]        <span class="hljs-comment">// 3ä¸ªè“è‰² (0x83 = 0x80 | 3)</span><br>[<span class="hljs-number">0x01</span>][<span class="hljs-number">00</span>]        <span class="hljs-comment">// 1ä¸ªçº¢è‰²</span><br>[<span class="hljs-number">0x05</span>][<span class="hljs-number">11</span>][<span class="hljs-number">22</span>][<span class="hljs-number">33</span>][<span class="hljs-number">44</span>][<span class="hljs-number">55</span>]  <span class="hljs-comment">// 5ä¸ªä¸é‡å¤</span><br>  â†‘                 â†‘<br> <span class="hljs-number">0x80</span><span class="hljs-number">+1</span>=<span class="hljs-number">0x81</span>?      ä¸å¯¹ï¼Œä»”ç»†çœ‹ï¼<br></code></pre></td></tr></table></figure>
<p>5.2 TGAçš„RLEåŒ…æ ¼å¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp">æ¯ä¸ªåŒ… = <span class="hljs-number">1</span>å­—èŠ‚æ ‡è®° + nå­—èŠ‚æ•°æ®<br><br>æ ‡è®°å­—èŠ‚ï¼š<br>bit7 = <span class="hljs-number">1</span> â†’ é‡å¤åŒ… (Run-length packet)<br>        â†“<br>   [<span class="hljs-number">1</span>][è®¡æ•°]  <span class="hljs-comment">// è®¡æ•° = ä½7ä½ + 1</span><br><br>bit7 = <span class="hljs-number">0</span> â†’ åŸå§‹åŒ… (Raw packet)<br>        â†“<br>   [<span class="hljs-number">0</span>][è®¡æ•°]  <span class="hljs-comment">// è®¡æ•° = ä½7ä½ + 1</span><br></code></pre></td></tr></table></figure>
<p>5.3 è§£å‹ç®—æ³•</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* <span class="hljs-title">decodeRLETGA</span><span class="hljs-params">(FILE* file, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height, <span class="hljs-type">int</span> channels)</span> </span>&#123;<br>    <span class="hljs-type">int</span> pixelCount = width * height;<br>    <span class="hljs-type">int</span> dataSize = pixelCount * channels;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* data = <span class="hljs-keyword">new</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>[dataSize];<br><br>    <span class="hljs-type">int</span> currentPixel = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> packetHeader;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> pixel[<span class="hljs-number">4</span>];  <span class="hljs-comment">// æœ€å¤šBGRA</span><br><br>    <span class="hljs-keyword">while</span> (currentPixel &lt; pixelCount) &#123;<br>        <span class="hljs-comment">// 1. è¯»åŒ…æ ‡è®°</span><br>        <span class="hljs-built_in">fread</span>(&amp;packetHeader, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, file);<br>        <span class="hljs-type">int</span> count = (packetHeader &amp; <span class="hljs-number">0x7F</span>) + <span class="hljs-number">1</span>;  <span class="hljs-comment">// ä½7ä½+1</span><br><br>        <span class="hljs-keyword">if</span> (packetHeader &amp; <span class="hljs-number">0x80</span>) &#123;  <span class="hljs-comment">// é‡å¤åŒ…</span><br>            <span class="hljs-comment">// è¯»ä¸€ä¸ªåƒç´ ï¼Œé‡å¤countæ¬¡</span><br>            <span class="hljs-built_in">fread</span>(pixel, channels, <span class="hljs-number">1</span>, file);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; count &amp;&amp; currentPixel &lt; pixelCount; i++) &#123;<br>                <span class="hljs-built_in">memcpy</span>(data + currentPixel * channels, pixel, channels);<br>                currentPixel++;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;  <span class="hljs-comment">// åŸå§‹åŒ…</span><br>            <span class="hljs-comment">// è¯»countä¸ªåƒç´ ï¼Œç›´æ¥å¤åˆ¶</span><br>            <span class="hljs-built_in">fread</span>(data + currentPixel * channels, channels, count, file);<br>            currentPixel += count;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> data;<br>&#125;<br></code></pre></td></tr></table></figure>
<hr />
<h4 id="å®Œæ•´tgaåŠ è½½å™¨æ”¯æŒtype-2å’Œ10"><a href="#å®Œæ•´tgaåŠ è½½å™¨æ”¯æŒtype-2å’Œ10" class="headerlink" title="å®Œæ•´tgaåŠ è½½å™¨æ”¯æŒtype-2å’Œ10"></a><a class="markdownIt-Anchor" href="#å®Œæ•´tgaåŠ è½½å™¨æ”¯æŒtype-2å’Œ10"></a> å®Œæ•´TGAåŠ è½½å™¨ï¼ˆæ”¯æŒType 2å’Œ10ï¼‰</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* <span class="hljs-title">loadTGA</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* path, <span class="hljs-type">int</span>&amp; width, <span class="hljs-type">int</span>&amp; height, <span class="hljs-type">int</span>&amp; channels)</span> </span>&#123;<br>    FILE* file = <span class="hljs-built_in">fopen</span>(path, <span class="hljs-string">&quot;rb&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!file) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br><br>    <span class="hljs-comment">// è¯»å¤´</span><br>    TGAHeader header;<br>    <span class="hljs-built_in">fread</span>(&amp;header, <span class="hljs-number">18</span>, <span class="hljs-number">1</span>, file);<br><br>    <span class="hljs-comment">// åªæ”¯æŒçœŸå½©è‰²</span><br>    <span class="hljs-keyword">if</span> (header.imageType != <span class="hljs-number">2</span> &amp;&amp; header.imageType != <span class="hljs-number">10</span>) &#123;<br>        <span class="hljs-built_in">fclose</span>(file);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// è·³è¿‡å›¾åƒID</span><br>    <span class="hljs-keyword">if</span> (header.idLength &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">fseek</span>(file, header.idLength, SEEK_CUR);<br>    &#125;<br><br>    <span class="hljs-comment">// è·³è¿‡è°ƒè‰²æ¿ï¼ˆæˆ‘ä»¬ä¸ç”¨ï¼‰</span><br>    <span class="hljs-keyword">if</span> (header.colorMapType == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-type">int</span> paletteSize = header.colorMapLength * (header.colorMapBits / <span class="hljs-number">8</span>);<br>        <span class="hljs-built_in">fseek</span>(file, paletteSize, SEEK_CUR);<br>    &#125;<br><br>    width = header.width;<br>    height = header.height;<br>    channels = header.bitsPerPixel / <span class="hljs-number">8</span>;<br><br>    <span class="hljs-comment">// è§£å‹/è¯»å–åƒç´ </span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* data;<br>    <span class="hljs-keyword">if</span> (header.imageType == <span class="hljs-number">10</span>) &#123;  <span class="hljs-comment">// RLEå‹ç¼©</span><br>        data = <span class="hljs-built_in">decodeRLETGA</span>(file, width, height, channels);<br>    &#125; <span class="hljs-keyword">else</span> &#123;  <span class="hljs-comment">// ä¸å‹ç¼©</span><br>        <span class="hljs-type">int</span> dataSize = width * height * channels;<br>        data = <span class="hljs-keyword">new</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>[dataSize];<br>        <span class="hljs-built_in">fread</span>(data, dataSize, <span class="hljs-number">1</span>, file);<br>    &#125;<br>    <span class="hljs-built_in">fclose</span>(file);<br><br>    <span class="hljs-comment">// BGR â†’ RGB</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; width * height * channels; i += channels) &#123;<br>        std::<span class="hljs-built_in">swap</span>(data[i], data[i + <span class="hljs-number">2</span>]);<br>    &#125;<br><br>    <span class="hljs-comment">// å¤„ç†åŸç‚¹</span><br>    <span class="hljs-type">bool</span> topLeft = (header.descriptor &amp; <span class="hljs-number">0x20</span>) != <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (topLeft) &#123;<br>        <span class="hljs-type">int</span> rowSize = width * channels;<br>        <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* flipped = <span class="hljs-keyword">new</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>[width * height * channels];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) &#123;<br>            <span class="hljs-built_in">memcpy</span>(flipped + (height - <span class="hljs-number">1</span> - y) * rowSize,<br>                   data + y * rowSize,<br>                   rowSize);<br>        &#125;<br>        <span class="hljs-keyword">delete</span>[] data;<br>        data = flipped;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> data;<br>&#125;<br></code></pre></td></tr></table></figure>
<hr />
<p>ä¸ƒã€OpenGLä¸­ä½¿ç”¨</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> w, h, channels;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* data = <span class="hljs-built_in">loadTGA</span>(<span class="hljs-string">&quot;earth.tga&quot;</span>, w, h, channels);<br><br>GLenum format = (channels == <span class="hljs-number">4</span>) ? GL_RGBA : GL_RGB;<br><span class="hljs-built_in">glTexImage2D</span>(GL_TEXTURE_2D, <span class="hljs-number">0</span>, format, w, h, <span class="hljs-number">0</span>, format, GL_UNSIGNED_BYTE, data);<br><br><span class="hljs-keyword">delete</span>[] data;<br></code></pre></td></tr></table></figure>
<h3 id="jpg"><a href="#jpg" class="headerlink" title="jpg"></a><a class="markdownIt-Anchor" href="#jpg"></a> JPG</h3>
<h4 id="jpgæ˜¯ä»€ä¹ˆ"><a href="#jpgæ˜¯ä»€ä¹ˆ" class="headerlink" title="jpgæ˜¯ä»€ä¹ˆ"></a><a class="markdownIt-Anchor" href="#jpgæ˜¯ä»€ä¹ˆ"></a> JPGæ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p>JPG = JPEG = Joint Photographic Experts Group = è”åˆå›¾åƒä¸“å®¶ç»„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">âœ… å‹ç¼©ç‡æé«˜ï¼ˆç…§ç‰‡10:1 ~ 20:1ï¼‰<br>âœ… äº’è”ç½‘äº‹å®æ ‡å‡†<br>âœ… 24ä½çœŸå½©è‰²<br>âŒ **æœ‰æŸå‹ç¼©**ï¼ˆè§£å‹åâ‰ åŸå›¾ï¼‰<br>âŒ **æå…¶å¤æ‚**ï¼ˆåƒä¸‡åˆ«è‡ªå·±å†™ï¼ï¼‰<br>âŒ ä¸æ”¯æŒé€æ˜é€šé“<br>âŒ è¾¹ç¼˜æœ‰é¬¼å½±ï¼ˆæŒ¯é“ƒæ•ˆåº”ï¼‰<br><br></code></pre></td></tr></table></figure>
<hr />
<h4 id="jpgçš„æ ¸å¿ƒå“²å­¦"><a href="#jpgçš„æ ¸å¿ƒå“²å­¦" class="headerlink" title="jpgçš„æ ¸å¿ƒå“²å­¦"></a><a class="markdownIt-Anchor" href="#jpgçš„æ ¸å¿ƒå“²å­¦"></a> JPGçš„æ ¸å¿ƒå“²å­¦</h4>
<p>2.1 äººçœ¼ç‰¹æ€§ï¼ˆJPGçš„ä½œå¼Šä¾æ®ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">äººçœ¼å¯¹äº®åº¦æ•æ„Ÿï¼Œå¯¹é¢œè‰²ä¸æ•æ„Ÿ<br>äººçœ¼å¯¹ä½é¢‘æ•æ„Ÿï¼Œå¯¹é«˜é¢‘ä¸æ•æ„Ÿ<br>äººçœ¼å¯¹å¹³æ»‘æ•æ„Ÿï¼Œå¯¹å™ªç‚¹ä¸æ•æ„Ÿ<br><br>â†’ ä¸¢æ‰äººçœ¼çœ‹ä¸æ¸…çš„æ•°æ®ï¼<br>â†’ ä¸¢æ‰äººçœ¼ä¸åœ¨æ„çš„æ•°æ®ï¼<br><br></code></pre></td></tr></table></figure>
<p>2.2 JPGå‹ç¼©æµç¨‹ï¼ˆ5æ­¥ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">RGBå›¾ç‰‡<br>    â†“ â‘  é¢œè‰²ç©ºé—´è½¬æ¢<br>YCbCrï¼ˆäº®åº¦+è‰²åº¦ï¼‰<br>    â†“ â‘¡ ä¸‹é‡‡æ ·ï¼ˆä¸¢æ‰è‰²åº¦ï¼‰<br>4:4:4 â†’ 4:2:0ï¼ˆè‰²åº¦å‡åŠï¼‰<br>    â†“ â‘¢ DCTå˜æ¢ï¼ˆæ—¶ç©ºâ†’é¢‘ç‡ï¼‰<br>8x8ç³»æ•°å—<br>    â†“ â‘£ é‡åŒ–ï¼ˆä¸¢æ‰é«˜é¢‘ï¼‰<br>é™¤ä»¥é‡åŒ–è¡¨â†’å–æ•´<br>    â†“ â‘¤ å“ˆå¤«æ›¼ç¼–ç ï¼ˆæ— æŸå‹ç¼©ï¼‰<br>JPEGæ–‡ä»¶<br><br></code></pre></td></tr></table></figure>
<hr />
<h4 id="ç¬¬1æ­¥é¢œè‰²ç©ºé—´è½¬æ¢"><a href="#ç¬¬1æ­¥é¢œè‰²ç©ºé—´è½¬æ¢" class="headerlink" title="ç¬¬1æ­¥é¢œè‰²ç©ºé—´è½¬æ¢"></a><a class="markdownIt-Anchor" href="#ç¬¬1æ­¥é¢œè‰²ç©ºé—´è½¬æ¢"></a> ç¬¬1æ­¥ï¼šé¢œè‰²ç©ºé—´è½¬æ¢</h4>
<p>3.1 RGB â†’ YCbCr</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// RGBè½¬äº®åº¦+è‰²åº¦</span><br>Y  =  <span class="hljs-number">0.299</span> * R + <span class="hljs-number">0.587</span> * G + <span class="hljs-number">0.114</span> * B<br>Cb = <span class="hljs-number">-0.169</span> * R - <span class="hljs-number">0.331</span> * G + <span class="hljs-number">0.500</span> * B + <span class="hljs-number">128</span><br>Cr =  <span class="hljs-number">0.500</span> * R - <span class="hljs-number">0.419</span> * G - <span class="hljs-number">0.081</span> * B + <span class="hljs-number">128</span><br><br><span class="hljs-comment">// YCbCr â†’ RGBï¼ˆè§£ç ç”¨ï¼‰</span><br>R = Y + <span class="hljs-number">1.402</span> * (Cr - <span class="hljs-number">128</span>)<br>G = Y - <span class="hljs-number">0.344</span> * (Cb - <span class="hljs-number">128</span>) - <span class="hljs-number">0.714</span> * (Cr - <span class="hljs-number">128</span>)<br>B = Y + <span class="hljs-number">1.772</span> * (Cb - <span class="hljs-number">128</span>)<br><br></code></pre></td></tr></table></figure>
<p>ä¸ºä»€ä¹ˆï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Yï¼ˆäº®åº¦ï¼‰â†’ äººçœ¼æ•æ„Ÿ â†’ ä¿ç•™å…¨éƒ¨ç»†èŠ‚<br>Cb/Crï¼ˆè‰²åº¦ï¼‰â†’ äººçœ¼ä¸æ•æ„Ÿ â†’ å¯ä»¥å‹ç¼©<br><br></code></pre></td></tr></table></figure>
<hr />
<h4 id="ç¬¬2æ­¥ä¸‹é‡‡æ ·è‰²åº¦å‹ç¼©"><a href="#ç¬¬2æ­¥ä¸‹é‡‡æ ·è‰²åº¦å‹ç¼©" class="headerlink" title="ç¬¬2æ­¥ä¸‹é‡‡æ ·è‰²åº¦å‹ç¼©"></a><a class="markdownIt-Anchor" href="#ç¬¬2æ­¥ä¸‹é‡‡æ ·è‰²åº¦å‹ç¼©"></a> ç¬¬2æ­¥ï¼šä¸‹é‡‡æ ·ï¼ˆè‰²åº¦å‹ç¼©ï¼‰</h4>
<p>4.1 é‡‡æ ·æ ¼å¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">4:4:4 â†’ ä¸å‹ç¼©ï¼Œæ¯ä¸ªåƒç´ éƒ½æœ‰Y,Cb,Cr<br>4:2:2 â†’ æ°´å¹³å‡åŠï¼Œæ¯2ä¸ªåƒç´ å…±äº«Cb,Cr<br>4:2:0 â†’ æ°´å¹³å‚ç›´éƒ½å‡åŠï¼Œæ¯4ä¸ªåƒç´ å…±äº«Cb,Cr â­æœ€å¸¸ç”¨<br>4:1:1 â†’ æ°´å¹³1/4<br><br></code></pre></td></tr></table></figure>
<p>4.2 4:2:0 ç¤ºæ„å›¾</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">åƒç´ çŸ©é˜µï¼š         Yåˆ†é‡ï¼šå®Œæ•´       Cb/Cråˆ†é‡ï¼š1/4<br>[Y][Y][Y][Y]      [Y][Y][Y][Y]      [Cb][ ][ ][ ]<br>[Y][Y][Y][Y]      [Y][Y][Y][Y]      [ ][ ][ ][ ]<br>[Y][Y][Y][Y]  â†’   [Y][Y][Y][Y]  â†’   [ ][ ][ ][ ]<br>[Y][Y][Y][Y]      [Y][Y][Y][Y]      [ ][ ][ ][ ]<br><br>æ¯4ä¸ªYå…±äº«1ä¸ªCbå’Œ1ä¸ªCr â†’ æ•°æ®é‡å‡åŠï¼<br><br></code></pre></td></tr></table></figure>
<hr />
<h4 id="ç¬¬3æ­¥dctå˜æ¢æ ¸å¿ƒéš¾ç‚¹"><a href="#ç¬¬3æ­¥dctå˜æ¢æ ¸å¿ƒéš¾ç‚¹" class="headerlink" title="ç¬¬3æ­¥dctå˜æ¢æ ¸å¿ƒéš¾ç‚¹"></a><a class="markdownIt-Anchor" href="#ç¬¬3æ­¥dctå˜æ¢æ ¸å¿ƒéš¾ç‚¹"></a> ç¬¬3æ­¥ï¼šDCTå˜æ¢ï¼ˆæ ¸å¿ƒéš¾ç‚¹ï¼‰</h4>
<p>5.1 ä»€ä¹ˆæ˜¯DCTï¼Ÿ</p>
<p>DCT = ç¦»æ•£ä½™å¼¦å˜æ¢ = æŠŠ8x8åƒç´ å—å˜æˆ8x8é¢‘ç‡ç³»æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ç©ºé—´åŸŸï¼ˆåƒç´ å€¼ï¼‰ï¼š         é¢‘ç‡åŸŸï¼ˆDCTç³»æ•°ï¼‰ï¼š<br>[89 78 76 ...]           [2350 123 -45 ...]<br>[90 77 75 ...]    â†’      [67   -12  8  ...]<br>[88 79 77 ...]           [-23   5  -2  ...]<br>[...]                    [...]<br><br>ä½é¢‘ï¼ˆå·¦ä¸Šè§’ï¼‰â†’ äº®åº¦å˜åŒ–å¹³ç¼“çš„åŒºåŸŸ<br>é«˜é¢‘ï¼ˆå³ä¸‹è§’ï¼‰â†’ è¾¹ç¼˜ã€çº¹ç†ã€å™ªç‚¹<br><br></code></pre></td></tr></table></figure>
<p>5.2 DCTå…¬å¼ï¼ˆçœ‹çœ‹å°±å¥½ï¼Œåˆ«èƒŒï¼ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ­£å‘DCTï¼ˆ8x8ï¼‰</span><br><span class="hljs-built_in">F</span>(u,v) = <span class="hljs-number">1</span>/<span class="hljs-number">4</span> * <span class="hljs-built_in">C</span>(u) * <span class="hljs-built_in">C</span>(v) *<br>         Î£Î£ <span class="hljs-built_in">f</span>(x,y) * <span class="hljs-built_in">cos</span>((<span class="hljs-number">2</span>x<span class="hljs-number">+1</span>)uÏ€/<span class="hljs-number">16</span>) * <span class="hljs-built_in">cos</span>((<span class="hljs-number">2</span>y<span class="hljs-number">+1</span>)vÏ€/<span class="hljs-number">16</span>)<br><br><span class="hljs-comment">// åå‘DCTï¼ˆè§£ç ç”¨ï¼‰</span><br><span class="hljs-built_in">f</span>(x,y) = <span class="hljs-number">1</span>/<span class="hljs-number">4</span> * Î£Î£ <span class="hljs-built_in">C</span>(u) * <span class="hljs-built_in">C</span>(v) *<br>         <span class="hljs-built_in">F</span>(u,v) * <span class="hljs-built_in">cos</span>((<span class="hljs-number">2</span>x<span class="hljs-number">+1</span>)uÏ€/<span class="hljs-number">16</span>) * <span class="hljs-built_in">cos</span>((<span class="hljs-number">2</span>y<span class="hljs-number">+1</span>)vÏ€/<span class="hljs-number">16</span>)<br><br><span class="hljs-comment">// C(u) = 1/âˆš2 å½“u=0ï¼Œå¦åˆ™ = 1</span><br><br></code></pre></td></tr></table></figure>
<p>5.3 ç›´è§‚ç†è§£</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 8x8çš„DCTåŸºå‡½æ•°ï¼ˆå¯è§†åŒ–ï¼‰</span><br>u=<span class="hljs-number">0</span>,v=<span class="hljs-number">0</span>: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â†’ ç›´æµåˆ†é‡ï¼ˆå¹³å‡äº®åº¦ï¼‰<br>u=<span class="hljs-number">1</span>,v=<span class="hljs-number">0</span>: â–†â–†â–‡â–‡â–ˆâ–ˆâ–ˆâ–ˆ  â†’ æ°´å¹³æ¸å˜<br>u=<span class="hljs-number">0</span>,v=<span class="hljs-number">1</span>: â–†â–‡â–ˆâ–‡â–†â–…â–„â–ƒ  â†’ å‚ç›´æ¸å˜<br>u=<span class="hljs-number">1</span>,v=<span class="hljs-number">1</span>: â–…â–†â–‡â–ˆâ–‡â–†â–…â–„  â†’ å¯¹è§’çº¿æ¸å˜<br>... è¶Šå¾€åè¶Šé«˜é¢‘<br><br></code></pre></td></tr></table></figure>
<hr />
<h4 id="ç¬¬4æ­¥é‡åŒ–ä¸¢æ‰æ•°æ®"><a href="#ç¬¬4æ­¥é‡åŒ–ä¸¢æ‰æ•°æ®" class="headerlink" title="ç¬¬4æ­¥é‡åŒ–ä¸¢æ‰æ•°æ®"></a><a class="markdownIt-Anchor" href="#ç¬¬4æ­¥é‡åŒ–ä¸¢æ‰æ•°æ®"></a> ç¬¬4æ­¥ï¼šé‡åŒ–ï¼ˆä¸¢æ‰æ•°æ®ï¼ï¼‰</h4>
<p>6.1 é‡åŒ–è¡¨</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// äº®åº¦é‡åŒ–è¡¨ï¼ˆJPEGæ ‡å‡†ï¼Œ50%è´¨é‡ï¼‰</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> quant_luminance[<span class="hljs-number">8</span>][<span class="hljs-number">8</span>] = &#123;<br>    &#123;<span class="hljs-number">16</span>, <span class="hljs-number">11</span>, <span class="hljs-number">10</span>, <span class="hljs-number">16</span>, <span class="hljs-number">24</span>, <span class="hljs-number">40</span>, <span class="hljs-number">51</span>, <span class="hljs-number">61</span>&#125;,<br>    &#123;<span class="hljs-number">12</span>, <span class="hljs-number">12</span>, <span class="hljs-number">14</span>, <span class="hljs-number">19</span>, <span class="hljs-number">26</span>, <span class="hljs-number">58</span>, <span class="hljs-number">60</span>, <span class="hljs-number">55</span>&#125;,<br>    &#123;<span class="hljs-number">14</span>, <span class="hljs-number">13</span>, <span class="hljs-number">16</span>, <span class="hljs-number">24</span>, <span class="hljs-number">40</span>, <span class="hljs-number">57</span>, <span class="hljs-number">69</span>, <span class="hljs-number">56</span>&#125;,<br>    &#123;<span class="hljs-number">14</span>, <span class="hljs-number">17</span>, <span class="hljs-number">22</span>, <span class="hljs-number">29</span>, <span class="hljs-number">51</span>, <span class="hljs-number">87</span>, <span class="hljs-number">80</span>, <span class="hljs-number">62</span>&#125;,<br>    &#123;<span class="hljs-number">18</span>, <span class="hljs-number">22</span>, <span class="hljs-number">37</span>, <span class="hljs-number">56</span>, <span class="hljs-number">68</span>, <span class="hljs-number">109</span>, <span class="hljs-number">103</span>, <span class="hljs-number">77</span>&#125;,<br>    &#123;<span class="hljs-number">24</span>, <span class="hljs-number">35</span>, <span class="hljs-number">55</span>, <span class="hljs-number">64</span>, <span class="hljs-number">81</span>, <span class="hljs-number">104</span>, <span class="hljs-number">113</span>, <span class="hljs-number">92</span>&#125;,<br>    &#123;<span class="hljs-number">49</span>, <span class="hljs-number">64</span>, <span class="hljs-number">78</span>, <span class="hljs-number">87</span>, <span class="hljs-number">103</span>, <span class="hljs-number">121</span>, <span class="hljs-number">120</span>, <span class="hljs-number">101</span>&#125;,<br>    &#123;<span class="hljs-number">72</span>, <span class="hljs-number">92</span>, <span class="hljs-number">95</span>, <span class="hljs-number">98</span>, <span class="hljs-number">112</span>, <span class="hljs-number">100</span>, <span class="hljs-number">103</span>, <span class="hljs-number">99</span>&#125;<br>&#125;;<br><br><span class="hljs-comment">// è‰²åº¦é‡åŒ–è¡¨ï¼ˆç³»æ•°æ›´å¤§â†’ä¸¢æ›´å¤šï¼‰</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> quant_chrominance[<span class="hljs-number">8</span>][<span class="hljs-number">8</span>] = &#123;<br>    &#123;<span class="hljs-number">17</span>, <span class="hljs-number">18</span>, <span class="hljs-number">24</span>, <span class="hljs-number">47</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>&#125;,<br>    &#123;<span class="hljs-number">18</span>, <span class="hljs-number">21</span>, <span class="hljs-number">26</span>, <span class="hljs-number">66</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>&#125;,<br>    &#123;<span class="hljs-number">24</span>, <span class="hljs-number">26</span>, <span class="hljs-number">56</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>&#125;,<br>    &#123;<span class="hljs-number">47</span>, <span class="hljs-number">66</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>&#125;,<br>    &#123;<span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>, <span class="hljs-number">99</span>&#125;,<br>    <span class="hljs-comment">// ... å…¨æ˜¯99ï¼Œé«˜é¢‘å…¨ä¸¢ï¼</span><br>&#125;;<br><br></code></pre></td></tr></table></figure>
<p>6.2 é‡åŒ–è¿‡ç¨‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// DCTç³»æ•°çŸ©é˜µ</span><br><span class="hljs-type">float</span> dct[<span class="hljs-number">8</span>][<span class="hljs-number">8</span>] = &#123;<br>    &#123;<span class="hljs-number">2350.5</span>, <span class="hljs-number">123.2</span>, <span class="hljs-number">-45.3</span>, ...&#125;,<br>    &#123;<span class="hljs-number">67.3</span>, <span class="hljs-number">-12.1</span>, <span class="hljs-number">8.7</span>, ...&#125;,<br>    <span class="hljs-comment">// ...</span><br>&#125;;<br><br><span class="hljs-comment">// é‡åŒ–ï¼šç³»æ•° / é‡åŒ–è¡¨ï¼Œç„¶åå–æ•´</span><br><span class="hljs-type">int</span> quantized[<span class="hljs-number">8</span>][<span class="hljs-number">8</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; j++) &#123;<br>        quantized[i][j] = <span class="hljs-built_in">round</span>(dct[i][j] / quant_luminance[i][j]);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ç»“æœï¼šå¾ˆå¤šé«˜é¢‘ç³»æ•°å˜æˆ0ï¼</span><br>[<span class="hljs-number">147</span>][<span class="hljs-number">11</span>][<span class="hljs-number">-5</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>[<span class="hljs-number">6</span>][<span class="hljs-number">-1</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>[<span class="hljs-number">-2</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>... å…¨æ˜¯<span class="hljs-number">0</span><br><br></code></pre></td></tr></table></figure>
<p>6.3 è´¨é‡å‚æ•°ï¼ˆ0-100ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Q = è´¨é‡ï¼ˆè¶Šå°å‹ç¼©è¶Šç‹ ï¼Œç”»è´¨è¶Šå·®ï¼‰</span><br><span class="hljs-keyword">if</span> (Q &lt; <span class="hljs-number">50</span>) &#123;<br>    scale = <span class="hljs-number">5000</span> / Q;   <span class="hljs-comment">// Q=10 â†’ scale=500</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    scale = <span class="hljs-number">200</span> - <span class="hljs-number">2</span>*Q;  <span class="hljs-comment">// Q=90 â†’ scale=20</span><br>&#125;<br><br><span class="hljs-comment">// é‡åŒ–è¡¨ = (æ ‡å‡†è¡¨ * scale + 50) / 100</span><br><span class="hljs-comment">// Q=90: é‡åŒ–è¡¨å‡ ä¹éƒ½æ˜¯1 â†’ è¿‘ä¹æ— æŸ</span><br><span class="hljs-comment">// Q=10: é‡åŒ–è¡¨Ã—50 â†’ å…¨å˜0 â†’ é©¬èµ›å…‹</span><br><br></code></pre></td></tr></table></figure>
<hr />
<h4 id="ç¬¬5æ­¥å“ˆå¤«æ›¼ç¼–ç æ— æŸå‹ç¼©"><a href="#ç¬¬5æ­¥å“ˆå¤«æ›¼ç¼–ç æ— æŸå‹ç¼©" class="headerlink" title="ç¬¬5æ­¥å“ˆå¤«æ›¼ç¼–ç æ— æŸå‹ç¼©"></a><a class="markdownIt-Anchor" href="#ç¬¬5æ­¥å“ˆå¤«æ›¼ç¼–ç æ— æŸå‹ç¼©"></a> ç¬¬5æ­¥ï¼šå“ˆå¤«æ›¼ç¼–ç ï¼ˆæ— æŸå‹ç¼©ï¼‰</h4>
<p>7.1 Zigzagæ‰«æ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æŠŠ8x8çŸ©é˜µå˜æˆ1x64åºåˆ—ï¼Œä½é¢‘åœ¨å‰</span><br><span class="hljs-number">0</span>,<span class="hljs-number">0</span> â†’ <span class="hljs-number">0</span>,<span class="hljs-number">1</span> â†’ <span class="hljs-number">1</span>,<span class="hljs-number">0</span> â†’ <span class="hljs-number">2</span>,<span class="hljs-number">0</span> â†’ <span class="hljs-number">1</span>,<span class="hljs-number">1</span> â†’ <span class="hljs-number">0</span>,<span class="hljs-number">2</span> â†’ ...<br><br><span class="hljs-comment">// ç›®çš„ï¼šè®©è¿ç»­çš„0éƒ½å‡‘åˆ°ä¸€èµ·</span><br>[<span class="hljs-number">147</span>][<span class="hljs-number">11</span>][<span class="hljs-number">6</span>][<span class="hljs-number">-5</span>][<span class="hljs-number">-1</span>][<span class="hljs-number">-2</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]...<br>  â†‘                              â†‘<br>  DCç³»æ•°                         ACç³»æ•°å…¨æ˜¯<span class="hljs-number">0</span><br><br></code></pre></td></tr></table></figure>
<p>7.2 DCç³»æ•°ç¼–ç ï¼ˆå·®åˆ†ç¼–ç ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// å½“å‰å—çš„DCç³»æ•° - ä¸Šä¸€ä¸ªå—çš„DCç³»æ•° = å·®å€¼</span><br><span class="hljs-comment">// å·®å€¼æ›´å° â†’ æ›´çŸ­å“ˆå¤«æ›¼ç </span><br><br><span class="hljs-comment">// ä¾‹ï¼š</span><br>å—<span class="hljs-number">1</span> DC = <span class="hljs-number">147</span> â†’ ç¼–ç  <span class="hljs-number">147</span><br>å—<span class="hljs-number">2</span> DC = <span class="hljs-number">152</span> â†’ å·®å€¼ <span class="hljs-number">+5</span> â†’ ç¼–ç  <span class="hljs-number">5</span><br>å—<span class="hljs-number">3</span> DC = <span class="hljs-number">149</span> â†’ å·®å€¼ <span class="hljs-number">-3</span> â†’ ç¼–ç  <span class="hljs-number">-3</span><br><br></code></pre></td></tr></table></figure>
<p>7.3 ACç³»æ•°ç¼–ç ï¼ˆæ¸¸ç¨‹ç¼–ç ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ ¼å¼ï¼š(è¿ç»­0çš„ä¸ªæ•°, ä¸‹ä¸€ä¸ªé0å€¼)</span><br><br>[<span class="hljs-number">11</span>,<span class="hljs-number">6</span>,<span class="hljs-number">-5</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">-2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,...]<br> â†“<br>(<span class="hljs-number">0</span>,<span class="hljs-number">11</span>) (<span class="hljs-number">0</span>,<span class="hljs-number">6</span>) (<span class="hljs-number">0</span>,<span class="hljs-number">-5</span>) (<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>) (<span class="hljs-number">0</span>,<span class="hljs-number">-2</span>) (<span class="hljs-number">5</span>,<span class="hljs-number">3</span>) ...<br><br><span class="hljs-comment">// (0,0) = å—ç»“æŸï¼ˆåé¢å…¨æ˜¯0ï¼‰</span><br><br></code></pre></td></tr></table></figure>
<p>7.4 å“ˆå¤«æ›¼è¡¨</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// JPEGæ ‡å‡†å®šä¹‰äº†å›ºå®šçš„å“ˆå¤«æ›¼è¡¨ï¼ˆä¹Ÿå¯è‡ªå®šä¹‰ï¼‰</span><br>äº®åº¦DCè¡¨ï¼š<br><span class="hljs-number">0x00</span> â†’ <span class="hljs-number">00</span>        (å·®å€¼<span class="hljs-number">0</span>)<br><span class="hljs-number">0x01</span> â†’ <span class="hljs-number">010</span>       (å·®å€¼<span class="hljs-number">1</span>)<br><span class="hljs-number">0x02</span> â†’ <span class="hljs-number">011</span>       (å·®å€¼<span class="hljs-number">2</span>)<br><span class="hljs-number">0x03</span> â†’ <span class="hljs-number">100</span>       (å·®å€¼<span class="hljs-number">3</span>)<br><span class="hljs-comment">// ...</span><br><br>äº®åº¦ACè¡¨ï¼š<br>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>) â†’ <span class="hljs-number">00</span>       (<span class="hljs-number">1</span>ä¸ªé<span class="hljs-number">0</span>å€¼)<br>(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>) â†’ <span class="hljs-number">01</span>       (<span class="hljs-number">2</span>ä¸ªé<span class="hljs-number">0</span>å€¼)<br>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) â†’ <span class="hljs-number">1100</span>     (<span class="hljs-number">1</span>ä¸ª<span class="hljs-number">0</span>ï¼Œç„¶å<span class="hljs-number">1</span>ä¸ªé<span class="hljs-number">0</span>)<br><span class="hljs-comment">// ...</span><br><br></code></pre></td></tr></table></figure>
<hr />
<h4 id="jpgæ–‡ä»¶ç»“æ„"><a href="#jpgæ–‡ä»¶ç»“æ„" class="headerlink" title="jpgæ–‡ä»¶ç»“æ„"></a><a class="markdownIt-Anchor" href="#jpgæ–‡ä»¶ç»“æ„"></a> JPGæ–‡ä»¶ç»“æ„</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">JPEGæ–‡ä»¶ = SOI + æ— æ•°æ®µ + EOI<br><br>SOI (0xFFD8) - Start of Image<br><br>[æ®µ] = æ ‡è®°(2å­—èŠ‚) + é•¿åº¦(2å­—èŠ‚) + æ•°æ®<br><br>å¸¸è§æ ‡è®°ï¼š<br>0xFFE0 - APP0 (JFIFå¤´)  &quot;JFIF\\0&quot;<br>0xFFDB - DQT (é‡åŒ–è¡¨)<br>0xFFC0 - SOF0 (å¸§å¼€å§‹)  â†’ å®½ã€é«˜ã€ç²¾åº¦<br>0xFFC4 - DHT (å“ˆå¤«æ›¼è¡¨)<br>0xFFDA - SOS (æ‰«æå¼€å§‹) â†’ çœŸæ­£çš„å›¾åƒæ•°æ®<br>0xFFD9 - EOI (ç»“æŸ)<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="png"><a href="#png" class="headerlink" title="png"></a><a class="markdownIt-Anchor" href="#png"></a> PNG</h3>
<h4 id="pngæ˜¯ä»€ä¹ˆ"><a href="#pngæ˜¯ä»€ä¹ˆ" class="headerlink" title="pngæ˜¯ä»€ä¹ˆ"></a><a class="markdownIt-Anchor" href="#pngæ˜¯ä»€ä¹ˆ"></a> PNGæ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p>PNG = Portable Network Graphics = å¯ç§»æ¤ç½‘ç»œå›¾å½¢æ ¼å¼<br />
âœ… æ— æŸå‹ç¼©ï¼ˆè§£å‹åå’ŒåŸæ¥ä¸€æ¨¡ä¸€æ ·ï¼ï¼‰<br />
âœ… æ”¯æŒé€æ˜é€šé“ï¼ˆAlphaï¼‰<br />
âœ… æ”¯æŒçœŸå½©è‰²ã€ç´¢å¼•è‰²ã€ç°åº¦<br />
âœ… æ¯”GIFå¥½10å€ï¼Œè¿˜å…è´¹ï¼<br />
âŒ æ¯”JPGå¤§ï¼ˆç…§ç‰‡ä¸ç”¨å®ƒï¼‰<br />
âŒ è§£ç æ¯”JPGå¿«ï¼Œæ¯”BMPæ…¢<br />
âŒ ä¸æ”¯æŒCMYKï¼ˆå°åˆ·ç”¨ä¸äº†ï¼‰</p>
<p>â€‹</p>
<h4 id="pngçš„æ ¸å¿ƒå“²å­¦"><a href="#pngçš„æ ¸å¿ƒå“²å­¦" class="headerlink" title="pngçš„æ ¸å¿ƒå“²å­¦"></a><a class="markdownIt-Anchor" href="#pngçš„æ ¸å¿ƒå“²å­¦"></a> PNGçš„æ ¸å¿ƒå“²å­¦</h4>
<p>2.1 PNG vs GIF æ©æ€¨æƒ…ä»‡<br />
1995å¹´ï¼ŒUnisyså…¬å¸å®£å¸ƒï¼šGIFç”¨çš„LZWå‹ç¼©æˆ‘ä»¬ä¸“åˆ©äº†ï¼Œè¦æ”¶è´¹ï¼<br />
äº’è”ç½‘ç‚¸äº† â†’  PNGè¯ç”Ÿï¼šæˆ‘ä»¬è¦åšå…è´¹çš„GIFæ›¿ä»£å“ï¼</p>
<p>æ‰€ä»¥PNGå¤©ç”Ÿï¼š<br />
âœ… å…è´¹ï¼å…è´¹ï¼å…è´¹ï¼<br />
âœ… æ¯”GIFå‹ç¼©ç‡æ›´é«˜<br />
âœ… æ”¯æŒæ›´å¤šé¢œè‰²ï¼ˆGIFåªæœ‰256è‰²ï¼‰<br />
âœ… æ”¯æŒçœŸAlphaé€æ˜ï¼ˆGIFåªæœ‰1ä½é€æ˜ï¼‰<br />
âœ… ä¸“åˆ©å‹å¥½</p>
<p>â€‹<br />
2.2 PNG vs JPG å®šä½ä¸åŒ<br />
PNG: æ— æŸã€é€æ˜ã€è¾¹ç¼˜é”åˆ© â†’ é€‚åˆå›¾æ ‡ã€UIã€æˆªå›¾ã€æ–‡å­—<br />
JPG: æœ‰æŸã€ç…§ç‰‡çº§ â†’ é€‚åˆé£æ™¯ã€äººåƒã€æ¸å˜</p>
<p>ç»å…¸åº”ç”¨ï¼š</p>
<ul>
<li>ä½ çš„åœ°çƒä»ªçº¹ç† â†’ PNG (é€æ˜èƒŒæ™¯)</li>
<li>æ¸¸æˆUIå›¾æ ‡ â†’ PNG</li>
<li>å¾®ä¿¡æˆªå›¾ â†’ PNG</li>
<li>æœ‹å‹åœˆè‡ªæ‹ â†’ JPG</li>
</ul>
<p>â€‹</p>
<h4 id="pngæ–‡ä»¶ç»“æ„æ•°æ®å—"><a href="#pngæ–‡ä»¶ç»“æ„æ•°æ®å—" class="headerlink" title="pngæ–‡ä»¶ç»“æ„æ•°æ®å—"></a><a class="markdownIt-Anchor" href="#pngæ–‡ä»¶ç»“æ„æ•°æ®å—"></a> PNGæ–‡ä»¶ç»“æ„ï¼ˆæ•°æ®å—ï¼ï¼‰</h4>
<p>3.1 æ–‡ä»¶ç»“æ„æ€»è§ˆ<br />
PNGæ–‡ä»¶ = 8å­—èŠ‚ç­¾å + æ— æ•°ä¸ªæ•°æ®å—</p>
<p>ç­¾åï¼ˆ8å­—èŠ‚ï¼‰ï¼š<br />
[137 80 78 71 13 10 26 10]  // è¿™æ˜¯PNGèº«ä»½è¯<br />
[  P  N  G  \r \n \z \n]</p>
<p>â€‹<br />
3.2 æ•°æ®å—ç»“æ„ï¼ˆ4éƒ¨åˆ†ï¼‰<br />
// æ¯ä¸ªæ•°æ®å—é•¿è¿™æ ·ï¼š<br />
[é•¿åº¦:4] [ç±»å‹:4] [æ•°æ®:é•¿åº¦] [CRC:4]</p>
<p>// é•¿åº¦ = æ•°æ®åŒºå¤§å°ï¼ˆä¸åŒ…æ‹¬å¤´å°¾ï¼‰<br />
// ç±»å‹ = IHDR/IDAT/IEND/â€¦ï¼ˆASCIIï¼‰<br />
// CRC = å¾ªç¯å†—ä½™æ ¡éªŒï¼ˆæ•°æ®æœ‰æ²¡æœ‰æŸåï¼‰</p>
<p>â€‹<br />
3.3 å…³é”®æ•°æ®å—<br />
ç±»å‹ å…¨ç§° å¿…é¡»ï¼Ÿ ä½œç”¨<br />
IHDR å›¾åƒå¤´ âœ… å®½ã€é«˜ã€ä½æ·±ã€é¢œè‰²ç±»å‹<br />
PLTE è°ƒè‰²æ¿ ç´¢å¼•è‰²å¿…é¡» é¢œè‰²è¡¨<br />
IDAT å›¾åƒæ•°æ® âœ… å‹ç¼©åçš„åƒç´ æ•°æ®<br />
IEND ç»“æŸ âœ… æ–‡ä»¶ç»“æŸæ ‡è®°<br />
tRNS é€æ˜ å¯é€‰ é€æ˜ä¿¡æ¯<br />
gAMA Gamma å¯é€‰ è‰²å½©æ ¡æ­£<br />
pHYs ç‰©ç†åƒç´  å¯é€‰ æ¯ç±³åƒç´ æ•°<br />
tEXt æ–‡æœ¬ å¯é€‰ ä½œè€…ã€æè¿°ç­‰<br />
å››ã€IHDRæ•°æ®å—ï¼ˆæœ€åŸºç¡€ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-type">int</span> width;           <span class="hljs-comment">// å®½åº¦ï¼ˆåƒç´ ï¼‰</span><br>    <span class="hljs-type">int</span> height;          <span class="hljs-comment">// é«˜åº¦ï¼ˆåƒç´ ï¼‰</span><br>    <span class="hljs-type">char</span> bitDepth;       <span class="hljs-comment">// ä½æ·±ï¼ˆ8/16/1/2/4ï¼‰</span><br>    <span class="hljs-type">char</span> colorType;      <span class="hljs-comment">// é¢œè‰²ç±»å‹ â­</span><br>    <span class="hljs-type">char</span> compression;    <span class="hljs-comment">// å‹ç¼©æ–¹æ³•ï¼ˆ0=DEFLATEï¼‰</span><br>    <span class="hljs-type">char</span> filterMethod;   <span class="hljs-comment">// æ»¤æ³¢å™¨æ–¹æ³•ï¼ˆ0=è‡ªé€‚åº”ï¼‰</span><br>    <span class="hljs-type">char</span> interlace;      <span class="hljs-comment">// éš”è¡Œæ‰«æï¼ˆ0=æ— ï¼Œ1=äºšå½“7ï¼‰</span><br>&#125; PNGIHDR;<br><br><span class="hljs-comment">// å¤§å°ï¼š13å­—èŠ‚</span><br>â€‹<br>colorTypeï¼ˆæ ¸å¿ƒï¼ï¼‰<br>å€¼ å«ä¹‰ ä½æ·± æ¯åƒç´ å­—èŠ‚<br><span class="hljs-number">0</span> ç°åº¦ <span class="hljs-number">1</span>/<span class="hljs-number">2</span>/<span class="hljs-number">4</span>/<span class="hljs-number">8</span>/<span class="hljs-number">16</span> ä½æ·±/<span class="hljs-number">8</span><br><span class="hljs-number">2</span> çœŸå½©è‰²ï¼ˆRGBï¼‰ <span class="hljs-number">8</span>/<span class="hljs-number">16</span> <span class="hljs-number">3</span><br><span class="hljs-number">3</span> ç´¢å¼•è‰² <span class="hljs-number">1</span>/<span class="hljs-number">2</span>/<span class="hljs-number">4</span>/<span class="hljs-number">8</span> <span class="hljs-number">1</span><br><span class="hljs-number">4</span> ç°åº¦+Alpha <span class="hljs-number">8</span>/<span class="hljs-number">16</span> <span class="hljs-number">2</span><br><span class="hljs-number">6</span> çœŸå½©è‰²+Alphaï¼ˆRGBAï¼‰ <span class="hljs-number">8</span>/<span class="hljs-number">16</span> <span class="hljs-number">4</span> â­æœ€å¸¸ç”¨<br>ä½ å¹³æ—¶ç”¨çš„PNGï¼šcolorType=<span class="hljs-number">6</span>, bitDepth=<span class="hljs-number">8</span> â†’ RGBAï¼<br>äº”ã€PNGçš„ä¸¤æ­¥å‹ç¼©æ³•<br>åŸå§‹åƒç´ æ•°æ®<br>    â†“ â‘  æ»¤æ³¢å™¨ï¼ˆé¢„æµ‹ç¼–ç ï¼‰<br>é¢„æµ‹æ®‹å·®ï¼ˆæ›´å°çš„æ•°å­—ï¼‰<br>    â†“ â‘¡ DEFLATEå‹ç¼©ï¼ˆLZ77 + å“ˆå¤«æ›¼ï¼‰<br>å‹ç¼©åçš„äºŒè¿›åˆ¶æµ<br>    â†“ æ”¾è¿›IDATå—<br>PNGæ–‡ä»¶<br></code></pre></td></tr></table></figure>
<p>â€‹</p>
<h4 id="ç¬¬1æ­¥æ»¤æ³¢å™¨æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ"><a href="#ç¬¬1æ­¥æ»¤æ³¢å™¨æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ" class="headerlink" title="ç¬¬1æ­¥æ»¤æ³¢å™¨æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ"></a><a class="markdownIt-Anchor" href="#ç¬¬1æ­¥æ»¤æ³¢å™¨æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ"></a> ç¬¬1æ­¥ï¼šæ»¤æ³¢å™¨ï¼ˆæ ¸å¿ƒä¸­çš„æ ¸å¿ƒï¼‰</h4>
<p>6.1 ä¸ºä»€ä¹ˆéœ€è¦æ»¤æ³¢å™¨ï¼Ÿ<br />
// åŸå§‹åƒç´ ï¼ˆRGBAï¼‰ï¼š<br />
[255,0,0,255] [255,1,0,255] [254,2,0,255] [255,3,0,255]<br />
çº¢           å¾®çº¢         å¾®æš—çº¢       æ›´æš—çº¢</p>
<p>// ç›´æ¥å‹ç¼©ï¼šæ•°æ®å·®å¼‚å¤§ï¼Œä¸å¥½å‹<br />
// ä½†ç›¸é‚»åƒç´ å¾ˆæ¥è¿‘å•Šï¼</p>
<p>// æ»¤æ³¢å™¨ = å­˜&quot;å·®å€¼&quot;è€Œä¸æ˜¯&quot;åŸå€¼&quot;<br />
[255,0,0,255] [+1,0,0,0] [-1,0,0,0] [+1,0,0,0]<br />
åŸºå‡†å€¼        å·®å€¼        å·®å€¼        å·®å€¼</p>
<p>// æ•°å­—å˜å°äº† â†’ å“ˆå¤«æ›¼ç¼–ç æ›´çŸ­ï¼</p>
<p>â€‹<br />
6.2 PNGçš„5ç§æ»¤æ³¢å™¨ï¼ˆæ¯è¡Œé€‰ä¸€ä¸ªï¼‰<br />
// 0. None: ä¸æ»¤æ³¢<br />
Filt(x) = Orig(x)</p>
<p>// 1. Sub: å‡å»å·¦è¾¹åƒç´ <br />
Filt(x) = Orig(x) - Orig(x-1)</p>
<p>// 2. Up: å‡ä¸Šè¾¹åƒç´ <br />
Filt(x) = Orig(x) - Orig(x - rowBytes)</p>
<p>// 3. Average: å‡(å·¦+ä¸Š)/2<br />
Filt(x) = Orig(x) - (Orig(x-1) + Orig(x - rowBytes)) / 2</p>
<p>// 4. Paeth: å‡Paethé¢„æµ‹å€¼ï¼ˆæœ€èªæ˜ï¼‰<br />
Filt(x) = Orig(x) - Paeth(å·¦, ä¸Š, å·¦ä¸Š)</p>
<p>â€‹<br />
6.3 Paethé¢„æµ‹å™¨ï¼ˆPNGçš„ç‹¬é—¨ç»æŠ€ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Paeth</span><span class="hljs-params">(<span class="hljs-type">int</span> left, <span class="hljs-type">int</span> above, <span class="hljs-type">int</span> upperLeft)</span> </span>&#123;<br>    <span class="hljs-comment">// é¢„æµ‹ = å·¦ + ä¸Š - å·¦ä¸Š</span><br>    <span class="hljs-type">int</span> predictor = left + above - upperLeft;<br><br>    <span class="hljs-comment">// é€‰ç¦»é¢„æµ‹å€¼æœ€è¿‘çš„å‚è€ƒåƒç´ </span><br>    <span class="hljs-type">int</span> pLeft = <span class="hljs-built_in">abs</span>(predictor - left);<br>    <span class="hljs-type">int</span> pAbove = <span class="hljs-built_in">abs</span>(predictor - above);<br>    <span class="hljs-type">int</span> pUpperLeft = <span class="hljs-built_in">abs</span>(predictor - upperLeft);<br><br>    <span class="hljs-keyword">if</span> (pLeft &lt;= pAbove &amp;&amp; pLeft &lt;= pUpperLeft)<br>        <span class="hljs-keyword">return</span> left;<br>    <span class="hljs-keyword">if</span> (pAbove &lt;= pUpperLeft)<br>        <span class="hljs-keyword">return</span> above;<br>    <span class="hljs-keyword">return</span> upperLeft;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>â€‹<br />
6.4 æ»¤æ³¢å™¨é€‰æ‹©ï¼ˆè‡ªé€‚åº”ï¼‰<br />
// PNGç¼–ç å™¨ä¼šå°è¯•5ç§æ»¤æ³¢å™¨ï¼Œé€‰å‹ç¼©ç‡æœ€é«˜çš„</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> bestFilter = <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> smallestSize = INF;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> f = <span class="hljs-number">0</span>; f &lt; <span class="hljs-number">5</span>; f++) &#123;<br>    <span class="hljs-built_in">applyFilter</span>(row, f);<br>    <span class="hljs-type">int</span> size = <span class="hljs-built_in">deflateCompress</span>(row);<br>    <span class="hljs-keyword">if</span> (size &lt; smallestSize) &#123;<br>        bestFilter = f;<br>        smallestSize = size;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ¯è¡Œç¬¬ä¸€ä¸ªå­—èŠ‚ = æ»¤æ³¢å™¨ç±»å‹</span><br>[filterType] [æ»¤æ³¢åçš„åƒç´ æ•°æ®...]<br></code></pre></td></tr></table></figure>
<p>â€‹</p>
<h4 id="ç¬¬2æ­¥deflateå‹ç¼©"><a href="#ç¬¬2æ­¥deflateå‹ç¼©" class="headerlink" title="ç¬¬2æ­¥deflateå‹ç¼©"></a><a class="markdownIt-Anchor" href="#ç¬¬2æ­¥deflateå‹ç¼©"></a> ç¬¬2æ­¥ï¼šDEFLATEå‹ç¼©</h4>
<p>7.1 DEFLATE = LZ77 + å“ˆå¤«æ›¼<br />
LZ77: æ‰¾é‡å¤å­—ç¬¦ä¸²ï¼Œç”¨(è·ç¦»,é•¿åº¦)æ›¿æ¢<br />
â€œABABABâ€ â†’ â€œAB(4,3)â€  // ä»4ä¸ªå­—ç¬¦å‰å¤åˆ¶3ä¸ª</p>
<p>å“ˆå¤«æ›¼: é«˜é¢‘å­—ç¬¦ç”¨çŸ­ç¼–ç ï¼Œä½é¢‘ç”¨é•¿ç¼–ç <br />
Aå‡ºç°100æ¬¡ â†’ ç¼–ç &quot;0&quot;<br />
Bå‡ºç°50æ¬¡  â†’ ç¼–ç &quot;10&quot;<br />
Cå‡ºç°1æ¬¡   â†’ ç¼–ç &quot;110&quot;</p>
<p>â€‹<br />
7.2 zlibåº“ï¼ˆPNGå®é™…ç”¨çš„ï¼‰<br />
// PNGä¸æ˜¯ç›´æ¥å­˜DEFLATEæ•°æ®ï¼Œå¤–é¢è¿˜åŒ…äº†zlibå¤´<br />
[zlibå¤´:2] [DEFLATEæ•°æ®â€¦] [zlibæ ¡éªŒ:4]</p>
<p>zlibå¤´ = å‹ç¼©æ–¹æ³•(8) + çª—å£å¤§å° + æ ¡éªŒä½</p>
<p>â€‹<br />
7.3 ä¸ºä»€ä¹ˆPNGæ¯”GIFå°ï¼Ÿ<br />
GIF: LZWå‹ç¼©ï¼ˆå—ä¸“åˆ©é™åˆ¶ï¼Œä¼˜åŒ–ä¸€èˆ¬ï¼‰<br />
PNG: DEFLATEï¼ˆLZ77+å“ˆå¤«æ›¼ï¼Œä¼˜åŒ–åˆ°æè‡´ï¼‰</p>
<p>ç›¸åŒå›¾ç‰‡ï¼ŒPNGæ¯”GIFå°20-30%ï¼</p>
<p>â€‹</p>
<h4 id="äºšå½“7éš”è¡Œæ‰«æadam7"><a href="#äºšå½“7éš”è¡Œæ‰«æadam7" class="headerlink" title="äºšå½“7éš”è¡Œæ‰«æadam7"></a><a class="markdownIt-Anchor" href="#äºšå½“7éš”è¡Œæ‰«æadam7"></a> äºšå½“7éš”è¡Œæ‰«æï¼ˆAdam7ï¼‰</h4>
<p>8.1 æ¸è¿›å¼æ˜¾ç¤º<br />
// æ™®é€šPNGï¼šä»ä¸Šåˆ°ä¸‹é€è¡Œæ˜¾ç¤º<br />
// ç½‘é€Ÿæ…¢æ—¶ï¼šçœ‹äº†åŠå¤©æ‰å‡ºæ¥ä¸ŠåŠæˆª</p>
<p>// äºšå½“7ï¼šåˆ†7éæ‰«æ<br />
ç¬¬1é: æ¯éš”8è¡Œ8åˆ— â­ å…ˆçœ‹åˆ°æ¨¡ç³Šè½®å»“<br />
ç¬¬2é: æ¯éš”8è¡Œ4åˆ—<br />
ç¬¬3é: æ¯éš”4è¡Œ8åˆ—<br />
ç¬¬4é: æ¯éš”4è¡Œ4åˆ—<br />
ç¬¬5é: æ¯éš”2è¡Œ4åˆ—<br />
ç¬¬6é: æ¯éš”2è¡Œ2åˆ—<br />
ç¬¬7é: æ¯éš”1è¡Œ1åˆ— â­ æœ€åè¡¥ç»†èŠ‚</p>
<p>æ•ˆæœï¼šå…ˆæ¨¡ç³Šåæ¸…æ™°ï¼Œç”¨æˆ·ä½“éªŒå¥½ï¼<br />
ä»£ä»·ï¼šæ–‡ä»¶å¤§10-20%</p>
<p>â€‹<br />
8.2 7éæ‰«æçš„åƒç´ åˆ†å¸ƒ<br />
1: oâ€¦oâ€¦oâ€¦<br />
2: .oâ€¦ .oâ€¦ .oâ€¦<br />
3: â€¦oâ€¦ â€¦oâ€¦ â€¦oâ€¦<br />
4: â€¦oâ€¦ â€¦oâ€¦ â€¦oâ€¦<br />
5: â€¦oâ€¦ â€¦oâ€¦ â€¦oâ€¦<br />
6: â€¦oâ€¦ â€¦oâ€¦ â€¦o.<br />
7: â€¦o. â€¦o. â€¦o</p>
<p>â€‹</p>
<h4 id="é€æ˜é€šé“pngçš„æ€æ‰‹é”"><a href="#é€æ˜é€šé“pngçš„æ€æ‰‹é”" class="headerlink" title="é€æ˜é€šé“pngçš„æ€æ‰‹é”"></a><a class="markdownIt-Anchor" href="#é€æ˜é€šé“pngçš„æ€æ‰‹é”"></a> é€æ˜é€šé“ï¼ˆPNGçš„æ€æ‰‹é”ï¼‰</h4>
<p>9.1 ä¸¤ç§é€æ˜æ–¹å¼<br />
// 1. ç´¢å¼•è‰²é€æ˜ï¼ˆtRNSå—ï¼‰<br />
è°ƒè‰²æ¿ç´¢å¼•5 â†’ åŠé€æ˜ â†’ tRNS[5] = 128<br />
è°ƒè‰²æ¿ç´¢å¼•6 â†’ å…¨é€æ˜ â†’ tRNS[6] = 0</p>
<p>// 2. çœŸå½©è‰²é€æ˜ï¼ˆRGBAï¼‰<br />
colorType=6 â†’ æ¯åƒç´ 4å­—èŠ‚ï¼šR,G,B,A<br />
A=255: ä¸é€æ˜<br />
A=0:   å…¨é€æ˜<br />
A=128: åŠé€æ˜</p>
<p>â€‹<br />
9.2 Alphaé¢„ä¹˜ï¼ˆPremultiplied Alphaï¼‰<br />
// æ™®é€šRGBA: (R,G,B,A)<br />
çº¢è‰²åŠé€æ˜ = (255,0,0,128)</p>
<p>// é¢„ä¹˜RGBA: (R<em>A/255, G</em>A/255, B*A/255, A)<br />
çº¢è‰²åŠé€æ˜ = (128,0,0,128)</p>
<p>// é¢„ä¹˜å¥½å¤„ï¼šç¼©æ”¾æ»¤æ³¢ä¸å‡ºç°é»‘è¾¹<br />
// OpenGLå¯ä»¥è®¾ç½®ï¼šglBlendFunc(GL_ONE, GL_ONE_MINUS_SRC_ALPHA)</p>
<p>â€‹</p>
<h4 id="pngè§£ç æµç¨‹stbåœ¨åšä»€ä¹ˆ"><a href="#pngè§£ç æµç¨‹stbåœ¨åšä»€ä¹ˆ" class="headerlink" title="pngè§£ç æµç¨‹stbåœ¨åšä»€ä¹ˆ"></a><a class="markdownIt-Anchor" href="#pngè§£ç æµç¨‹stbåœ¨åšä»€ä¹ˆ"></a> PNGè§£ç æµç¨‹ï¼ˆSTBåœ¨åšä»€ä¹ˆï¼‰</h4>
<ol>
<li>
<p>è¯»8å­—èŠ‚ç­¾å â†’ ç¡®è®¤æ˜¯PNG</p>
</li>
<li>
<p>å¾ªç¯è¯»æ•°æ®å—ï¼š</p>
<ul>
<li>è¯»é•¿åº¦ã€ç±»å‹</li>
<li>è¯»æ•°æ®ã€CRC</li>
<li>éªŒè¯CRCï¼ˆé˜²æ­¢æ–‡ä»¶æŸåï¼‰</li>
</ul>
</li>
<li>
<p>å¤„ç†IHDRå— â†’ å®½ã€é«˜ã€ä½æ·±ã€é¢œè‰²ç±»å‹</p>
</li>
<li>
<p>å¦‚æœæœ‰PLTE â†’ è¯»è°ƒè‰²æ¿</p>
</li>
<li>
<p>æ”¶é›†æ‰€æœ‰IDATå— â†’ åˆå¹¶æˆå®Œæ•´å‹ç¼©æµ</p>
</li>
<li>
<p>zlibè§£å‹ â†’ å¾—åˆ°æ»¤æ³¢åçš„åŸå§‹æ•°æ®</p>
</li>
<li>
<p>é€è¡Œé€†æ»¤æ³¢ï¼š</p>
<ul>
<li>è¯»æ¯è¡Œç¬¬1å­—èŠ‚ â†’ æ»¤æ³¢å™¨ç±»å‹</li>
<li>åº”ç”¨åå‘æ»¤æ³¢å™¨ â†’ æ¢å¤çœŸå®åƒç´ </li>
</ul>
</li>
<li>
<p>å¦‚æœæ˜¯äºšå½“7 â†’ é‡æ–°æ’åˆ—åƒç´ é¡ºåº</p>
</li>
<li>
<p>é¢œè‰²è½¬æ¢ï¼š</p>
<ul>
<li>ç´¢å¼•è‰² â†’ æŸ¥è°ƒè‰²æ¿</li>
<li>ç°åº¦ â†’ RGB</li>
<li>YCbCr? ä¸ç”¨ï¼ŒPNGæ˜¯RGB</li>
</ul>
</li>
<li>
<p>è¾“å‡ºRGBA/RGBæ•°ç»„</p>
</li>
</ol>
<p>â€‹</p>
<h4 id="ä¸ºä»€ä¹ˆpngä¸é€‚åˆæ¸¸æˆçº¹ç†"><a href="#ä¸ºä»€ä¹ˆpngä¸é€‚åˆæ¸¸æˆçº¹ç†" class="headerlink" title="ä¸ºä»€ä¹ˆpngä¸é€‚åˆæ¸¸æˆçº¹ç†"></a><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆpngä¸é€‚åˆæ¸¸æˆçº¹ç†"></a> ä¸ºä»€ä¹ˆPNGä¸é€‚åˆæ¸¸æˆçº¹ç†ï¼Ÿ</h4>
<p>é—®é¢˜1ï¼šè§£å‹æ…¢<br />
// PNGè§£å‹ï¼š<br />
zlib_inflate()  // CPUå¯†é›†ï¼Œå¤§é‡å†…å­˜æ“ä½œ<br />
é€†æ»¤æ³¢()        // é€åƒç´ è®¡ç®—</p>
<p>// DDSçº¹ç†ï¼š<br />
memcpy()        // ç›´æ¥ä¸Šä¼ GPU</p>
<p>â€‹<br />
é—®é¢˜2ï¼šä¸æ”¯æŒGPUå‹ç¼©<br />
// PNG: RGBA8888 â†’ 32ä½/åƒç´ <br />
1024x1024 PNG = 4MBæ˜¾å­˜</p>
<p>// DXT5 (BC3): å‹ç¼©çº¹ç† â†’ 1MBæ˜¾å­˜<br />
// ASTC/ETC2: æ‰‹æœºå‹ç¼©çº¹ç† â†’ 0.5MBæ˜¾å­˜</p>
<p>â€‹<br />
é—®é¢˜3ï¼šéšæœºè®¿é—®å›°éš¾<br />
// PNG: è¦è§£å‹æ•´ä¸ªæ–‡ä»¶æ‰èƒ½æ‹¿åˆ°æŸä¸ªåƒç´ <br />
// DDS: ç›´æ¥æ–‡ä»¶æ˜ å°„ï¼Œè¦å“ªé‡Œè¯»å“ªé‡Œ</p>
<p>â€‹<br />
æ¸¸æˆç”¨å•¥ï¼Ÿ<br />
UIå›¾æ ‡ â†’ PNGï¼ˆåŠ è½½æ—¶è§£å‹ï¼Œä¸€ç›´æ”¾æ˜¾å­˜ï¼‰<br />
3Dçº¹ç† â†’ DDS/KTXï¼ˆGPUåŸç”Ÿå‹ç¼©ï¼‰<br />
æˆªå›¾ â†’ PNGï¼ˆæ— æŸï¼Œé€šç”¨ï¼‰</p>
<h2 id="å†…å­˜å¸ƒå±€"><a href="#å†…å­˜å¸ƒå±€" class="headerlink" title="å†…å­˜å¸ƒå±€"></a><a class="markdownIt-Anchor" href="#å†…å­˜å¸ƒå±€"></a> å†…å­˜å¸ƒå±€</h2>
<h3 id="ä»€ä¹ˆæ˜¯å†…å­˜å¸ƒå±€"><a href="#ä»€ä¹ˆæ˜¯å†…å­˜å¸ƒå±€" class="headerlink" title="ä»€ä¹ˆæ˜¯å†…å­˜å¸ƒå±€"></a><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯å†…å­˜å¸ƒå±€"></a> ä»€ä¹ˆæ˜¯å†…å­˜å¸ƒå±€ï¼Ÿ</h3>
<p>å†…å­˜å¸ƒå±€ = åƒç´ æ•°æ®åœ¨å†…å­˜é‡Œçš„æ’åˆ—æ–¹å¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">è§£ç åå¾—åˆ°çš„æ˜¯å­—èŠ‚æ•°ç»„ï¼Œä½†OpenGLè¦çŸ¥é“ï¼š<br>â“ RGBè¿˜æ˜¯BGRï¼Ÿ<br>â“ ä¸€è¡Œå¤šå°‘å­—èŠ‚ï¼Ÿ<br>â“ åŸç‚¹åœ¨å·¦ä¸Šè¿˜æ˜¯å·¦ä¸‹ï¼Ÿ<br>â“ æ¯ä¸ªåƒç´ å å‡ ä½ï¼Ÿ<br><br>â†’ è¿™äº›å°±æ˜¯å†…å­˜å¸ƒå±€ï¼<br></code></pre></td></tr></table></figure>
<hr />
<h3 id="åƒç´ æ ¼å¼pixel-format"><a href="#åƒç´ æ ¼å¼pixel-format" class="headerlink" title="åƒç´ æ ¼å¼pixel-format"></a><a class="markdownIt-Anchor" href="#åƒç´ æ ¼å¼pixel-format"></a> åƒç´ æ ¼å¼ï¼ˆPixel Formatï¼‰</h3>
<p>2.1 é¢œè‰²é€šé“é¡ºåº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// BMP/TGAï¼šBGRé¡ºåº</span><br>[B] [G] [R]  [B] [G] [R] ...<br><br><span class="hljs-comment">// OpenGLè¦ï¼šRGBé¡ºåº</span><br>[R] [G] [B]  [R] [G] [B] ...<br><br><span class="hljs-comment">// PNGï¼šRGBAé¡ºåº</span><br>[R] [G] [B] [A] [R] [G] [B] [A] ...<br></code></pre></td></tr></table></figure>
<p>OpenGLæšä¸¾å€¼ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">GL_RGB   = <span class="hljs-number">0x1907</span>  <span class="hljs-comment">// çº¢ç»¿è“é¡ºåº</span><br>GL_BGR   = <span class="hljs-number">0x80E0</span>  <span class="hljs-comment">// è“ç»¿çº¢é¡ºåºï¼ˆæ‰©å±•ï¼‰</span><br>GL_RGBA  = <span class="hljs-number">0x1908</span>  <span class="hljs-comment">// çº¢ç»¿è“é€æ˜</span><br>GL_BGRA  = <span class="hljs-number">0x80E1</span>  <span class="hljs-comment">// è“ç»¿çº¢é€æ˜ï¼ˆæ‰©å±•ï¼‰</span><br></code></pre></td></tr></table></figure>
<p>å…³é”®ï¼š OpenGLé»˜è®¤æ˜¯RGBï¼Œä½†BMPæ˜¯BGR â†’ å¿…é¡»äº¤æ¢ï¼</p>
<hr />
<p>2.2 ä½æ·±ï¼ˆBits Per Pixelï¼‰</p>
<p>ä½æ·±    æ ¼å¼    æ¯åƒç´ å­—èŠ‚ é¢œè‰²æ•°é‡     ç”¨é€”<br />
8ä½     ç°åº¦     1å­—èŠ‚   256çº§ç°åº¦    é«˜åº¦å›¾ã€å­—ä½“<br />
24ä½    RGB     3å­—èŠ‚   1677ä¸‡è‰²     æ™®é€šå›¾ç‰‡<br />
32ä½    RGBA    4å­—èŠ‚   1677ä¸‡è‰²+é€æ˜ UIã€çº¹ç†<br />
16ä½    RGB565  2å­—èŠ‚   65536è‰²      æ‰‹æœºæ¸¸æˆ<br />
16ä½æµ®ç‚¹ RGBA16F 8å­—èŠ‚   HDR         é«˜åŠ¨æ€èŒƒå›´<br />
32ä½æµ®ç‚¹ RGBA32F 16å­—èŠ‚  æé«˜ç²¾åº¦      ç§‘å­¦è®¡ç®—</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// OpenGLæšä¸¾</span><br>GL_RGB8      <span class="hljs-comment">// 24ä½ï¼Œæ¯é€šé“8ä½</span><br>GL_RGBA8     <span class="hljs-comment">// 32ä½ï¼Œæ¯é€šé“8ä½</span><br>GL_RGB5_A1   <span class="hljs-comment">// 16ä½ï¼ŒRGB 5:6:5? ä¸å¯¹ï¼Œæ˜¯RGB5+A1</span><br>GL_RGB565    <span class="hljs-comment">// 16ä½ï¼ŒR5 G6 B5</span><br>GL_RGBA16F   <span class="hljs-comment">// 64ä½ï¼Œæ¯é€šé“16ä½æµ®ç‚¹</span><br>GL_RGBA32F   <span class="hljs-comment">// 128ä½ï¼Œæ¯é€šé“32ä½æµ®ç‚¹</span><br></code></pre></td></tr></table></figure>
<hr />
<p>2.3 é€šé“é¡ºåº + ä½æ·± = å†…éƒ¨æ ¼å¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// glTexImage2D çš„ internalFormat å‚æ•°</span><br><span class="hljs-built_in">glTexImage2D</span>(<br>    GL_TEXTURE_2D,<br>    <span class="hljs-number">0</span>,<br>    GL_RGBA8,        <span class="hljs-comment">// å†…éƒ¨æ ¼å¼ï¼šGPUé‡Œæ€ä¹ˆå­˜</span><br>    <span class="hljs-number">1024</span>, <span class="hljs-number">1024</span>,<br>    <span class="hljs-number">0</span>,<br>    GL_RGBA,         <span class="hljs-comment">// å¤–éƒ¨æ ¼å¼ï¼šå†…å­˜é‡Œæ€ä¹ˆæ’</span><br>    GL_UNSIGNED_BYTE, <span class="hljs-comment">// æ•°æ®ç±»å‹ï¼šæ¯ä¸ªé€šé“å å‡ å­—èŠ‚</span><br>    data<br>);<br></code></pre></td></tr></table></figure>
<p>å†…å¤–æ ¼å¼å¯ä»¥ä¸ä¸€æ ·ï¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// å†…å­˜æ˜¯BGRï¼Œä½†GPUå­˜æˆRGB</span><br><span class="hljs-built_in">glTexImage2D</span>(..., GL_RGB8, ..., GL_BGR, GL_UNSIGNED_BYTE, data);<br><span class="hljs-comment">// OpenGLä¼šå¸®ä½ è½¬æ¢ï¼</span><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="è¡Œå¯¹é½row-alignment"><a href="#è¡Œå¯¹é½row-alignment" class="headerlink" title="è¡Œå¯¹é½row-alignment"></a><a class="markdownIt-Anchor" href="#è¡Œå¯¹é½row-alignment"></a> è¡Œå¯¹é½ï¼ˆRow Alignmentï¼‰</h3>
<p>3.1 é—®é¢˜æ¥æº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ä¸€å¼  3x3 çš„24ä½BMP</span><br>æ¯è¡Œ = <span class="hljs-number">3</span>åƒç´  Ã— <span class="hljs-number">3</span>å­—èŠ‚ = <span class="hljs-number">9</span>å­—èŠ‚<br><br><span class="hljs-comment">// BMPè¦æ±‚æ¯è¡Œæ˜¯4å­—èŠ‚å€æ•°</span><br><span class="hljs-number">9</span>å­—èŠ‚ â†’ è¡¥åˆ°<span class="hljs-number">12</span>å­—èŠ‚<br>[RGB][RGB][RGB][<span class="hljs-number">00</span>]  <span class="hljs-comment">// æ¯è¡Œå¤š3ä¸ªåºŸå­—èŠ‚</span><br></code></pre></td></tr></table></figure>
<p>3.2 OpenGLçš„å¯¹é½è®¾ç½®</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// é»˜è®¤æ˜¯4å­—èŠ‚å¯¹é½</span><br><span class="hljs-built_in">glPixelStorei</span>(GL_UNPACK_ALIGNMENT, <span class="hljs-number">4</span>);<br><br><span class="hljs-comment">// å¦‚æœå›¾ç‰‡æ¯è¡Œæ­£å¥½3å­—èŠ‚ï¼ˆæ— å¡«å……ï¼‰</span><br><span class="hljs-built_in">glPixelStorei</span>(GL_UNPACK_ALIGNMENT, <span class="hljs-number">1</span>);  <span class="hljs-comment">// æ”¹æˆ1å­—èŠ‚å¯¹é½ï¼</span><br><br><span class="hljs-comment">// å…¶ä»–å¯¹é½å€¼</span><br><span class="hljs-number">2</span> â†’ æ¯è¡Œ<span class="hljs-number">16</span>ä½å€æ•°<br><span class="hljs-number">8</span> â†’ æ¯è¡Œ<span class="hljs-number">64</span>ä½å€æ•°<br></code></pre></td></tr></table></figure>
<p>3.3 ä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ªï¼Ÿ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// BMPï¼ˆæœ‰å¡«å……ï¼‰â†’ å¯¹é½=4</span><br><span class="hljs-built_in">glPixelStorei</span>(GL_UNPACK_ALIGNMENT, <span class="hljs-number">4</span>);<br><span class="hljs-built_in">glTexImage2D</span>(..., format, GL_UNSIGNED_BYTE, bmpData);<br><br><span class="hljs-comment">// PNGï¼ˆæ— å¡«å……ï¼‰â†’ å¯¹é½=1</span><br><span class="hljs-built_in">glPixelStorei</span>(GL_UNPACK_ALIGNMENT, <span class="hljs-number">1</span>);<br><span class="hljs-built_in">glTexImage2D</span>(..., format, GL_UNSIGNED_BYTE, pngData);<br><br><span class="hljs-comment">// TGAï¼ˆå¯èƒ½æœ‰å¡«å……ï¼‰â†’ è¦è‡ªå·±ç®—</span><br><span class="hljs-type">int</span> bytesPerRow = (width * channels + <span class="hljs-number">3</span>) &amp; ~<span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure>
<p>å¯¹é½é”™äº†ä¼šæ€æ ·ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">âœ… å¯¹é½=4ï¼Œå®é™…=4 â†’ æ­£å¸¸<br>âŒ å¯¹é½=4ï¼Œå®é™…=3 â†’ çº¹ç†æ–œäº†ã€æœ‰æ¡çº¹<br>âœ… å¯¹é½=1ï¼Œå®é™…=3 â†’ æ­£å¸¸ï¼ˆä½†æ…¢ä¸€ç‚¹ï¼‰<br>âœ… å¯¹é½=1ï¼Œå®é™…=4 â†’ æ­£å¸¸<br></code></pre></td></tr></table></figure>
<p>å®‰å…¨åšæ³•ï¼š ä¸ç¡®å®šæ—¶ç”¨å¯¹é½=1ï¼</p>
<hr />
<h3 id="åŸç‚¹æ–¹å‘origin"><a href="#åŸç‚¹æ–¹å‘origin" class="headerlink" title="åŸç‚¹æ–¹å‘origin"></a><a class="markdownIt-Anchor" href="#åŸç‚¹æ–¹å‘origin"></a> åŸç‚¹æ–¹å‘ï¼ˆOriginï¼‰</h3>
<p>4.1 ä¸‰ä¸ªåŸç‚¹ï¼Œä¸‰ä¸ªä¸–ç•Œ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// BMP/TGA: å·¦ä¸‹è§’(0,0)</span><br>ç¬¬ä¸€è¡Œ â†’ å›¾åƒæœ€ä¸‹é¢<br>æœ€åä¸€è¡Œ â†’ å›¾åƒæœ€ä¸Šé¢<br><br><span class="hljs-comment">// PNG/JPG: å·¦ä¸Šè§’(0,0)</span><br>ç¬¬ä¸€è¡Œ â†’ å›¾åƒæœ€ä¸Šé¢<br>æœ€åä¸€è¡Œ â†’ å›¾åƒæœ€ä¸‹é¢<br><br><span class="hljs-comment">// OpenGLçº¹ç†: å·¦ä¸‹è§’(0,0)</span><br>å’ŒBMPä¸€æ ·ï¼<br></code></pre></td></tr></table></figure>
<p>4.2 æ€ä¹ˆå¤„ç†ï¼Ÿ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ–¹æ¡ˆ1ï¼šCPUç¿»è½¬</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> y = <span class="hljs-number">0</span>; y &lt; height; y++) &#123;<br>    <span class="hljs-built_in">memcpy</span>(flipped + (height - <span class="hljs-number">1</span> - y) * rowSize,<br>           data + y * rowSize,<br>           rowSize);<br>&#125;<br><br><span class="hljs-comment">// æ–¹æ¡ˆ2ï¼šSTBè‡ªåŠ¨ç¿»è½¬ï¼ˆæ¨èï¼‰</span><br><span class="hljs-built_in">stbi_set_flip_vertically_on_load</span>(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// PNGå˜BMPåŸç‚¹</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* data = <span class="hljs-built_in">stbi_load</span>(<span class="hljs-string">&quot;png.png&quot;</span>, &amp;w, &amp;h, &amp;n, <span class="hljs-number">0</span>);<br><span class="hljs-comment">// ç°åœ¨åŸç‚¹åœ¨å·¦ä¸‹è§’ï¼Œå’ŒOpenGLä¸€è‡´ï¼</span><br><br><span class="hljs-comment">// æ–¹æ¡ˆ3ï¼šç€è‰²å™¨ç¿»è½¬ï¼ˆä¸æ¨èï¼‰</span><br>TexCoord = <span class="hljs-built_in">vec2</span>(u, <span class="hljs-number">1.0</span> - v);  <span class="hljs-comment">// åœ¨ç€è‰²å™¨é‡Œç¿»è½¬Våæ ‡</span><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="å‹ç¼©çº¹ç†æ ¼å¼gpuåŸç”Ÿ"><a href="#å‹ç¼©çº¹ç†æ ¼å¼gpuåŸç”Ÿ" class="headerlink" title="å‹ç¼©çº¹ç†æ ¼å¼gpuåŸç”Ÿ"></a><a class="markdownIt-Anchor" href="#å‹ç¼©çº¹ç†æ ¼å¼gpuåŸç”Ÿ"></a> å‹ç¼©çº¹ç†æ ¼å¼ï¼ˆGPUåŸç”Ÿï¼‰</h3>
<p>5.1 ä¸ºä»€ä¹ˆéœ€è¦å‹ç¼©çº¹ç†ï¼Ÿ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ™®é€šRGBA8888</span><br><span class="hljs-number">1024</span>x1024 çº¹ç† = <span class="hljs-number">1024</span>Ã—<span class="hljs-number">1024</span>Ã—<span class="hljs-number">4</span> = <span class="hljs-number">4</span>MB<br><br><span class="hljs-comment">// DXT5 (BC3) å‹ç¼©</span><br><span class="hljs-number">1024</span>x1024 çº¹ç† = <span class="hljs-number">1024</span>Ã—<span class="hljs-number">1024</span>Ã—<span class="hljs-number">1</span> = <span class="hljs-number">1</span>MB  <span class="hljs-comment">// 1:4å‹ç¼©</span><br><br><span class="hljs-comment">// ASTC 4x4</span><br><span class="hljs-number">1024</span>x1024 çº¹ç† = <span class="hljs-number">1024</span>Ã—<span class="hljs-number">1024</span>Ã—<span class="hljs-number">0.5</span> = <span class="hljs-number">512</span>KB  <span class="hljs-comment">// 1:8å‹ç¼©</span><br></code></pre></td></tr></table></figure>
<p>å‹ç¼©çº¹ç† = ç›´æ¥åœ¨GPUé‡Œå­˜å‹ç¼©æ ¼å¼ï¼Œæ¸²æŸ“æ—¶ç¡¬ä»¶è§£å‹</p>
<hr />
<p>5.2 ä¸»æµå‹ç¼©æ ¼å¼</p>
<p>æ ¼å¼ å¹³å° å‹ç¼©æ¯” è´¨é‡ å—å¤§å°<br />
DXT1/BC1 Windows 6:1 å·®ï¼ˆæ— é€æ˜ï¼‰ 4x4<br />
DXT5/BC3 Windows 4:1 å¥½ï¼ˆæœ‰é€æ˜ï¼‰ 4x4<br />
ETC2 Android 6:1 å¥½ 4x4<br />
ASTC æ–°æ‰‹æœº 8:1 æå¥½ å¯å˜<br />
PVRTC è€iPhone 6:1 ä¸­ç­‰ 4x4</p>
<p>5.3 å‹ç¼©çº¹ç†çš„å†…å­˜å¸ƒå±€</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// DXT5å‹ç¼©ä¸€ä¸ª4x4å—</span><br>[<span class="hljs-number">16</span>ä½é¢œè‰²<span class="hljs-number">0</span>][<span class="hljs-number">16</span>ä½é¢œè‰²<span class="hljs-number">1</span>][<span class="hljs-number">48</span>ä½ç´¢å¼•][<span class="hljs-number">64</span>ä½Alpha]<br>    <span class="hljs-number">2</span>å­—èŠ‚      <span class="hljs-number">2</span>å­—èŠ‚      <span class="hljs-number">6</span>å­—èŠ‚     <span class="hljs-number">8</span>å­—èŠ‚<br><span class="hljs-comment">// æ€»å…± 16å­—èŠ‚ å­˜ 16åƒç´  â†’ 1å­—èŠ‚/åƒç´ ï¼</span><br><br><span class="hljs-comment">// å†…å­˜å¸ƒå±€ä¸å†æ˜¯çº¿æ€§RGBï¼Œè€Œæ˜¯å›ºå®šå¤§å°çš„å—</span><br></code></pre></td></tr></table></figure>
<p>é‡ç‚¹ï¼š å‹ç¼©çº¹ç†ä¸èƒ½é€åƒç´ è®¿é—®ï¼Œå¿…é¡»æ•´å—è§£å‹ï¼</p>
<hr />
<h3 id="srgbä¸çº¿æ€§ç©ºé—´"><a href="#srgbä¸çº¿æ€§ç©ºé—´" class="headerlink" title="srgbä¸çº¿æ€§ç©ºé—´"></a><a class="markdownIt-Anchor" href="#srgbä¸çº¿æ€§ç©ºé—´"></a> sRGBä¸çº¿æ€§ç©ºé—´</h3>
<p>6.1 é—®é¢˜ï¼šæ˜¾ç¤ºå™¨æ˜¯å¼¯çš„ï¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ä½ ç»™æ˜¾ç¤ºå™¨ RGB(128,128,128)</span><br><span class="hljs-comment">// æ˜¾ç¤ºå™¨å®é™…äº®åº¦ = 0.5^2.2 â‰ˆ 0.22  // ä¸æ˜¯ä¸€åŠäº®åº¦ï¼</span><br><br><span class="hljs-comment">// å› ä¸ºCRTæ—¶ä»£ï¼Œç”µå‹å’Œäº®åº¦æ˜¯å¹‚ç‡å…³ç³»</span><br><span class="hljs-comment">// è¿™å«Gammaæ ¡æ­£</span><br></code></pre></td></tr></table></figure>
<p>6.2 sRGBçº¹ç†</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// PNG/JPGæ˜¯sRGBç¼–ç ï¼ˆå·²ç»Gammaå‹ç¼©ï¼‰</span><br>åƒç´ å€¼ = äº®åº¦^(<span class="hljs-number">1</span>/<span class="hljs-number">2.2</span>)  <span class="hljs-comment">// æ•…æ„è°ƒäº®ï¼Œè¡¥å¿æ˜¾ç¤ºå™¨</span><br><br><span class="hljs-comment">// OpenGLæ¸²æŸ“æ˜¯çº¿æ€§ç©ºé—´</span><br>shaderè®¡ç®— â†’ çº¿æ€§RGB â†’ Gammaæ ¡æ­£ â†’ æ˜¾ç¤ºå™¨<br><br><span class="hljs-comment">// å¦‚æœç”¨sRGBçº¹ç†</span><br><span class="hljs-built_in">glTexImage2D</span>(..., GL_SRGB8, ...);  <span class="hljs-comment">// OpenGLè‡ªåŠ¨è½¬çº¿æ€§</span><br></code></pre></td></tr></table></figure>
<p>é”™è¯¯ç”¨æ³•ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// sRGBå›¾ç‰‡ + GL_RGB8 = é¢œè‰²å‘æš—ï¼(å› ä¸ºç®—äº†ä¸¤æ¬¡Gamma)</span><br></code></pre></td></tr></table></figure>
<p>æ­£ç¡®ç”¨æ³•ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// UIå›¾æ ‡ï¼ˆsRGBï¼‰â†’ GL_SRGB8_ALPHA8</span><br><span class="hljs-comment">// æ³•çº¿è´´å›¾ï¼ˆçº¿æ€§ï¼‰â†’ GL_RGB8</span><br><span class="hljs-comment">// å…‰ç…§è®¡ç®—ï¼ˆçº¿æ€§ï¼‰â†’ GL_RGBA16F</span><br></code></pre></td></tr></table></figure>
<hr />
<h2 id="gpuä¸Šä¼ "><a href="#gpuä¸Šä¼ " class="headerlink" title="gpuä¸Šä¼ "></a><a class="markdownIt-Anchor" href="#gpuä¸Šä¼ "></a> GPUä¸Šä¼ </h2>
<h3 id="ä»€ä¹ˆæ˜¯gpuä¸Šä¼ "><a href="#ä»€ä¹ˆæ˜¯gpuä¸Šä¼ " class="headerlink" title="ä»€ä¹ˆæ˜¯gpuä¸Šä¼ "></a><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯gpuä¸Šä¼ "></a> ä»€ä¹ˆæ˜¯GPUä¸Šä¼ ï¼Ÿ</h3>
<p>GPUä¸Šä¼  = æŠŠåƒç´ æ•°æ®ä»å†…å­˜ï¼ˆRAMï¼‰æ¬åˆ°æ˜¾å­˜ï¼ˆVRAMï¼‰<br />
ä½ çš„ä»£ç                  RAM              VRAM<br />
data = loadTexture() â†’ [RGBRGBâ€¦]  â†’  [GPUçº¹ç†]<br />
CPUç®¡è¾–          GPUç®¡è¾–<br />
malloc/free      glTexImage2D</p>
<p>â€‹<br />
æ ¸å¿ƒé—®é¢˜ï¼šæ€ä¹ˆæ¬å¾—æœ€å¿«ã€æœ€çœå†…å­˜ï¼Ÿ</p>
<h3 id="æœ€åŸºç¡€çš„ä¸Šä¼ glteximage2d"><a href="#æœ€åŸºç¡€çš„ä¸Šä¼ glteximage2d" class="headerlink" title="æœ€åŸºç¡€çš„ä¸Šä¼ glteximage2d"></a><a class="markdownIt-Anchor" href="#æœ€åŸºç¡€çš„ä¸Šä¼ glteximage2d"></a> æœ€åŸºç¡€çš„ä¸Šä¼ ï¼šglTexImage2D</h3>
<p>2.1 å‡½æ•°ç­¾å</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glTexImage2D</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    GLenum target,     <span class="hljs-comment">// GL_TEXTURE_2D</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLint level,       <span class="hljs-comment">// mipmapå±‚çº§ï¼ˆ0=åŸå›¾ï¼‰</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLint internalFormat, <span class="hljs-comment">// GPUé‡Œæ€ä¹ˆå­˜ï¼ˆGL_RGBA8ï¼‰</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLsizei width,</span></span><br><span class="hljs-params"><span class="hljs-function">    GLsizei height,</span></span><br><span class="hljs-params"><span class="hljs-function">    GLint border,      <span class="hljs-comment">// å¿…é¡»æ˜¯0</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLenum format,     <span class="hljs-comment">// å†…å­˜é‡Œæ€ä¹ˆæ’ï¼ˆGL_RGBAï¼‰</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLenum type,       <span class="hljs-comment">// æ•°æ®ç±»å‹ï¼ˆGL_UNSIGNED_BYTEï¼‰</span></span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-type">const</span> <span class="hljs-type">void</span>* data   <span class="hljs-comment">// ä½ çš„åƒç´ æ•°æ®</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure>
<p>â€‹<br />
2.2 ä¸¤ç§å·¥ä½œæ¨¡å¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ¨¡å¼1ï¼šdata != NULL â†’ åˆ†é…æ˜¾å­˜ + æ‹·è´æ•°æ®</span><br><span class="hljs-built_in">glTexImage2D</span>(..., width, height, ..., data);<br><span class="hljs-comment">// æ­¤æ—¶dataå¯ä»¥freeäº†</span><br><br><span class="hljs-comment">// æ¨¡å¼2ï¼šdata == NULL â†’ åªåˆ†é…æ˜¾å­˜ï¼Œä¸ä¼ æ•°æ®</span><br><span class="hljs-built_in">glTexImage2D</span>(..., width, height, ..., <span class="hljs-literal">NULL</span>);<br><span class="hljs-comment">// åé¢ç”¨glTexSubImage2Dæ…¢æ…¢ä¼ </span><br></code></pre></td></tr></table></figure>
<p>â€‹<br />
2.3 ç¼ºç‚¹<br />
âŒ æ¯æ¬¡è°ƒç”¨éƒ½é‡æ–°åˆ†é…æ˜¾å­˜ï¼ˆæ…¢ï¼‰<br />
âŒ ä¸èƒ½å±€éƒ¨æ›´æ–°ï¼ˆè¦ä¼ å°±ä¼ æ•´å¼ ï¼‰<br />
âŒ CPU-&gt;GPUæ˜¯åŒæ­¥çš„ï¼ˆCPUç­‰GPUæ”¶å®Œæ‰è¿”å›ï¼‰<br />
âŒ å†…å­˜é‡Œdataè¦å®Œæ•´å­˜åœ¨ï¼ˆå¤§å›¾çˆ†RAMï¼‰</p>
<p>â€‹</p>
<h3 id="å±€éƒ¨æ›´æ–°gltexsubimage2d"><a href="#å±€éƒ¨æ›´æ–°gltexsubimage2d" class="headerlink" title="å±€éƒ¨æ›´æ–°gltexsubimage2d"></a><a class="markdownIt-Anchor" href="#å±€éƒ¨æ›´æ–°gltexsubimage2d"></a> å±€éƒ¨æ›´æ–°ï¼šglTexSubImage2D</h3>
<p>3.1 å‡½æ•°ç­¾å</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glTexSubImage2D</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    GLenum target,</span></span><br><span class="hljs-params"><span class="hljs-function">    GLint level,</span></span><br><span class="hljs-params"><span class="hljs-function">    GLint xoffset,     <span class="hljs-comment">// ä»å“ªé‡Œå¼€å§‹è´´</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLint yoffset,</span></span><br><span class="hljs-params"><span class="hljs-function">    GLsizei width,     <span class="hljs-comment">// è´´å¤šå¤§åŒºåŸŸ</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLsizei height,</span></span><br><span class="hljs-params"><span class="hljs-function">    GLenum format,     <span class="hljs-comment">// æ ¼å¼å’ŒglTexImage2Dä¸€è‡´</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLenum type,</span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-type">const</span> <span class="hljs-type">void</span>* data</span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure>
<p>â€‹<br />
3.2 å…¸å‹ç”¨æ³•ï¼šåŠ¨æ€çº¹ç†</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. å…ˆåˆ†é…æ˜¾å­˜ï¼ˆä¸ä¼ æ•°æ®ï¼‰</span><br><span class="hljs-built_in">glTexImage2D</span>(GL_TEXTURE_2D, <span class="hljs-number">0</span>, GL_RGBA8, <span class="hljs-number">1024</span>, <span class="hljs-number">1024</span>, <span class="hljs-number">0</span>, GL_RGBA, GL_UNSIGNED_BYTE, <span class="hljs-literal">NULL</span>);<br><br><span class="hljs-comment">// 2. æ¯å¸§åªæ›´æ–°å˜åŒ–åŒºåŸŸ</span><br><span class="hljs-keyword">while</span> (render) &#123;<br>    <span class="hljs-comment">// æ‘„åƒå¤´ç”»é¢åªæœ‰ä¸­é—´ä¸€å—å˜äº†</span><br>    <span class="hljs-built_in">glTexSubImage2D</span>(GL_TEXTURE_2D, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>, GL_RGBA, GL_UNSIGNED_BYTE, cameraData);<br>    <span class="hljs-comment">// å…¶ä»–åŒºåŸŸä¿æŒåŸæ ·ï¼</span><br>    <span class="hljs-built_in">draw</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>â€‹<br />
3.3 æ€§èƒ½å¯¹æ¯”</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// âŒ æ…¢ï¼šæ¯å¸§é‡æ–°åˆ†é…</span><br><span class="hljs-built_in">glTexImage2D</span>(..., newData);  <span class="hljs-comment">// 10ms</span><br><br><span class="hljs-comment">// âœ… å¿«ï¼šåªæ›´æ–°å±€éƒ¨</span><br><span class="hljs-built_in">glTexSubImage2D</span>(..., changedData);  <span class="hljs-comment">// 0.5ms</span><br>â€‹<br>åŒºåˆ«ï¼š<br>Â· glTexImage2D = æ‹†äº†æˆ¿å­é‡æ–°ç›–<br>Â· glTexSubImage2D = å“ªé‡Œåäº†è¡¥å“ªé‡Œ<br></code></pre></td></tr></table></figure>
<h3 id="å†…å­˜æ˜ å°„glmapbufferpbo"><a href="#å†…å­˜æ˜ å°„glmapbufferpbo" class="headerlink" title="å†…å­˜æ˜ å°„glmapbufferpbo"></a><a class="markdownIt-Anchor" href="#å†…å­˜æ˜ å°„glmapbufferpbo"></a> å†…å­˜æ˜ å°„ï¼šglMapBufferï¼ˆPBOï¼‰</h3>
<p>4.1 é—®é¢˜ï¼šæ•°æ®è¦ä»æ–‡ä»¶è¯»</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ï¼šä¸‰æ­¥æ‹·è´ï¼</span><br>FILE* f = <span class="hljs-built_in">fopen</span>(<span class="hljs-string">&quot;texture.bin&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>);<br><span class="hljs-built_in">fread</span>(tempBuffer, size, <span class="hljs-number">1</span>, f);  <span class="hljs-comment">// 1. ç£ç›˜ â†’ RAMä¸´æ—¶</span><br><span class="hljs-built_in">glTexSubImage2D</span>(..., tempBuffer); <span class="hljs-comment">// 2. RAMä¸´æ—¶ â†’ é©±åŠ¨</span><br><span class="hljs-keyword">delete</span>[] tempBuffer;            <span class="hljs-comment">// 3. é‡Šæ”¾ä¸´æ—¶</span><br><span class="hljs-comment">// æ€»å…±ï¼š2æ¬¡CPUæ‹·è´ + 1æ¬¡GPUä¼ è¾“</span><br></code></pre></td></tr></table></figure>
<p>â€‹<br />
4.2 PBO = Pixel Buffer Object</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. åˆ›å»ºPBOï¼ˆæ˜¾å­˜é‡Œçš„ç¼“å†²åŒºï¼‰</span><br>GLuint pbo;<br><span class="hljs-built_in">glGenBuffers</span>(<span class="hljs-number">1</span>, &amp;pbo);<br><span class="hljs-built_in">glBindBuffer</span>(GL_PIXEL_UNPACK_BUFFER, pbo);<br><span class="hljs-built_in">glBufferData</span>(GL_PIXEL_UNPACK_BUFFER, size, <span class="hljs-literal">NULL</span>, GL_STREAM_DRAW);<br><br><span class="hljs-comment">// 2. æ˜ å°„åˆ°CPUåœ°å€ç©ºé—´</span><br><span class="hljs-type">void</span>* ptr = <span class="hljs-built_in">glMapBuffer</span>(GL_PIXEL_UNPACK_BUFFER, GL_WRITE_ONLY);<br><span class="hljs-built_in">fread</span>(ptr, size, <span class="hljs-number">1</span>, f);  <span class="hljs-comment">// ç›´æ¥è¯»è¿›æ˜¾å­˜ï¼è·³è¿‡RAMæ‹·è´</span><br><span class="hljs-built_in">glUnmapBuffer</span>(GL_PIXEL_UNPACK_BUFFER);<br><br><span class="hljs-comment">// 3. å‘Šè¯‰OpenGLä»PBOå–æ•°æ®</span><br><span class="hljs-built_in">glTexSubImage2D</span>(..., <span class="hljs-number">0</span>);  <span class="hljs-comment">// dataå‚æ•°æ˜¯åç§»é‡ï¼Œä¸æ˜¯æŒ‡é’ˆï¼</span><br><br>â€‹<br>ä¼˜åŠ¿ï¼š<br>âœ… <span class="hljs-number">0</span>æ¬¡CPUæ‹·è´ï¼ˆæ–‡ä»¶â†’æ˜¾å­˜ç›´é€šï¼‰<br>âœ… å¼‚æ­¥ä¼ è¾“ï¼ˆCPUä¸ç­‰å¾…GPUï¼‰<br>âœ… å†…å­˜å¤ç”¨ï¼ˆä¸ç”¨åå¤malloc/freeï¼‰<br></code></pre></td></tr></table></figure>
<p>â€‹<br />
4.3 PBOåŒç¼“å†²ï¼ˆç»ˆæå½¢æ€ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 2ä¸ªPBOè½®æµç”¨</span><br>GLuint pbo[<span class="hljs-number">2</span>];<br><span class="hljs-type">int</span> currentPBO = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">while</span> (render) &#123;<br>    currentPBO = (currentPBO + <span class="hljs-number">1</span>) % <span class="hljs-number">2</span>;<br><br>    <span class="hljs-comment">// 1. æ˜ å°„å½“å‰PBOï¼Œå†™å…¥ä¸‹ä¸€å¸§æ•°æ®</span><br>    <span class="hljs-built_in">glBindBuffer</span>(GL_PIXEL_UNPACK_BUFFER, pbo[currentPBO]);<br>    <span class="hljs-type">void</span>* ptr = <span class="hljs-built_in">glMapBuffer</span>(GL_PIXEL_UNPACK_BUFFER, GL_WRITE_ONLY);<br>    <span class="hljs-comment">// ç”Ÿæˆ/è¯»å–ä¸‹ä¸€å¸§æ•°æ®...</span><br>    <span class="hljs-built_in">glUnmapBuffer</span>(GL_PIXEL_UNPACK_BUFFER);<br><br>    <span class="hljs-comment">// 2. ä¸Šä¼ ä¸Šä¸€å¸§çš„æ•°æ®ï¼ˆä»å¦ä¸€ä¸ªPBOï¼‰</span><br>    <span class="hljs-built_in">glBindBuffer</span>(GL_PIXEL_UNPACK_BUFFER, pbo[<span class="hljs-number">1</span> - currentPBO]);<br>    <span class="hljs-built_in">glTexSubImage2D</span>(..., <span class="hljs-number">0</span>);  <span class="hljs-comment">// GPUå¤„ç†ä¸Šä¼ ï¼ŒCPUåŒæ—¶ç”Ÿæˆä¸‹ä¸€å¸§</span><br><br>    <span class="hljs-built_in">draw</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è§†é¢‘æ’­æ”¾å™¨ã€æ‘„åƒå¤´é¢„è§ˆéƒ½æ˜¯è¿™ä¸ªåŸç†ï¼</p>
<h3 id="æŒä¹…æ˜ å°„persistent-mapping"><a href="#æŒä¹…æ˜ å°„persistent-mapping" class="headerlink" title="æŒä¹…æ˜ å°„persistent-mapping"></a><a class="markdownIt-Anchor" href="#æŒä¹…æ˜ å°„persistent-mapping"></a> æŒä¹…æ˜ å°„ï¼ˆPersistent Mappingï¼‰</h3>
<p>5.1 é—®é¢˜ï¼šglMap/glUnmapè¿˜æ˜¯æœ‰å¼€é”€</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ¯å¸§éƒ½è¦ï¼š</span><br><span class="hljs-built_in">glMapBuffer</span>()   <span class="hljs-comment">// å‘Šè¯‰é©±åŠ¨æˆ‘è¦å†™äº†</span><br><span class="hljs-comment">// å†™æ•°æ®...</span><br><span class="hljs-built_in">glUnmapBuffer</span>() <span class="hljs-comment">// å‘Šè¯‰é©±åŠ¨å†™å®Œäº†</span><br><span class="hljs-comment">// é©±åŠ¨è¦åšå†…å­˜åŒæ­¥ã€æƒé™æ£€æŸ¥</span><br></code></pre></td></tr></table></figure>
<p>â€‹<br />
5.2 ARB_buffer_storage æ‰©å±•</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. åˆ›å»ºæŒä¹…æ˜ å°„çš„ç¼“å†²åŒº</span><br><span class="hljs-built_in">glBufferStorage</span>(GL_PIXEL_UNPACK_BUFFER, size, <span class="hljs-literal">NULL</span>,<br>                GL_MAP_WRITE_BIT | GL_MAP_PERSISTENT_BIT | GL_MAP_COHERENT_BIT);<br><br><span class="hljs-comment">// 2. æ˜ å°„ä¸€æ¬¡ï¼Œæ°¸è¿œæœ‰æ•ˆ</span><br><span class="hljs-type">void</span>* ptr = <span class="hljs-built_in">glMapBufferRange</span>(GL_PIXEL_UNPACK_BUFFER, <span class="hljs-number">0</span>, size,<br>                             GL_MAP_WRITE_BIT | GL_MAP_PERSISTENT_BIT | GL_MAP_COHERENT_BIT);<br><br><span class="hljs-comment">// 3. ç›´æ¥å†™æŒ‡é’ˆï¼Œä¸ç”¨map/unmap</span><br><span class="hljs-keyword">while</span> (render) &#123;<br>    <span class="hljs-built_in">memcpy</span>(ptr, newData, size);  <span class="hljs-comment">// ç›´æ¥å†™ï¼</span><br>    <span class="hljs-built_in">glTexSubImage2D</span>(..., <span class="hljs-number">0</span>);     <span class="hljs-comment">// GPUç›´æ¥è¯»</span><br>    <span class="hljs-comment">// æ²¡æœ‰map/unmapå¼€é”€ï¼</span><br>&#125;<br>â€‹<br>ç°ä»£OpenGL/Vulkanéƒ½ç”¨è¿™ä¸ªæ¨¡å¼<br></code></pre></td></tr></table></figure>
<h3 id="å¼‚æ­¥ä¸Šä¼ çœŸæ­£çš„å¹¶è¡Œ"><a href="#å¼‚æ­¥ä¸Šä¼ çœŸæ­£çš„å¹¶è¡Œ" class="headerlink" title="å¼‚æ­¥ä¸Šä¼ çœŸæ­£çš„å¹¶è¡Œ"></a><a class="markdownIt-Anchor" href="#å¼‚æ­¥ä¸Šä¼ çœŸæ­£çš„å¹¶è¡Œ"></a> å¼‚æ­¥ä¸Šä¼ ï¼ˆçœŸæ­£çš„å¹¶è¡Œï¼‰</h3>
<p>6.1 é—®é¢˜ï¼šglTexSubImage2D æ˜¯åŒæ­¥çš„</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glTexSubImage2D</span>(...);  <span class="hljs-comment">// è¿™ä¸ªå‡½æ•°ä¸è¿”å›ï¼Œç›´åˆ°GPUæ”¶å®Œæ•°æ®ï¼</span><br><span class="hljs-comment">// CPUç­‰åœ¨è¿™é‡Œï¼ä¸èƒ½åšå…¶ä»–äº‹ï¼</span><br></code></pre></td></tr></table></figure>
<p>â€‹<br />
6.2 ç”¨FenceåŒæ­¥</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. å‘èµ·ä¸Šä¼ </span><br><span class="hljs-built_in">glTexSubImage2D</span>(...);<br><br><span class="hljs-comment">// 2. æ’å…¥ä¸€ä¸ªåŒæ­¥æ ‡è®°</span><br>GLsync sync = <span class="hljs-built_in">glFenceSync</span>(GL_SYNC_GPU_COMMANDS_COMPLETE, <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 3. é©¬ä¸Šå›æ¥åšå…¶ä»–CPUå·¥ä½œ</span><br><span class="hljs-built_in">generateNextFrameData</span>();  <span class="hljs-comment">// å’ŒGPUä¸Šä¼ å¹¶è¡Œï¼</span><br><br><span class="hljs-comment">// 4. éœ€è¦æ—¶å†ç­‰GPU</span><br><span class="hljs-built_in">glClientWaitSync</span>(sync, <span class="hljs-number">0</span>, GL_TIMEOUT_IGNORED);<br><span class="hljs-built_in">glDeleteSync</span>(sync);<br><br>â€‹<br>ç†æƒ³æµæ°´çº¿ï¼š<br>å¸§<span class="hljs-number">1</span>: CPU[ç”Ÿæˆæ•°æ®] â†’ GPU[ä¸Šä¼ çº¹ç†] â†’ GPU[æ¸²æŸ“]<br>å¸§<span class="hljs-number">2</span>:              CPU[ç”Ÿæˆæ•°æ®] â†’ GPU[ä¸Šä¼ çº¹ç†] â†’ GPU[æ¸²æŸ“]<br>å¸§<span class="hljs-number">3</span>:                           CPU[ç”Ÿæˆæ•°æ®] â†’ GPU[ä¸Šä¼ çº¹ç†] â†’ GPU[æ¸²æŸ“]<br></code></pre></td></tr></table></figure>
<p>â€‹</p>
<h3 id="å‹ç¼©çº¹ç†ä¸Šä¼ "><a href="#å‹ç¼©çº¹ç†ä¸Šä¼ " class="headerlink" title="å‹ç¼©çº¹ç†ä¸Šä¼ "></a><a class="markdownIt-Anchor" href="#å‹ç¼©çº¹ç†ä¸Šä¼ "></a> å‹ç¼©çº¹ç†ä¸Šä¼ </h3>
<p>7.1 ç›´æ¥ä¸Šä¼ å‹ç¼©æ ¼å¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// DDSæ–‡ä»¶é‡Œç›´æ¥æ˜¯DXTå‹ç¼©æ•°æ®</span><br><span class="hljs-built_in">glCompressedTexImage2D</span>(<br>    GL_TEXTURE_2D, <span class="hljs-number">0</span>,<br>    GL_COMPRESSED_RGBA_S3TC_DXT5_EXT,  <span class="hljs-comment">// å‹ç¼©æ ¼å¼</span><br>    width, height, <span class="hljs-number">0</span>,<br>    dataSize,      <span class="hljs-comment">// å‹ç¼©åå¤§å°</span><br>    data<br>);<br><br><span class="hljs-comment">// ä¸èƒ½ç”¨glTexImage2Dï¼</span><br><span class="hljs-comment">// ä¸èƒ½ç”¨glTexSubImage2Dï¼ˆå‹ç¼©å—å¿…é¡»æ•´å—æ›´æ–°ï¼‰</span><br></code></pre></td></tr></table></figure>
<p>â€‹<br />
7.2 å‹ç¼©çº¹ç†çš„å—å¯¹é½</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// DXT/BC å‹ç¼©å—æ˜¯ 4x4 åƒç´ </span><br><span class="hljs-comment">// æ›´æ–°æœ€å°å•ä½æ˜¯å—ï¼Œä¸æ˜¯åƒç´ ï¼</span><br><br><span class="hljs-comment">// âŒ é”™è¯¯ï¼šæ›´æ–°å•ä¸ªåƒç´ </span><br><span class="hljs-built_in">glCompressedTexSubImage2D</span>(..., x=<span class="hljs-number">1</span>, y=<span class="hljs-number">1</span>, width=<span class="hljs-number">1</span>, height=<span class="hljs-number">1</span>, ...);<br><span class="hljs-comment">// ä¸åˆæ³•ï¼å¿…é¡»4x4å¯¹é½</span><br><br><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šæ›´æ–°æ•´ä¸ªå—</span><br><span class="hljs-built_in">glCompressedTexSubImage2D</span>(..., x=<span class="hljs-number">0</span>, y=<span class="hljs-number">0</span>, width=<span class="hljs-number">4</span>, height=<span class="hljs-number">4</span>, ...);<br></code></pre></td></tr></table></figure>
<p>â€‹</p>
<h2 id="æ·±åº¦ç¼“å†²"><a href="#æ·±åº¦ç¼“å†²" class="headerlink" title="æ·±åº¦ç¼“å†²"></a><a class="markdownIt-Anchor" href="#æ·±åº¦ç¼“å†²"></a> æ·±åº¦ç¼“å†²</h2>
<h3 id="ä»€ä¹ˆæ˜¯æ·±åº¦ç¼“å†²"><a href="#ä»€ä¹ˆæ˜¯æ·±åº¦ç¼“å†²" class="headerlink" title="ä»€ä¹ˆæ˜¯æ·±åº¦ç¼“å†²"></a><a class="markdownIt-Anchor" href="#ä»€ä¹ˆæ˜¯æ·±åº¦ç¼“å†²"></a> ä»€ä¹ˆæ˜¯æ·±åº¦ç¼“å†²ï¼Ÿ</h3>
<p>æ·±åº¦ç¼“å†² = Z-Buffer = è®°å½•æ¯ä¸ªåƒç´ ç¦»æ‘„åƒæœºæœ‰å¤šè¿œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ä½ ç”»äº†ä¸€ä¸ªçƒï¼Œåˆç”»äº†ä¸€ä¸ªç«‹æ–¹ä½“<br>ä½†ç«‹æ–¹ä½“åœ¨çƒåé¢ï¼Œå´è¢«ç”»åœ¨äº†çƒå‰é¢ï¼<br>                                    â†“<br>GPUæ€ä¹ˆçŸ¥é“è°å‰è°åï¼Ÿ â†’ æ·±åº¦ç¼“å†²ï¼<br><br></code></pre></td></tr></table></figure>
<p>1.1 å¯è§†åŒ–ç†è§£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">å±å¹•ä¸Šçš„æ¯ä¸ªåƒç´ ï¼š<br>_________________<br>| åƒç´   | æ·±åº¦å€¼  |<br>|------|--------|<br>| (0,0)| 0.3    |  â† è¿‘å¤„<br>| (1,0)| 0.7    |  â† è¿œå¤„<br>| (2,0)| 0.5    |  â† ä¸­é—´<br>| ...  | ...    |<br><br>æ·±åº¦å€¼èŒƒå›´ï¼šè¿‘è£å‰ªé¢ = 0.0ï¼Œè¿œè£å‰ªé¢ = 1.0<br><br></code></pre></td></tr></table></figure>
<p>1.2 æ·±åº¦æµ‹è¯•åŸç†</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ä¼ªä»£ç </span><br><span class="hljs-keyword">for</span> (æ¯ä¸ªä¸‰è§’å½¢) &#123;<br>    <span class="hljs-keyword">for</span> (æ¯ä¸ªåƒç´ ) &#123;<br>        <span class="hljs-type">float</span> z = è®¡ç®—æ·±åº¦();<br>        <span class="hljs-keyword">if</span> (z &lt; depthBuffer[x][y]) &#123;  <span class="hljs-comment">// æ›´è¿‘ï¼Ÿ</span><br>            framebuffer[x][y] = color;  <span class="hljs-comment">// ç”»ï¼</span><br>            depthBuffer[x][y] = z;      <span class="hljs-comment">// æ›´æ–°æ·±åº¦</span><br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="æ·±åº¦ç¼“å†²çš„æ ¸å¿ƒä¸‰è¦ç´ "><a href="#æ·±åº¦ç¼“å†²çš„æ ¸å¿ƒä¸‰è¦ç´ " class="headerlink" title="æ·±åº¦ç¼“å†²çš„æ ¸å¿ƒä¸‰è¦ç´ "></a><a class="markdownIt-Anchor" href="#æ·±åº¦ç¼“å†²çš„æ ¸å¿ƒä¸‰è¦ç´ "></a> æ·±åº¦ç¼“å†²çš„æ ¸å¿ƒä¸‰è¦ç´ </h3>
<p>2.1 å¯ç”¨æ·±åº¦æµ‹è¯•</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. æ‰“å¼€æ·±åº¦æµ‹è¯•</span><br><span class="hljs-built_in">glEnable</span>(GL_DEPTH_TEST);<br><br><span class="hljs-comment">// 2. æ¯å¸§æ¸…é™¤æ·±åº¦ç¼“å†²</span><br><span class="hljs-built_in">glClear</span>(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);<br><span class="hljs-comment">//                    â†‘ å¿˜äº†è¿™ä¸ªå°±ä¹±å¥—ï¼</span><br><br></code></pre></td></tr></table></figure>
<p>å¿˜äº†æ¸…é™¤æ·±åº¦ç¼“å†²ä¼šæ€æ ·ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ç¬¬1å¸§ï¼šæ·±åº¦=0.5<br>ç¬¬2å¸§ï¼šæ·±åº¦=0.7 â†’ 0.5 &lt; 0.7ï¼Ÿä¸ç”»ï¼<br>ç¬¬3å¸§ï¼šè¶Šæ¥è¶Šè¿œ... æœ€åå•¥ä¹Ÿç”»ä¸å‡ºæ¥ï¼<br><br></code></pre></td></tr></table></figure>
<p>2.2 æ·±åº¦æ¯”è¾ƒå‡½æ•°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// é»˜è®¤ï¼šGL_LESSï¼ˆè¿‘çš„è¦†ç›–è¿œçš„ï¼‰</span><br><span class="hljs-built_in">glDepthFunc</span>(GL_LESS);    <span class="hljs-comment">// z &lt; depthBuffer â†’ é€šè¿‡</span><br><br><span class="hljs-comment">// å…¶ä»–é€‰é¡¹ï¼š</span><br>GL_ALWAYS   <span class="hljs-comment">// æ€»æ˜¯ç”»ï¼ˆä¸ç”¨æ·±åº¦æµ‹è¯•ï¼‰</span><br>GL_NEVER    <span class="hljs-comment">// æ€»æ˜¯ä¸ç”»</span><br>GL_EQUAL    <span class="hljs-comment">// ç›¸ç­‰æ‰ç”»</span><br>GL_LEQUAL   <span class="hljs-comment">// &lt;= é€šè¿‡ï¼ˆå¸¸ç”¨äºå¤©ç©ºç›’ï¼‰</span><br>GL_GREATER  <span class="hljs-comment">// &gt; é€šè¿‡ï¼ˆåè½¬ä¸–ç•Œï¼‰</span><br><br></code></pre></td></tr></table></figure>
<p>2.3 æ·±åº¦å†™å…¥</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// é»˜è®¤å¼€å¯ï¼šç”»è¿‡çš„åƒç´ ä¼šæ›´æ–°æ·±åº¦ç¼“å†²</span><br><span class="hljs-built_in">glDepthMask</span>(GL_TRUE);<br><br><span class="hljs-comment">// å…³é—­ï¼šåªè¯»ä¸å†™ï¼ˆé€æ˜ç‰©ä½“éœ€è¦ï¼‰</span><br><span class="hljs-built_in">glDepthMask</span>(GL_FALSE);<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="æ·±åº¦ç¼“å†²çš„ç²¾åº¦é—®é¢˜z-fighting"><a href="#æ·±åº¦ç¼“å†²çš„ç²¾åº¦é—®é¢˜z-fighting" class="headerlink" title="æ·±åº¦ç¼“å†²çš„ç²¾åº¦é—®é¢˜z-fighting"></a><a class="markdownIt-Anchor" href="#æ·±åº¦ç¼“å†²çš„ç²¾åº¦é—®é¢˜z-fighting"></a> æ·±åº¦ç¼“å†²çš„ç²¾åº¦é—®é¢˜ï¼ˆZ-Fightingï¼‰</h3>
<p>3.1 ä¸ºä»€ä¹ˆä¼šæœ‰ç²¾åº¦é—®é¢˜ï¼Ÿ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æŠ•å½±çŸ©é˜µæŠŠè§†é”¥ä½“å‹ç¼©åˆ° [0, 1]</span><br><span class="hljs-comment">// ä½†ï¼ä¸æ˜¯çº¿æ€§å‹ç¼©ï¼Œæ˜¯å€’æ•°å‹ç¼©ï¼</span><br><br>è¿‘å¹³é¢<span class="hljs-number">1.0</span> â†’ æ·±åº¦<span class="hljs-number">0.0</span><br>è¿œå¹³é¢<span class="hljs-number">100.0</span> â†’ æ·±åº¦<span class="hljs-number">1.0</span><br><br><span class="hljs-comment">// å®é™…åˆ†å¸ƒï¼š</span><br><span class="hljs-number">1.0</span> - <span class="hljs-number">1.1</span>: æ·±åº¦<span class="hljs-number">0.000</span> - <span class="hljs-number">0.095</span>  â† <span class="hljs-number">10</span>cmå <span class="hljs-number">10</span>%ç²¾åº¦<br><span class="hljs-number">1.1</span> - <span class="hljs-number">2.0</span>: æ·±åº¦<span class="hljs-number">0.095</span> - <span class="hljs-number">0.500</span>  â† <span class="hljs-number">90</span>cmå <span class="hljs-number">40</span>%ç²¾åº¦<br><span class="hljs-number">2.0</span> - <span class="hljs-number">100</span>: æ·±åº¦<span class="hljs-number">0.500</span> - <span class="hljs-number">1.000</span>  â† <span class="hljs-number">98</span>må <span class="hljs-number">50</span>%ç²¾åº¦<br><br>ç»“è®ºï¼šè¿‘å¤„ç²¾åº¦æé«˜ï¼Œè¿œå¤„ç²¾åº¦æå·®ï¼<br><br></code></pre></td></tr></table></figure>
<p>3.2 Z-Fightingç°è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ä¸¤ä¸ªå¹³é¢è·ç¦»0.01ç±³ï¼Œåœ¨è¿œå¤„ï¼š<br>å¹³é¢Aæ·±åº¦ = 0.999500<br>å¹³é¢Bæ·±åº¦ = 0.999501<br><br>æ·±åº¦ç¼“å†²åªæœ‰24ä½ â‰ˆ 1677ä¸‡çº§<br>0.999500 å’Œ 0.999501 æ˜¯åŒä¸€ä¸ªæ•´æ•°ï¼<br>â†’ ä¸¤ä¸ªå¹³é¢ç–¯ç‹‚é—ªçƒï¼<br><br></code></pre></td></tr></table></figure>
<p>ç»å…¸åœºæ™¯ï¼š</p>
<p>Â· åœ°é¢å’Œè‰çš®<br />
Â· é‡å çš„ Decal<br />
Â· å¤§åœºæ™¯è¿œæ™¯</p>
<p>3.3 è§£å†³æ–¹æ¡ˆ</p>
<p>æ–¹æ¡ˆ1ï¼šåè½¬Zï¼ˆReverse Zï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æŠŠè¿‘è¿œå¹³é¢åè¿‡æ¥ï¼</span><br>near = <span class="hljs-number">100.0</span>, far = <span class="hljs-number">1.0</span>  <span class="hljs-comment">// è¿‘å¤§è¿œå°</span><br><br><span class="hljs-comment">// æ·±åº¦åˆ†å¸ƒåè¿‡æ¥ï¼š</span><br>è¿œå¤„ â†’ <span class="hljs-number">0.0</span>ï¼ˆé«˜ç²¾åº¦ï¼‰<br>è¿‘å¤„ â†’ <span class="hljs-number">1.0</span>ï¼ˆä½ç²¾åº¦ï¼‰<br><br><span class="hljs-comment">// æµ®ç‚¹æ•°åœ¨0.0é™„è¿‘ç²¾åº¦æœ€é«˜ï¼</span><br><span class="hljs-built_in">glDepthFunc</span>(GL_GREATER);  <span class="hljs-comment">// æ”¹æˆå¤§äºé€šè¿‡</span><br><br></code></pre></td></tr></table></figure>
<p>æ–¹æ¡ˆ2ï¼šæé«˜æ·±åº¦ç²¾åº¦</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// é»˜è®¤24ä½</span><br><span class="hljs-built_in">glTexImage2D</span>(GL_DEPTH_COMPONENT, <span class="hljs-number">0</span>, GL_DEPTH_COMPONENT24, ...);<br><br><span class="hljs-comment">// 32ä½æµ®ç‚¹ï¼ˆæ…¢ï¼Œä½†å‡†ï¼‰</span><br><span class="hljs-built_in">glTexImage2D</span>(GL_DEPTH_COMPONENT, <span class="hljs-number">0</span>, GL_DEPTH_COMPONENT32F, ...);<br><br></code></pre></td></tr></table></figure>
<p>æ–¹æ¡ˆ3ï¼šæ‹‰è¿‘è¿œå¹³é¢</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// âŒ far = 10000.0</span><br>glm::<span class="hljs-built_in">perspective</span>(<span class="hljs-number">45.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.1f</span>, <span class="hljs-number">10000.0f</span>);<br><br><span class="hljs-comment">// âœ… far = 1000.0</span><br>glm::<span class="hljs-built_in">perspective</span>(<span class="hljs-number">45.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.1f</span>, <span class="hljs-number">1000.0f</span>);<br><br></code></pre></td></tr></table></figure>
<p>æ–¹æ¡ˆ4ï¼šå°åç§»ï¼ˆPolygon Offsetï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è®©è‰çš®æ¯”åœ°é¢&quot;æ›´è¿‘&quot;ä¸€ç‚¹ç‚¹</span><br><span class="hljs-built_in">glEnable</span>(GL_POLYGON_OFFSET_FILL);<br><span class="hljs-built_in">glPolygonOffset</span>(<span class="hljs-number">1.0f</span>, <span class="hljs-number">1.0f</span>);  <span class="hljs-comment">// åç§»é‡</span><br><br><span class="hljs-built_in">drawGround</span>();   <span class="hljs-comment">// æ­£å¸¸æ·±åº¦</span><br><span class="hljs-built_in">drawGrass</span>();    <span class="hljs-comment">// æ·±åº¦+åç§» â†’ æ°¸è¿œåœ¨ä¸Šé¢</span><br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="æ·±åº¦ç¼“å†²çš„å¯è§†åŒ–"><a href="#æ·±åº¦ç¼“å†²çš„å¯è§†åŒ–" class="headerlink" title="æ·±åº¦ç¼“å†²çš„å¯è§†åŒ–"></a><a class="markdownIt-Anchor" href="#æ·±åº¦ç¼“å†²çš„å¯è§†åŒ–"></a> æ·±åº¦ç¼“å†²çš„å¯è§†åŒ–</h3>
<p>4.1 æŠŠæ·±åº¦å€¼å½“æˆé¢œè‰²çœ‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ç‰‡å…ƒç€è‰²å™¨</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-type">float</span> depth = gl_FragCoord.z;  <span class="hljs-comment">// 0.0 - 1.0</span><br>    FragColor = <span class="hljs-built_in">vec4</span>(<span class="hljs-built_in">vec3</span>(depth), <span class="hljs-number">1.0</span>);<br>    <span class="hljs-comment">// è¿‘å¤„é»‘ï¼Œè¿œå¤„ç™½</span><br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>è°ƒè¯•æŠ€å·§ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">çº¯é»‘ â†’ æ·±åº¦=0.0ï¼ˆåœ¨è¿‘å¹³é¢ï¼‰<br>çº¯ç™½ â†’ æ·±åº¦=1.0ï¼ˆåœ¨è¿œå¹³é¢ï¼‰<br>é—ªçƒ â†’ Z-Fightingï¼<br><br></code></pre></td></tr></table></figure>
<p>4.2 çº¿æ€§åŒ–æ·±åº¦</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æŠŠéçº¿æ€§çš„æ·±åº¦è½¬æˆçº¿æ€§</span><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">linearizeDepth</span><span class="hljs-params">(<span class="hljs-type">float</span> depth)</span> </span>&#123;<br>    <span class="hljs-type">float</span> z = depth * <span class="hljs-number">2.0</span> - <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// è½¬åˆ°NDC</span><br>    <span class="hljs-keyword">return</span> (<span class="hljs-number">2.0</span> * near * far) / (far + near - z * (far - near));<br>    <span class="hljs-comment">// è¿”å›0-nearåˆ°farçš„è·ç¦»</span><br>&#125;<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="æ·±åº¦çº¹ç†é˜´å½±æ˜ å°„å‰ç½®"><a href="#æ·±åº¦çº¹ç†é˜´å½±æ˜ å°„å‰ç½®" class="headerlink" title="æ·±åº¦çº¹ç†é˜´å½±æ˜ å°„å‰ç½®"></a><a class="markdownIt-Anchor" href="#æ·±åº¦çº¹ç†é˜´å½±æ˜ å°„å‰ç½®"></a> æ·±åº¦çº¹ç†ï¼ˆé˜´å½±æ˜ å°„å‰ç½®ï¼‰</h3>
<p>5.1 æŠŠæ·±åº¦æ¸²æŸ“åˆ°çº¹ç†</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. åˆ›å»ºæ·±åº¦çº¹ç†</span><br>GLuint depthTexture;<br><span class="hljs-built_in">glGenTextures</span>(<span class="hljs-number">1</span>, &amp;depthTexture);<br><span class="hljs-built_in">glBindTexture</span>(GL_TEXTURE_2D, depthTexture);<br><span class="hljs-built_in">glTexImage2D</span>(GL_TEXTURE_2D, <span class="hljs-number">0</span>, GL_DEPTH_COMPONENT24, <span class="hljs-number">1024</span>, <span class="hljs-number">1024</span>, <span class="hljs-number">0</span>,<br>             GL_DEPTH_COMPONENT, GL_FLOAT, <span class="hljs-literal">NULL</span>);<br><br><span class="hljs-comment">// 2. ç»‘å®šåˆ°å¸§ç¼“å†²</span><br>GLuint depthFBO;<br><span class="hljs-built_in">glGenFramebuffers</span>(<span class="hljs-number">1</span>, &amp;depthFBO);<br><span class="hljs-built_in">glBindFramebuffer</span>(GL_FRAMEBUFFER, depthFBO);<br><span class="hljs-built_in">glFramebufferTexture2D</span>(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT,<br>                       GL_TEXTURE_2D, depthTexture, <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// 3. å‘Šè¯‰OpenGLï¼šæˆ‘ä¸ç”»é¢œè‰²</span><br><span class="hljs-built_in">glDrawBuffer</span>(GL_NONE);<br><span class="hljs-built_in">glReadBuffer</span>(GL_NONE);<br><br><span class="hljs-comment">// 4. æ¸²æŸ“åœºæ™¯åˆ°æ·±åº¦çº¹ç†</span><br><span class="hljs-built_in">glBindFramebuffer</span>(GL_FRAMEBUFFER, depthFBO);<br><span class="hljs-built_in">glClear</span>(GL_DEPTH_BUFFER_BIT);<br><span class="hljs-comment">// ç”»åœºæ™¯...</span><br><br></code></pre></td></tr></table></figure>
<p>5.2 åœ¨ç€è‰²å™¨é‡Œè¯»æ·±åº¦çº¹ç†</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-comment">// è¿™ä¸æ˜¯é¢œè‰²çº¹ç†ï¼æ˜¯æ·±åº¦çº¹ç†</span><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2DShadow</span> depthMap;  <span class="hljs-comment">// ç”¨Shadowé‡‡æ ·å™¨</span><br><br><span class="hljs-type">float</span> shadow = <span class="hljs-built_in">textureProj</span>(depthMap, shadowCoord);  <span class="hljs-comment">// è¿”å›0æˆ–1</span><br><br></code></pre></td></tr></table></figure>
<p>è¿™æ˜¯é˜´å½±æ˜ å°„ï¼ˆShadow Mappingï¼‰çš„åŸºç¡€ï¼</p>
<hr />
<h3 id="æ·±åº¦æµ‹è¯•çš„å¸¸è§é—®é¢˜"><a href="#æ·±åº¦æµ‹è¯•çš„å¸¸è§é—®é¢˜" class="headerlink" title="æ·±åº¦æµ‹è¯•çš„å¸¸è§é—®é¢˜"></a><a class="markdownIt-Anchor" href="#æ·±åº¦æµ‹è¯•çš„å¸¸è§é—®é¢˜"></a> æ·±åº¦æµ‹è¯•çš„å¸¸è§é—®é¢˜</h3>
<p>Q1: é€æ˜ç‰©ä½“æ€ä¹ˆå¤„ç†ï¼Ÿ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šç›´æ¥ç”»é€æ˜ç‰©ä½“</span><br><span class="hljs-built_in">glEnable</span>(GL_BLEND);<br><span class="hljs-built_in">drawTransparent</span>();  <span class="hljs-comment">// æ·±åº¦æµ‹è¯•å¼€ç€ï¼Œåé¢çš„é€æ˜ç‰©ä½“è¢«æŒ¡ä½äº†ï¼</span><br><br><span class="hljs-comment">// âœ… æ­£ç¡®ï¼š</span><br><span class="hljs-comment">// 1. ç”»æ‰€æœ‰ä¸é€æ˜ç‰©ä½“</span><br><span class="hljs-comment">// 2. ä»åå¾€å‰ç”»é€æ˜ç‰©ä½“</span><br><span class="hljs-built_in">glDepthMask</span>(GL_FALSE);  <span class="hljs-comment">// å…³æ·±åº¦å†™å…¥</span><br><span class="hljs-built_in">drawTransparentOrderedByDistance</span>();  <span class="hljs-comment">// è¿œâ†’è¿‘</span><br><span class="hljs-built_in">glDepthMask</span>(GL_TRUE);<br><br></code></pre></td></tr></table></figure>
<p>Q2: å¤©ç©ºç›’æ€ä¹ˆç”»ï¼Ÿ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// å¤©ç©ºç›’æ°¸è¿œåœ¨æœ€è¿œå¤„</span><br><span class="hljs-built_in">glDepthFunc</span>(GL_LEQUAL);  <span class="hljs-comment">// æ·±åº¦ç›¸ç­‰ä¹Ÿç”»</span><br><span class="hljs-built_in">drawSkybox</span>();<br><span class="hljs-built_in">glDepthFunc</span>(GL_LESS);    <span class="hljs-comment">// æ¢å¤</span><br><br></code></pre></td></tr></table></figure>
<p>Q3: æ·±åº¦å†²çªï¼ˆZ-Fightingï¼‰æ€ä¹ˆæŸ¥ï¼Ÿ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. å¯ç”¨æ·±åº¦åç§»çœ‹è°åœ¨ä¸Šé¢</span><br><span class="hljs-built_in">glPolygonOffset</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);<br><span class="hljs-built_in">glEnable</span>(GL_POLYGON_OFFSET_FILL);<br><br><span class="hljs-comment">// 2. å¯è§†åŒ–æ·±åº¦</span><br>FragColor = <span class="hljs-built_in">vec4</span>(<span class="hljs-built_in">vec3</span>(gl_FragCoord.z), <span class="hljs-number">1.0</span>);<br><br><span class="hljs-comment">// 3. æ‹‰è¿‘è¿œå¹³é¢æµ‹è¯•</span><br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a><a class="markdownIt-Anchor" href="#æ€§èƒ½ä¼˜åŒ–"></a> æ€§èƒ½ä¼˜åŒ–</h3>
<p>7.1 Early-Z æŠ€æœ¯</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ç°ä»£GPUåœ¨ç‰‡å…ƒç€è‰²å™¨**ä¹‹å‰**å°±åšæ·±åº¦æµ‹è¯•</span><br><span class="hljs-comment">// æ·±åº¦æ²¡é€šè¿‡ â†’ ç›´æ¥ä¸¢å¼ƒï¼Œä¸è·‘ç‰‡å…ƒç€è‰²å™¨ï¼</span><br><br><span class="hljs-comment">// âŒ ç ´åEarly-Zçš„æ“ä½œï¼š</span><br><span class="hljs-built_in">glDisable</span>(GL_DEPTH_TEST);<br><span class="hljs-built_in">glDepthMask</span>(GL_FALSE);  <span class="hljs-comment">// å…³æ·±åº¦å†™å…¥</span><br><span class="hljs-built_in">glDepthFunc</span>(GL_ALWAYS); <span class="hljs-comment">// æ€»æ˜¯é€šè¿‡</span><br><br><span class="hljs-comment">// âœ… ä¿æŒEarly-Zï¼š</span><br>å…ˆç”»æ‰€æœ‰ä¸é€æ˜ç‰©ä½“ï¼ˆæ·±åº¦æµ‹è¯•å¼€ï¼‰<br>åç”»é€æ˜ç‰©ä½“<br><br></code></pre></td></tr></table></figure>
<p>7.2 æ·±åº¦é¢„æ¸²æŸ“</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ç¬¬1éï¼šåªå†™æ·±åº¦ï¼Œä¸ç”»é¢œè‰²</span><br><span class="hljs-built_in">glColorMask</span>(GL_FALSE, GL_FALSE, GL_FALSE, GL_FALSE);<br><span class="hljs-built_in">drawScene</span>();<br><span class="hljs-built_in">glColorMask</span>(GL_TRUE, GL_TRUE, GL_TRUE, GL_TRUE);<br><br><span class="hljs-comment">// ç¬¬2éï¼šæ­£å¼æ¸²æŸ“ï¼ˆæ·±åº¦æµ‹è¯•å¼€ï¼Œæ·±åº¦å†™å…¥å…³ï¼‰</span><br><span class="hljs-built_in">glDepthMask</span>(GL_FALSE);<br><span class="hljs-built_in">drawScene</span>();  <span class="hljs-comment">// åªæœ‰å‰é¢é€šè¿‡çš„åƒç´ æ‰è·‘ç‰‡å…ƒç€è‰²å™¨</span><br><br><span class="hljs-comment">// å¥½å¤„ï¼šå‡å°‘overdrawï¼Œç‰‡å…ƒç€è‰²å™¨åªè·‘ä¸€æ¬¡ï¼</span><br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="æ·±åº¦ç¼“å†²é€ŸæŸ¥è¡¨"><a href="#æ·±åº¦ç¼“å†²é€ŸæŸ¥è¡¨" class="headerlink" title="æ·±åº¦ç¼“å†²é€ŸæŸ¥è¡¨"></a><a class="markdownIt-Anchor" href="#æ·±åº¦ç¼“å†²é€ŸæŸ¥è¡¨"></a> æ·±åº¦ç¼“å†²é€ŸæŸ¥è¡¨</h3>
<p>é—®é¢˜        ç—‡çŠ¶                   è§£å†³æ–¹æ¡ˆ<br />
å¿˜æ¸…æ·±åº¦     ç¬¬ä¸€å¸§æ­£å¸¸ï¼Œåé¢è¶Šæ¥è¶Šå°‘   glClear(GL_DEPTH_BUFFER_BIT)<br />
Z-Fighting é—ªçƒã€æ¡çº¹              æ‹‰è¿‘è¿œå¹³é¢ã€åè½¬Zã€æ·±åº¦åç§»<br />
é€æ˜ç‰©ä½“     é€è¿‡é€æ˜çœ‹åˆ°åé¢çš„ä¸œè¥¿æ²¡äº† ä»åå¾€å‰ç”»ï¼Œå…³æ·±åº¦å†™å…¥<br />
å¤©ç©ºç›’      è¢«åœºæ™¯æŒ¡ä½               glDepthFunc(GL_LEQUAL)<br />
é˜´å½±        é˜´å½±ä¸æ­£ç¡®              ç”¨æ·±åº¦çº¹ç†åšSha<br />
è½®å»“æè¾¹     æ·±åº¦æµ‹è¯•å½±å“æè¾¹         å…³æ·±åº¦å†™å…¥å†ç”»dow Map</p>
<hr />
<h1 id="opengl"><a href="#opengl" class="headerlink" title="opengl"></a><a class="markdownIt-Anchor" href="#opengl"></a> openGL</h1>
<h2 id="glfwçª—å£ç®¡ç†"><a href="#glfwçª—å£ç®¡ç†" class="headerlink" title="glfwçª—å£ç®¡ç†"></a><a class="markdownIt-Anchor" href="#glfwçª—å£ç®¡ç†"></a> GLFWçª—å£ç®¡ç†</h2>
<h3 id="ï¸-glfw-çª—å£ç®¡ç†å‡½æ•°"><a href="#ï¸-glfw-çª—å£ç®¡ç†å‡½æ•°" class="headerlink" title="ï¸-glfw-çª—å£ç®¡ç†å‡½æ•°"></a><a class="markdownIt-Anchor" href="#ï¸-glfw-çª—å£ç®¡ç†å‡½æ•°"></a> ğŸ—ï¸ GLFW çª—å£ç®¡ç†å‡½æ•°</h3>
<ol>
<li>åˆå§‹åŒ–å’Œç»ˆæ­¢</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// åˆå§‹åŒ–GLFWåº“</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">glfwInit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span>;<br><span class="hljs-comment">// è¿”å›å€¼ï¼šæˆåŠŸè¿”å›GLFW_TRUEï¼Œå¤±è´¥è¿”å›GLFW_FALSE</span><br><br><span class="hljs-comment">// ç»ˆæ­¢GLFWï¼Œé‡Šæ”¾èµ„æº</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glfwTerminate</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span>;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>çª—å£åˆ›å»ºå’Œé”€æ¯</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// åˆ›å»ºçª—å£</span><br><span class="hljs-function">GLFWwindow* <span class="hljs-title">glfwCreateWindow</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-type">int</span> width,                   <span class="hljs-comment">// çª—å£å®½åº¦ï¼ˆåƒç´ ï¼‰</span></span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-type">int</span> height,                  <span class="hljs-comment">// çª—å£é«˜åº¦</span></span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* title,          <span class="hljs-comment">// çª—å£æ ‡é¢˜</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLFWmonitor* monitor,       <span class="hljs-comment">// å…¨å±æ¨¡å¼ç”¨ï¼ŒNULLä¸ºçª—å£æ¨¡å¼</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLFWwindow* share           <span class="hljs-comment">// èµ„æºå…±äº«ï¼ŒNULLä¸ºä¸å…±äº«</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br><span class="hljs-comment">// è¿”å›å€¼ï¼šæˆåŠŸè¿”å›çª—å£æŒ‡é’ˆï¼Œå¤±è´¥è¿”å›NULL</span><br><br><span class="hljs-comment">//å†™æ³•2 </span><br> <span class="hljs-comment">// åˆ›å»ºçª—å£</span><br> GLFWwindow* window = <span class="hljs-built_in">glfwCreateWindow</span>(<span class="hljs-number">600</span>, <span class="hljs-number">600</span>, <span class="hljs-string">&quot;Chapter2 - program1 (GLAD)&quot;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);<br><br><span class="hljs-comment">// é”€æ¯çª—å£</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glfwDestroyWindow</span><span class="hljs-params">(GLFWwindow* window)</span></span>;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>çª—å£è®¾ç½®</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è®¾ç½®å½“å‰çº¿ç¨‹çš„ä¸»ä¸Šä¸‹æ–‡</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glfwMakeContextCurrent</span><span class="hljs-params">(GLFWwindow* window)</span></span>;<br><br><span class="hljs-comment">// æ£€æŸ¥çª—å£æ˜¯å¦åº”è¯¥å…³é—­</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">glfwWindowShouldClose</span><span class="hljs-params">(GLFWwindow* window)</span></span>;<br><span class="hljs-comment">// è¿”å›å€¼ï¼šé0è¡¨ç¤ºåº”è¯¥å…³é—­</span><br><br><span class="hljs-number">1.</span> <span class="hljs-built_in">glfwWindowShouldClose</span>() - åªè¯»æ£€æŸ¥<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">glfwWindowShouldClose</span><span class="hljs-params">(GLFWwindow* window)</span></span>;<br><br>ä½œç”¨ï¼šæ£€æŸ¥çª—å£æ˜¯å¦åº”è¯¥å…³é—­ï¼ˆåªè¯»ï¼Œä¸èƒ½è®¾ç½®ï¼‰<br>å‚æ•°ï¼šåªæœ‰çª—å£æŒ‡é’ˆ<br>è¿”å›å€¼ï¼š<span class="hljs-number">1</span>(<span class="hljs-literal">true</span>)è¡¨ç¤ºåº”è¯¥å…³é—­ï¼Œ<span class="hljs-number">0</span>(<span class="hljs-literal">false</span>)è¡¨ç¤ºç»§ç»­<br><br><span class="hljs-number">2.</span> <span class="hljs-built_in">glfwSetWindowShouldClose</span>() - åªå†™è®¾ç½®<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glfwSetWindowShouldClose</span><span class="hljs-params">(GLFWwindow* window, <span class="hljs-type">int</span> value)</span></span>;<br><br>ä½œç”¨ï¼šè®¾ç½®çª—å£æ˜¯å¦åº”è¯¥å…³é—­ï¼ˆåªå†™ï¼Œè®¾ç½®æ ‡å¿—ï¼‰<br>å‚æ•°ï¼šçª—å£æŒ‡é’ˆ + å¸ƒå°”å€¼<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>ç¼“å†²åŒºäº¤æ¢å’Œäº‹ä»¶å¤„ç†</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// äº¤æ¢å‰åç¼“å†²åŒºï¼ˆåŒç¼“å†²ï¼‰</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glfwSwapBuffers</span><span class="hljs-params">(GLFWwindow* window)</span></span>;<br><br><span class="hljs-comment">// å¤„ç†ç­‰å¾…ä¸­çš„äº‹ä»¶</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glfwPollEvents</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span>;<br></code></pre></td></tr></table></figure>
<ol start="5">
<li>çª—å£æç¤ºè®¾ç½®ï¼ˆåœ¨glfwCreateWindowå‰è°ƒç”¨ï¼‰</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è®¾ç½®çª—å£æç¤º</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glfwWindowHint</span><span class="hljs-params">(<span class="hljs-type">int</span> hint, <span class="hljs-type">int</span> value)</span></span>;<br><br><span class="hljs-comment">// å¸¸ç”¨æç¤ºï¼š</span><br><span class="hljs-built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MAJOR, <span class="hljs-number">4</span>);  <span class="hljs-comment">// OpenGLä¸»ç‰ˆæœ¬</span><br><span class="hljs-built_in">glfwWindowHint</span>(GLFW_CONTEXT_VERSION_MINOR, <span class="hljs-number">1</span>);  <span class="hljs-comment">// OpenGLæ¬¡ç‰ˆæœ¬</span><br><span class="hljs-built_in">glfwWindowHint</span>(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);  <span class="hljs-comment">// æ ¸å¿ƒæ¨¡å¼</span><br></code></pre></td></tr></table></figure>
<ol start="6">
<li>è¾“å…¥å¤„ç†</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è·å–æŒ‰é”®çŠ¶æ€</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">glfwGetKey</span><span class="hljs-params">(GLFWwindow* window, <span class="hljs-type">int</span> key)</span></span>;<br><span class="hljs-comment">// è¿”å›å€¼ï¼šGLFW_PRESSï¼ˆæŒ‰ä¸‹ï¼‰ã€GLFW_RELEASEï¼ˆé‡Šæ”¾ï¼‰</span><br><br><span class="hljs-comment">// å¸¸ç”¨æŒ‰é”®å¸¸é‡ï¼š</span><br>GLFW_KEY_ESCAPE     <span class="hljs-comment">// ESCé”®</span><br>GLFW_KEY_W          <span class="hljs-comment">// Wé”®</span><br>GLFW_KEY_A          <span class="hljs-comment">// Aé”®</span><br>GLFW_KEY_S          <span class="hljs-comment">// Sé”®</span><br>GLFW_KEY_D          <span class="hljs-comment">// Dé”®</span><br>GLFW_KEY_SPACE      <span class="hljs-comment">// ç©ºæ ¼é”®</span><br></code></pre></td></tr></table></figure>
<ol start="7">
<li>å›è°ƒå‡½æ•°è®¾ç½®</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è®¾ç½®çª—å£å¤§å°æ”¹å˜å›è°ƒï¼ˆå½“çª—å£å¤§å°æ”¹å˜ï¼Œè‡ªåŠ¨æ¸²æŸ“ï¼‰</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">framebuffer_size_callback</span><span class="hljs-params">(GLFWwindow* window, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span></span>;<br><br><span class="hljs-built_in">glfwSetFramebufferSizeCallback</span>(window, framebuffer_size_callback);<br></code></pre></td></tr></table></figure>
<h3 id="opengl-æ ¸å¿ƒå‡½æ•°"><a href="#opengl-æ ¸å¿ƒå‡½æ•°" class="headerlink" title="opengl-æ ¸å¿ƒå‡½æ•°"></a><a class="markdownIt-Anchor" href="#opengl-æ ¸å¿ƒå‡½æ•°"></a> ğŸ¨ OpenGL æ ¸å¿ƒå‡½æ•°</h3>
<ol>
<li>è§†å£è®¾ç½®</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è®¾ç½®OpenGLæ¸²æŸ“è§†å£</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glViewport</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    GLint x,        <span class="hljs-comment">// è§†å£å·¦ä¸‹è§’xåæ ‡ï¼ˆé€šå¸¸0ï¼‰</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLint y,        <span class="hljs-comment">// è§†å£å·¦ä¸‹è§’yåæ ‡ï¼ˆé€šå¸¸0ï¼‰</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLsizei width,  <span class="hljs-comment">// è§†å£å®½åº¦</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLsizei height  <span class="hljs-comment">// è§†å£é«˜åº¦</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>æ¸…å±å’Œé¢œè‰²è®¾ç½®</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è®¾ç½®æ¸…å±é¢œè‰²ï¼ˆRGBAï¼‰</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glClearColor</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    GLfloat red,    <span class="hljs-comment">// çº¢è‰²åˆ†é‡ (0.0 ~ 1.0)</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLfloat green,  <span class="hljs-comment">// ç»¿è‰²åˆ†é‡</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLfloat blue,   <span class="hljs-comment">// è“è‰²åˆ†é‡</span></span></span><br><span class="hljs-params"><span class="hljs-function">    GLfloat alpha   <span class="hljs-comment">// é€æ˜åº¦ (1.0ä¸ºä¸é€æ˜)</span></span></span><br><span class="hljs-params"><span class="hljs-function">)</span></span>;<br><br><span class="hljs-comment">// æ¸…ç©ºæŒ‡å®šç¼“å†²åŒº</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glClear</span><span class="hljs-params">(GLbitfield mask)</span></span>;<br><br><span class="hljs-comment">// å¸¸ç”¨æ©ç ï¼š</span><br>GL_COLOR_BUFFER_BIT    <span class="hljs-comment">// é¢œè‰²ç¼“å†²åŒº</span><br>GL_DEPTH_BUFFER_BIT    <span class="hljs-comment">// æ·±åº¦ç¼“å†²åŒº</span><br>GL_STENCIL_BUFFER_BIT  <span class="hljs-comment">// æ¨¡æ¿ç¼“å†²åŒº</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>è·å–OpenGLä¿¡æ¯</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è·å–OpenGLç‰ˆæœ¬ä¿¡æ¯</span><br><span class="hljs-function"><span class="hljs-type">const</span> GLubyte* <span class="hljs-title">glGetString</span><span class="hljs-params">(GLenum name)</span></span>;<br><br><span class="hljs-comment">// å¸¸ç”¨å‚æ•°ï¼š</span><br>GL_VENDOR                  <span class="hljs-comment">// æ˜¾å¡å‚å•†</span><br>GL_RENDERER                <span class="hljs-comment">// æ˜¾å¡å‹å·</span><br>GL_VERSION                 <span class="hljs-comment">// OpenGLç‰ˆæœ¬</span><br>GL_SHADING_LANGUAGE_VERSION <span class="hljs-comment">// GLSLç‰ˆæœ¬</span><br></code></pre></td></tr></table></figure>
<h3 id="glad-åˆå§‹åŒ–å‡½æ•°"><a href="#glad-åˆå§‹åŒ–å‡½æ•°" class="headerlink" title="glad-åˆå§‹åŒ–å‡½æ•°"></a><a class="markdownIt-Anchor" href="#glad-åˆå§‹åŒ–å‡½æ•°"></a> ğŸ”§ GLAD åˆå§‹åŒ–å‡½æ•°</h3>
<p>åŠ è½½OpenGLå‡½æ•°æŒ‡é’ˆ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// åˆå§‹åŒ–GLADï¼ŒåŠ è½½æ‰€æœ‰OpenGLå‡½æ•°æŒ‡é’ˆ</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">gladLoadGLLoader</span><span class="hljs-params">(GLADloadproc loader)</span></span>;<br><br><span class="hljs-comment">// ä½¿ç”¨æ–¹æ³•ï¼ˆé…åˆGLFWï¼‰ï¼š</span><br><span class="hljs-built_in">gladLoadGLLoader</span>((GLADloadproc)glfwGetProcAddress);<br></code></pre></td></tr></table></figure>
<h2 id="gladç€è‰²å™¨"><a href="#gladç€è‰²å™¨" class="headerlink" title="gladç€è‰²å™¨"></a><a class="markdownIt-Anchor" href="#gladç€è‰²å™¨"></a> gladç€è‰²å™¨</h2>
<h3 id="gladå‡½æ•°"><a href="#gladå‡½æ•°" class="headerlink" title="gladå‡½æ•°"></a><a class="markdownIt-Anchor" href="#gladå‡½æ•°"></a> gladå‡½æ•°</h3>
<ol>
<li>glCreateShader() - åˆ›å»ºç€è‰²å™¨å¯¹è±¡</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">GLuint <span class="hljs-title">glCreateShader</span><span class="hljs-params">(GLenum shaderType)</span></span>;<br><br></code></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<p>Â· shaderTypeï¼šç€è‰²å™¨ç±»å‹<br />
Â· GL_VERTEX_SHADERï¼šé¡¶ç‚¹ç€è‰²å™¨<br />
Â· GL_FRAGMENT_SHADERï¼šç‰‡æ®µç€è‰²å™¨<br />
Â· GL_GEOMETRY_SHADERï¼šå‡ ä½•ç€è‰²å™¨ï¼ˆé«˜çº§ï¼‰<br />
Â· GL_TESS_CONTROL_SHADERï¼šæ›²é¢ç»†åˆ†æ§åˆ¶ç€è‰²å™¨<br />
Â· GL_TESS_EVALUATION_SHADERï¼šæ›²é¢ç»†åˆ†è¯„ä¼°ç€è‰²å™¨</p>
<p>è¿”å›å€¼ï¼šç€è‰²å™¨å¯¹è±¡çš„IDï¼ˆGLuintï¼‰ï¼Œ0è¡¨ç¤ºå¤±è´¥</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">GLuint vertexShader = <span class="hljs-built_in">glCreateShader</span>(GL_VERTEX_SHADER);<br>GLuint fragmentShader = <span class="hljs-built_in">glCreateShader</span>(GL_FRAGMENT_SHADER);<br><br></code></pre></td></tr></table></figure>
<hr />
<ol start="2">
<li>glShaderSource() - è®¾ç½®ç€è‰²å™¨æºä»£ç </li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glShaderSource</span><span class="hljs-params">(GLuint shader,</span></span><br><span class="hljs-params"><span class="hljs-function">                    GLsizei count,</span></span><br><span class="hljs-params"><span class="hljs-function">                    <span class="hljs-type">const</span> GLchar** string,</span></span><br><span class="hljs-params"><span class="hljs-function">                    <span class="hljs-type">const</span> GLint* length)</span></span>;<br><br></code></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<p>Â· shaderï¼šç€è‰²å™¨å¯¹è±¡IDï¼ˆæ¥è‡ªglCreateShaderï¼‰<br />
Â· countï¼šå­—ç¬¦ä¸²æ•°é‡ï¼ˆé€šå¸¸ä¸º1ï¼‰<br />
Â· stringï¼šæŒ‡å‘æºä»£ç å­—ç¬¦ä¸²çš„æŒ‡é’ˆ<br />
Â· lengthï¼šæºä»£ç é•¿åº¦æ•°ç»„ï¼ŒNULLè¡¨ç¤ºå­—ç¬¦ä¸²ä»¥\0ç»“å°¾</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">const</span> <span class="hljs-type">char</span>* shaderCode = <span class="hljs-string">&quot;#version 430\\nvoid main() &#123;...&#125;&quot;</span>;<br><span class="hljs-built_in">glShaderSource</span>(shader, <span class="hljs-number">1</span>, &amp;shaderCode, <span class="hljs-literal">NULL</span>);<br><br></code></pre></td></tr></table></figure>
<hr />
<ol start="3">
<li>glCompileShader() - ç¼–è¯‘ç€è‰²å™¨</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glCompileShader</span><span class="hljs-params">(GLuint shader)</span></span>;<br><br></code></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<p>Â· shaderï¼šè¦ç¼–è¯‘çš„ç€è‰²å™¨å¯¹è±¡ID</p>
<p>é‡è¦ï¼šç¼–è¯‘åå¿…é¡»æ£€æŸ¥ç¼–è¯‘çŠ¶æ€ï¼</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glCompileShader</span>(vertexShader);<br><br><span class="hljs-comment">// æ£€æŸ¥ç¼–è¯‘é”™è¯¯</span><br>GLint success;<br><span class="hljs-built_in">glGetShaderiv</span>(vertexShader, GL_COMPILE_STATUS, &amp;success);<br><span class="hljs-keyword">if</span> (!success) &#123;<br>    <span class="hljs-type">char</span> infoLog[<span class="hljs-number">512</span>];<br>    <span class="hljs-built_in">glGetShaderInfoLog</span>(vertexShader, <span class="hljs-number">512</span>, <span class="hljs-literal">NULL</span>, infoLog);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;ç€è‰²å™¨ç¼–è¯‘å¤±è´¥: &quot;</span> &lt;&lt; infoLog &lt;&lt; std::endl;<br>&#125;<br></code></pre></td></tr></table></figure>
<hr />
<ol start="4">
<li>glCreateProgram() - åˆ›å»ºç€è‰²å™¨ç¨‹åº</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">GLuint <span class="hljs-title">glCreateProgram</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span>;<br><br></code></pre></td></tr></table></figure>
<p>è¿”å›å€¼ï¼šç¨‹åºå¯¹è±¡IDï¼ˆGLuintï¼‰ï¼Œ0è¡¨ç¤ºå¤±è´¥</p>
<p>ç¤ºä¾‹ï¼š</p>
<hr />
<ol start="5">
<li>glAttachShader() - é™„åŠ ç€è‰²å™¨åˆ°ç¨‹åº</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glAttachShader</span><span class="hljs-params">(GLuint program, GLuint shader)</span></span>;<br><br></code></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<p>Â· programï¼šç¨‹åºå¯¹è±¡ID<br />
Â· shaderï¼šç€è‰²å™¨å¯¹è±¡ID</p>
<p>æ³¨æ„ï¼šä¸€ä¸ªç€è‰²å™¨å¯ä»¥é™„åŠ åˆ°å¤šä¸ªç¨‹åº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glAttachShader</span>(shaderProgram, vertexShader);<br><span class="hljs-built_in">glAttachShader</span>(shaderProgram, fragmentShader);<br></code></pre></td></tr></table></figure>
<hr />
<ol start="6">
<li>glLinkProgram() - é“¾æ¥ç€è‰²å™¨ç¨‹åº</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glLinkProgram</span><span class="hljs-params">(GLuint program)</span></span>;<br></code></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<p>Â· programï¼šè¦é“¾æ¥çš„ç¨‹åºå¯¹è±¡ID</p>
<p>é‡è¦ï¼šé“¾æ¥åå¿…é¡»æ£€æŸ¥é“¾æ¥çŠ¶æ€ï¼</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glLinkProgram</span>(shaderProgram);<br><br><span class="hljs-comment">// æ£€æŸ¥é“¾æ¥é”™è¯¯</span><br>GLint success;<br><span class="hljs-built_in">glGetProgramiv</span>(shaderProgram, GL_LINK_STATUS, &amp;success);<br><span class="hljs-keyword">if</span> (!success) &#123;<br>    <span class="hljs-type">char</span> infoLog[<span class="hljs-number">512</span>];<br>    <span class="hljs-built_in">glGetProgramInfoLog</span>(shaderProgram, <span class="hljs-number">512</span>, <span class="hljs-literal">NULL</span>, infoLog);<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;ç¨‹åºé“¾æ¥å¤±è´¥: &quot;</span> &lt;&lt; infoLog &lt;&lt; std::endl;<br>&#125;<br></code></pre></td></tr></table></figure>
<hr />
<ol start="7">
<li>glUseProgram() - æ¿€æ´»ç€è‰²å™¨ç¨‹åº</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glUseProgram</span><span class="hljs-params">(GLuint program)</span></span>;<br><br></code></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<p>Â· programï¼šè¦ä½¿ç”¨çš„ç¨‹åºå¯¹è±¡IDï¼Œ0è¡¨ç¤ºåœç”¨æ‰€æœ‰ç¨‹åº</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glUseProgram</span>(shaderProgram);  <span class="hljs-comment">// æ¿€æ´»ç¨‹åº</span><br><span class="hljs-comment">// ... ç»˜åˆ¶æ“ä½œ ...</span><br><span class="hljs-built_in">glUseProgram</span>(<span class="hljs-number">0</span>);              <span class="hljs-comment">// åœç”¨ç¨‹åºï¼ˆå¯é€‰ï¼‰</span><br><br></code></pre></td></tr></table></figure>
<hr />
<ol start="8">
<li>glDeleteShader() - åˆ é™¤ç€è‰²å™¨å¯¹è±¡</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glDeleteShader</span><span class="hljs-params">(GLuint shader)</span></span>;<br><br></code></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<p>Â· shaderï¼šè¦åˆ é™¤çš„ç€è‰²å™¨å¯¹è±¡ID</p>
<p>æœ€ä½³å®è·µï¼šé“¾æ¥ç¨‹åºåå¯ä»¥åˆ é™¤ç€è‰²å™¨å¯¹è±¡</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glDeleteShader</span>(vertexShader);<br><span class="hljs-built_in">glDeleteShader</span>(fragmentShader);<br><br></code></pre></td></tr></table></figure>
<hr />
<ol start="9">
<li>glPointSize() - è®¾ç½®ç‚¹çš„å¤§å°</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glPointSize</span><span class="hljs-params">(GLfloat size)</span></span>;<br></code></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<p>Â· sizeï¼šç‚¹çš„ç›´å¾„ï¼ˆåƒç´ ï¼‰</p>
<p>æ³¨æ„ï¼šåªåœ¨GL_POINTSç»˜åˆ¶æ¨¡å¼æ—¶æœ‰æ•ˆ</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glPointSize</span>(<span class="hljs-number">30.0f</span>);  <span class="hljs-comment">// ç”»30åƒç´ å¤§çš„ç‚¹</span><br></code></pre></td></tr></table></figure>
<ol start="10">
<li>è®¾ç½®è§†å£</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> width, height;<br><span class="hljs-built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);  <span class="hljs-comment">// è·å–çª—å£å°ºå¯¸ï¼Œéšå¼å®šä¹‰æŒ‡é’ˆ</span><br><span class="hljs-built_in">glViewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);<br><br><span class="hljs-built_in">glViewport</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">600</span>, <span class="hljs-number">400</span>);<br><br><span class="hljs-comment">// è¿™æ„å‘³ç€ï¼š</span><br><span class="hljs-comment">// å·¦ä¸‹è§’ï¼šçª—å£åæ ‡(100, 100)</span><br><span class="hljs-comment">// å³ä¸Šè§’ï¼šçª—å£åæ ‡(100+600, 100+400) = (700, 500)</span><br><span class="hljs-comment">// è§†å£åŒºåŸŸï¼šä»(100,100)åˆ°(700,500)çš„çŸ©å½¢</span><br><br>OpenGLæ¸²æŸ“æµç¨‹ï¼š<br>+----------------+     +----------------+     +----------------+<br>|  åå°ç¼“å†²åŒº   | â†’   |  äº¤æ¢æ“ä½œ    | â†’   |  å‰å°ç¼“å†²åŒº     |<br>| (Back Buffer)  |     | (glfwSwapBuffers)|   | (Front Buffer) |<br>|  - GPUæ­£åœ¨æ¸²æŸ“ |     |                |     |  - æ­£åœ¨æ˜¾ç¤º     |<br>|  - ç”¨æˆ·çœ‹ä¸åˆ°  |     |                |     |  - ç”¨æˆ·çœ‹åˆ°     |<br>+----------------+     +----------------+     +----------------+<br></code></pre></td></tr></table></figure>
<hr />
<h3 id="ç»˜åˆ¶å‡½æ•°"><a href="#ç»˜åˆ¶å‡½æ•°" class="headerlink" title="ç»˜åˆ¶å‡½æ•°"></a><a class="markdownIt-Anchor" href="#ç»˜åˆ¶å‡½æ•°"></a> ğŸ¨ ç»˜åˆ¶å‡½æ•°</h3>
<p>glDrawArrays() - ç»˜åˆ¶å›¾å…ƒ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glDrawArrays</span><span class="hljs-params">(GLenum mode, GLint first, GLsizei count)</span></span>;<br><br></code></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<p>Â· modeï¼šç»˜åˆ¶æ¨¡å¼ï¼ˆè¦ç”»ä»€ä¹ˆï¼‰<br />
Â· GL_POINTSï¼šç‚¹<br />
Â· GL_LINESï¼šçº¿<br />
Â· GL_LINE_STRIPï¼šè¿ç»­æŠ˜çº¿<br />
Â· GL_LINE_LOOPï¼šé—­åˆæŠ˜çº¿<br />
Â· GL_TRIANGLESï¼šä¸‰è§’å½¢ï¼ˆæœ€å¸¸ç”¨ï¼‰<br />
Â· GL_TRIANGLE_STRIPï¼šä¸‰è§’å½¢å¸¦<br />
Â· GL_TRIANGLE_FANï¼šä¸‰è§’å½¢æ‰‡<br />
Â· firstï¼šä»ç¬¬å‡ ä¸ªé¡¶ç‚¹å¼€å§‹ï¼ˆé€šå¸¸ä¸º0ï¼‰<br />
Â· countï¼šä½¿ç”¨å¤šå°‘ä¸ªé¡¶ç‚¹</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ç”»ä¸€ä¸ªç‚¹</span><br><span class="hljs-built_in">glDrawArrays</span>(GL_POINTS, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br><br><span class="hljs-comment">// ç”»ä¸€ä¸ªä¸‰è§’å½¢ï¼ˆ3ä¸ªé¡¶ç‚¹ï¼‰</span><br><span class="hljs-built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>);<br><br><span class="hljs-comment">// ç”»ä¸€æ¡çº¿ï¼ˆ2ä¸ªé¡¶ç‚¹ï¼‰</span><br><span class="hljs-built_in">glDrawArrays</span>(GL_LINES, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>);<br><br></code></pre></td></tr></table></figure>
<hr />
<ol>
<li>é”™è¯¯æ£€æŸ¥</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-number">1.</span> <span class="hljs-built_in">glGetShaderiv</span>(GLuint shader, GLenum pname, GLint *params)<br><br>åŠŸèƒ½ï¼š<br><br>è·å–ç€è‰²å™¨å¯¹è±¡çš„ä¿¡æ¯ï¼ˆivè¡¨ç¤ºè¿”å›çš„æ˜¯æ•´æ•°å‘é‡ï¼‰ã€‚<br><br>å‚æ•°ï¼š<br><br>Â· shaderï¼šè¦æŸ¥è¯¢çš„ç€è‰²å™¨å¯¹è±¡ID<br>Â· pnameï¼šè¦æŸ¥è¯¢çš„å‚æ•°ç±»å‹ï¼ˆæšä¸¾å¸¸é‡ï¼‰<br>  Â· GL_COMPILE_STATUSï¼šæŸ¥è¯¢ç¼–è¯‘æ˜¯å¦æˆåŠŸï¼ˆè¿”å›GL_TRUE/GL_FALSEï¼‰<br>  Â· GL_SHADER_TYPEï¼šæŸ¥è¯¢ç€è‰²å™¨ç±»å‹ï¼ˆé¡¶ç‚¹/ç‰‡æ®µ/å‡ ä½•ç­‰ï¼‰<br>  Â· GL_INFO_LOG_LENGTHï¼šè·å–ä¿¡æ¯æ—¥å¿—çš„é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰<br>  Â· GL_SHADER_SOURCE_LENGTHï¼šè·å–ç€è‰²å™¨æºä»£ç çš„é•¿åº¦<br>Â· paramsï¼šæŒ‡å‘å­˜å‚¨ç»“æœçš„æ•´æ•°æ•°ç»„çš„æŒ‡é’ˆ<br><br><span class="hljs-number">2.</span> <span class="hljs-built_in">glGetShaderInfoLog</span>(GLuint shader, GLsizei maxLength, GLsizei *length, GLchar *infoLog)<br><br>åŠŸèƒ½ï¼š<br><br>è·å–ç€è‰²å™¨ç¼–è¯‘çš„ä¿¡æ¯æ—¥å¿—ï¼Œç‰¹åˆ«æ˜¯ç¼–è¯‘é”™è¯¯ä¿¡æ¯ã€‚<br><br>å‚æ•°ï¼š<br><br>Â· shaderï¼šè¦æŸ¥è¯¢çš„ç€è‰²å™¨å¯¹è±¡ID<br>Â· maxLengthï¼šinfoLogç¼“å†²åŒºçš„æœ€å¤§é•¿åº¦ï¼ˆåŒ…æ‹¬ç©ºç»ˆæ­¢ç¬¦ï¼‰<br>Â· lengthï¼šæŒ‡å‘å®é™…å†™å…¥æ—¥å¿—é•¿åº¦çš„æŒ‡é’ˆï¼ˆå¯ä¸º<span class="hljs-literal">NULL</span>ï¼‰<br>Â· infoLogï¼šæŒ‡å‘å­˜å‚¨æ—¥å¿—çš„å­—ç¬¦æ•°ç»„çš„æŒ‡é’ˆ<br><br><span class="hljs-number">3.</span> <span class="hljs-built_in">glGetProgramiv</span>() - è·å–ç¨‹åºçŠ¶æ€<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glGetProgramiv</span><span class="hljs-params">(GLuint program, GLenum pname, GLint* params)</span></span>;<br>å¸¸ç”¨å‚æ•°ï¼š<br><br>Â· GL_LINK_STATUSï¼šé“¾æ¥æ˜¯å¦æˆåŠŸ<br>Â· GL_VALIDATE_STATUSï¼šéªŒè¯æ˜¯å¦æˆåŠŸ<br>Â· GL_ATTACHED_SHADERSï¼šé™„åŠ çš„ç€è‰²å™¨æ•°é‡<br><br><span class="hljs-number">4.</span> <span class="hljs-built_in">glGetProgramInfoLog</span>() - è·å–ç¨‹åºé“¾æ¥æ—¥å¿—<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">glGetProgramInfoLog</span><span class="hljs-params">(GLuint program, GLsizei maxLength,</span></span><br><span class="hljs-params"><span class="hljs-function">                        GLsizei* length, GLchar* infoLog)</span></span>;<br></code></pre></td></tr></table></figure>
<h3 id="å®Œæ•´ç€è‰²å™¨åˆ›å»ºæµç¨‹"><a href="#å®Œæ•´ç€è‰²å™¨åˆ›å»ºæµç¨‹" class="headerlink" title="å®Œæ•´ç€è‰²å™¨åˆ›å»ºæµç¨‹"></a><a class="markdownIt-Anchor" href="#å®Œæ•´ç€è‰²å™¨åˆ›å»ºæµç¨‹"></a> ğŸ”„ å®Œæ•´ç€è‰²å™¨åˆ›å»ºæµç¨‹</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-number">1.</span>  <span class="hljs-built_in">glCreateShader</span>()      <span class="hljs-comment">// åˆ›å»ºç€è‰²å™¨å¯¹è±¡</span><br><span class="hljs-number">2.</span>  <span class="hljs-built_in">glShaderSource</span>()      <span class="hljs-comment">// è®¾ç½®æºä»£ç </span><br><span class="hljs-number">3.</span>  <span class="hljs-built_in">glCompileShader</span>()     <span class="hljs-comment">// ç¼–è¯‘</span><br><span class="hljs-number">4.</span>  æ£€æŸ¥ç¼–è¯‘é”™è¯¯          <span class="hljs-comment">// glGetShaderiv/glGetShaderInfoLog</span><br><span class="hljs-number">5.</span>  <span class="hljs-built_in">glCreateProgram</span>()     <span class="hljs-comment">// åˆ›å»ºç¨‹åº</span><br><span class="hljs-number">6.</span>  <span class="hljs-built_in">glAttachShader</span>()      <span class="hljs-comment">// é™„åŠ ç€è‰²å™¨</span><br><span class="hljs-number">7.</span>  <span class="hljs-built_in">glLinkProgram</span>()       <span class="hljs-comment">// é“¾æ¥ç¨‹åº</span><br><span class="hljs-number">8.</span>  æ£€æŸ¥é“¾æ¥é”™è¯¯          <span class="hljs-comment">// glGetProgramiv/glGetProgramInfoLog</span><br><span class="hljs-number">9.</span>  <span class="hljs-built_in">glDeleteShader</span>()      <span class="hljs-comment">// åˆ é™¤ç€è‰²å™¨ï¼ˆé“¾æ¥åï¼‰</span><br><span class="hljs-number">10.</span> <span class="hljs-built_in">glUseProgram</span>()       <span class="hljs-comment">// ä½¿ç”¨ç¨‹åº</span><br><br></code></pre></td></tr></table></figure>
<h2 id="openglåˆå§‹åŒ–renderæ¸²æŸ“"><a href="#openglåˆå§‹åŒ–renderæ¸²æŸ“" class="headerlink" title="openglåˆå§‹åŒ–renderæ¸²æŸ“"></a><a class="markdownIt-Anchor" href="#openglåˆå§‹åŒ–renderæ¸²æŸ“"></a> openGLåˆå§‹åŒ–&amp;renderæ¸²æŸ“</h2>
<h3 id="åˆå§‹åŒ–å‡½æ•°-init"><a href="#åˆå§‹åŒ–å‡½æ•°-init" class="headerlink" title="åˆå§‹åŒ–å‡½æ•°-init"></a><a class="markdownIt-Anchor" href="#åˆå§‹åŒ–å‡½æ•°-init"></a> åˆå§‹åŒ–å‡½æ•° init()</h3>
<ol>
<li>createShaderProgram()</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">shaderProgram = <span class="hljs-built_in">createShaderProgram</span>(<span class="hljs-string">&quot;shaders/triangle.vert&quot;</span>, <span class="hljs-string">&quot;shaders/triangle.frag&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šåˆ›å»ºå¹¶ç¼–è¯‘ç€è‰²å™¨ç¨‹åº</p>
<p>Â· è¯»å–é¡¶ç‚¹ç€è‰²å™¨(.vert)å’Œç‰‡æ®µç€è‰²å™¨(.frag)æ–‡ä»¶<br />
Â· ç¼–è¯‘ä¸¤ä¸ªç€è‰²å™¨å¹¶é“¾æ¥æˆå¯æ‰§è¡Œç¨‹åº<br />
Â· è¿”å›ç€è‰²å™¨ç¨‹åºçš„ID</p>
<ol start="2">
<li>å®šä¹‰é¡¶ç‚¹æ•°æ®</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">float</span> vertices[] = &#123;...&#125;;<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šå®šä¹‰ä¸‰è§’å½¢çš„å‡ ä½•æ•°æ®</p>
<p>Â· æ¯ä¸ªé¡¶ç‚¹åŒ…å«ï¼š3ä¸ªä½ç½®åæ ‡ + 3ä¸ªé¢œè‰²å€¼(RGB)<br />
Â· å…±3ä¸ªé¡¶ç‚¹ï¼Œç»„æˆä¸€ä¸ªä¸‰è§’å½¢<br />
Â· æ•°æ®æ ¼å¼ï¼šäº¤é”™æ•°ç»„(ä½ç½®+é¢œè‰²äº¤é”™å­˜å‚¨)</p>
<ol start="3">
<li>glGenVertexArrays() å’Œ glGenBuffers()</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glGenVertexArrays</span>(<span class="hljs-number">1</span>, &amp;VAO);<br><span class="hljs-built_in">glGenBuffers</span>(<span class="hljs-number">1</span>, &amp;VBO);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šç”ŸæˆOpenGLå¯¹è±¡</p>
<p>Â· VAOï¼šé¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Œè®°å½•é¡¶ç‚¹å±æ€§é…ç½®<br />
Â· VBOï¼šé¡¶ç‚¹ç¼“å†²åŒºå¯¹è±¡ï¼Œå­˜å‚¨é¡¶ç‚¹æ•°æ®åˆ°GPUå†…å­˜</p>
<ol start="4">
<li>glBindVertexArray()</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glBindVertexArray</span>(VAO);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šç»‘å®šVAO</p>
<p>Â· å¼€å§‹è®°å½•é¡¶ç‚¹å±æ€§é…ç½®<br />
Â· åç»­çš„é¡¶ç‚¹å±æ€§è®¾ç½®éƒ½ä¼šè®°å½•åˆ°è¿™ä¸ªVAOä¸­</p>
<ol start="5">
<li>glBindBuffer() å’Œ glBufferData()</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, VBO);<br><span class="hljs-built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="hljs-built_in">sizeof</span>(vertices), vertices, GL_STATIC_DRAW);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šç»‘å®šVBOå¹¶ä¸Šä¼ æ•°æ®</p>
<p>Â· glBindBuffer()ï¼šæŒ‡å®šæ“ä½œå“ªä¸ªç¼“å†²åŒº<br />
Â· glBufferData()ï¼šå°†CPUæ•°æ®å¤åˆ¶åˆ°GPUçš„VBOä¸­<br />
Â· GL_STATIC_DRAWï¼šæç¤ºæ•°æ®ä¸ä¼šé¢‘ç¹ä¿®æ”¹ï¼ŒGPUå¯ä»¥ä¼˜åŒ–å­˜å‚¨</p>
<ol start="6">
<li>glVertexAttribPointer()ï¼ˆæ ¸å¿ƒå‡½æ•°ï¼‰</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ä½ç½®å±æ€§</span><br><span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">6</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>), (<span class="hljs-type">void</span>*)<span class="hljs-number">0</span>);<br><span class="hljs-comment">// é¢œè‰²å±æ€§</span><br><span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">6</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>), (<span class="hljs-type">void</span>*)(<span class="hljs-number">3</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>)));<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šé…ç½®å¦‚ä½•ä»VBOè¯»å–æ•°æ®</p>
<p>å‚æ•°è¯¦è§£ï¼š</p>
<p>Â· å‚æ•°1ï¼šå±æ€§ç´¢å¼•ï¼ˆå¯¹åº”ç€è‰²å™¨ä¸­çš„locationï¼‰<br />
Â· å‚æ•°2ï¼šæ¯ä¸ªé¡¶ç‚¹è¯»å–çš„åˆ†é‡æ•°ï¼ˆ3è¡¨ç¤ºvec3ï¼‰<br />
Â· å‚æ•°3ï¼šæ•°æ®ç±»å‹ï¼ˆGL_FLOATè¡¨ç¤ºfloatï¼‰<br />
Â· å‚æ•°4ï¼šæ˜¯å¦å½’ä¸€åŒ–ï¼ˆGL_FALSEè¡¨ç¤ºä¸å½’ä¸€åŒ–ï¼‰<br />
Â· å‚æ•°5ï¼šæ­¥é•¿ï¼ˆä»ä¸€ä¸ªé¡¶ç‚¹åˆ°ä¸‹ä¸€ä¸ªé¡¶ç‚¹çš„å­—èŠ‚æ•°ï¼‰ 6 * sizeof(float) = 24å­—èŠ‚<br />
Â· å‚æ•°6ï¼šåç§»é‡ï¼ˆè¯¥å±æ€§åœ¨é¡¶ç‚¹å†…çš„èµ·å§‹ä½ç½®ï¼‰ ä½ç½®ï¼šä»0å­—èŠ‚å¼€å§‹<br />
Â· é¢œè‰²ï¼šä»12å­—èŠ‚ï¼ˆ3ä¸ªfloatï¼‰å¼€å§‹</p>
<ol start="7">
<li>glEnableVertexAttribArray()</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glEnableVertexAttribArray</span>(<span class="hljs-number">0</span>);<br><span class="hljs-built_in">glEnableVertexAttribArray</span>(<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šå¯ç”¨é¡¶ç‚¹å±æ€§</p>
<p>Â· å‘Šè¯‰OpenGLå¯ç”¨å¯¹åº”ç´¢å¼•çš„é¡¶ç‚¹å±æ€§<br />
Â· åªæœ‰å¯ç”¨åï¼Œç€è‰²å™¨æ‰èƒ½æ¥æ”¶åˆ°æ•°æ®</p>
<ol start="8">
<li>è§£ç»‘æ“ä½œ</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, <span class="hljs-number">0</span>);<br><span class="hljs-built_in">glBindVertexArray</span>(<span class="hljs-number">0</span>);<br><br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šè§£é™¤ç»‘å®šï¼Œé¿å…æ„å¤–ä¿®æ”¹</p>
<p>Â· éµå¾ª&quot;ä½¿ç”¨åè§£ç»‘&quot;çš„è‰¯å¥½ç¼–ç¨‹ä¹ æƒ¯</p>
<h3 id="æ¸²æŸ“å‡½æ•°-render"><a href="#æ¸²æŸ“å‡½æ•°-render" class="headerlink" title="æ¸²æŸ“å‡½æ•°-render"></a><a class="markdownIt-Anchor" href="#æ¸²æŸ“å‡½æ•°-render"></a> æ¸²æŸ“å‡½æ•° render()</h3>
<ol>
<li>glClearColor() å’Œ glClear()</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glClearColor</span>(<span class="hljs-number">0.2f</span>, <span class="hljs-number">0.3f</span>, <span class="hljs-number">0.3f</span>, <span class="hljs-number">1.0f</span>);<br><span class="hljs-built_in">glClear</span>(GL_COLOR_BUFFER_BIT);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šæ¸…å±</p>
<p>Â· glClearColor()ï¼šè®¾ç½®æ¸…å±é¢œè‰²ï¼ˆé’ç»¿è‰²ï¼‰<br />
Â· glClear()ï¼šç”¨è®¾ç½®çš„é¢œè‰²æ¸…é™¤é¢œè‰²ç¼“å†²åŒº</p>
<ol start="2">
<li>glUseProgram()</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glUseProgram</span>(shaderProgram);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šæ¿€æ´»ç€è‰²å™¨ç¨‹åº</p>
<p>Â· å‘Šè¯‰OpenGLä½¿ç”¨å“ªä¸ªç€è‰²å™¨ç¨‹åºè¿›è¡Œæ¸²æŸ“</p>
<ol start="3">
<li>glBindVertexArray()</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glBindVertexArray</span>(VAO);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šç»‘å®šVAO</p>
<p>Â· æ¢å¤ä¹‹å‰é…ç½®çš„æ‰€æœ‰é¡¶ç‚¹å±æ€§çŠ¶æ€<br />
Â· è‡ªåŠ¨å…³è”å¯¹åº”çš„VBOå’Œå±æ€§é…ç½®</p>
<ol start="4">
<li>glDrawArrays()ï¼ˆæ ¸å¿ƒæ¸²æŸ“å‡½æ•°ï¼‰</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glDrawArrays</span>(GL_TRIANGLES, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šæ‰§è¡Œç»˜åˆ¶å‘½ä»¤</p>
<p>Â· å‚æ•°1ï¼šç»˜åˆ¶æ¨¡å¼ï¼ˆGL_TRIANGLESè¡¨ç¤ºç»˜åˆ¶ä¸‰è§’å½¢ï¼‰<br />
Â· å‚æ•°2ï¼šèµ·å§‹é¡¶ç‚¹ç´¢å¼•ï¼ˆä»ç¬¬0ä¸ªé¡¶ç‚¹å¼€å§‹ï¼‰<br />
Â· å‚æ•°3ï¼šç»˜åˆ¶çš„é¡¶ç‚¹æ•°ï¼ˆç»˜åˆ¶3ä¸ªé¡¶ç‚¹ï¼Œç»„æˆ1ä¸ªä¸‰è§’å½¢ï¼‰</p>
<ol start="5">
<li>è§£ç»‘VAO</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glBindVertexArray</span>(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šæ¸²æŸ“å®Œæˆåè§£ç»‘VAO</p>
<h3 id="å›è°ƒå‡½æ•°-framebuffer_size_callback"><a href="#å›è°ƒå‡½æ•°-framebuffer_size_callback" class="headerlink" title="å›è°ƒå‡½æ•°-framebuffer_size_callback"></a><a class="markdownIt-Anchor" href="#å›è°ƒå‡½æ•°-framebuffer_size_callback"></a> å›è°ƒå‡½æ•° framebuffer_size_callback()</h3>
<p>glViewport()</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glViewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height);<br></code></pre></td></tr></table></figure>
<p>ä½œç”¨ï¼šè®¾ç½®è§†å£ï¼ˆæ¸²æŸ“åŒºåŸŸï¼‰</p>
<p>Â· å½“çª—å£å¤§å°æ”¹å˜æ—¶è¢«è°ƒç”¨<br />
Â· ç¡®ä¿æ¸²æŸ“å†…å®¹æ­£ç¡®é€‚åº”æ–°çª—å£å°ºå¯¸<br />
Â· å‚æ•°1,2ï¼šè§†å£å·¦ä¸‹è§’åœ¨çª—å£ä¸­çš„ä½ç½®<br />
Â· å‚æ•°3,4ï¼šè§†å£çš„å®½åº¦å’Œé«˜åº¦ï¼ˆå®é™…åƒç´ æ•°ï¼‰</p>
<h3 id="æ•°æ®æµç¨‹å›¾"><a href="#æ•°æ®æµç¨‹å›¾" class="headerlink" title="æ•°æ®æµç¨‹å›¾"></a><a class="markdownIt-Anchor" href="#æ•°æ®æµç¨‹å›¾"></a> æ•°æ®æµç¨‹å›¾</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">CPUå†…å­˜(verticesæ•°ç»„)<br>    â†“ glBufferData()<br>GPUå†…å­˜(VBOä¸­)<br>    â†“ VAOé…ç½®(glVertexAttribPointer)<br>é¡¶ç‚¹ç€è‰²å™¨(location 0,1æ¥æ”¶)<br>    â†“ glDrawArrays()<br>å…‰æ …åŒ–(é¢œè‰²æ’å€¼)<br>    â†“<br>ç‰‡æ®µç€è‰²å™¨<br>    â†“<br>å¸§ç¼“å†²åŒº<br>    â†“ glfwSwapBuffers()<br>çª—å£æ˜¾ç¤º<br><br></code></pre></td></tr></table></figure>
<h3 id="å…³é”®æ¦‚å¿µæ€»ç»“"><a href="#å…³é”®æ¦‚å¿µæ€»ç»“" class="headerlink" title="å…³é”®æ¦‚å¿µæ€»ç»“"></a><a class="markdownIt-Anchor" href="#å…³é”®æ¦‚å¿µæ€»ç»“"></a> å…³é”®æ¦‚å¿µæ€»ç»“</h3>
<p>å¯¹è±¡ ä½œç”¨ ç±»æ¯”<br />
VBO å­˜å‚¨é¡¶ç‚¹æ•°æ® ä»“åº“ï¼ˆå­˜æ”¾è´§ç‰©ï¼‰<br />
VAO è®°å½•æ•°æ®è¯»å–æ–¹å¼ ä»“åº“ç®¡ç†æ‰‹å†Œ<br />
Shader å¤„ç†æ•°æ®çš„ç¨‹åº åŠ å·¥æœºå™¨<br />
glDrawArrays å¼€å§‹æ¸²æŸ“ å¼€å§‹ç”Ÿäº§<br />
glViewport è®¾ç½®æ˜¾ç¤ºåŒºåŸŸ å†³å®šåœ¨å“ªä¸ªå±å¹•ä¸Šæ˜¾ç¤º</p>
<h2 id="é¡¶ç‚¹ç€è‰²å™¨"><a href="#é¡¶ç‚¹ç€è‰²å™¨" class="headerlink" title="é¡¶ç‚¹ç€è‰²å™¨"></a><a class="markdownIt-Anchor" href="#é¡¶ç‚¹ç€è‰²å™¨"></a> é¡¶ç‚¹ç€è‰²å™¨</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a><a class="markdownIt-Anchor" href="#åŸºæœ¬æ¦‚å¿µ"></a> åŸºæœ¬æ¦‚å¿µ</h3>
<ol>
<li>å®šä¹‰</li>
</ol>
<p>é¡¶ç‚¹ç€è‰²å™¨æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨GPUä¸Šçš„å°ç¨‹åºï¼Œå¯¹æ¸²æŸ“ç®¡çº¿çš„æ¯ä¸ªé¡¶ç‚¹æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<ol start="2">
<li>ä¸»è¦èŒè´£</li>
</ol>
<p>Â· å¤„ç†é¡¶ç‚¹æ•°æ®ï¼ˆä½ç½®ã€é¢œè‰²ã€æ³•çº¿ã€çº¹ç†åæ ‡ç­‰ï¼‰<br />
Â· æ‰§è¡Œåæ ‡å˜æ¢ï¼ˆæ¨¡å‹â†’ä¸–ç•Œâ†’è§†å›¾â†’æŠ•å½±ï¼‰<br />
Â· ä¼ é€’æ•°æ®ç»™åç»­æ¸²æŸ“é˜¶æ®µ</p>
<ol start="3">
<li>æ‰§è¡Œæ—¶æœº</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">é¡¶ç‚¹æ•°æ® â†’ é¡¶ç‚¹ç€è‰²å™¨ â†’ å…‰æ …åŒ– â†’ ç‰‡æ®µç€è‰²å™¨<br>  â†“          â†“        â†“        â†“<br>æ¯ä¸ªé¡¶ç‚¹    æ¯ä¸ªé¡¶ç‚¹   ç”Ÿæˆç‰‡æ®µ   æ¯ä¸ªåƒç´ <br></code></pre></td></tr></table></figure>
<h3 id="æ ¸å¿ƒä»£ç ç»“æ„"><a href="#æ ¸å¿ƒä»£ç ç»“æ„" class="headerlink" title="æ ¸å¿ƒä»£ç ç»“æ„"></a><a class="markdownIt-Anchor" href="#æ ¸å¿ƒä»£ç ç»“æ„"></a> æ ¸å¿ƒä»£ç ç»“æ„</h3>
<p>åŸºæœ¬æ¨¡æ¿ï¼š</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#version 430 core                  // 1. ç‰ˆæœ¬å£°æ˜</span><br><br><span class="hljs-keyword">layout</span> (<span class="hljs-keyword">location</span> = <span class="hljs-number">0</span>) <span class="hljs-keyword">in</span> <span class="hljs-type">vec3</span> aPos;  <span class="hljs-comment">// 2. è¾“å…¥ï¼šé¡¶ç‚¹ä½ç½®</span><br><span class="hljs-keyword">layout</span> (<span class="hljs-keyword">location</span> = <span class="hljs-number">1</span>) <span class="hljs-keyword">in</span> <span class="hljs-type">vec3</span> aColor;<span class="hljs-comment">//   è¾“å…¥ï¼šé¡¶ç‚¹é¢œè‰²</span><br><br><span class="hljs-keyword">out</span> <span class="hljs-type">vec3</span> ourColor;                 <span class="hljs-comment">// 3. è¾“å‡ºï¼šç»™ç‰‡æ®µç€è‰²å™¨</span><br><br><span class="hljs-type">void</span> main() &#123;                      <span class="hljs-comment">// 4. ä¸»å‡½æ•°</span><br>    <span class="hljs-built_in">gl_Position</span> = <span class="hljs-type">vec4</span>(aPos, <span class="hljs-number">1.0</span>);   <span class="hljs-comment">// å¿…é¡»ï¼šè®¾ç½®é¡¶ç‚¹ä½ç½®</span><br>    ourColor = aColor;               <span class="hljs-comment">// å¯é€‰ï¼šä¼ é€’é¢œè‰²</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="å…³é”®ç»„ä»¶è¯¦è§£"><a href="#å…³é”®ç»„ä»¶è¯¦è§£" class="headerlink" title="å…³é”®ç»„ä»¶è¯¦è§£"></a><a class="markdownIt-Anchor" href="#å…³é”®ç»„ä»¶è¯¦è§£"></a> å…³é”®ç»„ä»¶è¯¦è§£</h3>
<ol>
<li>è¾“å…¥ï¼ˆinå˜é‡ï¼‰</li>
</ol>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-comment">// ä»VAO/VBOæ¥æ”¶æ•°æ®</span><br><span class="hljs-keyword">layout</span> (<span class="hljs-keyword">location</span> = X) <span class="hljs-keyword">in</span> ç±»å‹ å˜é‡å;<br></code></pre></td></tr></table></figure>
<p>Â· location = Xï¼šå¯¹åº”C++ä¸­glVertexAttribPointerçš„ç¬¬ä¸€ä¸ªå‚æ•°<br />
Â· ç±»å‹ï¼švec2ã€vec3ã€vec4ç­‰<br />
Â· æ•°æ®æ¥æºï¼šVAOé…ç½®çš„é¡¶ç‚¹å±æ€§</p>
<ol start="2">
<li>è¾“å‡º</li>
</ol>
<p>Â· å¿…éœ€è¾“å‡ºï¼šgl_Positionï¼ˆå†…ç½®å˜é‡ï¼Œvec4ç±»å‹ï¼‰<br />
Â· è¡¨ç¤ºé¡¶ç‚¹åœ¨è£å‰ªç©ºé—´ä¸­çš„æœ€ç»ˆä½ç½®<br />
Â· è‡ªå®šä¹‰è¾“å‡ºï¼šä½¿ç”¨outå…³é”®å­—<br />
Â· ä¼ é€’ç»™ç‰‡æ®µç€è‰²å™¨çš„æ•°æ®ï¼ˆå¦‚é¢œè‰²ã€çº¹ç†åæ ‡ï¼‰<br />
Â· ä¼šè¢«å…‰æ …åŒ–æ’å€¼</p>
<ol start="3">
<li>Uniformå˜é‡</li>
</ol>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">uniform</span> ç±»å‹ å˜é‡å;  <span class="hljs-comment">// ä»C++ä¼ å…¥çš„å…¨å±€å˜é‡</span><br></code></pre></td></tr></table></figure>
<p>ç”¨é€”ï¼š</p>
<p>Â· å˜æ¢çŸ©é˜µï¼ˆæ¨¡å‹ã€è§†å›¾ã€æŠ•å½±ï¼‰<br />
Â· æ—¶é—´ï¼ˆç”¨äºåŠ¨ç”»ï¼‰<br />
Â· å…‰ç…§å‚æ•°<br />
Â· å…¶ä»–å…¨å±€è®¾ç½®</p>
<h3 id="å‘é‡ç±»å‹ç³»ç»Ÿ"><a href="#å‘é‡ç±»å‹ç³»ç»Ÿ" class="headerlink" title="å‘é‡ç±»å‹ç³»ç»Ÿ"></a><a class="markdownIt-Anchor" href="#å‘é‡ç±»å‹ç³»ç»Ÿ"></a> å‘é‡ç±»å‹ç³»ç»Ÿ</h3>
<p>ç±»å‹ åˆ†é‡æ•° å¸¸ç”¨åœºæ™¯<br />
vec2  2   çº¹ç†åæ ‡(uv)ã€2Dä½ç½®<br />
vec3  3   3Dä½ç½®(xyz)ã€é¢œè‰²(rgb)ã€æ³•çº¿<br />
vec4  4   é½æ¬¡åæ ‡ã€RGBAé¢œè‰²<br />
vec1  1   æå°‘ç”¨ï¼ˆç›´æ¥ç”¨floatï¼‰</p>
<p>å‘é‡æ“ä½œï¼š</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-comment">// æ„é€ </span><br><span class="hljs-type">vec3</span> pos = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>);<br><span class="hljs-type">vec4</span> color = <span class="hljs-type">vec4</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);  <span class="hljs-comment">// çº¢è‰²ï¼Œä¸é€æ˜</span><br><br><span class="hljs-comment">// è®¿é—®åˆ†é‡</span><br><span class="hljs-type">float</span> x = pos.x;      <span class="hljs-comment">// 1.0</span><br><span class="hljs-type">vec2</span> xy = pos.xy;     <span class="hljs-comment">// (1.0, 2.0)</span><br><br><span class="hljs-comment">// Swizzleï¼ˆåˆ†é‡é‡æ’ï¼‰</span><br><span class="hljs-type">vec3</span> yxz = pos.yxz;   <span class="hljs-comment">// (2.0, 1.0, 3.0)</span><br><br><span class="hljs-comment">// è¿ç®—</span><br><span class="hljs-type">vec3</span> a = <span class="hljs-type">vec3</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>, <span class="hljs-number">3.0</span>);<br><span class="hljs-type">vec3</span> b = <span class="hljs-type">vec3</span>(<span class="hljs-number">4.0</span>, <span class="hljs-number">5.0</span>, <span class="hljs-number">6.0</span>);<br><span class="hljs-type">vec3</span> c = a + b;              <span class="hljs-comment">// å‘é‡åŠ </span><br><span class="hljs-type">float</span> <span class="hljs-built_in">dot</span> = <span class="hljs-built_in">dot</span>(a, b);       <span class="hljs-comment">// ç‚¹ç§¯ï¼š32.0</span><br><span class="hljs-type">vec3</span> <span class="hljs-built_in">cross</span> = <span class="hljs-built_in">cross</span>(a, b);    <span class="hljs-comment">// å‰ç§¯ï¼ˆä»…vec3ï¼‰</span><br></code></pre></td></tr></table></figure>
<h3 id="3då›¾å½¢å­¦å˜æ¢"><a href="#3då›¾å½¢å­¦å˜æ¢" class="headerlink" title="3då›¾å½¢å­¦å˜æ¢"></a><a class="markdownIt-Anchor" href="#3då›¾å½¢å­¦å˜æ¢"></a> 3Då›¾å½¢å­¦å˜æ¢</h3>
<p>æ ‡å‡†å˜æ¢æµç¨‹ï¼š</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-meta">#version 430 core</span><br><span class="hljs-keyword">layout</span> (<span class="hljs-keyword">location</span> = <span class="hljs-number">0</span>) <span class="hljs-keyword">in</span> <span class="hljs-type">vec3</span> aPos;<br><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat4</span> model;      <span class="hljs-comment">// æ¨¡å‹çŸ©é˜µï¼ˆç‰©ä½“å˜æ¢ï¼‰</span><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat4</span> view;       <span class="hljs-comment">// è§†å›¾çŸ©é˜µï¼ˆæ‘„åƒæœºï¼‰</span><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">mat4</span> projection; <span class="hljs-comment">// æŠ•å½±çŸ©é˜µï¼ˆ3Dâ†’2Dï¼‰</span><br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-comment">// å®Œæ•´çš„MVPå˜æ¢</span><br>    <span class="hljs-built_in">gl_Position</span> = projection * view * model * <span class="hljs-type">vec4</span>(aPos, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å„å˜æ¢çŸ©é˜µä½œç”¨ï¼š</p>
<p>Â· æ¨¡å‹çŸ©é˜µï¼šç‰©ä½“åæ ‡ç³» â†’ ä¸–ç•Œåæ ‡ç³»<br />
Â· å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ç‰©ä½“<br />
Â· è§†å›¾çŸ©é˜µï¼šä¸–ç•Œåæ ‡ç³» â†’ æ‘„åƒæœºåæ ‡ç³»<br />
Â· æ‘„åƒæœºä½ç½®å’Œæ–¹å‘<br />
Â· æŠ•å½±çŸ©é˜µï¼š3Dç©ºé—´ â†’ 2Dæ ‡å‡†åŒ–è®¾å¤‡åæ ‡<br />
Â· é€è§†/æ­£äº¤æŠ•å½±</p>
<h3 id="é«˜çº§åº”ç”¨"><a href="#é«˜çº§åº”ç”¨" class="headerlink" title="é«˜çº§åº”ç”¨"></a><a class="markdownIt-Anchor" href="#é«˜çº§åº”ç”¨"></a> é«˜çº§åº”ç”¨</h3>
<ol>
<li>ç®€å•åŠ¨ç”»</li>
</ol>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> time;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-comment">// ä¸Šä¸‹æ³¢åŠ¨</span><br>    <span class="hljs-type">float</span> wave = <span class="hljs-built_in">sin</span>(aPos.x * <span class="hljs-number">5.0</span> + time) * <span class="hljs-number">0.1</span>;<br>    <span class="hljs-type">vec3</span> newPos = <span class="hljs-type">vec3</span>(aPos.x, aPos.y + wave, aPos.z);<br>    <span class="hljs-built_in">gl_Position</span> = <span class="hljs-type">vec4</span>(newPos, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>é¡¶ç‚¹å…‰ç…§è®¡ç®—</li>
</ol>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">layout</span> (<span class="hljs-keyword">location</span> = <span class="hljs-number">2</span>) <span class="hljs-keyword">in</span> <span class="hljs-type">vec3</span> aNormal;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> lightPos;<br><span class="hljs-keyword">uniform</span> <span class="hljs-type">vec3</span> lightColor;<br><br><span class="hljs-keyword">out</span> <span class="hljs-type">vec3</span> LightingColor;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-comment">// è®¡ç®—å…‰ç…§ï¼ˆåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ï¼Œæ€§èƒ½å¥½ä½†è´¨é‡ä½ï¼‰</span><br>    <span class="hljs-type">vec3</span> lightDir = <span class="hljs-built_in">normalize</span>(lightPos - aPos);<br>    <span class="hljs-type">float</span> diff = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(aNormal, lightDir), <span class="hljs-number">0.0</span>);<br>    LightingColor = diff * lightColor;<br>&#125;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>å‡ ä½•å˜å½¢</li>
</ol>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-comment">// æ‰­æ›²æ•ˆæœ</span><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">float</span> twistFactor;<br><br><span class="hljs-type">void</span> main() &#123;<br>    <span class="hljs-type">float</span> angle = aPos.y * twistFactor;<br>    <span class="hljs-type">float</span> cosA = <span class="hljs-built_in">cos</span>(angle);<br>    <span class="hljs-type">float</span> sinA = <span class="hljs-built_in">sin</span>(angle);<br><br>    <span class="hljs-type">mat2</span> rot = <span class="hljs-type">mat2</span>(cosA, -sinA, sinA, cosA);<br>    <span class="hljs-type">vec2</span> twisted = rot * aPos.xz;<br><br>    <span class="hljs-built_in">gl_Position</span> = <span class="hljs-type">vec4</span>(twisted.x, aPos.y, twisted.y, <span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="ä¸cçš„æ•°æ®è¿æ¥"><a href="#ä¸cçš„æ•°æ®è¿æ¥" class="headerlink" title="ä¸cçš„æ•°æ®è¿æ¥"></a><a class="markdownIt-Anchor" href="#ä¸cçš„æ•°æ®è¿æ¥"></a> ä¸C++çš„æ•°æ®è¿æ¥</h3>
<p>æ•°æ®æµå‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">C++ç¨‹åº â†’ VAOé…ç½® â†’ é¡¶ç‚¹ç€è‰²å™¨ â†’ ç‰‡æ®µç€è‰²å™¨<br>   â†“        â†“          â†“         â†“<br>è®¾ç½®uniform  å®šä¹‰å±æ€§  æ¥æ”¶inå˜é‡  æ¥æ”¶æ’å€¼åæ•°æ®<br>            layout   å¤„ç†è®¡ç®—   æœ€ç»ˆé¢œè‰²è¾“å‡º<br></code></pre></td></tr></table></figure>
<p>è¿æ¥æ­¥éª¤ï¼š</p>
<ol>
<li>
<p>C++ä¸­é…ç½®VAOï¼š</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, stride, offset);<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>ç€è‰²å™¨å£°æ˜å¯¹åº”locationï¼š</p>
 <figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">layout</span> (<span class="hljs-keyword">location</span> = <span class="hljs-number">0</span>) <span class="hljs-keyword">in</span> <span class="hljs-type">vec3</span> aPos;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>ä¼ é€’uniformï¼š</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// C++ä¸­</span><br>GLint loc = <span class="hljs-built_in">glGetUniformLocation</span>(program, <span class="hljs-string">&quot;time&quot;</span>);<br><span class="hljs-built_in">glUniform1f</span>(loc, currentTime);<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="ç‰‡æ®µç€è‰²å™¨"><a href="#ç‰‡æ®µç€è‰²å™¨" class="headerlink" title="ç‰‡æ®µç€è‰²å™¨"></a><a class="markdownIt-Anchor" href="#ç‰‡æ®µç€è‰²å™¨"></a> ç‰‡æ®µç€è‰²å™¨</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µ-2"><a href="#åŸºæœ¬æ¦‚å¿µ-2" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ-2"></a><a class="markdownIt-Anchor" href="#åŸºæœ¬æ¦‚å¿µ-2"></a> åŸºæœ¬æ¦‚å¿µ</h3>
<p>å®šä¹‰<br />
ç‰‡æ®µç€è‰²å™¨ï¼ˆFragment Shaderï¼‰æ˜¯GPUæ¸²æŸ“ç®¡çº¿çš„æœ€åä¸€ä¸ªå¯ç¼–ç¨‹é˜¶æ®µï¼Œå¤„ç†æ¯ä¸ªåƒç´ ï¼ˆç‰‡æ®µï¼‰ çš„æœ€ç»ˆé¢œè‰²ã€‚<br />
æ ¸å¿ƒèŒè´£<br />
Â· è®¡ç®—æ¯ä¸ªåƒç´ çš„æœ€ç»ˆé¢œè‰²<br />
Â· åº”ç”¨çº¹ç†ã€å…‰ç…§ã€é˜´å½±ç­‰æ•ˆæœ<br />
Â· å†³å®šåƒç´ æ˜¯å¦è¢«ä¸¢å¼ƒï¼ˆé€æ˜åº¦ã€æ·±åº¦æµ‹è¯•ç­‰ï¼‰<br />
æ‰§è¡Œæ—¶æœº<br />
é¡¶ç‚¹ç€è‰²å™¨ â†’ å…‰æ …åŒ– â†’ ç‰‡æ®µç€è‰²å™¨ â†’ å¸§ç¼“å†²åŒº<br />
â†“         â†“         â†“         â†“<br />
æ¯ä¸ªé¡¶ç‚¹    ç”Ÿæˆç‰‡æ®µ   æ¯ä¸ªåƒç´     æœ€ç»ˆå›¾åƒ</p>
<p>â€‹<br />
Â· æ‰§è¡Œæ¬¡æ•° = å±å¹•åƒç´ æ•°ï¼ˆæˆ–å¯è§ç‰‡æ®µæ•°ï¼‰<br />
Â· é€šå¸¸æ‰§è¡Œæ¬¡æ•° &gt;&gt; é¡¶ç‚¹ç€è‰²å™¨æ‰§è¡Œæ¬¡æ•°<br />
äºŒã€æ ¸å¿ƒä»£ç ç»“æ„<br />
åŸºæœ¬æ¨¡æ¿ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#version 430 core                <span class="hljs-comment">// 1. ç‰ˆæœ¬å£°æ˜</span></span><br><br>in vec3 ourColor;                <span class="hljs-comment">// 2. è¾“å…¥ï¼šä»é¡¶ç‚¹ç€è‰²å™¨æ¥ï¼ˆæ’å€¼åï¼‰</span><br>in vec2 TexCoord;                <span class="hljs-comment">//    å…¶ä»–æ’å€¼æ•°æ®</span><br><br>out vec4 FragColor;              <span class="hljs-comment">// 3. è¾“å‡ºï¼šæœ€ç»ˆåƒç´ é¢œè‰²ï¼ˆå¿…é¡»ï¼ï¼‰</span><br><br>uniform sampler2D ourTexture;    <span class="hljs-comment">// 4. Uniformå˜é‡ï¼šçº¹ç†é‡‡æ ·å™¨</span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;                    <span class="hljs-comment">// 5. ä¸»å‡½æ•°</span><br>    <span class="hljs-comment">// ç®€å•é¢œè‰²è¾“å‡º</span><br>    FragColor = <span class="hljs-built_in">vec4</span>(ourColor, <span class="hljs-number">1.0</span>);<br><br>    <span class="hljs-comment">// æˆ–çº¹ç†é‡‡æ ·</span><br>    <span class="hljs-comment">// FragColor = texture(ourTexture, TexCoord);</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="å…³é”®ç»„ä»¶è¯¦è§£-2"><a href="#å…³é”®ç»„ä»¶è¯¦è§£-2" class="headerlink" title="å…³é”®ç»„ä»¶è¯¦è§£-2"></a><a class="markdownIt-Anchor" href="#å…³é”®ç»„ä»¶è¯¦è§£-2"></a> å…³é”®ç»„ä»¶è¯¦è§£</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs cpp">è¾“å…¥ï¼ˆinå˜é‡ï¼‰<br>in ç±»å‹ å˜é‡å;  <span class="hljs-comment">// ä»é¡¶ç‚¹ç€è‰²å™¨ä¼ é€’ï¼Œç»è¿‡å…‰æ …åŒ–æ’å€¼</span><br>â€‹<br>ç‰¹ç‚¹ï¼š<br>Â· è‡ªåŠ¨æ’å€¼ï¼šä¸‰è§’å½¢é¡¶ç‚¹é—´çš„å¹³æ»‘è¿‡æ¸¡<br>Â· æ— locationï¼šä¸é¡¶ç‚¹ç€è‰²å™¨çš„outå˜é‡åå¯¹åº”<br>Â· å…¸å‹è¾“å…¥ï¼š<br>Â· é¢œè‰²ï¼šin vec3 ourColor;<br>Â· çº¹ç†åæ ‡ï¼šin vec2 TexCoord;<br>Â· æ³•çº¿ï¼šin vec3 Normal;<br>Â· ä¸–ç•Œåæ ‡ï¼šin vec3 FragPos;<br>è¾“å‡º<br>Â· å¿…éœ€è¾“å‡ºï¼šè‡³å°‘ä¸€ä¸ªoutå˜é‡ï¼ˆé€šå¸¸æ˜¯FragColorï¼‰<br>out vec4 FragColor;  <span class="hljs-comment">// RGBAé¢œè‰²ï¼ŒA=é€æ˜åº¦</span><br><br>â€‹<br>Â· å¤šæ¸²æŸ“ç›®æ ‡ï¼ˆMRTï¼‰ï¼š<br><span class="hljs-built_in">layout</span>(location = <span class="hljs-number">0</span>) out vec4 ColorBuffer;<br><span class="hljs-built_in">layout</span>(location = <span class="hljs-number">1</span>) out vec4 NormalBuffer;<br><span class="hljs-built_in">layout</span>(location = <span class="hljs-number">2</span>) out vec4 PositionBuffer;<br><br>â€‹<br>Uniformå˜é‡<br>uniform ç±»å‹ å˜é‡å;  <span class="hljs-comment">// ä»C++ä¼ å…¥ï¼Œæ‰€æœ‰ç‰‡æ®µå…±äº«</span><br><br>â€‹<br>å¸¸ç”¨uniformï¼š<br>Â· çº¹ç†é‡‡æ ·å™¨ï¼šsampler2D, samplerCube<br>Â· æ—¶é—´ï¼š<span class="hljs-type">float</span> time<br>Â· å…‰ç…§å‚æ•°ï¼švec3 lightPos, vec3 lightColor<br>Â· æè´¨å±æ€§ï¼švec3 ambient, vec3 diffuse, vec3 specular<br>Â· æ‘„åƒæœºä½ç½®ï¼švec3 viewPos<br></code></pre></td></tr></table></figure>
<h3 id="å†…ç½®å˜é‡ä¸å‡½æ•°"><a href="#å†…ç½®å˜é‡ä¸å‡½æ•°" class="headerlink" title="å†…ç½®å˜é‡ä¸å‡½æ•°"></a><a class="markdownIt-Anchor" href="#å†…ç½®å˜é‡ä¸å‡½æ•°"></a> å†…ç½®å˜é‡ä¸å‡½æ•°</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cpp">é‡è¦å†…ç½®å˜é‡<br><span class="hljs-comment">// ç‰‡æ®µä¿¡æ¯</span><br>vec4 gl_FragCoord;      <span class="hljs-comment">// åƒç´ åæ ‡(x,y,z,w)ï¼Œzæ˜¯æ·±åº¦</span><br><span class="hljs-type">bool</span> gl_FrontFacing;    <span class="hljs-comment">// æ˜¯å¦æ­£é¢æœå‘</span><br>vec2 gl_PointCoord;     <span class="hljs-comment">// ç‚¹ç²¾çµçš„çº¹ç†åæ ‡</span><br><br><span class="hljs-comment">// æ·±åº¦æ§åˆ¶ï¼ˆå¯é€‰ï¼‰</span><br><span class="hljs-type">float</span> gl_FragDepth;     <span class="hljs-comment">// æ‰‹åŠ¨è®¾ç½®æ·±åº¦å€¼</span><br><br>â€‹<br>æ ¸å¿ƒå†…ç½®å‡½æ•°<br><span class="hljs-comment">// çº¹ç†é‡‡æ ·</span><br><span class="hljs-function">vec4 <span class="hljs-title">texture</span><span class="hljs-params">(sampler2D sampler, vec2 coord)</span></span>;<br><span class="hljs-function">vec4 <span class="hljs-title">texture</span><span class="hljs-params">(samplerCube sampler, vec3 coord)</span></span>;<br><br><span class="hljs-comment">// æ•°å­¦å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">length</span><span class="hljs-params">(vec2/vec3 v)</span></span>;    <span class="hljs-comment">// å‘é‡é•¿åº¦</span><br><span class="hljs-function">vec3 <span class="hljs-title">normalize</span><span class="hljs-params">(vec3 v)</span></span>;       <span class="hljs-comment">// å•ä½åŒ–</span><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">dot</span><span class="hljs-params">(vec3 a, vec3 b)</span></span>;    <span class="hljs-comment">// ç‚¹ç§¯</span><br><span class="hljs-function">vec3 <span class="hljs-title">cross</span><span class="hljs-params">(vec3 a, vec3 b)</span></span>;   <span class="hljs-comment">// å‰ç§¯</span><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">mix</span><span class="hljs-params">(<span class="hljs-type">float</span> a, <span class="hljs-type">float</span> b, <span class="hljs-type">float</span> t)</span></span>; <span class="hljs-comment">// çº¿æ€§æ’å€¼</span><br><br><span class="hljs-comment">// å™ªå£°ä¸éšæœº</span><br><span class="hljs-function"><span class="hljs-type">float</span> <span class="hljs-title">noise</span><span class="hljs-params">(vec2/vec3 p)</span></span>;     <span class="hljs-comment">// æŸæ—å™ªå£°</span><br></code></pre></td></tr></table></figure>
<p>â€‹</p>
<h3 id="çº¹ç†å¤„ç†"><a href="#çº¹ç†å¤„ç†" class="headerlink" title="çº¹ç†å¤„ç†"></a><a class="markdownIt-Anchor" href="#çº¹ç†å¤„ç†"></a> çº¹ç†å¤„ç†</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs cpp">åŸºæœ¬çº¹ç†é‡‡æ ·<br>uniform sampler2D texture1;<br>in vec2 TexCoord;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// é‡‡æ ·çº¹ç†</span><br>    vec4 texColor = <span class="hljs-built_in">texture</span>(texture1, TexCoord);<br><br>    <span class="hljs-comment">// æ··åˆçº¹ç†å’Œé¢œè‰²</span><br>    FragColor = texColor * <span class="hljs-built_in">vec4</span>(ourColor, <span class="hljs-number">1.0</span>);<br>&#125;<br><br>â€‹<br>å¤šçº¹ç†æ··åˆ<br>uniform sampler2D texture1;<br>uniform sampler2D texture2;<br>uniform <span class="hljs-type">float</span> mixValue;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    vec4 tex1 = <span class="hljs-built_in">texture</span>(texture1, TexCoord);<br>    vec4 tex2 = <span class="hljs-built_in">texture</span>(texture2, TexCoord);<br>    FragColor = <span class="hljs-built_in">mix</span>(tex1, tex2, mixValue);<br>&#125;<br><br>â€‹<br>çº¹ç†è¿‡æ»¤ä¸åŒ…è£…<br><span class="hljs-comment">// çº¹ç†åæ ‡å˜æ¢ï¼ˆå¤„ç†è¶…å‡º[0,1]èŒƒå›´ï¼‰</span><br>vec2 wrappedCoord = <span class="hljs-built_in">fract</span>(TexCoord);  <span class="hljs-comment">// é‡å¤çº¹ç†</span><br>vec2 mirroredCoord = <span class="hljs-built_in">abs</span>(TexCoord);   <span class="hljs-comment">// é•œåƒé‡å¤</span><br><br><span class="hljs-comment">// è‡ªå®šä¹‰é‡‡æ ·</span><br><span class="hljs-function">vec4 <span class="hljs-title">customSample</span><span class="hljs-params">(sampler2D tex, vec2 coord)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">texture</span>(tex, coord);<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="glmæ•°å­¦å·¥å…·åº“"><a href="#glmæ•°å­¦å·¥å…·åº“" class="headerlink" title="glmæ•°å­¦å·¥å…·åº“"></a><a class="markdownIt-Anchor" href="#glmæ•°å­¦å·¥å…·åº“"></a> glmæ•°å­¦å·¥å…·åº“</h2>
<h3 id="glmæ ¸å¿ƒæ¦‚å¿µ"><a href="#glmæ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="glmæ ¸å¿ƒæ¦‚å¿µ"></a><a class="markdownIt-Anchor" href="#glmæ ¸å¿ƒæ¦‚å¿µ"></a> ğŸ“¦ GLMæ ¸å¿ƒæ¦‚å¿µ</h3>
<p>GLM = OpenGL Mathematicsï¼Œä¸“ä¸ºå›¾å½¢å­¦è®¾è®¡çš„æ•°å­¦åº“</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;glm/glm.hpp&gt;</span>              <span class="hljs-comment">// æ ¸å¿ƒåº“</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;glm/gtc/matrix_transform.hpp&gt;</span> <span class="hljs-comment">// å˜æ¢å‡½æ•°</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;glm/gtc/type_ptr.hpp&gt;</span>     <span class="hljs-comment">// ç±»å‹æŒ‡é’ˆè½¬æ¢</span></span><br><br></code></pre></td></tr></table></figure>
<h3 id="åŸºæœ¬æ•°æ®ç±»å‹"><a href="#åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="åŸºæœ¬æ•°æ®ç±»å‹"></a><a class="markdownIt-Anchor" href="#åŸºæœ¬æ•°æ®ç±»å‹"></a> ğŸ”¢ åŸºæœ¬æ•°æ®ç±»å‹</h3>
<p>å‘é‡ (Vectors)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">glm::vec2 <span class="hljs-title">v2</span><span class="hljs-params">(<span class="hljs-number">1.0f</span>, <span class="hljs-number">2.0f</span>)</span></span>;          <span class="hljs-comment">// 2Då‘é‡ (x, y)</span><br><span class="hljs-function">glm::vec3 <span class="hljs-title">v3</span><span class="hljs-params">(<span class="hljs-number">1.0f</span>, <span class="hljs-number">2.0f</span>, <span class="hljs-number">3.0f</span>)</span></span>;    <span class="hljs-comment">// 3Då‘é‡ (x, y, z) â† æœ€å¸¸ç”¨ï¼</span><br><span class="hljs-function">glm::vec4 <span class="hljs-title">v4</span><span class="hljs-params">(<span class="hljs-number">1.0f</span>, <span class="hljs-number">2.0f</span>, <span class="hljs-number">3.0f</span>, <span class="hljs-number">1.0f</span>)</span></span>; <span class="hljs-comment">// 4Då‘é‡ (x, y, z, w)</span><br><br><span class="hljs-comment">// è®¿é—®åˆ†é‡</span><br><span class="hljs-type">float</span> x = v<span class="hljs-number">3.</span>x;     <span class="hljs-comment">// ç›´æ¥è®¿é—®</span><br><span class="hljs-type">float</span> y = v3[<span class="hljs-number">1</span>];    <span class="hljs-comment">// æ•°ç»„å¼è®¿é—®</span><br><span class="hljs-type">float</span> z = v<span class="hljs-number">3.</span>r;     <span class="hljs-comment">// é¢œè‰²å¼è®¿é—® (r,g,b,a)</span><br><br><span class="hljs-comment">// å¸¸ç”¨å‘é‡</span><br>glm::vec3 zero = glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">0.0f</span>);          <span class="hljs-comment">// (0,0,0)</span><br>glm::vec3 one = glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">1.0f</span>);           <span class="hljs-comment">// (1,1,1)</span><br>glm::vec3 up = glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>); <span class="hljs-comment">// ä¸Šæ–¹å‘</span><br><br></code></pre></td></tr></table></figure>
<p>çŸ©é˜µ (Matrices)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp">glm::mat2 m2;        <span class="hljs-comment">// 2Ã—2çŸ©é˜µ</span><br>glm::mat3 m3;        <span class="hljs-comment">// 3Ã—3çŸ©é˜µ</span><br>glm::mat4 m4;        <span class="hljs-comment">// 4Ã—4çŸ©é˜µ â† 3Då˜æ¢æœ€å¸¸ç”¨ï¼</span><br><br><span class="hljs-comment">// åˆ›å»ºå•ä½çŸ©é˜µï¼ˆä»€ä¹ˆéƒ½ä¸åšçš„çŸ©é˜µï¼‰</span><br>glm::mat4 identity = glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>);  <span class="hljs-comment">// å¯¹è§’çº¿ä¸º1ï¼Œå…¶ä»–ä¸º0</span><br><span class="hljs-comment">// [1, 0, 0, 0]</span><br><span class="hljs-comment">// [0, 1, 0, 0]</span><br><span class="hljs-comment">// [0, 0, 1, 0]</span><br><span class="hljs-comment">// [0, 0, 0, 1]</span><br><br><span class="hljs-comment">// è®¿é—®å…ƒç´ </span><br><span class="hljs-type">float</span> elem = m4[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>];  <span class="hljs-comment">// ç¬¬0è¡Œç¬¬1åˆ—</span><br><br></code></pre></td></tr></table></figure>
<h3 id="å˜æ¢çŸ©é˜µ-transformations"><a href="#å˜æ¢çŸ©é˜µ-transformations" class="headerlink" title="å˜æ¢çŸ©é˜µ-transformations"></a><a class="markdownIt-Anchor" href="#å˜æ¢çŸ©é˜µ-transformations"></a> ğŸš€ å˜æ¢çŸ©é˜µ (Transformations)</h3>
<ol>
<li>å¹³ç§» (Translation)</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">glm::mat4 model = glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>);  <span class="hljs-comment">// å•ä½çŸ©é˜µ</span><br>model = glm::<span class="hljs-built_in">translate</span>(model, glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">1.0f</span>, <span class="hljs-number">2.0f</span>, <span class="hljs-number">3.0f</span>));<br><span class="hljs-comment">// å°†ç‰©ä½“ç§»åŠ¨åˆ°(1, 2, 3)ä½ç½®</span><br><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>æ—‹è½¬ (Rotation)</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ç»•ç‰¹å®šè½´æ—‹è½¬ï¼ˆè§’åº¦å•ä½ï¼šå¼§åº¦ï¼‰</span><br>model = glm::<span class="hljs-built_in">rotate</span>(model, angle, glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>));<br><span class="hljs-comment">// ç»•Yè½´æ—‹è½¬angleå¼§åº¦</span><br><br><span class="hljs-comment">// å¸¸ç”¨ï¼šåº¦è½¬å¼§åº¦</span><br><span class="hljs-type">float</span> radians = glm::<span class="hljs-built_in">radians</span>(<span class="hljs-number">45.0f</span>);  <span class="hljs-comment">// 45åº¦è½¬å¼§åº¦</span><br>model = glm::<span class="hljs-built_in">rotate</span>(model, glm::<span class="hljs-built_in">radians</span>(<span class="hljs-number">45.0f</span>), glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>));<br><br><span class="hljs-comment">// ç»•å¤šä¸ªè½´æ—‹è½¬ï¼ˆæ³¨æ„é¡ºåºï¼ï¼‰</span><br>glm::mat4 rotation = glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>);<br>rotation = glm::<span class="hljs-built_in">rotate</span>(rotation, angleX, glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)); <span class="hljs-comment">// Xè½´</span><br>rotation = glm::<span class="hljs-built_in">rotate</span>(rotation, angleY, glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)); <span class="hljs-comment">// Yè½´</span><br>rotation = glm::<span class="hljs-built_in">rotate</span>(rotation, angleZ, glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)); <span class="hljs-comment">// Zè½´</span><br><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>ç¼©æ”¾ (Scaling)</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">model = glm::<span class="hljs-built_in">scale</span>(model, glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">2.0f</span>, <span class="hljs-number">2.0f</span>, <span class="hljs-number">2.0f</span>));  <span class="hljs-comment">// å‡åŒ€æ”¾å¤§2å€</span><br>model = glm::<span class="hljs-built_in">scale</span>(model, glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">1.0f</span>, <span class="hljs-number">2.0f</span>, <span class="hljs-number">1.0f</span>));  <span class="hljs-comment">// åªåœ¨Yè½´æ‹‰ä¼¸2å€</span><br><br></code></pre></td></tr></table></figure>
<h3 id="è§†å›¾å’ŒæŠ•å½±çŸ©é˜µ"><a href="#è§†å›¾å’ŒæŠ•å½±çŸ©é˜µ" class="headerlink" title="è§†å›¾å’ŒæŠ•å½±çŸ©é˜µ"></a><a class="markdownIt-Anchor" href="#è§†å›¾å’ŒæŠ•å½±çŸ©é˜µ"></a> ğŸ“ è§†å›¾å’ŒæŠ•å½±çŸ©é˜µ</h3>
<p>è§†å›¾çŸ©é˜µ (View Matrix) - â€œç›¸æœºâ€</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ–¹æ³•1ï¼šç›´æ¥å¹³ç§»ï¼ˆç›¸æœºåé€€ï¼‰</span><br>glm::mat4 view = glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>);<br>view = glm::<span class="hljs-built_in">translate</span>(view, glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">-3.0f</span>));  <span class="hljs-comment">// ç›¸æœºåœ¨Z=3</span><br><br><span class="hljs-comment">// æ–¹æ³•2ï¼šä½¿ç”¨lookAtï¼ˆæ›´ç›´è§‚ï¼‰</span><br>glm::mat4 view = glm::<span class="hljs-built_in">lookAt</span>(<br>    glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">3.0f</span>),   <span class="hljs-comment">// ç›¸æœºä½ç½®</span><br>    glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>),   <span class="hljs-comment">// çœ‹å‘çš„ç›®æ ‡ç‚¹</span><br>    glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>)    <span class="hljs-comment">// ç›¸æœºçš„&quot;ä¸Š&quot;æ–¹å‘</span><br>);<br><br></code></pre></td></tr></table></figure>
<p>æŠ•å½±çŸ©é˜µ (Projection Matrix)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// é€è§†æŠ•å½± (3Dæ•ˆæœï¼Œæœ‰è¿‘å¤§è¿œå°)</span><br>glm::mat4 projection = glm::<span class="hljs-built_in">perspective</span>(<br>    glm::<span class="hljs-built_in">radians</span>(<span class="hljs-number">45.0f</span>),            <span class="hljs-comment">// è§†é‡è§’åº¦(FOV) - å¸¸ç”¨45Â°</span><br>    (<span class="hljs-type">float</span>)width / (<span class="hljs-type">float</span>)height,   <span class="hljs-comment">// å®½é«˜æ¯”</span><br>    <span class="hljs-number">0.1f</span>,                           <span class="hljs-comment">// è¿‘å¹³é¢ - æœ€è¿‘èƒ½çœ‹åˆ°å“ªé‡Œ</span><br>    <span class="hljs-number">100.0f</span>                          <span class="hljs-comment">// è¿œå¹³é¢ - æœ€è¿œèƒ½çœ‹åˆ°å“ªé‡Œ</span><br>);<br><br><span class="hljs-comment">// æ­£äº¤æŠ•å½± (2D/UIï¼Œæ— è¿‘å¤§è¿œå°)</span><br>glm::mat4 ortho = glm::<span class="hljs-built_in">ortho</span>(<br>    <span class="hljs-number">-2.0f</span>, <span class="hljs-number">2.0f</span>,     <span class="hljs-comment">// å·¦/å³è¾¹ç•Œ</span><br>    <span class="hljs-number">-1.5f</span>, <span class="hljs-number">1.5f</span>,     <span class="hljs-comment">// ä¸‹/ä¸Šè¾¹ç•Œ</span><br>    <span class="hljs-number">0.1f</span>, <span class="hljs-number">100.0f</span>     <span class="hljs-comment">// è¿‘/è¿œå¹³é¢</span><br>);<br><br></code></pre></td></tr></table></figure>
<h3 id="çŸ©é˜µæ“ä½œå’Œç»„åˆ"><a href="#çŸ©é˜µæ“ä½œå’Œç»„åˆ" class="headerlink" title="çŸ©é˜µæ“ä½œå’Œç»„åˆ"></a><a class="markdownIt-Anchor" href="#çŸ©é˜µæ“ä½œå’Œç»„åˆ"></a> ğŸ§® çŸ©é˜µæ“ä½œå’Œç»„åˆ</h3>
<p>çŸ©é˜µä¹˜æ³•é¡ºåº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// é‡è¦ï¼šçŸ©é˜µä¹˜æ³•é¡ºåºæ˜¯ä»å³å‘å·¦ï¼</span><br>glm::mat4 mvp = projection * view * model;<br><br><span class="hljs-comment">// ç­‰ä»·äºï¼š</span><br><span class="hljs-comment">// 1. å…ˆåº”ç”¨æ¨¡å‹å˜æ¢ï¼šmodel Ã— vertex</span><br><span class="hljs-comment">// 2. å†åº”ç”¨è§†å›¾å˜æ¢ï¼šview Ã— (model Ã— vertex)</span><br><span class="hljs-comment">// 3. æœ€åæŠ•å½±ï¼šprojection Ã— (view Ã— model Ã— vertex)</span><br><br></code></pre></td></tr></table></figure>
<p>å˜æ¢é¡ºåºå¾ˆé‡è¦ï¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// âŒ é”™è¯¯é¡ºåºï¼šå…ˆç§»åŠ¨åæ—‹è½¬</span><br>glm::mat4 wrong = glm::<span class="hljs-built_in">rotate</span>(glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>), angle, axis)<br>                * glm::<span class="hljs-built_in">translate</span>(glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>), position);<br><span class="hljs-comment">// ç‰©ä½“ä¼šç»•ä¸–ç•ŒåŸç‚¹æ—‹è½¬ï¼</span><br><br><span class="hljs-comment">// âœ… æ­£ç¡®é¡ºåºï¼šå…ˆæ—‹è½¬åç§»åŠ¨</span><br>glm::mat4 correct = glm::<span class="hljs-built_in">translate</span>(glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>), position)<br>                  * glm::<span class="hljs-built_in">rotate</span>(glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>), angle, axis);<br><span class="hljs-comment">// ç‰©ä½“ç»•è‡ªèº«ä¸­å¿ƒæ—‹è½¬ï¼Œç„¶åç§»åŠ¨</span><br><br></code></pre></td></tr></table></figure>
<h3 id="å‘é‡å’ŒçŸ©é˜µè¿ç®—"><a href="#å‘é‡å’ŒçŸ©é˜µè¿ç®—" class="headerlink" title="å‘é‡å’ŒçŸ©é˜µè¿ç®—"></a><a class="markdownIt-Anchor" href="#å‘é‡å’ŒçŸ©é˜µè¿ç®—"></a> ğŸ“Š å‘é‡å’ŒçŸ©é˜µè¿ç®—</h3>
<p>å‘é‡è¿ç®—</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">glm::vec3 <span class="hljs-title">a</span><span class="hljs-params">(<span class="hljs-number">1.0f</span>, <span class="hljs-number">2.0f</span>, <span class="hljs-number">3.0f</span>)</span></span>;<br><span class="hljs-function">glm::vec3 <span class="hljs-title">b</span><span class="hljs-params">(<span class="hljs-number">4.0f</span>, <span class="hljs-number">5.0f</span>, <span class="hljs-number">6.0f</span>)</span></span>;<br><br><span class="hljs-comment">// åŸºæœ¬è¿ç®—</span><br>glm::vec3 c = a + b;      <span class="hljs-comment">// åŠ æ³• (5,7,9)</span><br>glm::vec3 d = a - b;      <span class="hljs-comment">// å‡æ³• (-3,-3,-3)</span><br>glm::vec3 e = a * <span class="hljs-number">2.0f</span>;   <span class="hljs-comment">// æ•°ä¹˜ (2,4,6)</span><br>glm::vec3 f = a / <span class="hljs-number">2.0f</span>;   <span class="hljs-comment">// æ•°é™¤ (0.5,1,1.5)</span><br><br><span class="hljs-comment">// ç‚¹ç§¯ï¼ˆç»“æœï¼šæ ‡é‡ï¼‰- ç”¨äºæ±‚è§’åº¦ã€æŠ•å½±</span><br><span class="hljs-type">float</span> dot = glm::<span class="hljs-built_in">dot</span>(a, b);  <span class="hljs-comment">// 1*4 + 2*5 + 3*6 = 32</span><br><br><span class="hljs-comment">// å‰ç§¯ï¼ˆç»“æœï¼šå‘é‡ï¼‰- ç”¨äºæ±‚æ³•çº¿ã€å‚ç›´å‘é‡</span><br>glm::vec3 cross = glm::<span class="hljs-built_in">cross</span>(a, b);  <span class="hljs-comment">// å‚ç›´äºaå’Œbçš„å‘é‡</span><br><br><span class="hljs-comment">// é•¿åº¦å’Œå½’ä¸€åŒ–</span><br><span class="hljs-type">float</span> length = glm::<span class="hljs-built_in">length</span>(a);        <span class="hljs-comment">// å‘é‡é•¿åº¦</span><br>glm::vec3 normalized = glm::<span class="hljs-built_in">normalize</span>(a); <span class="hljs-comment">// å•ä½å‘é‡ï¼ˆé•¿åº¦ä¸º1ï¼‰</span><br><br><span class="hljs-comment">// è·ç¦»</span><br><span class="hljs-type">float</span> distance = glm::<span class="hljs-built_in">distance</span>(a, b); <span class="hljs-comment">// aå’Œbä¹‹é—´çš„è·ç¦»</span><br><br></code></pre></td></tr></table></figure>
<p>çŸ©é˜µè¿ç®—</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp">glm::mat4 A = glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>);<br>glm::mat4 B = glm::<span class="hljs-built_in">translate</span>(glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>), glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>));<br><br><span class="hljs-comment">// çŸ©é˜µä¹˜æ³•</span><br>glm::mat4 C = A * B;  <span class="hljs-comment">// ç»„åˆå˜æ¢</span><br><br><span class="hljs-comment">// çŸ©é˜µæ±‚é€†</span><br>glm::mat4 inverse = glm::<span class="hljs-built_in">inverse</span>(A);  <span class="hljs-comment">// é€†çŸ©é˜µ</span><br><br><span class="hljs-comment">// çŸ©é˜µè½¬ç½®</span><br>glm::mat4 transpose = glm::<span class="hljs-built_in">transpose</span>(A);<br></code></pre></td></tr></table></figure>
<p>â€‹</p>
<h2 id="uniformå‡½æ•°å°è£…"><a href="#uniformå‡½æ•°å°è£…" class="headerlink" title="uniformå‡½æ•°å°è£…"></a><a class="markdownIt-Anchor" href="#uniformå‡½æ•°å°è£…"></a> uniformå‡½æ•°å°è£…</h2>
<h3 id="opengl-uniformåŸè£…å‡½æ•°åº“"><a href="#opengl-uniformåŸè£…å‡½æ•°åº“" class="headerlink" title="opengl-uniformåŸè£…å‡½æ•°åº“"></a><a class="markdownIt-Anchor" href="#opengl-uniformåŸè£…å‡½æ•°åº“"></a> ğŸ“¦ OpenGL UniformåŸè£…å‡½æ•°åº“</h3>
<p>æ ¸å¿ƒå¤´æ–‡ä»¶</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;glad/glad.h&gt;</span>  <span class="hljs-comment">// åŒ…å«æ‰€æœ‰glUniform*å‡½æ•°å£°æ˜</span></span><br></code></pre></td></tr></table></figure>
<p>æ‰€æœ‰glUniformå‡½æ•°ä¸€è§ˆè¡¨</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp">å‡½æ•° å‚æ•°æ ¼å¼ å¯¹åº”GLSLç±»å‹ ç”¨é€”<br>æ ‡é‡ç±»<br>glUniform1&#123;i/ui/f&#125; (loc, value) <span class="hljs-type">int</span>/uint/<span class="hljs-type">float</span> å•ä¸ªå€¼<br>glUniform2&#123;i/ui/f&#125; (loc, v0, v1) ivec2/uvec2/vec2 <span class="hljs-number">2</span>åˆ†é‡<br>glUniform3&#123;i/ui/f&#125; (loc, v0, v1, v2) ivec3/uvec3/vec3 <span class="hljs-number">3</span>åˆ†é‡<br>glUniform4&#123;i/ui/f&#125; (loc, v0, v1, v2, v3) ivec4/uvec4/vec4 <span class="hljs-number">4</span>åˆ†é‡<br>æ•°ç»„ç±»<br>glUniform1&#123;i/ui/f&#125;<span class="hljs-built_in">v</span> (loc, count, array) <span class="hljs-type">int</span>[]/<span class="hljs-type">float</span>[] æ ‡é‡æ•°ç»„<br>glUniform2&#123;i/ui/f&#125;<span class="hljs-built_in">v</span> (loc, count, array) vec2[] <span class="hljs-number">2</span>Då‘é‡æ•°ç»„<br>glUniform3&#123;i/ui/f&#125;<span class="hljs-built_in">v</span> (loc, count, array) vec3[] <span class="hljs-number">3</span>Då‘é‡æ•°ç»„<br>glUniform4&#123;i/ui/f&#125;<span class="hljs-built_in">v</span> (loc, count, array) vec4[] <span class="hljs-number">4</span>Då‘é‡æ•°ç»„<br>çŸ©é˜µç±»<br><span class="hljs-built_in">glUniformMatrix2fv</span> (loc, count, transpose, array) mat2 <span class="hljs-number">2</span>Ã—<span class="hljs-number">2</span>çŸ©é˜µ<br><span class="hljs-built_in">glUniformMatrix3fv</span> (loc, count, transpose, array) mat3 <span class="hljs-number">3</span>Ã—<span class="hljs-number">3</span>çŸ©é˜µ<br><span class="hljs-built_in">glUniformMatrix4fv</span> (loc, count, transpose, array) mat4 <span class="hljs-number">4</span>Ã—<span class="hljs-number">4</span>çŸ©é˜µ<br><span class="hljs-built_in">glUniformMatrix2x3fv</span> (loc, count, transpose, array) mat2x3 <span class="hljs-number">2</span>Ã—<span class="hljs-number">3</span>çŸ©é˜µ<br><span class="hljs-built_in">glUniformMatrix3x2fv</span> (loc, count, transpose, array) mat3x2 <span class="hljs-number">3</span>Ã—<span class="hljs-number">2</span>çŸ©é˜µ<br></code></pre></td></tr></table></figure>
<hr />
<h3 id="uniformåŸè£…å‡½æ•°è¯¦ç»†ç”¨æ³•"><a href="#uniformåŸè£…å‡½æ•°è¯¦ç»†ç”¨æ³•" class="headerlink" title="uniformåŸè£…å‡½æ•°è¯¦ç»†ç”¨æ³•"></a><a class="markdownIt-Anchor" href="#uniformåŸè£…å‡½æ•°è¯¦ç»†ç”¨æ³•"></a> ğŸ”§ UniformåŸè£…å‡½æ•°è¯¦ç»†ç”¨æ³•</h3>
<ol>
<li>è·å–Uniformä½ç½®ï¼ˆå¿…é¡»ç¬¬ä¸€æ­¥ï¼‰</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">GLint location = <span class="hljs-built_in">glGetUniformLocation</span>(GLuint program, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* name);<br><span class="hljs-comment">// è¿”å›å€¼ï¼š-1è¡¨ç¤ºæ²¡æ‰¾åˆ°ï¼Œâ‰¥0è¡¨ç¤ºä½ç½®ç´¢å¼•</span><br><span class="hljs-comment">// ä¾‹å¦‚ï¼šglGetUniformLocation(shaderProgram, &quot;model&quot;);</span><br></code></pre></td></tr></table></figure>
<ol>
<li>å¿…é¡»æ¿€æ´»ç€è‰²å™¨ç¨‹åº</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glUseProgram</span>(shaderProgram);  <span class="hljs-comment">// å¿…é¡»å…ˆè°ƒç”¨ï¼</span><br><span class="hljs-comment">// ä¹‹åæ‰èƒ½è®¾ç½®è¿™ä¸ªç¨‹åºçš„uniform</span><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>æ ‡é‡è®¾ç½®ç¤ºä¾‹</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è®¾ç½®å•ä¸ªfloat</span><br><span class="hljs-built_in">glUniform1f</span>(location, <span class="hljs-number">3.14f</span>);<br><br><span class="hljs-comment">// è®¾ç½®å•ä¸ªint</span><br><span class="hljs-built_in">glUniform1i</span>(location, <span class="hljs-number">42</span>);<br><br><span class="hljs-comment">// è®¾ç½®vec3 (3ä¸ªfloat)</span><br><span class="hljs-built_in">glUniform3f</span>(location, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>);  <span class="hljs-comment">// çº¢è‰²</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>å‘é‡æ•°ç»„è®¾ç½®</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è®¾ç½®vec3æ•°ç»„</span><br>GLfloat colors[] = &#123;<br>    <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-comment">// çº¢è‰²</span><br>    <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>,  <span class="hljs-comment">// ç»¿è‰²</span><br>    <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">1.0f</span>   <span class="hljs-comment">// è“è‰²</span><br>&#125;;<br><span class="hljs-built_in">glUniform3fv</span>(location, <span class="hljs-number">3</span>, colors);  <span class="hljs-comment">// 3ä¸ªvec3</span><br></code></pre></td></tr></table></figure>
<ol start="4">
<li>çŸ©é˜µè®¾ç½®ï¼ˆæœ€å¸¸ç”¨ï¼ï¼‰</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// è®¾ç½®4Ã—4çŸ©é˜µ</span><br>glm::mat4 model = glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>);<br><span class="hljs-built_in">glUniformMatrix4fv</span>(location,          <span class="hljs-comment">// uniformä½ç½®</span><br>                   <span class="hljs-number">1</span>,                 <span class="hljs-comment">// çŸ©é˜µæ•°é‡</span><br>                   GL_FALSE,          <span class="hljs-comment">// æ˜¯å¦è½¬ç½®ï¼ˆGLMæ˜¯åˆ—ä¸»åºï¼‰</span><br>                   glm::<span class="hljs-built_in">value_ptr</span>(model)); <span class="hljs-comment">// æ•°æ®æŒ‡é’ˆ</span><br></code></pre></td></tr></table></figure>
<ol start="5">
<li>å®Œæ•´æµç¨‹ç¤ºä¾‹</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// åŸè£…OpenGL uniformè®¾ç½®æµç¨‹</span><br>GLuint shaderProgram = ...;  <span class="hljs-comment">// å·²é“¾æ¥ç€è‰²å™¨ç¨‹åº</span><br><br><span class="hljs-comment">// 1. æ¿€æ´»ç¨‹åº</span><br><span class="hljs-built_in">glUseProgram</span>(shaderProgram);<br><br><span class="hljs-comment">// 2. è·å–æ‰€æœ‰uniformä½ç½®</span><br>GLint modelLoc = <span class="hljs-built_in">glGetUniformLocation</span>(shaderProgram, <span class="hljs-string">&quot;model&quot;</span>);<br>GLint viewLoc = <span class="hljs-built_in">glGetUniformLocation</span>(shaderProgram, <span class="hljs-string">&quot;view&quot;</span>);<br>GLint projLoc = <span class="hljs-built_in">glGetUniformLocation</span>(shaderProgram, <span class="hljs-string">&quot;projection&quot;</span>);<br>GLint colorLoc = <span class="hljs-built_in">glGetUniformLocation</span>(shaderProgram, <span class="hljs-string">&quot;color&quot;</span>);<br><br><span class="hljs-comment">// 3. è®¾ç½®uniformå€¼</span><br>glm::mat4 model = glm::<span class="hljs-built_in">translate</span>(glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>), glm::<span class="hljs-built_in">vec3</span>(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>));<br><span class="hljs-built_in">glUniformMatrix4fv</span>(modelLoc, <span class="hljs-number">1</span>, GL_FALSE, glm::<span class="hljs-built_in">value_ptr</span>(model));<br><br>glm::mat4 view = glm::<span class="hljs-built_in">lookAt</span>(...);<br><span class="hljs-built_in">glUniformMatrix4fv</span>(viewLoc, <span class="hljs-number">1</span>, GL_FALSE, glm::<span class="hljs-built_in">value_ptr</span>(view));<br><br>glm::mat4 projection = glm::<span class="hljs-built_in">perspective</span>(...);<br><span class="hljs-built_in">glUniformMatrix4fv</span>(projLoc, <span class="hljs-number">1</span>, GL_FALSE, glm::<span class="hljs-built_in">value_ptr</span>(projection));<br><br><span class="hljs-built_in">glUniform3f</span>(colorLoc, <span class="hljs-number">1.0f</span>, <span class="hljs-number">0.0f</span>, <span class="hljs-number">0.0f</span>);  <span class="hljs-comment">// çº¢è‰²</span><br></code></pre></td></tr></table></figure>
<hr />
<h2 id="stackåº“"><a href="#stackåº“" class="headerlink" title="stackåº“"></a><a class="markdownIt-Anchor" href="#stackåº“"></a> stackåº“</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µ-3"><a href="#åŸºæœ¬æ¦‚å¿µ-3" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ-3"></a><a class="markdownIt-Anchor" href="#åŸºæœ¬æ¦‚å¿µ-3"></a> åŸºæœ¬æ¦‚å¿µ</h3>
<p>ä»€ä¹ˆæ˜¯ stackï¼Ÿ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stack&gt;</span></span><br><span class="hljs-comment">// æ ˆï¼ˆStackï¼‰ï¼šåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„</span><br><span class="hljs-comment">// æ¯”å–»ï¼šå ç›˜å­ - æœ€åæ”¾çš„ç›˜å­æœ€å…ˆæ‹¿èµ°</span><br><br></code></pre></td></tr></table></figure>
<p>åº•å±‚å®ç°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// std::stack æ˜¯å®¹å™¨é€‚é…å™¨ï¼Œé»˜è®¤ç”¨ deque å®ç°</span><br><span class="hljs-keyword">template</span>&lt;<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span>,<br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Container</span> = std::deque&lt;T&gt;  <span class="hljs-comment">// å¯ä»¥æ¢æˆ vector æˆ– list</span><br>&gt; <span class="hljs-keyword">class</span> stack;<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="æ ¸å¿ƒå‡½æ•°3ä¸ªåŸºæœ¬æ“ä½œ"><a href="#æ ¸å¿ƒå‡½æ•°3ä¸ªåŸºæœ¬æ“ä½œ" class="headerlink" title="æ ¸å¿ƒå‡½æ•°3ä¸ªåŸºæœ¬æ“ä½œ"></a><a class="markdownIt-Anchor" href="#æ ¸å¿ƒå‡½æ•°3ä¸ªåŸºæœ¬æ“ä½œ"></a> æ ¸å¿ƒå‡½æ•°ï¼ˆ3ä¸ªåŸºæœ¬æ“ä½œï¼‰</h3>
<ol>
<li>push() - å‹æ ˆ/å…¥æ ˆ</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::stack&lt;<span class="hljs-type">int</span>&gt; s;<br><br>s.<span class="hljs-built_in">push</span>(<span class="hljs-number">10</span>);     <span class="hljs-comment">// æ ˆï¼š[10]</span><br>s.<span class="hljs-built_in">push</span>(<span class="hljs-number">20</span>);     <span class="hljs-comment">// æ ˆï¼š[10, 20]</span><br>s.<span class="hljs-built_in">push</span>(<span class="hljs-number">30</span>);     <span class="hljs-comment">// æ ˆï¼š[10, 20, 30]</span><br><span class="hljs-comment">// æ—¶é—´å¤æ‚åº¦ï¼šO(1)</span><br><br></code></pre></td></tr></table></figure>
<ol>
<li>top() - æŸ¥çœ‹æ ˆé¡¶</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> value = s.<span class="hljs-built_in">top</span>();  <span class="hljs-comment">// è¿”å›30ï¼Œä½†ä¸ç§»é™¤</span><br><span class="hljs-comment">// æ ˆä»ä¸ºï¼š[10, 20, 30]</span><br><span class="hljs-comment">// é‡è¦ï¼šå¦‚æœæ ˆä¸ºç©ºï¼Œè°ƒç”¨ top() æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼</span><br><br></code></pre></td></tr></table></figure>
<ol>
<li>pop() - å¼¹æ ˆ/å‡ºæ ˆ</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">s.<span class="hljs-built_in">pop</span>();  <span class="hljs-comment">// ç§»é™¤30</span><br><span class="hljs-comment">// æ ˆå˜ä¸ºï¼š[10, 20]</span><br><span class="hljs-comment">// æ³¨æ„ï¼špop() ä¸è¿”å›å…ƒç´ ï¼åªç§»é™¤ï¼</span><br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="è¾…åŠ©å‡½æ•°"><a href="#è¾…åŠ©å‡½æ•°" class="headerlink" title="è¾…åŠ©å‡½æ•°"></a><a class="markdownIt-Anchor" href="#è¾…åŠ©å‡½æ•°"></a> è¾…åŠ©å‡½æ•°</h3>
<ol>
<li>empty() - åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©º</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">while</span> (!s.<span class="hljs-built_in">empty</span>()) &#123;  <span class="hljs-comment">// æ ˆä¸ä¸ºç©ºæ—¶å¾ªç¯</span><br>    s.<span class="hljs-built_in">pop</span>();<br>&#125;<br><span class="hljs-comment">// å®‰å…¨æ¸…ç©ºæ ˆçš„æ–¹æ³•</span><br><br></code></pre></td></tr></table></figure>
<ol>
<li>size() - è·å–æ ˆä¸­å…ƒç´ æ•°é‡</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::cout &lt;&lt; <span class="hljs-string">&quot;æ ˆå¤§å°: &quot;</span> &lt;&lt; s.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="å¸¸è§é”™è¯¯ç”¨æ³•"><a href="#å¸¸è§é”™è¯¯ç”¨æ³•" class="headerlink" title="å¸¸è§é”™è¯¯ç”¨æ³•"></a><a class="markdownIt-Anchor" href="#å¸¸è§é”™è¯¯ç”¨æ³•"></a> å¸¸è§é”™è¯¯ç”¨æ³•</h3>
<p>é”™è¯¯1ï¼špop() è·å–å€¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// âŒ é”™è¯¯ï¼</span><br><span class="hljs-type">int</span> x = s.<span class="hljs-built_in">pop</span>();  <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼pop() ä¸è¿”å›å€¼</span><br><br><span class="hljs-comment">// âœ… æ­£ç¡®åšæ³•ï¼š</span><br><span class="hljs-type">int</span> x = s.<span class="hljs-built_in">top</span>();  <span class="hljs-comment">// å…ˆè·å–</span><br>s.<span class="hljs-built_in">pop</span>();          <span class="hljs-comment">// å†ç§»é™¤</span><br><br></code></pre></td></tr></table></figure>
<p>é”™è¯¯2ï¼šç©ºæ ˆæ—¶è°ƒç”¨ top()</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::stack&lt;<span class="hljs-type">int</span>&gt; emptyStack;<br><br><span class="hljs-comment">// âŒ å±é™©ï¼</span><br><span class="hljs-type">int</span> x = emptyStack.<span class="hljs-built_in">top</span>();  <span class="hljs-comment">// æœªå®šä¹‰è¡Œä¸ºï¼</span><br><br><span class="hljs-comment">// âœ… å®‰å…¨åšæ³•ï¼š</span><br><span class="hljs-keyword">if</span> (!emptyStack.<span class="hljs-built_in">empty</span>()) &#123;<br>    <span class="hljs-type">int</span> x = emptyStack.<span class="hljs-built_in">top</span>();<br>&#125;<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="åœ¨å›¾å½¢å­¦ä¸­çš„å®é™…åº”ç”¨"><a href="#åœ¨å›¾å½¢å­¦ä¸­çš„å®é™…åº”ç”¨" class="headerlink" title="åœ¨å›¾å½¢å­¦ä¸­çš„å®é™…åº”ç”¨"></a><a class="markdownIt-Anchor" href="#åœ¨å›¾å½¢å­¦ä¸­çš„å®é™…åº”ç”¨"></a> åœ¨å›¾å½¢å­¦ä¸­çš„å®é™…åº”ç”¨</h3>
<ol>
<li>çŸ©é˜µå †æ ˆï¼ˆç»å…¸åº”ç”¨ï¼‰</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp">std::stack&lt;glm::mat4&gt; matrixStack;<br><br><span class="hljs-comment">// ä¿å­˜å½“å‰å˜æ¢çŠ¶æ€</span><br>matrixStack.<span class="hljs-built_in">push</span>(currentMatrix);<br><br><span class="hljs-comment">// åº”ç”¨å±€éƒ¨å˜æ¢</span><br>currentMatrix = glm::<span class="hljs-built_in">translate</span>(currentMatrix, position);<br><br><span class="hljs-comment">// æ¸²æŸ“ç‰©ä½“...</span><br><br><span class="hljs-comment">// æ¢å¤ä¹‹å‰çŠ¶æ€</span><br>currentMatrix = matrixStack.<span class="hljs-built_in">top</span>();<br>matrixStack.<span class="hljs-built_in">pop</span>();<br><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>å¤ªé˜³ç³»å±‚çº§å˜æ¢ç¤ºä¾‹</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ¨¡æ‹Ÿ OpenGL çš„çŸ©é˜µå †æ ˆ</span><br>std::stack&lt;glm::mat4&gt; mvStack;<br>mvStack.<span class="hljs-built_in">push</span>(glm::<span class="hljs-built_in">mat4</span>(<span class="hljs-number">1.0f</span>));  <span class="hljs-comment">// å•ä½çŸ©é˜µ</span><br><br><span class="hljs-comment">// å¤ªé˜³</span><br>glm::mat4 sunModel = mvStack.<span class="hljs-built_in">top</span>();<br><br><span class="hljs-comment">// è¡Œæ˜Ÿï¼ˆç»§æ‰¿å¤ªé˜³çš„åæ ‡ç³»ï¼‰</span><br>mvStack.<span class="hljs-built_in">push</span>(mvStack.<span class="hljs-built_in">top</span>());  <span class="hljs-comment">// ä¿å­˜çŠ¶æ€</span><br>glm::mat4 planetModel = mvStack.<span class="hljs-built_in">top</span>();<br>planetModel = glm::<span class="hljs-built_in">translate</span>(planetModel, planetPosition);<br><br><span class="hljs-comment">// æœˆçƒï¼ˆç»§æ‰¿è¡Œæ˜Ÿä½ç½®ï¼‰</span><br>mvStack.<span class="hljs-built_in">push</span>(planetModel);  <span class="hljs-comment">// ä¿å­˜è¡Œæ˜Ÿä½ç½®</span><br><span class="hljs-comment">// ...æœˆçƒå˜æ¢...</span><br>mvStack.<span class="hljs-built_in">pop</span>();  <span class="hljs-comment">// å›åˆ°è¡Œæ˜Ÿä½ç½®</span><br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="åº•å±‚å®¹å™¨æ›´æ¢"><a href="#åº•å±‚å®¹å™¨æ›´æ¢" class="headerlink" title="åº•å±‚å®¹å™¨æ›´æ¢"></a><a class="markdownIt-Anchor" href="#åº•å±‚å®¹å™¨æ›´æ¢"></a> åº•å±‚å®¹å™¨æ›´æ¢</h3>
<p>ä½¿ç”¨ä¸åŒåº•å±‚å®¹å™¨</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// é»˜è®¤ï¼šdequeï¼ˆå¹³è¡¡æ€§èƒ½ï¼‰</span><br>std::stack&lt;<span class="hljs-type">int</span>&gt; s1;<br><br><span class="hljs-comment">// ä½¿ç”¨ vectorï¼ˆè¿ç»­å†…å­˜ï¼‰</span><br>std::stack&lt;<span class="hljs-type">int</span>, std::vector&lt;<span class="hljs-type">int</span>&gt;&gt; s2;<br><br><span class="hljs-comment">// ä½¿ç”¨ listï¼ˆå¿«é€Ÿæ’å…¥åˆ é™¤ï¼‰</span><br>std::stack&lt;<span class="hljs-type">int</span>, std::list&lt;<span class="hljs-type">int</span>&gt;&gt; s3;<br><br><span class="hljs-comment">// æ‰€æœ‰æ¥å£å®Œå…¨ç›¸åŒï¼</span><br><br></code></pre></td></tr></table></figure>
<p>æ€§èƒ½å¯¹æ¯”</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// push()/pop() æ€§èƒ½ï¼š</span><br>deque:  å¹³å‡ <span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)ï¼Œé€‚åˆé€šç”¨åœºæ™¯<br>vector: å¹³å‡ <span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)ï¼Œä½†æ‰©å®¹æ—¶ <span class="hljs-built_in">O</span>(n)<br>list:   æ€»æ˜¯ <span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)ï¼Œä½†å†…å­˜å¼€é”€å¤§<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="æ ˆ-vs-å†…å­˜æ ˆçš„åŒºåˆ«"><a href="#æ ˆ-vs-å†…å­˜æ ˆçš„åŒºåˆ«" class="headerlink" title="æ ˆ-vs-å†…å­˜æ ˆçš„åŒºåˆ«"></a><a class="markdownIt-Anchor" href="#æ ˆ-vs-å†…å­˜æ ˆçš„åŒºåˆ«"></a> æ ˆ vs å†…å­˜æ ˆçš„åŒºåˆ«</h3>
<p>é‡è¦åŒºåˆ†</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// std::stackï¼ˆæ•°æ®ç»“æ„ï¼‰            å†…å­˜æ ˆï¼ˆç³»ç»Ÿæ ˆï¼‰</span><br><span class="hljs-comment">// -----------------------------   --------------------</span><br><span class="hljs-comment">// åœ¨å †ä¸Šç®¡ç†æ•°æ®                   å­˜å‚¨å±€éƒ¨å˜é‡ã€è¿”å›åœ°å€</span><br><span class="hljs-comment">// å¤§å°åªå—ç³»ç»Ÿå†…å­˜é™åˆ¶              å›ºå®šå¤§å°ï¼ˆé€šå¸¸1-8MBï¼‰</span><br><span class="hljs-comment">// æ‰‹åŠ¨ push/pop ç®¡ç†               è‡ªåŠ¨åˆ†é…/é‡Šæ”¾</span><br><span class="hljs-comment">// å¯ä»¥å­˜ä»»æ„å¯¹è±¡                   åªèƒ½å­˜åŸºæœ¬ç±»å‹å’ŒæŒ‡é’ˆ</span><br><br></code></pre></td></tr></table></figure>
<p>éªŒè¯ç¤ºä¾‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stack&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// std::stack å¯¹è±¡æœ¬èº«åœ¨æ ˆå†…å­˜ä¸Šï¼ˆå¾ˆå°ï¼‰</span><br>    std::stack&lt;<span class="hljs-type">int</span>&gt; s;<br><br>    <span class="hljs-comment">// ä½†å®ƒçš„æ•°æ®åœ¨å †ä¸Šï¼Œå¯ä»¥å¾ˆå¤§</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) &#123;<br>        s.<span class="hljs-built_in">push</span>(i);  <span class="hljs-comment">// 100ä¸‡æ•°æ®ï¼Œä¸ä¼šæ ˆæº¢å‡ºï¼</span><br>    &#125;<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;æ ˆå¤§å°: &quot;</span> &lt;&lt; s.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<hr />
<h2 id="çº¹ç†-æ³•çº¿-æè´¨-å…‰æº"><a href="#çº¹ç†-æ³•çº¿-æè´¨-å…‰æº" class="headerlink" title="çº¹ç†-æ³•çº¿-æè´¨-å…‰æº"></a><a class="markdownIt-Anchor" href="#çº¹ç†-æ³•çº¿-æè´¨-å…‰æº"></a> çº¹ç†ã€æ³•çº¿ã€æè´¨ã€å…‰æº</h2>
<h3 id="çº¹ç†texture"><a href="#çº¹ç†texture" class="headerlink" title="çº¹ç†texture"></a><a class="markdownIt-Anchor" href="#çº¹ç†texture"></a> çº¹ç†ï¼ˆTextureï¼‰</h3>
<p>1.1 ä»€ä¹ˆæ˜¯çº¹ç†ï¼Ÿ</p>
<p>çº¹ç† = è´´å›¾ = è¦†ç›–åœ¨3Dæ¨¡å‹è¡¨é¢çš„å›¾ç‰‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">æ¨¡å‹æ˜¯éª¨æ¶ï¼Œçº¹ç†æ˜¯çš®è‚¤<br>çƒä½“æ˜¯åœ°çƒä»ªï¼Œçº¹ç†æ˜¯ä¸–ç•Œåœ°å›¾<br><br></code></pre></td></tr></table></figure>
<p>1.2 çº¹ç†åæ ‡ï¼ˆUVï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// æ¯ä¸ªé¡¶ç‚¹å¯¹åº”å›¾ç‰‡ä¸Šçš„ä¸€ä¸ªç‚¹</span><br>u = (<span class="hljs-type">float</span>)j / sectorCount;  <span class="hljs-comment">// æ¨ªå‘ï¼š0 â†’ 1ï¼ˆå·¦åˆ°å³ï¼‰</span><br>v = (<span class="hljs-type">float</span>)i / stackCount;   <span class="hljs-comment">// çºµå‘ï¼š0 â†’ 1ï¼ˆä¸Šåˆ°ä¸‹ï¼‰</span><br><br><span class="hljs-comment">// é¡¶ç‚¹æ•°æ®å¸ƒå±€ï¼ˆ8ä¸ªfloatï¼‰</span><br>[xyz][nx ny nz][u v]<br>ä½ç½®   æ³•çº¿    çº¹ç†åæ ‡<br><br></code></pre></td></tr></table></figure>
<p>1.3 çº¹ç†åŠ è½½ï¼ˆstb_imageï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> STB_IMAGE_IMPLEMENTATION</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stb_image.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title">loadTexture</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* path)</span> </span>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> textureID;<br>    <span class="hljs-built_in">glGenTextures</span>(<span class="hljs-number">1</span>, &amp;textureID);<br><br>    <span class="hljs-comment">// ç¿»è½¬Yè½´ï¼ˆOpenGLåŸç‚¹åœ¨å·¦ä¸‹ï¼Œå›¾ç‰‡åŸç‚¹åœ¨å·¦ä¸Šï¼‰</span><br>    <span class="hljs-built_in">stbi_set_flip_vertically_on_load</span>(<span class="hljs-literal">true</span>);<br><br>    <span class="hljs-comment">// åŠ è½½å›¾ç‰‡</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>* data = <span class="hljs-built_in">stbi_load</span>(path, &amp;width, &amp;height, &amp;nrChannels, <span class="hljs-number">0</span>);<br><br>    <span class="hljs-comment">// è®¾ç½®çº¹ç†å‚æ•°</span><br>    <span class="hljs-built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);  <span class="hljs-comment">// Uæ–¹å‘é‡å¤</span><br>    <span class="hljs-built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);  <span class="hljs-comment">// Væ–¹å‘é‡å¤</span><br>    <span class="hljs-built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);  <span class="hljs-comment">// ç¼©å°</span><br>    <span class="hljs-built_in">glTexParameteri</span>(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);  <span class="hljs-comment">// æ”¾å¤§</span><br><br>    <span class="hljs-keyword">return</span> textureID;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>1.4 çº¹ç†è¦æ±‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">âœ… å°ºå¯¸æ˜¯2çš„å¹‚ï¼š512ã€1024ã€2048ã€4096<br>âœ… RGBæ¨¡å¼ï¼ˆä¸æ˜¯CMYKï¼‰<br>âœ… æ ¼å¼ï¼šJPGï¼ˆæ— é€æ˜ï¼‰ã€PNGï¼ˆæœ‰é€æ˜ï¼‰<br>âŒ å°ºå¯¸ä¸æ˜¯2çš„å¹‚ï¼ˆå¦‚1920Ã—1080ï¼‰<br>âŒ CMYKæ¨¡å¼çš„JPG<br><br></code></pre></td></tr></table></figure>
<p>1.5 ç€è‰²å™¨ä¸­ä½¿ç”¨</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-comment">// é¡¶ç‚¹ç€è‰²å™¨</span><br><span class="hljs-keyword">layout</span> (<span class="hljs-keyword">location</span> = <span class="hljs-number">2</span>) <span class="hljs-keyword">in</span> <span class="hljs-type">vec2</span> aTexCoord;<br><span class="hljs-keyword">out</span> <span class="hljs-type">vec2</span> TexCoord;<br>TexCoord = aTexCoord;<br><br><span class="hljs-comment">// ç‰‡å…ƒç€è‰²å™¨</span><br><span class="hljs-keyword">uniform</span> <span class="hljs-type">sampler2D</span> ourTexture;<br><span class="hljs-type">vec3</span> color = <span class="hljs-built_in">texture</span>(ourTexture, TexCoord).rgb;<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="æ³•çº¿normal"><a href="#æ³•çº¿normal" class="headerlink" title="æ³•çº¿normal"></a><a class="markdownIt-Anchor" href="#æ³•çº¿normal"></a> æ³•çº¿ï¼ˆNormalï¼‰</h3>
<p>2.1 ä»€ä¹ˆæ˜¯æ³•çº¿ï¼Ÿ</p>
<p>æ³•çº¿ = å‚ç›´äºè¡¨é¢çš„æ–¹å‘å‘é‡ = é¢æœå“ªè¾¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">        â†‘ æ³•çº¿<br>        â”‚<br>        â”‚<br>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” è¡¨é¢<br><br></code></pre></td></tr></table></figure>
<p>2.2 çƒä½“çš„æ³•çº¿</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// çƒä½“çš„æ³•çº¿ = ä»çƒå¿ƒæŒ‡å‘é¡¶ç‚¹</span><br>lengthInv = <span class="hljs-number">1.0f</span> / radius;<br>nx = x * lengthInv;<br>ny = y * lengthInv;<br>nz = z * lengthInv;<br><br><span class="hljs-comment">// é¡¶ç‚¹æ•°æ®ï¼šä½ç½®åé¢ç´§è·Ÿç€æ³•çº¿</span><br>[xyz][nx ny nz][u v]<br>ä½ç½®   æ³•çº¿    çº¹ç†<br><br></code></pre></td></tr></table></figure>
<p>2.3 æ³•çº¿çš„ç”¨é€”</p>
<ol>
<li>å…‰ç…§è®¡ç®—ï¼ˆæ ¸å¿ƒï¼ï¼‰</li>
</ol>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-type">vec3</span> norm = <span class="hljs-built_in">normalize</span>(Normal);<br><span class="hljs-type">vec3</span> lightDir = <span class="hljs-built_in">normalize</span>(lightPos - FragPos);<br><span class="hljs-type">float</span> diff = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(norm, lightDir), <span class="hljs-number">0.0</span>);  <span class="hljs-comment">// ä½™å¼¦å€¼</span><br><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>èƒŒé¢å‰”é™¤</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glEnable</span>(GL_CULL_FACE);<br><span class="hljs-built_in">glCullFace</span>(GL_BACK);  <span class="hljs-comment">// ä¸æ¸²æŸ“çƒä½“å†…è¡¨é¢</span><br><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>ç¯å¢ƒé®è”½ã€åå°„ç­‰é«˜çº§æ•ˆæœ</li>
<li>æ³•çº¿å˜æ¢ï¼ˆé‡è¦ï¼ï¼‰</li>
</ol>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-comment">// æ¨¡å‹æœ‰æ—‹è½¬ç¼©æ”¾æ—¶ï¼Œæ³•çº¿ä¸èƒ½ç›´æ¥ä¹˜modelçŸ©é˜µ</span><br>Normal = <span class="hljs-type">mat3</span>(<span class="hljs-built_in">transpose</span>(<span class="hljs-built_in">inverse</span>(model))) * aNormal;<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="æè´¨material"><a href="#æè´¨material" class="headerlink" title="æè´¨material"></a><a class="markdownIt-Anchor" href="#æè´¨material"></a> æè´¨ï¼ˆMaterialï¼‰</h3>
<p>3.1 ä»€ä¹ˆæ˜¯æè´¨ï¼Ÿ</p>
<p>æè´¨ = ç‰©ä½“è¡¨é¢å¦‚ä½•ä¸å…‰äº¤äº’çš„è§„åˆ™</p>
<p>3.2 Phongå…‰ç…§æ¨¡å‹çš„æè´¨å±æ€§</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-comment">// æè´¨ç»“æ„ä½“</span><br>struct Material &#123;<br>    <span class="hljs-type">vec3</span> ambient;   <span class="hljs-comment">// ç¯å¢ƒå…‰åå°„ç³»æ•°</span><br>    <span class="hljs-type">vec3</span> diffuse;   <span class="hljs-comment">// æ¼«åå°„åå°„ç³»æ•°</span><br>    <span class="hljs-type">vec3</span> specular;  <span class="hljs-comment">// é•œé¢åå°„åå°„ç³»æ•°</span><br>    <span class="hljs-type">float</span> shininess; <span class="hljs-comment">// åå…‰åº¦ï¼ˆè¶Šå¤§é«˜å…‰è¶Šé›†ä¸­ï¼‰</span><br>&#125;;<br><br><span class="hljs-comment">// å…‰æºç»“æ„ä½“</span><br>struct Light &#123;<br>    <span class="hljs-type">vec3</span> position;  <span class="hljs-comment">// å…‰æºä½ç½®</span><br>    <span class="hljs-type">vec3</span> ambient;   <span class="hljs-comment">// ç¯å¢ƒå…‰å¼ºåº¦</span><br>    <span class="hljs-type">vec3</span> diffuse;   <span class="hljs-comment">// æ¼«åå°„å¼ºåº¦</span><br>    <span class="hljs-type">vec3</span> specular;  <span class="hljs-comment">// é•œé¢åå°„å¼ºåº¦</span><br>&#125;;<br><br></code></pre></td></tr></table></figure>
<p>3.3 æè´¨ = çº¹ç† + å…‰ç…§å‚æ•°</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// çº¹ç†å†³å®šæ¼«åå°„é¢œè‰²</span><br>vec3 diffuseColor = <span class="hljs-built_in">texture</span>(ourTexture, TexCoord).rgb;<br><br><span class="hljs-comment">// æè´¨å‚æ•°æ§åˆ¶å…‰ç…§å“åº”</span><br><span class="hljs-type">float</span> ambientStrength = <span class="hljs-number">0.1</span>;   <span class="hljs-comment">// ç¯å¢ƒå…‰ç³»æ•°</span><br><span class="hljs-type">float</span> specularStrength = <span class="hljs-number">0.5</span>;  <span class="hljs-comment">// é•œé¢åå°„ç³»æ•°</span><br><span class="hljs-type">float</span> shininess = <span class="hljs-number">32.0</span>;        <span class="hljs-comment">// åå…‰åº¦</span><br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="å…‰æºlight"><a href="#å…‰æºlight" class="headerlink" title="å…‰æºlight"></a><a class="markdownIt-Anchor" href="#å…‰æºlight"></a> å…‰æºï¼ˆLightï¼‰</h3>
<p>4.1 ä¸‰ç§å…‰æºç±»å‹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// 1. å¹³è¡Œå…‰ï¼ˆå¤ªé˜³ï¼‰</span><br>vec3 lightDir = <span class="hljs-built_in">normalize</span>(-lightDirection);  <span class="hljs-comment">// æ–¹å‘å›ºå®š</span><br><br><span class="hljs-comment">// 2. ç‚¹å…‰æºï¼ˆç¯æ³¡ï¼‰</span><br>vec3 lightDir = <span class="hljs-built_in">normalize</span>(lightPos - FragPos);  <span class="hljs-comment">// æœ‰ä½ç½®ï¼Œå‘å››å‘¨</span><br><br><span class="hljs-comment">// 3. èšå…‰ç¯ï¼ˆæ‰‹ç”µç­’ï¼‰</span><br><span class="hljs-type">float</span> theta = <span class="hljs-built_in">dot</span>(lightDir, <span class="hljs-built_in">normalize</span>(lightDirection));<br><span class="hljs-keyword">if</span>(theta &gt; cutoffAngle) &#123; <span class="hljs-comment">/* ç…§äº® */</span> &#125;<br><br></code></pre></td></tr></table></figure>
<p>4.2 Phongå…‰ç…§ä¸‰è¦ç´ </p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-comment">// 1. ç¯å¢ƒå…‰ï¼ˆAmbientï¼‰</span><br><span class="hljs-comment">// æ°¸ä¸é»‘æš—ï¼Œæ¨¡æ‹Ÿå…¨å±€å…‰ç…§åå¼¹</span><br><span class="hljs-type">float</span> ambientStrength = <span class="hljs-number">0.1</span>;<br><span class="hljs-type">vec3</span> ambient = ambientStrength * lightColor;<br><br><span class="hljs-comment">// 2. æ¼«åå°„ï¼ˆDiffuseï¼‰</span><br><span class="hljs-comment">// ç²—ç³™è¡¨é¢ï¼Œå„å‘åŒæ€§</span><br><span class="hljs-type">vec3</span> norm = <span class="hljs-built_in">normalize</span>(Normal);<br><span class="hljs-type">vec3</span> lightDir = <span class="hljs-built_in">normalize</span>(lightPos - FragPos);<br><span class="hljs-type">float</span> diff = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(norm, lightDir), <span class="hljs-number">0.0</span>);<br><span class="hljs-type">vec3</span> diffuse = diff * lightColor;<br><br><span class="hljs-comment">// 3. é•œé¢åå°„ï¼ˆSpecularï¼‰</span><br><span class="hljs-comment">// å…‰æ»‘è¡¨é¢ï¼Œé«˜å…‰</span><br><span class="hljs-type">vec3</span> viewDir = <span class="hljs-built_in">normalize</span>(viewPos - FragPos);<br><span class="hljs-type">vec3</span> reflectDir = <span class="hljs-built_in">reflect</span>(-lightDir, norm);<br><span class="hljs-type">float</span> spec = <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">max</span>(<span class="hljs-built_in">dot</span>(viewDir, reflectDir), <span class="hljs-number">0.0</span>), <span class="hljs-number">32</span>);<br><span class="hljs-type">vec3</span> specular = specularStrength * spec * lightColor;<br><br><span class="hljs-comment">// æœ€ç»ˆé¢œè‰²</span><br><span class="hljs-type">vec3</span> result = (ambient + diffuse + specular) * objectColor;<br><br></code></pre></td></tr></table></figure>
<p>4.3 å…‰æºä½ç½®è®¾ç½®</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// å›ºå®šå…‰æºï¼ˆå¤ªé˜³ï¼‰</span><br><span class="hljs-built_in">glUniform3f</span>(lightPosLoc, <span class="hljs-number">2.0f</span>, <span class="hljs-number">2.0f</span>, <span class="hljs-number">2.0f</span>);<br><br><span class="hljs-comment">// ç§»åŠ¨å…‰æºï¼ˆæ‰‹ç”µç­’ï¼‰</span><br><span class="hljs-built_in">glUniform3f</span>(lightPosLoc, <span class="hljs-built_in">sin</span>(time) * <span class="hljs-number">3.0f</span>, <span class="hljs-number">2.0f</span>, <span class="hljs-built_in">cos</span>(time) * <span class="hljs-number">3.0f</span>);<br><br><span class="hljs-comment">// å…‰æºè·Ÿéšæ‘„åƒæœºï¼ˆå¤´ç¯ï¼‰</span><br><span class="hljs-built_in">glUniform3f</span>(lightPosLoc, camX, camY, camZ);<br><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="å®Œæ•´æ¸²æŸ“æ–¹ç¨‹"><a href="#å®Œæ•´æ¸²æŸ“æ–¹ç¨‹" class="headerlink" title="å®Œæ•´æ¸²æŸ“æ–¹ç¨‹"></a><a class="markdownIt-Anchor" href="#å®Œæ•´æ¸²æŸ“æ–¹ç¨‹"></a> å®Œæ•´æ¸²æŸ“æ–¹ç¨‹</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// Phongå…‰ç…§æ¨¡å‹</span><br>FinalColor = (<br>    ambient +                    <span class="hljs-comment">// ç¯å¢ƒå…‰ï¼ˆå¸¸æ•°ï¼‰</span><br>    diffuse * <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, NÂ·L) +     <span class="hljs-comment">// æ¼«åå°„ï¼ˆä½™å¼¦å®šå¾‹ï¼‰</span><br>    specular * <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, RÂ·V), shininess)  <span class="hljs-comment">// é•œé¢åå°„ï¼ˆPhongï¼‰</span><br>) * objectColor;<br><br><span class="hljs-comment">// N: æ³•çº¿</span><br><span class="hljs-comment">// L: å…‰æºæ–¹å‘</span><br><span class="hljs-comment">// R: åå°„æ–¹å‘</span><br><span class="hljs-comment">// V: è§†çº¿æ–¹å‘</span><br></code></pre></td></tr></table></figure>
<h1 id="ç‰©ä½“"><a href="#ç‰©ä½“" class="headerlink" title="ç‰©ä½“"></a><a class="markdownIt-Anchor" href="#ç‰©ä½“"></a> ç‰©ä½“</h1>
<h2 id="çƒä½“"><a href="#çƒä½“" class="headerlink" title="çƒä½“"></a><a class="markdownIt-Anchor" href="#çƒä½“"></a> çƒä½“</h2>
<h3 id="æ ¸å¿ƒæ€æƒ³ç»çº¬åº¦æ³•"><a href="#æ ¸å¿ƒæ€æƒ³ç»çº¬åº¦æ³•" class="headerlink" title="æ ¸å¿ƒæ€æƒ³ç»çº¬åº¦æ³•"></a><a class="markdownIt-Anchor" href="#æ ¸å¿ƒæ€æƒ³ç»çº¬åº¦æ³•"></a> æ ¸å¿ƒæ€æƒ³ï¼šç»çº¬åº¦æ³•</h3>
<p>æŠŠçƒä½“æƒ³è±¡æˆåœ°çƒä»ªï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">  åŒ—æ (i=0)<br>    â—<br>   /|\\<br>  / | \\<br> /  |  \\<br>â—â€”â€”â€”â—â€”â€”â€”â— èµ¤é“ (i=stackCount/2)<br> \\  |  /<br>  \\ | /<br>   \\|/<br>    â— å—æ (i=stackCount)<br><br></code></pre></td></tr></table></figure>
<h3 id="å…³é”®å‚æ•°"><a href="#å…³é”®å‚æ•°" class="headerlink" title="å…³é”®å‚æ•°"></a><a class="markdownIt-Anchor" href="#å…³é”®å‚æ•°"></a> å…³é”®å‚æ•°</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">float</span> radius = <span class="hljs-number">1.0f</span>;        <span class="hljs-comment">// åŠå¾„</span><br><span class="hljs-type">int</span> sectorCount = <span class="hljs-number">36</span>;       <span class="hljs-comment">// ç»åº¦åˆ†æ®µæ•°ï¼ˆç»•Yè½´ä¸€åœˆåˆ†å¤šå°‘ä»½ï¼‰</span><br><span class="hljs-type">int</span> stackCount = <span class="hljs-number">18</span>;        <span class="hljs-comment">// çº¬åº¦åˆ†æ®µæ•°ï¼ˆä»åŒ—æåˆ°å—æåˆ†å¤šå°‘å±‚ï¼‰</span><br><br></code></pre></td></tr></table></figure>
<h3 id="é¡¶ç‚¹ç”ŸæˆåŒé‡å¾ªç¯"><a href="#é¡¶ç‚¹ç”ŸæˆåŒé‡å¾ªç¯" class="headerlink" title="é¡¶ç‚¹ç”ŸæˆåŒé‡å¾ªç¯"></a><a class="markdownIt-Anchor" href="#é¡¶ç‚¹ç”ŸæˆåŒé‡å¾ªç¯"></a> é¡¶ç‚¹ç”Ÿæˆï¼ˆåŒé‡å¾ªç¯ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// å¤–å±‚ï¼šçº¬åº¦ï¼ˆä¸Šä¸‹ï¼‰</span><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt;= stackCount; ++i) &#123;<br>    <span class="hljs-comment">// çº¬åº¦è§’ï¼šä» +90Â° åˆ° -90Â°</span><br>    stackAngle = M_PI / <span class="hljs-number">2</span> - i * stackStep;<br><br>    <span class="hljs-comment">// å½“å‰çº¬åº¦åœˆçš„åŠå¾„å’Œé«˜åº¦</span><br>    xy = radius * <span class="hljs-built_in">cos</span>(stackAngle);  <span class="hljs-comment">// æ°´å¹³åŠå¾„</span><br>    z = radius * <span class="hljs-built_in">sin</span>(stackAngle);   <span class="hljs-comment">// å‚ç›´é«˜åº¦</span><br><br>    <span class="hljs-comment">// å†…å±‚ï¼šç»åº¦ï¼ˆç»•åœˆï¼‰</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt;= sectorCount; ++j) &#123;<br>        <span class="hljs-comment">// ç»åº¦è§’ï¼šä» 0Â° åˆ° 360Â°</span><br>        sectorAngle = j * sectorStep;<br><br>        <span class="hljs-comment">// çƒé¢åæ ‡ â†’ ç›´è§’åæ ‡</span><br>        x = xy * <span class="hljs-built_in">cos</span>(sectorAngle);<br>        y = xy * <span class="hljs-built_in">sin</span>(sectorAngle);<br>        <span class="hljs-comment">// z å·²åœ¨å¤–å±‚è®¡ç®—</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>åæ ‡è½¬æ¢å…¬å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">x = r Â· cos(lat) Â· cos(lon)<br>y = r Â· cos(lat) Â· sin(lon)<br>z = r Â· sin(lat)<br><br></code></pre></td></tr></table></figure>
<h3 id="é¡¶ç‚¹æ•°æ®å¸ƒå±€æ¯ä¸ªé¡¶ç‚¹8ä¸ªfloat"><a href="#é¡¶ç‚¹æ•°æ®å¸ƒå±€æ¯ä¸ªé¡¶ç‚¹8ä¸ªfloat" class="headerlink" title="é¡¶ç‚¹æ•°æ®å¸ƒå±€æ¯ä¸ªé¡¶ç‚¹8ä¸ªfloat"></a><a class="markdownIt-Anchor" href="#é¡¶ç‚¹æ•°æ®å¸ƒå±€æ¯ä¸ªé¡¶ç‚¹8ä¸ªfloat"></a> é¡¶ç‚¹æ•°æ®å¸ƒå±€ï¼ˆæ¯ä¸ªé¡¶ç‚¹8ä¸ªfloatï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp">vertices.<span class="hljs-built_in">push_back</span>(x);   <span class="hljs-comment">// 0: ä½ç½®X</span><br>vertices.<span class="hljs-built_in">push_back</span>(y);   <span class="hljs-comment">// 1: ä½ç½®Y</span><br>vertices.<span class="hljs-built_in">push_back</span>(z);   <span class="hljs-comment">// 2: ä½ç½®Z</span><br>vertices.<span class="hljs-built_in">push_back</span>(nx);  <span class="hljs-comment">// 3: æ³•çº¿X</span><br>vertices.<span class="hljs-built_in">push_back</span>(ny);  <span class="hljs-comment">// 4: æ³•çº¿Y</span><br>vertices.<span class="hljs-built_in">push_back</span>(nz);  <span class="hljs-comment">// 5: æ³•çº¿Z</span><br>vertices.<span class="hljs-built_in">push_back</span>(u);   <span class="hljs-comment">// 6: çº¹ç†U</span><br>vertices.<span class="hljs-built_in">push_back</span>(v);   <span class="hljs-comment">// 7: çº¹ç†V</span><br><br></code></pre></td></tr></table></figure>
<p>stride = 8 * sizeof(float)</p>
<h3 id="ç´¢å¼•ç”Ÿæˆä¸‰è§’å½¢æ‹¼å‡‘"><a href="#ç´¢å¼•ç”Ÿæˆä¸‰è§’å½¢æ‹¼å‡‘" class="headerlink" title="ç´¢å¼•ç”Ÿæˆä¸‰è§’å½¢æ‹¼å‡‘"></a><a class="markdownIt-Anchor" href="#ç´¢å¼•ç”Ÿæˆä¸‰è§’å½¢æ‹¼å‡‘"></a> ç´¢å¼•ç”Ÿæˆï¼ˆä¸‰è§’å½¢æ‹¼å‡‘ï¼‰</h3>
<p>æ¯ä¸ªå››è¾¹å½¢åˆ‡æˆ2ä¸ªä¸‰è§’å½¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">    å½“å‰åœˆ:  Aâ”€â”€â”€â”€â”€B<br>            |     |<br>    ä¸‹åœˆ:   Câ”€â”€â”€â”€â”€â”€D<br><br>ä¸‰è§’å½¢1 (ä¸Š): (A, C, B)<br>ä¸‰è§’å½¢2 (ä¸‹): (B, C, D)<br><br></code></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">int</span> k1 = i * (sectorCount + <span class="hljs-number">1</span>);  <span class="hljs-comment">// å½“å‰åœˆèµ·ç‚¹</span><br><span class="hljs-type">int</span> k2 = k1 + sectorCount + <span class="hljs-number">1</span>;   <span class="hljs-comment">// ä¸‹åœˆèµ·ç‚¹</span><br><br><span class="hljs-comment">// ä¸Šä¸‰è§’å½¢</span><br>indices.<span class="hljs-built_in">push_back</span>(k1);      <span class="hljs-comment">// A</span><br>indices.<span class="hljs-built_in">push_back</span>(k2);      <span class="hljs-comment">// C</span><br>indices.<span class="hljs-built_in">push_back</span>(k1 + <span class="hljs-number">1</span>);  <span class="hljs-comment">// B</span><br><br><span class="hljs-comment">// ä¸‹ä¸‰è§’å½¢</span><br>indices.<span class="hljs-built_in">push_back</span>(k1 + <span class="hljs-number">1</span>);  <span class="hljs-comment">// B</span><br>indices.<span class="hljs-built_in">push_back</span>(k2);      <span class="hljs-comment">// C</span><br>indices.<span class="hljs-built_in">push_back</span>(k2 + <span class="hljs-number">1</span>);  <span class="hljs-comment">// D</span><br><br></code></pre></td></tr></table></figure>
<h3 id="æ³•çº¿è®¡ç®—çƒä½“ç‰¹ä¾‹"><a href="#æ³•çº¿è®¡ç®—çƒä½“ç‰¹ä¾‹" class="headerlink" title="æ³•çº¿è®¡ç®—çƒä½“ç‰¹ä¾‹"></a><a class="markdownIt-Anchor" href="#æ³•çº¿è®¡ç®—çƒä½“ç‰¹ä¾‹"></a> æ³•çº¿è®¡ç®—ï¼ˆçƒä½“ç‰¹ä¾‹ï¼‰</h3>
<p>æ³•çº¿ = é¡¶ç‚¹ä½ç½®å½’ä¸€åŒ–</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp">lengthInv = <span class="hljs-number">1.0f</span> / radius;<br>nx = x * lengthInv;<br>ny = y * lengthInv;<br>nz = z * lengthInv;<br><br></code></pre></td></tr></table></figure>
<h3 id="çº¹ç†åæ ‡uvæ˜ å°„"><a href="#çº¹ç†åæ ‡uvæ˜ å°„" class="headerlink" title="çº¹ç†åæ ‡uvæ˜ å°„"></a><a class="markdownIt-Anchor" href="#çº¹ç†åæ ‡uvæ˜ å°„"></a> çº¹ç†åæ ‡ï¼ˆUVæ˜ å°„ï¼‰</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">u = (<span class="hljs-type">float</span>)j / sectorCount;  <span class="hljs-comment">// ç»åº¦: 0 â†’ 1 (ä»å·¦åˆ°å³)</span><br>v = (<span class="hljs-type">float</span>)i / stackCount;   <span class="hljs-comment">// çº¬åº¦: 0 â†’ 1 (ä»ä¸Šåˆ°ä¸‹)</span><br><br></code></pre></td></tr></table></figure>
<h3 id="é¡¶ç‚¹å±æ€§è®¾ç½®"><a href="#é¡¶ç‚¹å±æ€§è®¾ç½®" class="headerlink" title="é¡¶ç‚¹å±æ€§è®¾ç½®"></a><a class="markdownIt-Anchor" href="#é¡¶ç‚¹å±æ€§è®¾ç½®"></a> é¡¶ç‚¹å±æ€§è®¾ç½®</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">// ä½ç½® (slot 0) - 3ä¸ªfloat</span><br><span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">8</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>), (<span class="hljs-type">void</span>*)<span class="hljs-number">0</span>);<br><span class="hljs-comment">// æ³•çº¿ (slot 1) - 3ä¸ªfloat</span><br><span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">8</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>), (<span class="hljs-type">void</span>*)(<span class="hljs-number">3</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>)));<br><span class="hljs-comment">// çº¹ç† (slot 2) - 2ä¸ªfloat</span><br><span class="hljs-built_in">glVertexAttribPointer</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, GL_FLOAT, GL_FALSE, <span class="hljs-number">8</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>), (<span class="hljs-type">void</span>*)(<span class="hljs-number">6</span> * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>)));<br><br></code></pre></td></tr></table></figure>
<h3 id="ç»˜åˆ¶å‘½ä»¤"><a href="#ç»˜åˆ¶å‘½ä»¤" class="headerlink" title="ç»˜åˆ¶å‘½ä»¤"></a><a class="markdownIt-Anchor" href="#ç»˜åˆ¶å‘½ä»¤"></a> ç»˜åˆ¶å‘½ä»¤</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">glDrawElements</span>(GL_TRIANGLES, indices.<span class="hljs-built_in">size</span>(), GL_UNSIGNED_INT, <span class="hljs-number">0</span>);<br><br></code></pre></td></tr></table></figure>
<h3 id="ç²¾åº¦æ§åˆ¶"><a href="#ç²¾åº¦æ§åˆ¶" class="headerlink" title="ç²¾åº¦æ§åˆ¶"></a><a class="markdownIt-Anchor" href="#ç²¾åº¦æ§åˆ¶"></a> ç²¾åº¦æ§åˆ¶</h3>
<p>å‚æ•°        ä½æ¨¡  ä¸­æ¨¡  é«˜æ¨¡<br />
sectorCount 24   36   72<br />
stackCount  12   18   36<br />
é¡¶ç‚¹æ•°       325  703  2701<br />
ä¸‰è§’å½¢æ•°     1056 2304 9216</p>
<p>ğŸ’¡ æ ¸å¿ƒå…¬å¼æ€»ç»“</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp">é¡¶ç‚¹ä½ç½® = çƒé¢åæ ‡ â†’ ç›´è§’åæ ‡<br>æ³•çº¿æ–¹å‘ = é¡¶ç‚¹ä½ç½® / åŠå¾„<br>çº¹ç†åæ ‡ = ç»åº¦/<span class="hljs-number">360</span>Â°, çº¬åº¦/<span class="hljs-number">180</span>Â°<br>ä¸‰è§’å½¢ç´¢å¼• = ä¸Šä¸‹ä¸¤åœˆäº¤é”™è¿æ¥<br></code></pre></td></tr></table></figure>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2026/12/28/C-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">â† Next C++å­¦ä¹ ç¬”è®°</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2026/11/23/Database/">DB-notes Prev â†’</a></div></div></div><details id="reward"><summary>reward</summary><div><span>å¾®ä¿¡ | Wechat</span><br><img src="/images/WeChat.png"></div><div><span>æ”¯ä»˜å® | Alipay</span><br><img src="/images/Alipay.png"></div></details><div id="comments"><div id="giscus"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">âˆ§ </a><a class="i-index" id="to-index" onClick="tocControl.change()" title="To Catalog"><span class="tocBtnIconBar"></span><span class="tocBtnIconBar"></span><span class="tocBtnIconBar"></span></a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a><a onclick="BgmControl()"><svg id="bgm-control" viewBox="0 0 30 34" fill="#18d1ff" style="width: 24px; transition: transform .3s;margin-top: 4px"><path d="M25.998 23.422V11.29h3.999v12.132h-3.999zM19.497 6.234h4.001v22.243h-4.001V6.234zM12.998.867h4v32.978h-4V.867zm-6.5 5.367h4.001v22.243H6.498V6.234zm-6.5 5.056h4v12.132h-4V11.29z"></path></svg><audio id="bgm" src="/audio/bgm.mp3" autoplay loop crossorigin="anonymous"> </audio></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/images/1.jpg" alt="Logo" style="margin:0;border-radius:0;"></a><h1 id="Dr"><a href="/">Lnk</a></h1><div id="description"><p></p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/Lnkqwq"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" href="3403583728@qq.com"><i class="fa fa-envelope" alt="E-Mail"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%BA%B9%E7%90%86%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.</span> <span class="toc-text"> å›¾åƒå¤„ç†&amp;çº¹ç†åŠ è½½</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text"> å›¾åƒæ–‡ä»¶æ ¼å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E4%BD%8D%E6%95%B0%E4%B8%8E%E5%83%8F%E7%B4%A0"><span class="toc-number">1.1.1.</span> <span class="toc-text"> å›¾åƒä½æ•°ä¸åƒç´ </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bmp"><span class="toc-number">1.1.2.</span> <span class="toc-text"> BMP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bmp%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.2.1.</span> <span class="toc-text"> BMPæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E6%80%BB%E5%85%B1%E5%B0%B1%E4%B8%A4%E9%83%A8%E5%88%86"><span class="toc-number">1.1.2.2.</span> <span class="toc-text"> æ–‡ä»¶ç»“æ„ï¼ˆæ€»å…±å°±ä¸¤éƒ¨åˆ†ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%83%8F%E7%B4%A0%E6%95%B0%E6%8D%AE%E5%B8%83%E5%B1%80%E5%9D%91"><span class="toc-number">1.1.2.3.</span> <span class="toc-text"> åƒç´ æ•°æ®å¸ƒå±€ï¼ˆå‘ï¼ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E8%AF%BB%E5%8F%96%E4%BB%A3%E7%A0%81"><span class="toc-number">1.1.2.4.</span> <span class="toc-text"> å®Œæ•´è¯»å–ä»£ç </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#opengl%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.2.5.</span> <span class="toc-text"> OpenGLä¸­ä½¿ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.2.6.</span> <span class="toc-text"> å¸¸è§é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bmp%E5%8E%9F%E7%82%B9%E4%B8%8E%E9%AB%98%E5%BA%A6%E5%AD%97%E6%AE%B5"><span class="toc-number">1.1.2.7.</span> <span class="toc-text"> BMPåŸç‚¹ä¸é«˜åº¦å­—æ®µ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tga"><span class="toc-number">1.1.3.</span> <span class="toc-text"> TGA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tga%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.3.1.</span> <span class="toc-text"> TGAæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E6%AF%94bmp%E4%B9%B1%E5%A4%9A%E4%BA%86"><span class="toc-number">1.1.3.2.</span> <span class="toc-text"> æ–‡ä»¶ç»“æ„ï¼ˆæ¯”BMPä¹±å¤šäº†ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%8E%8B%E7%BC%A9tgatype-2%E6%9C%80%E7%AE%80%E5%8D%95"><span class="toc-number">1.1.3.3.</span> <span class="toc-text"> ä¸å‹ç¼©TGAï¼ˆType 2ï¼Œæœ€ç®€å•ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%8E%8B%E7%BC%A9tga%E8%AF%BB%E5%8F%96%E4%BB%A3%E7%A0%81type-2"><span class="toc-number">1.1.3.4.</span> <span class="toc-text"> ä¸å‹ç¼©TGAè¯»å–ä»£ç ï¼ˆType 2ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rle%E5%8E%8B%E7%BC%A9tgatype-10%E9%87%8D%E7%82%B9"><span class="toc-number">1.1.3.5.</span> <span class="toc-text"> RLEå‹ç¼©TGAï¼ˆType 10ï¼Œé‡ç‚¹ï¼ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4tga%E5%8A%A0%E8%BD%BD%E5%99%A8%E6%94%AF%E6%8C%81type-2%E5%92%8C10"><span class="toc-number">1.1.3.6.</span> <span class="toc-text"> å®Œæ•´TGAåŠ è½½å™¨ï¼ˆæ”¯æŒType 2å’Œ10ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jpg"><span class="toc-number">1.1.4.</span> <span class="toc-text"> JPG</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#jpg%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.4.1.</span> <span class="toc-text"> JPGæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jpg%E7%9A%84%E6%A0%B8%E5%BF%83%E5%93%B2%E5%AD%A6"><span class="toc-number">1.1.4.2.</span> <span class="toc-text"> JPGçš„æ ¸å¿ƒå“²å­¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC1%E6%AD%A5%E9%A2%9C%E8%89%B2%E7%A9%BA%E9%97%B4%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.1.4.3.</span> <span class="toc-text"> ç¬¬1æ­¥ï¼šé¢œè‰²ç©ºé—´è½¬æ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC2%E6%AD%A5%E4%B8%8B%E9%87%87%E6%A0%B7%E8%89%B2%E5%BA%A6%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.1.4.4.</span> <span class="toc-text"> ç¬¬2æ­¥ï¼šä¸‹é‡‡æ ·ï¼ˆè‰²åº¦å‹ç¼©ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC3%E6%AD%A5dct%E5%8F%98%E6%8D%A2%E6%A0%B8%E5%BF%83%E9%9A%BE%E7%82%B9"><span class="toc-number">1.1.4.5.</span> <span class="toc-text"> ç¬¬3æ­¥ï¼šDCTå˜æ¢ï¼ˆæ ¸å¿ƒéš¾ç‚¹ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC4%E6%AD%A5%E9%87%8F%E5%8C%96%E4%B8%A2%E6%8E%89%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.4.6.</span> <span class="toc-text"> ç¬¬4æ­¥ï¼šé‡åŒ–ï¼ˆä¸¢æ‰æ•°æ®ï¼ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC5%E6%AD%A5%E5%93%88%E5%A4%AB%E6%9B%BC%E7%BC%96%E7%A0%81%E6%97%A0%E6%8D%9F%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.1.4.7.</span> <span class="toc-text"> ç¬¬5æ­¥ï¼šå“ˆå¤«æ›¼ç¼–ç ï¼ˆæ— æŸå‹ç¼©ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jpg%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.4.8.</span> <span class="toc-text"> JPGæ–‡ä»¶ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#png"><span class="toc-number">1.1.5.</span> <span class="toc-text"> PNG</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#png%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.5.1.</span> <span class="toc-text"> PNGæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#png%E7%9A%84%E6%A0%B8%E5%BF%83%E5%93%B2%E5%AD%A6"><span class="toc-number">1.1.5.2.</span> <span class="toc-text"> PNGçš„æ ¸å¿ƒå“²å­¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#png%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E6%95%B0%E6%8D%AE%E5%9D%97"><span class="toc-number">1.1.5.3.</span> <span class="toc-text"> PNGæ–‡ä»¶ç»“æ„ï¼ˆæ•°æ®å—ï¼ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC1%E6%AD%A5%E6%BB%A4%E6%B3%A2%E5%99%A8%E6%A0%B8%E5%BF%83%E4%B8%AD%E7%9A%84%E6%A0%B8%E5%BF%83"><span class="toc-number">1.1.5.4.</span> <span class="toc-text"> ç¬¬1æ­¥ï¼šæ»¤æ³¢å™¨ï¼ˆæ ¸å¿ƒä¸­çš„æ ¸å¿ƒï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC2%E6%AD%A5deflate%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.1.5.5.</span> <span class="toc-text"> ç¬¬2æ­¥ï¼šDEFLATEå‹ç¼©</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%9A%E5%BD%937%E9%9A%94%E8%A1%8C%E6%89%AB%E6%8F%8Fadam7"><span class="toc-number">1.1.5.6.</span> <span class="toc-text"> äºšå½“7éš”è¡Œæ‰«æï¼ˆAdam7ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%8F%E6%98%8E%E9%80%9A%E9%81%93png%E7%9A%84%E6%9D%80%E6%89%8B%E9%94%8F"><span class="toc-number">1.1.5.7.</span> <span class="toc-text"> é€æ˜é€šé“ï¼ˆPNGçš„æ€æ‰‹é”ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#png%E8%A7%A3%E7%A0%81%E6%B5%81%E7%A8%8Bstb%E5%9C%A8%E5%81%9A%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.5.8.</span> <span class="toc-text"> PNGè§£ç æµç¨‹ï¼ˆSTBåœ¨åšä»€ä¹ˆï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88png%E4%B8%8D%E9%80%82%E5%90%88%E6%B8%B8%E6%88%8F%E7%BA%B9%E7%90%86"><span class="toc-number">1.1.5.9.</span> <span class="toc-text"> ä¸ºä»€ä¹ˆPNGä¸é€‚åˆæ¸¸æˆçº¹ç†ï¼Ÿ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80"><span class="toc-number">1.2.</span> <span class="toc-text"> å†…å­˜å¸ƒå±€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80"><span class="toc-number">1.2.1.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯å†…å­˜å¸ƒå±€ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%83%8F%E7%B4%A0%E6%A0%BC%E5%BC%8Fpixel-format"><span class="toc-number">1.2.2.</span> <span class="toc-text"> åƒç´ æ ¼å¼ï¼ˆPixel Formatï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E5%AF%B9%E9%BD%90row-alignment"><span class="toc-number">1.2.3.</span> <span class="toc-text"> è¡Œå¯¹é½ï¼ˆRow Alignmentï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%82%B9%E6%96%B9%E5%90%91origin"><span class="toc-number">1.2.4.</span> <span class="toc-text"> åŸç‚¹æ–¹å‘ï¼ˆOriginï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9%E7%BA%B9%E7%90%86%E6%A0%BC%E5%BC%8Fgpu%E5%8E%9F%E7%94%9F"><span class="toc-number">1.2.5.</span> <span class="toc-text"> å‹ç¼©çº¹ç†æ ¼å¼ï¼ˆGPUåŸç”Ÿï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#srgb%E4%B8%8E%E7%BA%BF%E6%80%A7%E7%A9%BA%E9%97%B4"><span class="toc-number">1.2.6.</span> <span class="toc-text"> sRGBä¸çº¿æ€§ç©ºé—´</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gpu%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.3.</span> <span class="toc-text"> GPUä¸Šä¼ </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFgpu%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.3.1.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯GPUä¸Šä¼ ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%9F%BA%E7%A1%80%E7%9A%84%E4%B8%8A%E4%BC%A0glteximage2d"><span class="toc-number">1.3.2.</span> <span class="toc-text"> æœ€åŸºç¡€çš„ä¸Šä¼ ï¼šglTexImage2D</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E6%9B%B4%E6%96%B0gltexsubimage2d"><span class="toc-number">1.3.3.</span> <span class="toc-text"> å±€éƒ¨æ›´æ–°ï¼šglTexSubImage2D</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84glmapbufferpbo"><span class="toc-number">1.3.4.</span> <span class="toc-text"> å†…å­˜æ˜ å°„ï¼šglMapBufferï¼ˆPBOï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E6%98%A0%E5%B0%84persistent-mapping"><span class="toc-number">1.3.5.</span> <span class="toc-text"> æŒä¹…æ˜ å°„ï¼ˆPersistent Mappingï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%BC%A0%E7%9C%9F%E6%AD%A3%E7%9A%84%E5%B9%B6%E8%A1%8C"><span class="toc-number">1.3.6.</span> <span class="toc-text"> å¼‚æ­¥ä¸Šä¼ ï¼ˆçœŸæ­£çš„å¹¶è¡Œï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9%E7%BA%B9%E7%90%86%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.3.7.</span> <span class="toc-text"> å‹ç¼©çº¹ç†ä¸Šä¼ </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E7%BC%93%E5%86%B2"><span class="toc-number">1.4.</span> <span class="toc-text"> æ·±åº¦ç¼“å†²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B7%B1%E5%BA%A6%E7%BC%93%E5%86%B2"><span class="toc-number">1.4.1.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯æ·±åº¦ç¼“å†²ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E7%BC%93%E5%86%B2%E7%9A%84%E6%A0%B8%E5%BF%83%E4%B8%89%E8%A6%81%E7%B4%A0"><span class="toc-number">1.4.2.</span> <span class="toc-text"> æ·±åº¦ç¼“å†²çš„æ ¸å¿ƒä¸‰è¦ç´ </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E7%BC%93%E5%86%B2%E7%9A%84%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98z-fighting"><span class="toc-number">1.4.3.</span> <span class="toc-text"> æ·±åº¦ç¼“å†²çš„ç²¾åº¦é—®é¢˜ï¼ˆZ-Fightingï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E7%BC%93%E5%86%B2%E7%9A%84%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">1.4.4.</span> <span class="toc-text"> æ·±åº¦ç¼“å†²çš„å¯è§†åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E7%BA%B9%E7%90%86%E9%98%B4%E5%BD%B1%E6%98%A0%E5%B0%84%E5%89%8D%E7%BD%AE"><span class="toc-number">1.4.5.</span> <span class="toc-text"> æ·±åº¦çº¹ç†ï¼ˆé˜´å½±æ˜ å°„å‰ç½®ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E6%B5%8B%E8%AF%95%E7%9A%84%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">1.4.6.</span> <span class="toc-text"> æ·±åº¦æµ‹è¯•çš„å¸¸è§é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.7.</span> <span class="toc-text"> æ€§èƒ½ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%BA%A6%E7%BC%93%E5%86%B2%E9%80%9F%E6%9F%A5%E8%A1%A8"><span class="toc-number">1.4.8.</span> <span class="toc-text"> æ·±åº¦ç¼“å†²é€ŸæŸ¥è¡¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#opengl"><span class="toc-number">2.</span> <span class="toc-text"> openGL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#glfw%E7%AA%97%E5%8F%A3%E7%AE%A1%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text"> GLFWçª—å£ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%B8%8F-glfw-%E7%AA%97%E5%8F%A3%E7%AE%A1%E7%90%86%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.1.</span> <span class="toc-text"> ğŸ—ï¸ GLFW çª—å£ç®¡ç†å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#opengl-%E6%A0%B8%E5%BF%83%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.2.</span> <span class="toc-text"> ğŸ¨ OpenGL æ ¸å¿ƒå‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#glad-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.3.</span> <span class="toc-text"> ğŸ”§ GLAD åˆå§‹åŒ–å‡½æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#glad%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">2.2.</span> <span class="toc-text"> gladç€è‰²å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#glad%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.1.</span> <span class="toc-text"> gladå‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.2.</span> <span class="toc-text"> ğŸ¨ ç»˜åˆ¶å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E7%9D%80%E8%89%B2%E5%99%A8%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.3.</span> <span class="toc-text"> ğŸ”„ å®Œæ•´ç€è‰²å™¨åˆ›å»ºæµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#opengl%E5%88%9D%E5%A7%8B%E5%8C%96render%E6%B8%B2%E6%9F%93"><span class="toc-number">2.3.</span> <span class="toc-text"> openGLåˆå§‹åŒ–&amp;renderæ¸²æŸ“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%87%BD%E6%95%B0-init"><span class="toc-number">2.3.1.</span> <span class="toc-text"> åˆå§‹åŒ–å‡½æ•° init()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0-render"><span class="toc-number">2.3.2.</span> <span class="toc-text"> æ¸²æŸ“å‡½æ•° render()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0-framebuffer_size_callback"><span class="toc-number">2.3.3.</span> <span class="toc-text"> å›è°ƒå‡½æ•° framebuffer_size_callback()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">2.3.4.</span> <span class="toc-text"> æ•°æ®æµç¨‹å›¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5%E6%80%BB%E7%BB%93"><span class="toc-number">2.3.5.</span> <span class="toc-text"> å…³é”®æ¦‚å¿µæ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">2.4.</span> <span class="toc-text"> é¡¶ç‚¹ç€è‰²å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">2.4.1.</span> <span class="toc-text"> åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81%E7%BB%93%E6%9E%84"><span class="toc-number">2.4.2.</span> <span class="toc-text"> æ ¸å¿ƒä»£ç ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.4.3.</span> <span class="toc-text"> å…³é”®ç»„ä»¶è¯¦è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.4.4.</span> <span class="toc-text"> å‘é‡ç±»å‹ç³»ç»Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3d%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%8F%98%E6%8D%A2"><span class="toc-number">2.4.5.</span> <span class="toc-text"> 3Då›¾å½¢å­¦å˜æ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8"><span class="toc-number">2.4.6.</span> <span class="toc-text"> é«˜çº§åº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8Ec%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.4.7.</span> <span class="toc-text"> ä¸C++çš„æ•°æ®è¿æ¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%87%E6%AE%B5%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">2.5.</span> <span class="toc-text"> ç‰‡æ®µç€è‰²å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-2"><span class="toc-number">2.5.1.</span> <span class="toc-text"> åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3-2"><span class="toc-number">2.5.2.</span> <span class="toc-text"> å…³é”®ç»„ä»¶è¯¦è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F%E4%B8%8E%E5%87%BD%E6%95%B0"><span class="toc-number">2.5.3.</span> <span class="toc-text"> å†…ç½®å˜é‡ä¸å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%B9%E7%90%86%E5%A4%84%E7%90%86"><span class="toc-number">2.5.4.</span> <span class="toc-text"> çº¹ç†å¤„ç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#glm%E6%95%B0%E5%AD%A6%E5%B7%A5%E5%85%B7%E5%BA%93"><span class="toc-number">2.6.</span> <span class="toc-text"> glmæ•°å­¦å·¥å…·åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#glm%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">2.6.1.</span> <span class="toc-text"> ğŸ“¦ GLMæ ¸å¿ƒæ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.6.2.</span> <span class="toc-text"> ğŸ”¢ åŸºæœ¬æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E6%8D%A2%E7%9F%A9%E9%98%B5-transformations"><span class="toc-number">2.6.3.</span> <span class="toc-text"> ğŸš€ å˜æ¢çŸ©é˜µ (Transformations)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%92%8C%E6%8A%95%E5%BD%B1%E7%9F%A9%E9%98%B5"><span class="toc-number">2.6.4.</span> <span class="toc-text"> ğŸ“ è§†å›¾å’ŒæŠ•å½±çŸ©é˜µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A9%E9%98%B5%E6%93%8D%E4%BD%9C%E5%92%8C%E7%BB%84%E5%90%88"><span class="toc-number">2.6.5.</span> <span class="toc-text"> ğŸ§® çŸ©é˜µæ“ä½œå’Œç»„åˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E5%92%8C%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97"><span class="toc-number">2.6.6.</span> <span class="toc-text"> ğŸ“Š å‘é‡å’ŒçŸ©é˜µè¿ç®—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#uniform%E5%87%BD%E6%95%B0%E5%B0%81%E8%A3%85"><span class="toc-number">2.7.</span> <span class="toc-text"> uniformå‡½æ•°å°è£…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#opengl-uniform%E5%8E%9F%E8%A3%85%E5%87%BD%E6%95%B0%E5%BA%93"><span class="toc-number">2.7.1.</span> <span class="toc-text"> ğŸ“¦ OpenGL UniformåŸè£…å‡½æ•°åº“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uniform%E5%8E%9F%E8%A3%85%E5%87%BD%E6%95%B0%E8%AF%A6%E7%BB%86%E7%94%A8%E6%B3%95"><span class="toc-number">2.7.2.</span> <span class="toc-text"> ğŸ”§ UniformåŸè£…å‡½æ•°è¯¦ç»†ç”¨æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stack%E5%BA%93"><span class="toc-number">2.8.</span> <span class="toc-text"> stackåº“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-3"><span class="toc-number">2.8.1.</span> <span class="toc-text"> åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%87%BD%E6%95%B03%E4%B8%AA%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">2.8.2.</span> <span class="toc-text"> æ ¸å¿ƒå‡½æ•°ï¼ˆ3ä¸ªåŸºæœ¬æ“ä½œï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0"><span class="toc-number">2.8.3.</span> <span class="toc-text"> è¾…åŠ©å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%94%99%E8%AF%AF%E7%94%A8%E6%B3%95"><span class="toc-number">2.8.4.</span> <span class="toc-text"> å¸¸è§é”™è¯¯ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%9B%BE%E5%BD%A2%E5%AD%A6%E4%B8%AD%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8"><span class="toc-number">2.8.5.</span> <span class="toc-text"> åœ¨å›¾å½¢å­¦ä¸­çš„å®é™…åº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%AE%B9%E5%99%A8%E6%9B%B4%E6%8D%A2"><span class="toc-number">2.8.6.</span> <span class="toc-text"> åº•å±‚å®¹å™¨æ›´æ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%88-vs-%E5%86%85%E5%AD%98%E6%A0%88%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.8.7.</span> <span class="toc-text"> æ ˆ vs å†…å­˜æ ˆçš„åŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%B9%E7%90%86-%E6%B3%95%E7%BA%BF-%E6%9D%90%E8%B4%A8-%E5%85%89%E6%BA%90"><span class="toc-number">2.9.</span> <span class="toc-text"> çº¹ç†ã€æ³•çº¿ã€æè´¨ã€å…‰æº</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%B9%E7%90%86texture"><span class="toc-number">2.9.1.</span> <span class="toc-text"> çº¹ç†ï¼ˆTextureï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%95%E7%BA%BFnormal"><span class="toc-number">2.9.2.</span> <span class="toc-text"> æ³•çº¿ï¼ˆNormalï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%90%E8%B4%A8material"><span class="toc-number">2.9.3.</span> <span class="toc-text"> æè´¨ï¼ˆMaterialï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%89%E6%BA%90light"><span class="toc-number">2.9.4.</span> <span class="toc-text"> å…‰æºï¼ˆLightï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%B8%B2%E6%9F%93%E6%96%B9%E7%A8%8B"><span class="toc-number">2.9.5.</span> <span class="toc-text"> å®Œæ•´æ¸²æŸ“æ–¹ç¨‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%89%A9%E4%BD%93"><span class="toc-number">3.</span> <span class="toc-text"> ç‰©ä½“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%83%E4%BD%93"><span class="toc-number">3.1.</span> <span class="toc-text"> çƒä½“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3%E7%BB%8F%E7%BA%AC%E5%BA%A6%E6%B3%95"><span class="toc-number">3.1.1.</span> <span class="toc-text"> æ ¸å¿ƒæ€æƒ³ï¼šç»çº¬åº¦æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%8F%82%E6%95%B0"><span class="toc-number">3.1.2.</span> <span class="toc-text"> å…³é”®å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B6%E7%82%B9%E7%94%9F%E6%88%90%E5%8F%8C%E9%87%8D%E5%BE%AA%E7%8E%AF"><span class="toc-number">3.1.3.</span> <span class="toc-text"> é¡¶ç‚¹ç”Ÿæˆï¼ˆåŒé‡å¾ªç¯ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B6%E7%82%B9%E6%95%B0%E6%8D%AE%E5%B8%83%E5%B1%80%E6%AF%8F%E4%B8%AA%E9%A1%B6%E7%82%B98%E4%B8%AAfloat"><span class="toc-number">3.1.4.</span> <span class="toc-text"> é¡¶ç‚¹æ•°æ®å¸ƒå±€ï¼ˆæ¯ä¸ªé¡¶ç‚¹8ä¸ªfloatï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%94%9F%E6%88%90%E4%B8%89%E8%A7%92%E5%BD%A2%E6%8B%BC%E5%87%91"><span class="toc-number">3.1.5.</span> <span class="toc-text"> ç´¢å¼•ç”Ÿæˆï¼ˆä¸‰è§’å½¢æ‹¼å‡‘ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%95%E7%BA%BF%E8%AE%A1%E7%AE%97%E7%90%83%E4%BD%93%E7%89%B9%E4%BE%8B"><span class="toc-number">3.1.6.</span> <span class="toc-text"> æ³•çº¿è®¡ç®—ï¼ˆçƒä½“ç‰¹ä¾‹ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%B9%E7%90%86%E5%9D%90%E6%A0%87uv%E6%98%A0%E5%B0%84"><span class="toc-number">3.1.7.</span> <span class="toc-text"> çº¹ç†åæ ‡ï¼ˆUVæ˜ å°„ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B6%E7%82%B9%E5%B1%9E%E6%80%A7%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.1.8.</span> <span class="toc-text"> é¡¶ç‚¹å±æ€§è®¾ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.9.</span> <span class="toc-text"> ç»˜åˆ¶å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B2%BE%E5%BA%A6%E6%8E%A7%E5%88%B6"><span class="toc-number">3.1.10.</span> <span class="toc-text"> ç²¾åº¦æ§åˆ¶</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>
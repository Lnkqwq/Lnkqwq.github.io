<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>DB-notes | Hexo</title><meta name="description" content="SQL  SQL基础  DDL（定义结构） 一、数据库操作 12345678-- 创建数据库CREATE DATABASE 数据库名;-- 删除数据库DROP DATABASE 数据库名;-- 修改数据库（某些数据库支持）ALTER DATABASE 数据库名 ...; 二、表操作（核心） 创建表 12345CREATE TABLE 表名 (    列名 数据类型,    列名 数据类型,">
<meta property="og:type" content="article">
<meta property="og:title" content="DB-notes">
<meta property="og:url" content="http://example.com/2026/02/23/Database/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="SQL  SQL基础  DDL（定义结构） 一、数据库操作 12345678-- 创建数据库CREATE DATABASE 数据库名;-- 删除数据库DROP DATABASE 数据库名;-- 修改数据库（某些数据库支持）ALTER DATABASE 数据库名 ...; 二、表操作（核心） 创建表 12345CREATE TABLE 表名 (    列名 数据类型,    列名 数据类型,">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2026-02-23T05:01:28.000Z">
<meta property="article:modified_time" content="2026-02-27T12:53:39.602Z">
<meta property="article:author" content="Lnk">
<meta name="twitter:card" content="summary"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/BenderLight.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><meta name="page-config" content="{&quot;code_fold&quot;:null}"><script class="pjax-js">var config = {"root":"/","code_fold":15,"search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy"}};
var page_config = {
  code_fold: null
};
function updatePageConfig() {
  var newPageConfig = document.querySelector('meta[name="page-config"]');
  if (newPageConfig) {
    page_config = JSON.parse(newPageConfig.content);
  }
}
document.addEventListener('pjax:complete', function() { updatePageConfig(); });
updatePageConfig();</script><link type="text/css" rel="stylesheet" href="/lib/encrypt/hbe.style.css"><script src="//unpkg.com/mermaid@11.12.2/dist/mermaid.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
 menuSettings: {
   zoom: "None"
 },
 showMathMenu: false,
 jax: ["input/TeX","output/CommonHTML"],
 extensions: ["tex2jax.js"],
 TeX: {
   extensions: ["AMSmath.js","AMSsymbols.js"],
   equationNumbers: {
     autoNumber: "AMS"
   }
 },
 tex2jax: {
   inlineMath: [["\\(", "\\)"]],
   displayMath: [["\\[", "\\]"]]
 }
});</script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('/images/BK.PNG');
 --light-background: url('/images/BK.PNG');
 --theme-encrypt-confirm: 'confirm'
}</style><script defer src="/js/arknights.js"></script><script defer src="/js/search.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@11.12.2/dist/mermaid.esm.min.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
  menuSettings: {
    zoom: "None"
  },
  showMathMenu: false,
  jax: ["input/TeX","output/CommonHTML"],
  extensions: ["tex2jax.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js"],
    equationNumbers: {
      autoNumber: "AMS"
    }
  },
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]]
  }
});
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/lib/encrypt/hbe.js"></script><script async src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.vercount','meta[name=page-config]'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><script class="pjax-js">reset= () => {window.giscusSettings = {
 repo: 'Lnkqwq/Lnkqwq.github.io',
 repoId: 'R_kgDORZSSAA',
 category: '',
 categoryId: '',
 mapping: 'pathname',
 strict: '0',
 reactionsEnabled: '1',
 emitMetadata: '0',
 inputPosition: 'bottom',
 lang: 'zh-CN',
 crossorigin: 'anonymous' , loading: 'lazy'};window.giscusThemeConfig = { theme: 'preferred_color_scheme' };MathJax.Hub.Queue(["Typeset", MathJax.Hub]);document.querySelector('.lg-container')?.remove()
const postBg = document.querySelector('#post-bg');
if (postBg) lightGallery(postBg, {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.vercount','meta[name=page-config]'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>DB-notes</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2026-02-23T05:01:28.000Z" id="date"> 2026-02-23</time></div></span><br><span>Last Update: <div class="control"><time datetime="2026-02-27T12:53:39.602Z" id="updated"> 2026-02-27</time></div></span></div></div><hr><div id="post-content"><h1 id="sql"><a href="#sql" class="headerlink" title="sql"></a><a class="markdownIt-Anchor" href="#sql"></a> SQL</h1>
<h2 id="sql基础"><a href="#sql基础" class="headerlink" title="sql基础"></a><a class="markdownIt-Anchor" href="#sql基础"></a> SQL基础</h2>
<h3 id="ddl定义结构"><a href="#ddl定义结构" class="headerlink" title="ddl定义结构"></a><a class="markdownIt-Anchor" href="#ddl定义结构"></a> DDL（定义结构）</h3>
<p>一、数据库操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建数据库</span><br><span class="hljs-keyword">CREATE</span> DATABASE 数据库名;<br><br><span class="hljs-comment">-- 删除数据库</span><br><span class="hljs-keyword">DROP</span> DATABASE 数据库名;<br><br><span class="hljs-comment">-- 修改数据库（某些数据库支持）</span><br><span class="hljs-keyword">ALTER</span> DATABASE 数据库名 ...;<br></code></pre></td></tr></table></figure>
<p>二、表操作（核心）</p>
<p>创建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> 表名 (<br>    列名 数据类型,<br>    列名 数据类型,<br>    ...<br>);<br></code></pre></td></tr></table></figure>
<p>数据类型概览</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 数值型</span><br><span class="hljs-type">INT</span> <span class="hljs-operator">/</span> <span class="hljs-type">INTEGER</span><br><span class="hljs-type">BIGINT</span><br><span class="hljs-type">SMALLINT</span><br><span class="hljs-type">DECIMAL</span>(p,s) <span class="hljs-operator">/</span> <span class="hljs-type">NUMERIC</span>(p,s)<br><span class="hljs-type">FLOAT</span> <span class="hljs-operator">/</span> <span class="hljs-keyword">DOUBLE</span><br><span class="hljs-type">REAL</span><br><br><span class="hljs-comment">-- 字符型</span><br><span class="hljs-type">CHAR</span>(n)           <span class="hljs-comment">-- 定长</span><br><span class="hljs-type">VARCHAR</span>(n)        <span class="hljs-comment">-- 变长</span><br>TEXT              <span class="hljs-comment">-- 长文本</span><br><br><span class="hljs-comment">-- 日期时间型</span><br><span class="hljs-type">DATE</span><br><span class="hljs-type">TIME</span><br><span class="hljs-type">TIMESTAMP</span> <span class="hljs-operator">/</span> DATETIME<br><span class="hljs-keyword">YEAR</span><br><br><span class="hljs-comment">-- 二进制型</span><br><span class="hljs-type">BLOB</span><br><span class="hljs-type">BINARY</span>(n)<br><span class="hljs-type">VARBINARY</span>(n)<br><br><span class="hljs-comment">-- 布尔型</span><br><span class="hljs-type">BOOLEAN</span> <span class="hljs-operator">/</span> BOOL<br></code></pre></td></tr></table></figure>
<p>约束条件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 列级约束（跟在数据类型后）</span><br>列名 数据类型 <span class="hljs-keyword">PRIMARY KEY</span><br>列名 数据类型 <span class="hljs-keyword">NOT NULL</span><br>列名 数据类型 <span class="hljs-keyword">UNIQUE</span><br>列名 数据类型 <span class="hljs-keyword">DEFAULT</span> 默认值<br>列名 数据类型 <span class="hljs-keyword">CHECK</span> (条件)<br>列名 数据类型 <span class="hljs-keyword">REFERENCES</span> 其他表(列)<br><br><span class="hljs-comment">-- 表级约束（单独定义）</span><br><span class="hljs-keyword">PRIMARY KEY</span> (列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>, ...)<br><span class="hljs-keyword">UNIQUE</span> (列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>, ...)<br><span class="hljs-keyword">FOREIGN KEY</span> (列) <span class="hljs-keyword">REFERENCES</span> 其他表(列)<br><span class="hljs-keyword">CHECK</span> (条件)<br></code></pre></td></tr></table></figure>
<p>创建完整表结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> 表名 (<br>    列名<span class="hljs-number">1</span> 数据类型 [约束],<br>    列名<span class="hljs-number">2</span> 数据类型 [约束],<br>    [表级约束<span class="hljs-number">1</span>],<br>    [表级约束<span class="hljs-number">2</span>],<br>    ...<br>);<br></code></pre></td></tr></table></figure>
<p>三、修改表结构</p>
<p>增加列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER TABLE</span> 表名 <span class="hljs-keyword">ADD</span> 列名 数据类型;<br><span class="hljs-keyword">ALTER TABLE</span> 表名 <span class="hljs-keyword">ADD</span> 列名 数据类型 [约束];<br></code></pre></td></tr></table></figure>
<p>删除列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER TABLE</span> 表名 <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">COLUMN</span> 列名;<br></code></pre></td></tr></table></figure>
<p>修改列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 修改数据类型</span><br><span class="hljs-keyword">ALTER TABLE</span> 表名 MODIFY <span class="hljs-keyword">COLUMN</span> 列名 新数据类型;<br><br><span class="hljs-comment">-- 修改列名（某些数据库使用）</span><br><span class="hljs-keyword">ALTER TABLE</span> 表名 RENAME <span class="hljs-keyword">COLUMN</span> 旧列名 <span class="hljs-keyword">TO</span> 新列名;<br><span class="hljs-keyword">ALTER TABLE</span> 表名 CHANGE 旧列名 新列名 数据类型;<br></code></pre></td></tr></table></figure>
<p>添加约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER TABLE</span> 表名 <span class="hljs-keyword">ADD CONSTRAINT</span> 约束名 <span class="hljs-keyword">PRIMARY KEY</span> (列);<br><span class="hljs-keyword">ALTER TABLE</span> 表名 <span class="hljs-keyword">ADD CONSTRAINT</span> 约束名 <span class="hljs-keyword">UNIQUE</span> (列);<br><span class="hljs-keyword">ALTER TABLE</span> 表名 <span class="hljs-keyword">ADD CONSTRAINT</span> 约束名 <span class="hljs-keyword">FOREIGN KEY</span> (列) <span class="hljs-keyword">REFERENCES</span> 其他表(列);<br><span class="hljs-keyword">ALTER TABLE</span> 表名 <span class="hljs-keyword">ADD CONSTRAINT</span> 约束名 <span class="hljs-keyword">CHECK</span> (条件);<br></code></pre></td></tr></table></figure>
<p>删除约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER TABLE</span> 表名 <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">CONSTRAINT</span> 约束名;<br><span class="hljs-keyword">ALTER TABLE</span> 表名 <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">PRIMARY KEY</span>;<br><span class="hljs-keyword">ALTER TABLE</span> 表名 <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">FOREIGN KEY</span> 约束名;<br></code></pre></td></tr></table></figure>
<p>修改表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER TABLE</span> 旧表名 RENAME <span class="hljs-keyword">TO</span> 新表名;<br>RENAME <span class="hljs-keyword">TABLE</span> 旧表名 <span class="hljs-keyword">TO</span> 新表名;<br></code></pre></td></tr></table></figure>
<p>四、删除表结构</p>
<p>删除表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> 表名;<br></code></pre></td></tr></table></figure>
<p>清空表数据（保留结构）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span> 表名;<br></code></pre></td></tr></table></figure>
<p>五、其他对象操作</p>
<p>索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX 索引名 <span class="hljs-keyword">ON</span> 表名 (列);<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX 索引名 <span class="hljs-keyword">ON</span> 表名 (列);<br><span class="hljs-keyword">DROP</span> INDEX 索引名;<br></code></pre></td></tr></table></figure>
<p>视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> 视图名 <span class="hljs-keyword">AS</span> <span class="hljs-keyword">SELECT</span>语句;<br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> 视图名;<br></code></pre></td></tr></table></figure>
<p>序列（部分数据库）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> SEQUENCE 序列名;<br><span class="hljs-keyword">DROP</span> SEQUENCE 序列名;<br></code></pre></td></tr></table></figure>
<h3 id="dml操作数据"><a href="#dml操作数据" class="headerlink" title="dml操作数据"></a><a class="markdownIt-Anchor" href="#dml操作数据"></a> DML（操作数据）</h3>
<p>一、插入数据 (INSERT)</p>
<p>插入完整行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT INTO</span> 表名 <span class="hljs-keyword">VALUES</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, 值<span class="hljs-number">3</span>, ...);<br></code></pre></td></tr></table></figure>
<p>插入指定列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT INTO</span> 表名 (列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>, 列<span class="hljs-number">3</span>, ...) <span class="hljs-keyword">VALUES</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, 值<span class="hljs-number">3</span>, ...);<br></code></pre></td></tr></table></figure>
<p>插入多行数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT INTO</span> 表名 (列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>) <span class="hljs-keyword">VALUES</span><br>(值<span class="hljs-number">1</span>a, 值<span class="hljs-number">2</span>a),<br>(值<span class="hljs-number">1</span>b, 值<span class="hljs-number">2</span>b),<br>(值<span class="hljs-number">1</span>c, 值<span class="hljs-number">2</span>c);<br></code></pre></td></tr></table></figure>
<p>从查询结果插入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT INTO</span> 目标表 (列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>)<br><span class="hljs-keyword">SELECT</span> 源列<span class="hljs-number">1</span>, 源列<span class="hljs-number">2</span> <span class="hljs-keyword">FROM</span> 源表 <span class="hljs-keyword">WHERE</span> 条件;<br></code></pre></td></tr></table></figure>
<p>二、更新数据 (UPDATE)</p>
<p>更新所有行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> 表名 <span class="hljs-keyword">SET</span> 列名 <span class="hljs-operator">=</span> 新值;<br></code></pre></td></tr></table></figure>
<p>更新满足条件的行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> 表名<br><span class="hljs-keyword">SET</span> 列<span class="hljs-number">1</span> <span class="hljs-operator">=</span> 新值<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span> <span class="hljs-operator">=</span> 新值<span class="hljs-number">2</span>, ...<br><span class="hljs-keyword">WHERE</span> 条件;<br></code></pre></td></tr></table></figure>
<p>基于表达式更新</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> 表名<br><span class="hljs-keyword">SET</span> 列名 <span class="hljs-operator">=</span> 表达式<br><span class="hljs-keyword">WHERE</span> 条件;<br></code></pre></td></tr></table></figure>
<p>基于子查询更新</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> 表名<br><span class="hljs-keyword">SET</span> 列名 <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> 子查询)<br><span class="hljs-keyword">WHERE</span> 条件;<br></code></pre></td></tr></table></figure>
<p>三、删除数据 (DELETE)</p>
<p>删除所有行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> 表名;<br></code></pre></td></tr></table></figure>
<p>删除满足条件的行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> 表名 <span class="hljs-keyword">WHERE</span> 条件;<br></code></pre></td></tr></table></figure>
<p>基于子查询删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> 表名<br><span class="hljs-keyword">WHERE</span> 列名 <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> 子查询);<br><br><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> 表名<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span> 子查询);<br></code></pre></td></tr></table></figure>
<p>清空表（DDL操作，但功能类似）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">TRUNCATE</span> <span class="hljs-keyword">TABLE</span> 表名;<br></code></pre></td></tr></table></figure>
<p>四、合并数据 (MERGE/UPSERT)</p>
<p>标准合并语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">MERGE</span> <span class="hljs-keyword">INTO</span> 目标表 <span class="hljs-keyword">USING</span> 源表<br><span class="hljs-keyword">ON</span> (匹配条件)<br><span class="hljs-keyword">WHEN</span> MATCHED <span class="hljs-keyword">THEN</span><br>    <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> 列 <span class="hljs-operator">=</span> 值<br><span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">NOT</span> MATCHED <span class="hljs-keyword">THEN</span><br>    <span class="hljs-keyword">INSERT</span> (列列表) <span class="hljs-keyword">VALUES</span> (值列表);<br></code></pre></td></tr></table></figure>
<p>插入或更新 (部分数据库特有)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- MySQL</span><br><span class="hljs-keyword">INSERT INTO</span> 表名 (列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>) <span class="hljs-keyword">VALUES</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>)<br><span class="hljs-keyword">ON</span> DUPLICATE KEY <span class="hljs-keyword">UPDATE</span> 列<span class="hljs-number">1</span> <span class="hljs-operator">=</span> 新值<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span> <span class="hljs-operator">=</span> 新值<span class="hljs-number">2</span>;<br><br><span class="hljs-comment">-- PostgreSQL</span><br><span class="hljs-keyword">INSERT INTO</span> 表名 (列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>) <span class="hljs-keyword">VALUES</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>)<br><span class="hljs-keyword">ON</span> CONFLICT (约束列) DO <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> 列<span class="hljs-number">1</span> <span class="hljs-operator">=</span> 新值<span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>
<h3 id="dql查询数据"><a href="#dql查询数据" class="headerlink" title="dql查询数据"></a><a class="markdownIt-Anchor" href="#dql查询数据"></a> DQL（查询数据）</h3>
<p>一、基础查询结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>语句完整结构<br><span class="hljs-keyword">SELECT</span> [<span class="hljs-keyword">DISTINCT</span>] 列表达式<br><span class="hljs-keyword">FROM</span> 表名<br>[<span class="hljs-keyword">WHERE</span> 条件]<br>[<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 分组列]<br>[<span class="hljs-keyword">HAVING</span> 分组条件]<br>[<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 排序列 [<span class="hljs-keyword">ASC</span><span class="hljs-operator">|</span><span class="hljs-keyword">DESC</span>]]<br>[LIMIT<span class="hljs-operator">/</span><span class="hljs-keyword">OFFSET</span> 分页];<br></code></pre></td></tr></table></figure>
<p>​<br />
二、SELECT子句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql">选择列<br><span class="hljs-comment">-- 选择所有列</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br><br><span class="hljs-comment">-- 选择特定列</span><br><span class="hljs-keyword">SELECT</span> 列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>, 列<span class="hljs-number">3</span><br><br><span class="hljs-comment">-- 使用表达式</span><br><span class="hljs-keyword">SELECT</span> 列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span> <span class="hljs-operator">+</span> 列<span class="hljs-number">3</span>, 函数名(列)<br><br><span class="hljs-comment">-- 使用常量值</span><br><span class="hljs-keyword">SELECT</span> 列, <span class="hljs-string">&#x27;固定值&#x27;</span> <span class="hljs-keyword">AS</span> 常量列<br><br><span class="hljs-comment">-- 使用列别名</span><br><span class="hljs-keyword">SELECT</span> 列 <span class="hljs-keyword">AS</span> 别名<br><span class="hljs-keyword">SELECT</span> 列 别名<br>​<br>去重<br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> 列<br></code></pre></td></tr></table></figure>
<p>​<br />
三、WHERE子句（条件过滤）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">比较运算符<br><span class="hljs-operator">=</span>     <span class="hljs-comment">-- 等于</span><br><span class="hljs-operator">&lt;&gt;</span> <span class="hljs-operator">!=</span> <span class="hljs-comment">-- 不等于</span><br><span class="hljs-operator">&lt;</span> <span class="hljs-operator">&lt;=</span>  <span class="hljs-comment">-- 小于/小于等于</span><br><span class="hljs-operator">&gt;</span> <span class="hljs-operator">&gt;=</span>  <span class="hljs-comment">-- 大于/大于等于</span><br>​<br>逻辑运算符<br><span class="hljs-keyword">AND</span>   <span class="hljs-comment">-- 与</span><br><span class="hljs-keyword">OR</span>    <span class="hljs-comment">-- 或</span><br><span class="hljs-keyword">NOT</span>   <span class="hljs-comment">-- 非</span><br>​<br>特殊运算符<br><span class="hljs-keyword">BETWEEN</span> 值<span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> 值<span class="hljs-number">2</span>      <span class="hljs-comment">-- 在范围内</span><br><span class="hljs-keyword">IN</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...)       <span class="hljs-comment">-- 在列表中</span><br><span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...)   <span class="hljs-comment">-- 不在列表中</span><br><br><span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;模式&#x27;</span>             <span class="hljs-comment">-- 模式匹配</span><br>  <span class="hljs-operator">%</span> <span class="hljs-comment">-- 匹配任意字符</span><br>  _ <span class="hljs-comment">-- 匹配单个字符</span><br><br><span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>                <span class="hljs-comment">-- 是空值</span><br><span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT NULL</span>            <span class="hljs-comment">-- 非空值</span><br></code></pre></td></tr></table></figure>
<p>​<br />
四、聚合函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)                <span class="hljs-comment">-- 统计行数</span><br><span class="hljs-built_in">COUNT</span>(列)               <span class="hljs-comment">-- 统计非空值</span><br><span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> 列)      <span class="hljs-comment">-- 统计去重值</span><br><br><span class="hljs-built_in">SUM</span>(列)                 <span class="hljs-comment">-- 求和</span><br><span class="hljs-built_in">AVG</span>(列)                 <span class="hljs-comment">-- 平均值</span><br><span class="hljs-built_in">MAX</span>(列)                 <span class="hljs-comment">-- 最大值</span><br><span class="hljs-built_in">MIN</span>(列)                 <span class="hljs-comment">-- 最小值</span><br>​<br>五、<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>与<span class="hljs-keyword">HAVING</span><br>分组语法<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>, ...<br><br><span class="hljs-keyword">HAVING</span> 聚合函数条件<br></code></pre></td></tr></table></figure>
<p>​<br />
六、JOIN连接查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">连接类型<br><span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> 表 <span class="hljs-keyword">ON</span> 条件      <span class="hljs-comment">-- 内连接</span><br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> 表 <span class="hljs-keyword">ON</span> 条件       <span class="hljs-comment">-- 左外连接</span><br><span class="hljs-keyword">RIGHT</span> <span class="hljs-keyword">JOIN</span> 表 <span class="hljs-keyword">ON</span> 条件      <span class="hljs-comment">-- 右外连接</span><br><span class="hljs-keyword">FULL</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> 表 <span class="hljs-keyword">ON</span> 条件 <span class="hljs-comment">-- 全外连接</span><br><span class="hljs-keyword">CROSS</span> <span class="hljs-keyword">JOIN</span> 表             <span class="hljs-comment">-- 交叉连接</span><br>​<br>连接方式<br><span class="hljs-comment">-- 等值连接</span><br><span class="hljs-keyword">JOIN</span> 表 <span class="hljs-keyword">ON</span> A.列 <span class="hljs-operator">=</span> B.列<br><br><span class="hljs-comment">-- 非等值连接</span><br><span class="hljs-keyword">JOIN</span> 表 <span class="hljs-keyword">ON</span> A.列 <span class="hljs-keyword">BETWEEN</span> B.最小值 <span class="hljs-keyword">AND</span> B.最大值<br><br><span class="hljs-comment">-- 自连接</span><br>表 <span class="hljs-keyword">AS</span> 别名<span class="hljs-number">1</span> <span class="hljs-keyword">JOIN</span> 表 <span class="hljs-keyword">AS</span> 别名<span class="hljs-number">2</span> <span class="hljs-keyword">ON</span> 条件<br></code></pre></td></tr></table></figure>
<p>​<br />
七、子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">子查询位置<br><span class="hljs-comment">-- 在WHERE中</span><br><span class="hljs-keyword">WHERE</span> 列 操作符 (<span class="hljs-keyword">SELECT</span> ...)<br><br><span class="hljs-comment">-- 在FROM中</span><br><span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> ...) <span class="hljs-keyword">AS</span> 别名<br><br><span class="hljs-comment">-- 在SELECT中</span><br><span class="hljs-keyword">SELECT</span> 列, (<span class="hljs-keyword">SELECT</span> ...) <span class="hljs-keyword">AS</span> 计算列<br><br><span class="hljs-comment">-- 在HAVING中</span><br><span class="hljs-keyword">HAVING</span> 聚合函数 操作符 (<span class="hljs-keyword">SELECT</span> ...)<br>​<br>子查询运算符<br><span class="hljs-keyword">IN</span> <span class="hljs-operator">/</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span><br><span class="hljs-keyword">EXISTS</span> <span class="hljs-operator">/</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span><br>比较运算符 (<span class="hljs-operator">=</span>, <span class="hljs-operator">&gt;</span>, <span class="hljs-operator">&lt;</span>, <span class="hljs-operator">&gt;=</span>, <span class="hljs-operator">&lt;=</span>, <span class="hljs-operator">&lt;&gt;</span>)<br><span class="hljs-keyword">ALL</span> <span class="hljs-operator">/</span> <span class="hljs-keyword">ANY</span> <span class="hljs-operator">/</span> <span class="hljs-keyword">SOME</span><br></code></pre></td></tr></table></figure>
<p>​<br />
八、集合操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>查询<span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> 查询<span class="hljs-number">2</span>        <span class="hljs-comment">-- 并集（去重）</span><br>查询<span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> 查询<span class="hljs-number">2</span>    <span class="hljs-comment">-- 并集（不去重）</span><br><br>查询<span class="hljs-number">1</span> <span class="hljs-keyword">INTERSECT</span> 查询<span class="hljs-number">2</span>    <span class="hljs-comment">-- 交集</span><br>查询<span class="hljs-number">1</span> <span class="hljs-keyword">EXCEPT</span> 查询<span class="hljs-number">2</span>       <span class="hljs-comment">-- 差集</span><br>查询<span class="hljs-number">1</span> MINUS 查询<span class="hljs-number">2</span>        <span class="hljs-comment">-- 差集（某些数据库）</span><br></code></pre></td></tr></table></figure>
<p>​<br />
九、常用函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>字符串函数<br>CONCAT(串<span class="hljs-number">1</span>, 串<span class="hljs-number">2</span>)        <span class="hljs-comment">-- 连接</span><br><span class="hljs-built_in">UPPER</span>(串) <span class="hljs-operator">/</span> <span class="hljs-built_in">LOWER</span>(串)    <span class="hljs-comment">-- 大小写转换</span><br>LENGTH(串)              <span class="hljs-comment">-- 长度</span><br><span class="hljs-built_in">SUBSTRING</span>(串, 开始, 长度) <span class="hljs-comment">-- 子串</span><br><span class="hljs-built_in">TRIM</span>(串)                <span class="hljs-comment">-- 去空格</span><br>REPLACE(串, 旧, 新)      <span class="hljs-comment">-- 替换</span><br>​<br>数值函数<br>ROUND(数值, 小数位)      <span class="hljs-comment">-- 四舍五入</span><br><span class="hljs-built_in">CEIL</span>(数值) <span class="hljs-operator">/</span> <span class="hljs-built_in">FLOOR</span>(数值)  <span class="hljs-comment">-- 上下取整</span><br><span class="hljs-built_in">ABS</span>(数值)                <span class="hljs-comment">-- 绝对值</span><br><span class="hljs-built_in">MOD</span>(被除数, 除数)        <span class="hljs-comment">-- 取模</span><br>​<br>日期函数<br><span class="hljs-built_in">CURRENT_DATE</span>            <span class="hljs-comment">-- 当前日期</span><br><span class="hljs-built_in">CURRENT_TIME</span>            <span class="hljs-comment">-- 当前时间</span><br><span class="hljs-built_in">CURRENT_TIMESTAMP</span>       <span class="hljs-comment">-- 当前时间戳</span><br><span class="hljs-built_in">EXTRACT</span>(部分 <span class="hljs-keyword">FROM</span> 日期)  <span class="hljs-comment">-- 提取部分</span><br>DATE_ADD(日期, <span class="hljs-type">INTERVAL</span>) <span class="hljs-comment">-- 日期加减</span><br>DATEDIFF(日期<span class="hljs-number">1</span>, 日期<span class="hljs-number">2</span>)   <span class="hljs-comment">-- 日期差</span><br>​<br>条件函数<br><span class="hljs-keyword">CASE</span><br>    <span class="hljs-keyword">WHEN</span> 条件<span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> 结果<span class="hljs-number">1</span><br>    <span class="hljs-keyword">WHEN</span> 条件<span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span> 结果<span class="hljs-number">2</span><br>    <span class="hljs-keyword">ELSE</span> 默认结果<br><span class="hljs-keyword">END</span><br><br><span class="hljs-built_in">COALESCE</span>(值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, ...)   <span class="hljs-comment">-- 返回第一个非NULL值</span><br><span class="hljs-built_in">NULLIF</span>(值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>)          <span class="hljs-comment">-- 两值相等返回NULL</span><br>IF(条件, 真值, 假值)       <span class="hljs-comment">-- 简单条件判断</span><br></code></pre></td></tr></table></figure>
<p>​<br />
十、排序与分页</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><br>排序<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 列<span class="hljs-number">1</span> [<span class="hljs-keyword">ASC</span><span class="hljs-operator">|</span><span class="hljs-keyword">DESC</span>], 列<span class="hljs-number">2</span> [<span class="hljs-keyword">ASC</span><span class="hljs-operator">|</span><span class="hljs-keyword">DESC</span>]<br>​<br>分页（语法因数据库而异）<br><span class="hljs-comment">-- MySQL/PostgreSQL</span><br>LIMIT 行数 <span class="hljs-keyword">OFFSET</span> 跳过行数<br>LIMIT 跳过行数, 行数<br><br><span class="hljs-comment">-- SQL Server/Oracle 12c+</span><br><span class="hljs-keyword">OFFSET</span> 跳过行数 <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">FETCH</span> NEXT 行数 <span class="hljs-keyword">ROWS</span> <span class="hljs-keyword">ONLY</span><br></code></pre></td></tr></table></figure>
<h3 id="dcl控制权限"><a href="#dcl控制权限" class="headerlink" title="dcl控制权限"></a><a class="markdownIt-Anchor" href="#dcl控制权限"></a> DCL（控制权限）</h3>
<p>一、用户管理</p>
<p>创建用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> 用户名 IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;密码&#x27;</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> 用户名@主机 IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;密码&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>修改用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> 用户名 IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;新密码&#x27;</span>;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> 用户名 ACCOUNT LOCK<span class="hljs-operator">/</span>UNLOCK;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> 用户名 PASSWORD EXPIRE;<br>RENAME <span class="hljs-keyword">USER</span> 旧用户名 <span class="hljs-keyword">TO</span> 新用户名;<br></code></pre></td></tr></table></figure>
<p>删除用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> 用户名;<br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> 用户名@主机;<br></code></pre></td></tr></table></figure>
<p>二、权限管理</p>
<p>权限类型概览</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 数据权限</span><br><span class="hljs-keyword">SELECT</span>     <span class="hljs-comment">-- 查询</span><br><span class="hljs-keyword">INSERT</span>     <span class="hljs-comment">-- 插入</span><br><span class="hljs-keyword">UPDATE</span>     <span class="hljs-comment">-- 更新</span><br><span class="hljs-keyword">DELETE</span>     <span class="hljs-comment">-- 删除</span><br><span class="hljs-keyword">REFERENCES</span> <span class="hljs-comment">-- 外键引用</span><br><br><span class="hljs-comment">-- 结构权限</span><br><span class="hljs-keyword">CREATE</span>     <span class="hljs-comment">-- 创建对象</span><br><span class="hljs-keyword">ALTER</span>      <span class="hljs-comment">-- 修改结构</span><br><span class="hljs-keyword">DROP</span>       <span class="hljs-comment">-- 删除对象</span><br>INDEX      <span class="hljs-comment">-- 索引操作</span><br><br><span class="hljs-comment">-- 系统权限</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span>     <span class="hljs-comment">-- 创建用户</span><br><span class="hljs-keyword">GRANT</span> OPTION    <span class="hljs-comment">-- 授权权限</span><br>SHUTDOWN        <span class="hljs-comment">-- 关闭数据库</span><br>SUPER           <span class="hljs-comment">-- 超级权限</span><br></code></pre></td></tr></table></figure>
<p>授予权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 授予特定权限</span><br><span class="hljs-keyword">GRANT</span> 权限列表 <span class="hljs-keyword">ON</span> 对象 <span class="hljs-keyword">TO</span> 用户;<br><br><span class="hljs-comment">-- 授予所有权限</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> 对象 <span class="hljs-keyword">TO</span> 用户;<br><br><span class="hljs-comment">-- 授予带授权权限</span><br><span class="hljs-keyword">GRANT</span> 权限 <span class="hljs-keyword">ON</span> 对象 <span class="hljs-keyword">TO</span> 用户 <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> OPTION;<br></code></pre></td></tr></table></figure>
<p>权限列表格式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 单个权限</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> 表名 <span class="hljs-keyword">TO</span> 用户名;<br><br><span class="hljs-comment">-- 多个权限</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>, <span class="hljs-keyword">INSERT</span>, <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">ON</span> 表名 <span class="hljs-keyword">TO</span> 用户名;<br><br><span class="hljs-comment">-- 所有表权限</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">ON</span> 数据库名.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> 用户名;<br><br><span class="hljs-comment">-- 特定列权限</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>(列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>), <span class="hljs-keyword">UPDATE</span>(列<span class="hljs-number">1</span>) <span class="hljs-keyword">ON</span> 表名 <span class="hljs-keyword">TO</span> 用户名;<br></code></pre></td></tr></table></figure>
<p>撤销权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 撤销特定权限</span><br><span class="hljs-keyword">REVOKE</span> 权限列表 <span class="hljs-keyword">ON</span> 对象 <span class="hljs-keyword">FROM</span> 用户;<br><br><span class="hljs-comment">-- 撤销所有权限</span><br><span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> 对象 <span class="hljs-keyword">FROM</span> 用户;<br><br><span class="hljs-comment">-- 撤销授权权限</span><br><span class="hljs-keyword">REVOKE</span> <span class="hljs-keyword">GRANT</span> OPTION <span class="hljs-keyword">ON</span> 对象 <span class="hljs-keyword">FROM</span> 用户;<br></code></pre></td></tr></table></figure>
<p>三、对象作用域</p>
<p>权限作用域级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 全局级别</span><br><span class="hljs-keyword">GRANT</span> 权限 <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> 用户;<br><br><span class="hljs-comment">-- 数据库级别</span><br><span class="hljs-keyword">GRANT</span> 权限 <span class="hljs-keyword">ON</span> 数据库名.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> 用户;<br><br><span class="hljs-comment">-- 表级别</span><br><span class="hljs-keyword">GRANT</span> 权限 <span class="hljs-keyword">ON</span> 数据库名.表名 <span class="hljs-keyword">TO</span> 用户;<br><br><span class="hljs-comment">-- 列级别</span><br><span class="hljs-keyword">GRANT</span> 权限(列名) <span class="hljs-keyword">ON</span> 表名 <span class="hljs-keyword">TO</span> 用户;<br><br><span class="hljs-comment">-- 存储过程级别</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">PROCEDURE</span> 过程名 <span class="hljs-keyword">TO</span> 用户;<br></code></pre></td></tr></table></figure>
<p>四、角色管理</p>
<p>创建与管理角色</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> ROLE 角色名;<br><span class="hljs-keyword">DROP</span> ROLE 角色名;<br><span class="hljs-keyword">GRANT</span> 角色 <span class="hljs-keyword">TO</span> 用户;<br><span class="hljs-keyword">REVOKE</span> 角色 <span class="hljs-keyword">FROM</span> 用户;<br><span class="hljs-keyword">SET</span> ROLE 角色名;<br></code></pre></td></tr></table></figure>
<p>角色权限分配</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GRANT</span> 权限 <span class="hljs-keyword">ON</span> 对象 <span class="hljs-keyword">TO</span> 角色;<br><span class="hljs-keyword">REVOKE</span> 权限 <span class="hljs-keyword">ON</span> 对象 <span class="hljs-keyword">FROM</span> 角色;<br></code></pre></td></tr></table></figure>
<p>五、权限查看</p>
<p>查询权限信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看用户权限</span><br><span class="hljs-keyword">SHOW</span> GRANTS <span class="hljs-keyword">FOR</span> 用户名;<br><br><span class="hljs-comment">-- 查看当前用户权限</span><br><span class="hljs-keyword">SHOW</span> GRANTS;<br><br><span class="hljs-comment">-- 查看角色权限</span><br><span class="hljs-keyword">SHOW</span> GRANTS <span class="hljs-keyword">FOR</span> 角色名;<br><br><span class="hljs-comment">-- 系统表查询（具体表名因数据库而异）</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> 权限相关系统表;<br></code></pre></td></tr></table></figure>
<p>六、其他控制语句</p>
<p>密码策略</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> 用户名 PASSWORD EXPIRE;           <span class="hljs-comment">-- 密码过期</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> 用户名 PASSWORD EXPIRE NEVER;     <span class="hljs-comment">-- 永不过期</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> 用户名 PASSWORD EXPIRE <span class="hljs-type">INTERVAL</span> N <span class="hljs-keyword">DAY</span>; <span class="hljs-comment">-- N天后过期</span><br></code></pre></td></tr></table></figure>
<p>账户锁定</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> 用户名 ACCOUNT LOCK;    <span class="hljs-comment">-- 锁定账户</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> 用户名 ACCOUNT UNLOCK;  <span class="hljs-comment">-- 解锁账户</span><br></code></pre></td></tr></table></figure>
<p>连接限制</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> 用户名 <span class="hljs-keyword">WITH</span> MAX_CONNECTIONS_PER_HOUR N;<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> 用户名 <span class="hljs-keyword">WITH</span> MAX_USER_CONNECTIONS N;<br></code></pre></td></tr></table></figure>
<hr />
<p>​</p>
<h3 id="tcl管理事务"><a href="#tcl管理事务" class="headerlink" title="tcl管理事务"></a><a class="markdownIt-Anchor" href="#tcl管理事务"></a> TCL（管理事务）</h3>
<p>一、事务基本控制</p>
<p>开启事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 标准语法</span><br><span class="hljs-keyword">BEGIN</span> TRANSACTION;<br><span class="hljs-comment">-- 或</span><br><span class="hljs-keyword">START</span> TRANSACTION;<br><br><span class="hljs-comment">-- 简写</span><br><span class="hljs-keyword">BEGIN</span>;<br><br><span class="hljs-comment">-- 设置隔离级别开启（部分数据库）</span><br><span class="hljs-keyword">SET</span> TRANSACTION ISOLATION LEVEL 级别;<br></code></pre></td></tr></table></figure>
<p>提交事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">COMMIT</span>;<br><span class="hljs-keyword">COMMIT</span> WORK;<br></code></pre></td></tr></table></figure>
<p>回滚事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ROLLBACK</span>;<br><span class="hljs-keyword">ROLLBACK</span> WORK;<br><br><span class="hljs-comment">-- 回滚到指定保存点</span><br><span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TO</span> 保存点名;<br><span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TO</span> <span class="hljs-keyword">SAVEPOINT</span> 保存点名;<br></code></pre></td></tr></table></figure>
<p>二、保存点控制</p>
<p>创建保存点</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SAVEPOINT</span> 保存点名;<br></code></pre></td></tr></table></figure>
<p>删除保存点</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">RELEASE</span> <span class="hljs-keyword">SAVEPOINT</span> 保存点名;<br></code></pre></td></tr></table></figure>
<p>三、事务特性设置</p>
<p>设置事务特性</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> TRANSACTION<br>[ISOLATION LEVEL 级别]<br>[READ <span class="hljs-keyword">ONLY</span> <span class="hljs-operator">|</span> READ WRITE]<br>[DIAGNOSTICS SIZE 大小];<br></code></pre></td></tr></table></figure>
<p>隔离级别设置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> TRANSACTION ISOLATION LEVEL<br>    READ UNCOMMITTED <span class="hljs-operator">|</span><br>    READ COMMITTED <span class="hljs-operator">|</span><br>    REPEATABLE READ <span class="hljs-operator">|</span><br>    SERIALIZABLE;<br><br><span class="hljs-comment">-- 会话级别设置</span><br><span class="hljs-keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL 级别;<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL 级别;<br></code></pre></td></tr></table></figure>
<p>访问模式设置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> TRANSACTION READ <span class="hljs-keyword">ONLY</span>;   <span class="hljs-comment">-- 只读事务</span><br><span class="hljs-keyword">SET</span> TRANSACTION READ WRITE;  <span class="hljs-comment">-- 读写事务</span><br></code></pre></td></tr></table></figure>
<p>四、事务状态控制</p>
<p>设置约束检查</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SET</span> CONSTRAINTS <span class="hljs-keyword">ALL</span> DEFERRED;   <span class="hljs-comment">-- 延迟检查</span><br><span class="hljs-keyword">SET</span> CONSTRAINTS <span class="hljs-keyword">ALL</span> IMMEDIATE;  <span class="hljs-comment">-- 立即检查</span><br><span class="hljs-keyword">SET</span> CONSTRAINTS 约束名 DEFERRED;<br></code></pre></td></tr></table></figure>
<p>设置事务超时</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- PostgreSQL示例</span><br><span class="hljs-keyword">START</span> TRANSACTION;<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">LOCAL</span> lock_timeout <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;2s&#x27;</span>;<br><br><span class="hljs-comment">-- 其他数据库类似语法</span><br><span class="hljs-keyword">SET</span> LOCK_TIMEOUT 毫秒数;<br></code></pre></td></tr></table></figure>
<p>五、两阶段提交（分布式事务）</p>
<p>准备阶段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">PREPARE</span> TRANSACTION <span class="hljs-string">&#x27;事务ID&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>提交/回滚预备事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">COMMIT</span> PREPARED <span class="hljs-string">&#x27;事务ID&#x27;</span>;<br><span class="hljs-keyword">ROLLBACK</span> PREPARED <span class="hljs-string">&#x27;事务ID&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>六、事务控制函数</p>
<p>事务信息查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 获取当前事务ID</span><br><span class="hljs-keyword">SELECT</span> txid_current();<br><br><span class="hljs-comment">-- 检查是否在事务中</span><br><span class="hljs-keyword">SELECT</span> in_transaction();<br><br><span class="hljs-comment">-- 获取事务时间戳</span><br><span class="hljs-keyword">SELECT</span> transaction_timestamp();<br><span class="hljs-keyword">SELECT</span> now();  <span class="hljs-comment">-- 事务开始时间</span><br><span class="hljs-keyword">SELECT</span> clock_timestamp();  <span class="hljs-comment">-- 实时时间</span><br></code></pre></td></tr></table></figure>
<p>七、锁控制（相关TCL操作）</p>
<p>显式加锁</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;       <span class="hljs-comment">-- 排他锁</span><br><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FOR</span> SHARE;        <span class="hljs-comment">-- 共享锁</span><br><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">NO</span> KEY <span class="hljs-keyword">UPDATE</span>;<br><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FOR</span> KEY SHARE;<br><br><span class="hljs-comment">-- 表级锁</span><br>LOCK <span class="hljs-keyword">TABLE</span> 表名 <span class="hljs-keyword">IN</span> 锁模式;<br></code></pre></td></tr></table></figure>
<p>锁模式类型</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">ACCESS SHARE         <span class="hljs-comment">-- 最低级别锁</span><br><span class="hljs-type">ROW</span> SHARE            <span class="hljs-comment">-- 行共享锁</span><br><span class="hljs-type">ROW</span> EXCLUSIVE        <span class="hljs-comment">-- 行排他锁</span><br>SHARE <span class="hljs-keyword">UPDATE</span> EXCLUSIVE<br>SHARE                <span class="hljs-comment">-- 共享锁</span><br>SHARE <span class="hljs-type">ROW</span> EXCLUSIVE<br>EXCLUSIVE            <span class="hljs-comment">-- 排他锁</span><br>ACCESS EXCLUSIVE     <span class="hljs-comment">-- 最高级别锁</span><br></code></pre></td></tr></table></figure>
<hr />
<h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a><a class="markdownIt-Anchor" href="#mysql"></a> MySQL</h2>
<h3 id="mysql-2"><a href="#mysql-2" class="headerlink" title="mysql-2"></a><a class="markdownIt-Anchor" href="#mysql-2"></a> MySQL</h3>
<h4 id="一-mysql-特有数据类型"><a href="#一-mysql-特有数据类型" class="headerlink" title="一-mysql-特有数据类型"></a><a class="markdownIt-Anchor" href="#一-mysql-特有数据类型"></a> 一、MySQL 特有数据类型</h4>
<ol>
<li>数值类型扩展</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 整数类型（有符号/无符号）</span><br>TINYINT      <span class="hljs-comment">-- 1字节 (-128~127 或 0~255)</span><br><span class="hljs-type">SMALLINT</span>     <span class="hljs-comment">-- 2字节</span><br>MEDIUMINT    <span class="hljs-comment">-- 3字节</span><br><span class="hljs-type">INT</span><span class="hljs-operator">/</span><span class="hljs-type">INTEGER</span>  <span class="hljs-comment">-- 4字节</span><br><span class="hljs-type">BIGINT</span>       <span class="hljs-comment">-- 8字节</span><br><br><span class="hljs-comment">-- 使用UNSIGNED（MySQL特有）</span><br><span class="hljs-keyword">CREATE TABLE</span> t (<br>    id <span class="hljs-type">INT</span> UNSIGNED AUTO_INCREMENT,<br>    age TINYINT UNSIGNED<br>);<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>字符串类型扩展</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- TEXT类型细分（MySQL特有）</span><br>TINYTEXT    <span class="hljs-comment">-- 最多255字节</span><br>TEXT        <span class="hljs-comment">-- 最多65,535字节</span><br>MEDIUMTEXT  <span class="hljs-comment">-- 最多16,777,215字节</span><br>LONGTEXT    <span class="hljs-comment">-- 最多4GB</span><br><br><span class="hljs-comment">-- ENUM和SET类型（MySQL特有）</span><br><span class="hljs-keyword">CREATE TABLE</span> users (<br>    gender ENUM(<span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-string">&#x27;其他&#x27;</span>),  <span class="hljs-comment">-- 单选</span><br>    hobbies <span class="hljs-keyword">SET</span>(<span class="hljs-string">&#x27;读书&#x27;</span>, <span class="hljs-string">&#x27;运动&#x27;</span>, <span class="hljs-string">&#x27;音乐&#x27;</span>, <span class="hljs-string">&#x27;游戏&#x27;</span>)  <span class="hljs-comment">-- 多选</span><br>);<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>时间类型扩展</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">YEAR</span>        <span class="hljs-comment">-- 年份（1901-2155）</span><br><span class="hljs-comment">-- MySQL特有，1字节存储</span><br></code></pre></td></tr></table></figure>
<p>二、MySQL 特有语法</p>
<ol>
<li>AUTO_INCREMENT（自增）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 标准语法</span><br><span class="hljs-keyword">CREATE TABLE</span> users (<br>    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY KEY</span> AUTO_INCREMENT,<br>    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>)<br>);<br><br><span class="hljs-comment">-- MySQL设置自增起始值</span><br><span class="hljs-keyword">ALTER TABLE</span> users AUTO_INCREMENT <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br><br><span class="hljs-comment">-- 查看下一个自增值</span><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">TABLE</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;users&#x27;</span>;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>ENGINE 存储引擎</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 指定存储引擎（MySQL特有）</span><br><span class="hljs-keyword">CREATE TABLE</span> t1 (<br>    id <span class="hljs-type">INT</span><br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;<br><br><span class="hljs-comment">-- 常用引擎</span><br>ENGINE<span class="hljs-operator">=</span>InnoDB    <span class="hljs-comment">-- 默认，支持事务</span><br>ENGINE<span class="hljs-operator">=</span>MyISAM    <span class="hljs-comment">-- 旧版默认，全文索引</span><br>ENGINE<span class="hljs-operator">=</span>MEMORY    <span class="hljs-comment">-- 内存表</span><br>ENGINE<span class="hljs-operator">=</span>ARCHIVE   <span class="hljs-comment">-- 归档存储</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>字符集与校对规则</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 设置字符集（MySQL详细控制）</span><br><span class="hljs-keyword">CREATE</span> DATABASE db<br><span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARACTER SET</span> utf8mb4<br><span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci;<br><br><span class="hljs-comment">-- 表级别设置</span><br><span class="hljs-keyword">CREATE TABLE</span> t (<br>    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>)<br>) <span class="hljs-keyword">CHARACTER SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_bin;<br><br><span class="hljs-comment">-- 列级别设置</span><br><span class="hljs-keyword">CREATE TABLE</span> t (<br>    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">CHARACTER SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_bin<br>);<br></code></pre></td></tr></table></figure>
<h4 id="三-mysql-查询扩展"><a href="#三-mysql-查询扩展" class="headerlink" title="三-mysql-查询扩展"></a><a class="markdownIt-Anchor" href="#三-mysql-查询扩展"></a> 三、MySQL 查询扩展</h4>
<ol>
<li>LIMIT 分页（MySQL简化语法）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 标准SQL分页</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users LIMIT <span class="hljs-number">10</span> <span class="hljs-keyword">OFFSET</span> <span class="hljs-number">20</span>;<br><br><span class="hljs-comment">-- MySQL特有简化写法</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users LIMIT <span class="hljs-number">20</span>, <span class="hljs-number">10</span>;  <span class="hljs-comment">-- 跳过20行，取10行</span><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>正则表达式</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- REGEXP运算符（MySQL扩展）</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username REGEXP <span class="hljs-string">&#x27;^[A-Z]&#x27;</span>;  <span class="hljs-comment">-- 以大写开头</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> email REGEXP <span class="hljs-string">&#x27;@gmail\\.com$&#x27;</span>;  <span class="hljs-comment">-- gmail结尾</span><br><br><span class="hljs-comment">-- 不区分大小写</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> username REGEXP <span class="hljs-type">BINARY</span> <span class="hljs-string">&#x27;^[a-z]&#x27;</span>;  <span class="hljs-comment">-- 区分大小写</span><br><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>全文检索（MyISAM/InnoDB）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建全文索引</span><br><span class="hljs-keyword">CREATE TABLE</span> articles (<br>    id <span class="hljs-type">INT</span>,<br>    title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),<br>    content TEXT,<br>    FULLTEXT(title, content)  <span class="hljs-comment">-- 全文索引</span><br>) ENGINE<span class="hljs-operator">=</span>InnoDB;<br><br><span class="hljs-comment">-- 使用MATCH...AGAINST搜索</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> articles<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(title, content) AGAINST(<span class="hljs-string">&#x27;数据库 教程&#x27;</span> <span class="hljs-keyword">IN</span> <span class="hljs-keyword">NATURAL</span> <span class="hljs-keyword">LANGUAGE</span> MODE);<br><br><span class="hljs-comment">-- 布尔模式搜索</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> articles<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(title, content) AGAINST(<span class="hljs-string">&#x27;+MySQL -Oracle&#x27;</span> <span class="hljs-keyword">IN</span> <span class="hljs-type">BOOLEAN</span> MODE);<br></code></pre></td></tr></table></figure>
<h4 id="四-mysql-函数扩展"><a href="#四-mysql-函数扩展" class="headerlink" title="四-mysql-函数扩展"></a><a class="markdownIt-Anchor" href="#四-mysql-函数扩展"></a> 四、MySQL 函数扩展</h4>
<ol>
<li>字符串函数</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- MySQL特有字符串函数</span><br><span class="hljs-keyword">SELECT</span> CONCAT_WS(<span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;2024&#x27;</span>, <span class="hljs-string">&#x27;01&#x27;</span>, <span class="hljs-string">&#x27;15&#x27;</span>);  <span class="hljs-comment">-- 2024-01-15</span><br><span class="hljs-keyword">SELECT</span> GROUP_CONCAT(username SEPARATOR <span class="hljs-string">&#x27;, &#x27;</span>) <span class="hljs-keyword">FROM</span> users;  <span class="hljs-comment">-- 合并为一行</span><br><span class="hljs-keyword">SELECT</span> IFNULL(email, <span class="hljs-string">&#x27;无邮箱&#x27;</span>) <span class="hljs-keyword">FROM</span> users;  <span class="hljs-comment">-- 空值替换</span><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>流程控制函数</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- IF函数（三元运算）</span><br><span class="hljs-keyword">SELECT</span> username, IF(age<span class="hljs-operator">&gt;=</span><span class="hljs-number">18</span>, <span class="hljs-string">&#x27;成年&#x27;</span>, <span class="hljs-string">&#x27;未成年&#x27;</span>) <span class="hljs-keyword">AS</span> 状态 <span class="hljs-keyword">FROM</span> users;<br><br><span class="hljs-comment">-- 日期格式化</span><br><span class="hljs-keyword">SELECT</span> DATE_FORMAT(NOW(), <span class="hljs-string">&#x27;%Y年%m月%d日 %H:%i:%s&#x27;</span>);  <span class="hljs-comment">-- 2024年01月15日 14:30:25</span><br><span class="hljs-keyword">SELECT</span> DATE_FORMAT(birthday, <span class="hljs-string">&#x27;%W, %M %e, %Y&#x27;</span>) <span class="hljs-keyword">FROM</span> users;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>窗口函数（MySQL 8.0+）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- ROW_NUMBER() 行号</span><br><span class="hljs-keyword">SELECT</span><br>    username,<br>    age,<br>    <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> 排名<br><span class="hljs-keyword">FROM</span> users;<br><br><span class="hljs-comment">-- RANK() 和 DENSE_RANK()</span><br><span class="hljs-keyword">SELECT</span><br>    username,<br>    age,<br>    <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rank_num,<br>    <span class="hljs-built_in">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> age <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> dense_rank_num<br><span class="hljs-keyword">FROM</span> users;<br></code></pre></td></tr></table></figure>
<p>五、MySQL 系统管理与维护</p>
<ol>
<li>系统变量操作</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看系统变量</span><br><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%timeout%&#x27;</span>;<br><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@global</span>.wait_timeout;<br><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@session</span>.sql_mode;<br><br><span class="hljs-comment">-- 设置变量（会话级）</span><br><span class="hljs-keyword">SET</span> SESSION sql_mode <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;STRICT_TRANS_TABLES&#x27;</span>;<br><span class="hljs-keyword">SET</span> @<span class="hljs-variable">@session</span>.wait_timeout <span class="hljs-operator">=</span> <span class="hljs-number">600</span>;<br><br><span class="hljs-comment">-- 设置变量（全局级，需要权限）</span><br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> max_connections <span class="hljs-operator">=</span> <span class="hljs-number">500</span>;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>用户与权限管理</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 创建用户（MySQL语法）</span><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;user1&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;password123&#x27;</span>;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;user2&#x27;</span>@<span class="hljs-string">&#x27;192.168.1.%&#x27;</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;password&#x27;</span>;<br><br><span class="hljs-comment">-- 授权（详细控制）</span><br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>, <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> learn_sql.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;user1&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> db1.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;user2&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> OPTION;<br><br><span class="hljs-comment">-- 查看权限</span><br><span class="hljs-keyword">SHOW</span> GRANTS <span class="hljs-keyword">FOR</span> <span class="hljs-string">&#x27;user1&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span>;<br><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>备份与恢复</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- mysqldump命令（命令行工具）</span><br># 备份整个数据库<br>mysqldump <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p learn_sql <span class="hljs-operator">&gt;</span> backup.sql<br><br># 备份特定表<br>mysqldump <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p learn_sql users orders <span class="hljs-operator">&gt;</span> tables.sql<br><br># 只备份结构<br>mysqldump <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p <span class="hljs-comment">--no-data learn_sql &gt; structure.sql</span><br></code></pre></td></tr></table></figure>
<h4 id="六-mysql-性能与优化"><a href="#六-mysql-性能与优化" class="headerlink" title="六-mysql-性能与优化"></a><a class="markdownIt-Anchor" href="#六-mysql-性能与优化"></a> 六、MySQL 性能与优化</h4>
<ol>
<li>执行计划分析</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- EXPLAIN输出详细（MySQL特有信息）</span><br>EXPLAIN FORMAT<span class="hljs-operator">=</span>JSON <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>;<br><br><span class="hljs-comment">-- 查看索引使用情况</span><br>EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users USE INDEX(age_index) <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>索引提示</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 强制使用索引</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users FORCE INDEX (idx_age) <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>;<br><br><span class="hljs-comment">-- 忽略索引</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users IGNORE INDEX (idx_age) <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>;<br><br><span class="hljs-comment">-- 建议使用索引</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users USE INDEX (idx_age) <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>查询缓存（MySQL 8.0已移除）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- MySQL 5.7及之前版本</span><br><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;query_cache%&#x27;</span>;<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> query_cache_size <span class="hljs-operator">=</span> <span class="hljs-number">67108864</span>;<br></code></pre></td></tr></table></figure>
<h4 id="七-mysql-事务与锁"><a href="#七-mysql-事务与锁" class="headerlink" title="七-mysql-事务与锁"></a><a class="markdownIt-Anchor" href="#七-mysql-事务与锁"></a> 七、MySQL 事务与锁</h4>
<ol>
<li>事务隔离级别</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看当前隔离级别</span><br><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@transaction_isolation</span>;  <span class="hljs-comment">-- MySQL 8.0+</span><br><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@tx_isolation</span>;           <span class="hljs-comment">-- MySQL 5.7</span><br><br><span class="hljs-comment">-- 设置隔离级别</span><br><span class="hljs-keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL REPEATABLE READ;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>表锁定（MyISAM）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 手动锁定表</span><br>LOCK TABLES users READ, orders WRITE;<br><span class="hljs-comment">-- 执行操作...</span><br>UNLOCK TABLES;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>行锁查看（InnoDB）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看当前锁信息</span><br><span class="hljs-keyword">SHOW</span> ENGINE INNODB STATUS\\G<br><br><span class="hljs-comment">-- 查看锁等待</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_LOCKS;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_LOCK_WAITS;<br></code></pre></td></tr></table></figure>
<h4 id="八-mysql-安全注意事项"><a href="#八-mysql-安全注意事项" class="headerlink" title="八-mysql-安全注意事项"></a><a class="markdownIt-Anchor" href="#八-mysql-安全注意事项"></a> 八、MySQL 安全注意事项</h4>
<ol>
<li>SQL Mode 严格模式</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 推荐设置（防止无效数据）</span><br><span class="hljs-keyword">SET</span> sql_mode <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION&#x27;</span>;<br><br><span class="hljs-comment">-- 查看当前模式</span><br><span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@sql_mode</span>;<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>密码策略</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 密码验证插件</span><br>INSTALL PLUGIN validate_password SONAME <span class="hljs-string">&#x27;validate_password.so&#x27;</span>;<br><br><span class="hljs-comment">-- 查看密码策略</span><br><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;validate_password%&#x27;</span>;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>安全连接</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- SSL连接</span><br>mysql <span class="hljs-comment">--ssl-mode=REQUIRED -u root -p</span><br><br><span class="hljs-comment">-- 查看SSL状态</span><br><span class="hljs-keyword">SHOW</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;Ssl_cipher&#x27;</span>;<br></code></pre></td></tr></table></figure>
<h4 id="九-mysql-实用技巧"><a href="#九-mysql-实用技巧" class="headerlink" title="九-mysql-实用技巧"></a><a class="markdownIt-Anchor" href="#九-mysql-实用技巧"></a> 九、MySQL 实用技巧</h4>
<ol>
<li>批量插入优化</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 多条VALUES（性能优化）</span><br><span class="hljs-keyword">INSERT INTO</span> users (username, age) <span class="hljs-keyword">VALUES</span><br>(<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-number">20</span>), (<span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-number">21</span>), (<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-number">22</span>), ...;<br><br><span class="hljs-comment">-- ON DUPLICATE KEY UPDATE</span><br><span class="hljs-keyword">INSERT INTO</span> users (id, username) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;Lnk&#x27;</span>)<br><span class="hljs-keyword">ON</span> DUPLICATE KEY <span class="hljs-keyword">UPDATE</span> username <span class="hljs-operator">=</span> <span class="hljs-keyword">VALUES</span>(username);<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>生成测试数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 使用序列生成</span><br><span class="hljs-keyword">INSERT INTO</span> users (username, age)<br><span class="hljs-keyword">SELECT</span><br>    CONCAT(<span class="hljs-string">&#x27;user&#x27;</span>, n) <span class="hljs-keyword">AS</span> username,<br>    <span class="hljs-built_in">FLOOR</span>(RAND() <span class="hljs-operator">*</span> <span class="hljs-number">50</span>) <span class="hljs-operator">+</span> <span class="hljs-number">18</span> <span class="hljs-keyword">AS</span> age<br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@row</span> :<span class="hljs-operator">=</span> <span class="hljs-variable">@row</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> n<br>    <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3</span>) t1,<br>         (<span class="hljs-keyword">SELECT</span> <span class="hljs-number">0</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">2</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-number">3</span>) t2,<br>         (<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@row</span> :<span class="hljs-operator">=</span> <span class="hljs-number">0</span>) r<br>) numbers<br>LIMIT <span class="hljs-number">100</span>;<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>常用元数据查询</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查看所有数据库大小</span><br><span class="hljs-keyword">SELECT</span><br>    table_schema <span class="hljs-keyword">AS</span> <span class="hljs-string">&#x27;数据库&#x27;</span>,<br>    ROUND(<span class="hljs-built_in">SUM</span>(data_length <span class="hljs-operator">+</span> index_length) <span class="hljs-operator">/</span> <span class="hljs-number">1024</span> <span class="hljs-operator">/</span> <span class="hljs-number">1024</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> <span class="hljs-string">&#x27;大小(MB)&#x27;</span><br><span class="hljs-keyword">FROM</span> information_schema.tables<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> table_schema;<br><br><span class="hljs-comment">-- 查看表状态</span><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">TABLE</span> STATUS <span class="hljs-keyword">FROM</span> learn_sql <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;users&#x27;</span>;<br></code></pre></td></tr></table></figure>
<hr />
<h4 id="必须记住的show命令"><a href="#必须记住的show命令" class="headerlink" title="必须记住的show命令"></a><a class="markdownIt-Anchor" href="#必须记住的show命令"></a> 必须记住的SHOW命令</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> DATABASES;                    <span class="hljs-comment">-- 所有数据库</span><br><span class="hljs-keyword">SHOW</span> TABLES;                       <span class="hljs-comment">-- 当前数据库所有表</span><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE TABLE</span> table_name;      <span class="hljs-comment">-- 查看建表语句</span><br><span class="hljs-keyword">SHOW</span> INDEX <span class="hljs-keyword">FROM</span> table_name;        <span class="hljs-comment">-- 查看索引</span><br><span class="hljs-keyword">SHOW</span> PROCESSLIST;                  <span class="hljs-comment">-- 查看连接进程</span><br><span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%pattern%&#x27;</span>;   <span class="hljs-comment">-- 查看系统变量</span><br><span class="hljs-keyword">SHOW</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%pattern%&#x27;</span>;      <span class="hljs-comment">-- 查看系统状态</span><br></code></pre></td></tr></table></figure>
<hr />
<h1 id="neo4j"><a href="#neo4j" class="headerlink" title="neo4j"></a><a class="markdownIt-Anchor" href="#neo4j"></a> Neo4j</h1>
<h2 id="一-neo4j基础概念"><a href="#一-neo4j基础概念" class="headerlink" title="一-neo4j基础概念"></a><a class="markdownIt-Anchor" href="#一-neo4j基础概念"></a> 一、Neo4j基础概念</h2>
<p>图数据库三要素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1. 节点 (Node)       = 实体<br>   - 标签 (Label)    : 类别，如 :User, :Computer<br>   - 属性 (Property) : 特征，如 &#123;name: &quot;Alice&quot;, age: 25&#125;<br><br>2. 关系 (Relationship) = 连接<br>   - 类型 (Type)     : 关系类型，如 :FOLLOWS, :OWNS<br>   - 方向 (Direction): → 或 ←<br>   - 属性 (Property) : 关系的特征<br><br>3. 路径 (Path)       = 节点和关系的序列<br></code></pre></td></tr></table></figure>
<p>与SQL概念对比</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">SQL           →     Neo4j<br>----------------------------<br>数据库(Database) →  图数据库(Graph Database)<br>表(Table)      →  标签(Label)<br>行(Row)        →  节点(Node)<br>列(Column)     →  属性(Property)<br>外键(Foreign Key) → 关系(Relationship)<br>JOIN查询        →  模式匹配(Pattern Matching)<br></code></pre></td></tr></table></figure>
<h2 id="二-cypher查询语言结构"><a href="#二-cypher查询语言结构" class="headerlink" title="二-cypher查询语言结构"></a><a class="markdownIt-Anchor" href="#二-cypher查询语言结构"></a> 二、Cypher查询语言结构</h2>
<p>Cypher语法模式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">(节点) - [关系] -&gt; (节点)<br></code></pre></td></tr></table></figure>
<p>基础结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 完整Cypher语句结构<br>[MATCH WHERE]           -- 查找数据（可选）<br>[OPTIONAL MATCH WHERE]  -- 可选查找<br>[WITH ORDER BY SKIP LIMIT] -- 中间处理<br>CREATE/MERGE            -- 创建数据<br>SET/REMOVE/DELETE       -- 修改数据<br>RETURN [ORDER BY SKIP LIMIT] -- 返回结果<br></code></pre></td></tr></table></figure>
<h2 id="三-数据操作crud"><a href="#三-数据操作crud" class="headerlink" title="三-数据操作crud"></a><a class="markdownIt-Anchor" href="#三-数据操作crud"></a> 三、数据操作（CRUD）</h2>
<ol>
<li>CREATE - 创建数据</li>
</ol>
<p>创建节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 创建带标签和属性的节点<br>CREATE (:Person &#123;name: &quot;Alice&quot;, age: 30&#125;)<br><br>-- 创建多个节点<br>CREATE (:Person &#123;name: &quot;Bob&quot;&#125;), (:Person &#123;name: &quot;Charlie&quot;&#125;)<br><br>-- 创建带多个标签的节点<br>CREATE (:User:Admin &#123;name: &quot;Admin&quot;, level: 5&#125;)<br></code></pre></td></tr></table></figure>
<p>创建关系</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 为现有节点创建关系<br>MATCH (a:Person &#123;name: &quot;Alice&quot;&#125;), (b:Person &#123;name: &quot;Bob&quot;&#125;)<br>CREATE (a)-[:FRIENDS_WITH &#123;since: 2020&#125;]-&gt;(b)<br><br>-- 同时创建节点和关系<br>CREATE (a:Person &#123;name: &quot;Alice&quot;&#125;)-[:KNOWS]-&gt;(b:Person &#123;name: &quot;Bob&quot;&#125;)<br></code></pre></td></tr></table></figure>
<ol>
<li>MATCH - 查询数据</li>
</ol>
<p>基础查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 查询所有节点<br>MATCH (n) RETURN n<br><br>-- 查询特定标签的节点<br>MATCH (p:Person) RETURN p<br><br>-- 查询带属性的节点<br>MATCH (p:Person &#123;name: &quot;Alice&quot;&#125;) RETURN p<br></code></pre></td></tr></table></figure>
<p>关系查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 查询关系<br>MATCH (:Person &#123;name: &quot;Alice&quot;&#125;)-[r]-&gt;(friend) RETURN friend<br><br>-- 查询特定类型的关系<br>MATCH (:Person)-[:FRIENDS_WITH]-&gt;(friend) RETURN friend<br><br>-- 查询双向关系<br>MATCH (a:Person)-[:FRIENDS_WITH]-(b:Person) RETURN a, b<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>WHERE - 条件过滤</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 基础条件<br>MATCH (p:Person) WHERE p.age &gt; 25 RETURN p<br><br>-- 字符串匹配<br>MATCH (p:Person) WHERE p.name STARTS WITH &#x27;A&#x27; RETURN p<br>MATCH (p:Person) WHERE p.name CONTAINS &#x27;lic&#x27; RETURN p<br>MATCH (p:Person) WHERE p.name ENDS WITH &#x27;e&#x27; RETURN p<br><br>-- 正则表达式<br>MATCH (p:Person) WHERE p.name =~ &#x27;.*Ali.*&#x27; RETURN p<br><br>-- 多条件<br>MATCH (p:Person) WHERE p.age &gt; 20 AND p.name CONTAINS &#x27;A&#x27; RETURN p<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>SET/REMOVE - 更新数据</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 更新属性<br>MATCH (p:Person &#123;name: &quot;Alice&quot;&#125;)<br>SET p.age = 31, p.city = &quot;Beijing&quot;<br>RETURN p<br><br>-- 添加标签<br>MATCH (p:Person &#123;name: &quot;Alice&quot;&#125;)<br>SET p:Admin<br>RETURN p<br><br>-- 移除属性<br>MATCH (p:Person &#123;name: &quot;Alice&quot;&#125;)<br>REMOVE p.city<br>RETURN p<br><br>-- 移除标签<br>MATCH (p:Person:Admin &#123;name: &quot;Alice&quot;&#125;)<br>REMOVE p:Admin<br>RETURN p<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>DELETE - 删除数据</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 删除节点（必须先删除关系）<br>MATCH (p:Person &#123;name: &quot;Bob&quot;&#125;)<br>DETACH DELETE p<br><br>-- 删除关系<br>MATCH (a:Person &#123;name: &quot;Alice&quot;&#125;)-[r:FRIENDS_WITH]-&gt;(b:Person &#123;name: &quot;Bob&quot;&#125;)<br>DELETE r<br></code></pre></td></tr></table></figure>
<ol start="5">
<li>MERGE - 创建或匹配</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 存在则匹配，不存在则创建<br>MERGE (p:Person &#123;name: &quot;Alice&quot;&#125;)<br>ON CREATE SET p.created = timestamp()<br>ON MATCH SET p.lastSeen = timestamp()<br>RETURN p<br><br>-- 合并关系<br>MATCH (a:Person &#123;name: &quot;Alice&quot;&#125;), (b:Person &#123;name: &quot;Bob&quot;&#125;)<br>MERGE (a)-[:FRIENDS_WITH]-&gt;(b)<br></code></pre></td></tr></table></figure>
<h2 id="四-高级查询"><a href="#四-高级查询" class="headerlink" title="四-高级查询"></a><a class="markdownIt-Anchor" href="#四-高级查询"></a> 四、高级查询</h2>
<ol>
<li>路径查询</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 可变长度路径<br>MATCH (a:Person &#123;name: &quot;Alice&quot;&#125;)-[:FRIENDS_WITH*1..3]-&gt;(friend)<br>RETURN friend<br><br>-- 最短路径<br>MATCH path = shortestPath(<br>  (a:Person &#123;name: &quot;Alice&quot;&#125;)<br>  -[:FRIENDS_WITH*1..10]-&gt;<br>  (b:Person &#123;name: &quot;David&quot;&#125;)<br>)<br>RETURN path, length(path) as distance<br><br>-- 所有路径<br>MATCH path = (a:Person &#123;name: &quot;Alice&quot;&#125;)-[:FRIENDS_WITH*]-&gt;(b:Person &#123;name: &quot;David&quot;&#125;)<br>RETURN path<br></code></pre></td></tr></table></figure>
<ol start="2">
<li>聚合函数</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 计数<br>MATCH (p:Person) RETURN count(p) as total_persons<br><br>-- 分组统计<br>MATCH (p:Person) RETURN p.city, count(p) as residents<br><br>-- 集合操作<br>MATCH (p:Person) RETURN collect(p.name) as all_names<br>MATCH (p:Person) RETURN collect(DISTINCT p.city) as cities<br></code></pre></td></tr></table></figure>
<ol start="3">
<li>排序和分页</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 排序<br>MATCH (p:Person) RETURN p ORDER BY p.age DESC<br><br>-- 分页<br>MATCH (p:Person) RETURN p SKIP 10 LIMIT 5<br><br>-- 组合<br>MATCH (p:Person)<br>RETURN p.name, p.age<br>ORDER BY p.age DESC<br>SKIP 0 LIMIT 10<br></code></pre></td></tr></table></figure>
<ol start="4">
<li>WITH子句（中间处理）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 管道式处理<br>MATCH (p:Person)<br>WITH p ORDER BY p.age DESC LIMIT 5<br>RETURN collect(p.name) as oldest_five<br><br>-- 聚合后过滤<br>MATCH (p:Person)<br>WITH p.city as city, count(p) as population<br>WHERE population &gt; 100<br>RETURN city, population<br></code></pre></td></tr></table></figure>
<h2 id="五-索引和约束"><a href="#五-索引和约束" class="headerlink" title="五-索引和约束"></a><a class="markdownIt-Anchor" href="#五-索引和约束"></a> 五、索引和约束</h2>
<p>创建索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 创建单属性索引<br>CREATE INDEX FOR (p:Person) ON (p.name)<br><br>-- 创建复合索引<br>CREATE INDEX FOR (p:Person) ON (p.name, p.age)<br><br>-- 全文索引<br>CREATE FULLTEXT INDEX personAndPlace FOR (p:Person|Place) ON EACH [p.name, p.description]<br></code></pre></td></tr></table></figure>
<p>创建约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 唯一性约束<br>CREATE CONSTRAINT FOR (p:Person) REQUIRE p.email IS UNIQUE<br><br>-- 存在性约束（企业版）<br>CREATE CONSTRAINT FOR (p:Person) REQUIRE p.name IS NOT NULL<br><br>-- 节点键约束<br>CREATE CONSTRAINT FOR (p:Person) REQUIRE (p.firstname, p.lastname) IS NODE KEY<br></code></pre></td></tr></table></figure>
<p>查看和删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 查看索引和约束<br>SHOW INDEXES<br>SHOW CONSTRAINTS<br><br>-- 删除索引<br>DROP INDEX index_name<br><br>-- 删除约束<br>DROP CONSTRAINT constraint_name<br></code></pre></td></tr></table></figure>
<h2 id="六-函数和操作符"><a href="#六-函数和操作符" class="headerlink" title="六-函数和操作符"></a><a class="markdownIt-Anchor" href="#六-函数和操作符"></a> 六、函数和操作符</h2>
<p>字符串函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">RETURN toString(123)                    -- &quot;123&quot;<br>RETURN toUpper(&quot;hello&quot;)                 -- &quot;HELLO&quot;<br>RETURN toLower(&quot;HELLO&quot;)                 -- &quot;hello&quot;<br>RETURN substring(&quot;hello&quot;, 1, 3)         -- &quot;ell&quot;<br>RETURN split(&quot;a,b,c&quot;, &quot;,&quot;)              -- [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]<br>RETURN replace(&quot;hello&quot;, &quot;l&quot;, &quot;w&quot;)       -- &quot;hewwo&quot;<br></code></pre></td></tr></table></figure>
<p>数值函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">RETURN round(3.1415)                    -- 3<br>RETURN ceil(3.14)                       -- 4<br>RETURN floor(3.9)                       -- 3<br>RETURN abs(-5)                          -- 5<br>RETURN rand()                           -- 随机数 0-1<br></code></pre></td></tr></table></figure>
<p>时间函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">RETURN datetime()                       -- 当前时间<br>RETURN date()                           -- 当前日期<br>RETURN timestamp()                      -- 时间戳（毫秒）<br>RETURN duration(&quot;P1Y2M10DT12H45M30S&quot;)   -- 持续时间<br></code></pre></td></tr></table></figure>
<p>列表函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">RETURN size([1,2,3])                    -- 3<br>RETURN head([1,2,3])                    -- 1<br>RETURN last([1,2,3])                    -- 3<br>RETURN tail([1,2,3])                    -- [2,3]<br>RETURN reverse([1,2,3])                 -- [3,2,1]<br></code></pre></td></tr></table></figure>
<p>关系函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">MATCH (a)-[r]-(b)<br>RETURN type(r)                          -- 关系类型<br>RETURN startNode(r)                     -- 起始节点<br>RETURN endNode(r)                       -- 结束节点<br>RETURN id(r)                            -- 关系ID<br></code></pre></td></tr></table></figure>
<h2 id="七-管理命令"><a href="#七-管理命令" class="headerlink" title="七-管理命令"></a><a class="markdownIt-Anchor" href="#七-管理命令"></a> 七、管理命令</h2>
<p>数据库管理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 查看数据库<br>SHOW DATABASES<br><br>-- 切换数据库（Neo4j 4.0+）<br>:USE database_name<br><br>-- 创建数据库（企业版）<br>CREATE DATABASE database_name<br><br>-- 删除数据库（企业版）<br>DROP DATABASE database_name<br></code></pre></td></tr></table></figure>
<p>用户和权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 创建用户（企业版）<br>CREATE USER username SET PASSWORD &#x27;password&#x27;<br><br>-- 修改密码<br>ALTER USER username SET PASSWORD &#x27;new_password&#x27;<br><br>-- 授予角色<br>GRANT ROLE reader, publisher TO username<br><br>-- 查看用户<br>SHOW USERS<br></code></pre></td></tr></table></figure>
<p>导入导出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 导入CSV<br>LOAD CSV WITH HEADERS FROM &#x27;file:///data.csv&#x27; AS row<br>CREATE (:Person &#123;name: row.name, age: toInteger(row.age)&#125;)<br><br>-- 导出数据（通过APOC插件）<br>CALL apoc.export.cypher.all(&#x27;export.cypher&#x27;, &#123;&#125;)<br><br>-- 备份（企业版）<br>BACKUP DATABASE neo4j TO &#x27;/backup/location&#x27;<br></code></pre></td></tr></table></figure>
<h2 id="八-bloodhound专用查询模式"><a href="#八-bloodhound专用查询模式" class="headerlink" title="八-bloodhound专用查询模式"></a><a class="markdownIt-Anchor" href="#八-bloodhound专用查询模式"></a> 八、Bloodhound专用查询模式</h2>
<p>AD域关系查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 查找域管理员<br>MATCH (g:Group &#123;name: &quot;DOMAIN ADMINS@DOMAIN.LOCAL&quot;&#125;)<br>RETURN g<br><br>-- 查找用户到域管理员的路径<br>MATCH p = shortestPath(<br>  (n:User)<br>  -[*1..]<br>  -&gt; (m:Group &#123;name: &quot;DOMAIN ADMINS@DOMAIN.LOCAL&quot;&#125;)<br>)<br>RETURN p LIMIT 5<br><br>-- 查找有Session的计算机<br>MATCH (c:Computer)-[:HasSession]-&gt;(u:User)<br>RETURN c.name, u.name<br><br>-- Kerberoastable用户<br>MATCH (u:User &#123;hasspn: true&#125;)<br>WHERE NOT u.owned<br>RETURN u.name, u.serviceprincipalnames<br></code></pre></td></tr></table></figure>
<p>攻击路径分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-- 最短特权提升路径<br>MATCH p = shortestPath(<br>  (start:User &#123;owned: true&#125;)<br>  -[*1..10]-&gt;<br>  (target:Group &#123;highvalue: true&#125;)<br>)<br>RETURN p, length(p) as distance<br>ORDER BY distance ASC<br><br>-- 权限传递链<br>MATCH (g1:Group)-[:MemberOf*1..5]-&gt;(g2:Group)<br>RETURN g1.name, g2.name<br></code></pre></td></tr></table></figure>
<h2 id="九-neo4j与mysql语法对比速查"><a href="#九-neo4j与mysql语法对比速查" class="headerlink" title="九-neo4j与mysql语法对比速查"></a><a class="markdownIt-Anchor" href="#九-neo4j与mysql语法对比速查"></a> 九、Neo4j与MySQL语法对比速查</h2>
<p>CRUD操作对比</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">操作      MySQL                    Neo4j (Cypher)<br>-----------------------------------------------------------<br>创建      INSERT INTO              CREATE (:Label &#123;prop: value&#125;)<br>查询      SELECT * FROM            MATCH (n:Label) RETURN n<br>更新      UPDATE SET               MATCH (n) SET n.prop = value<br>删除      DELETE FROM              MATCH (n) DETACH DELETE n<br>条件      WHERE                    WHERE<br>连接      JOIN ON                  MATCH (a)-[r]-(b)<br>分页      LIMIT offset, count      SKIP offset LIMIT count<br>排序      ORDER BY                 ORDER BY<br></code></pre></td></tr></table></figure>
<p>核心差异提醒</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">1. Neo4j没有&quot;表&quot;，只有&quot;标签&quot;<br>2. 关系是一等公民，不是外键<br>3. JOIN通过模式匹配自动完成<br>4. 数据模型更灵活，没有固定模式<br>5. 擅长深度关联查询，不适合大批量简单查询<br></code></pre></td></tr></table></figure><div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2026/02/24/%E5%9B%BE%E5%BD%A2%E5%AD%A6%E7%BC%96%E7%A8%8B/">← Next 图形学编程</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2026/02/22/python/">python Prev →</a></div></div></div><details id="reward"><summary>reward</summary><div><span>微信 | Wechat</span><br><img src="/images/WeChat.png"></div><div><span>支付宝 | Alipay</span><br><img src="/images/Alipay.png"></div></details><div id="comments"><div id="giscus"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" onClick="tocControl.change()" title="To Catalog"><span class="tocBtnIconBar"></span><span class="tocBtnIconBar"></span><span class="tocBtnIconBar"></span></a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a><a onclick="BgmControl()"><svg id="bgm-control" viewBox="0 0 30 34" fill="#18d1ff" style="width: 24px; transition: transform .3s;margin-top: 4px"><path d="M25.998 23.422V11.29h3.999v12.132h-3.999zM19.497 6.234h4.001v22.243h-4.001V6.234zM12.998.867h4v32.978h-4V.867zm-6.5 5.367h4.001v22.243H6.498V6.234zm-6.5 5.056h4v12.132h-4V11.29z"></path></svg><audio id="bgm" src="/audio/bgm.mp3" autoplay loop crossorigin="anonymous"> </audio></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/images/1.jpg" alt="Logo" style="margin:0;border-radius:0;"></a><h1 id="Dr"><a href="/">Lnk</a></h1><div id="description"><p></p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/Lnkqwq"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" href="3403583728@qq.com"><i class="fa fa-envelope" alt="E-Mail"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#sql"><span class="toc-number">1.</span> <span class="toc-text"> SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E5%9F%BA%E7%A1%80"><span class="toc-number">1.1.</span> <span class="toc-text"> SQL基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ddl%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.1.</span> <span class="toc-text"> DDL（定义结构）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dml%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.2.</span> <span class="toc-text"> DML（操作数据）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dql%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.3.</span> <span class="toc-text"> DQL（查询数据）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dcl%E6%8E%A7%E5%88%B6%E6%9D%83%E9%99%90"><span class="toc-number">1.1.4.</span> <span class="toc-text"> DCL（控制权限）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tcl%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.1.5.</span> <span class="toc-text"> TCL（管理事务）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql"><span class="toc-number">1.2.</span> <span class="toc-text"> MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql-2"><span class="toc-number">1.2.1.</span> <span class="toc-text"> MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80-mysql-%E7%89%B9%E6%9C%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.1.1.</span> <span class="toc-text"> 一、MySQL 特有数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89-mysql-%E6%9F%A5%E8%AF%A2%E6%89%A9%E5%B1%95"><span class="toc-number">1.2.1.2.</span> <span class="toc-text"> 三、MySQL 查询扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B-mysql-%E5%87%BD%E6%95%B0%E6%89%A9%E5%B1%95"><span class="toc-number">1.2.1.3.</span> <span class="toc-text"> 四、MySQL 函数扩展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%AD-mysql-%E6%80%A7%E8%83%BD%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="toc-number">1.2.1.4.</span> <span class="toc-text"> 六、MySQL 性能与优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%83-mysql-%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81"><span class="toc-number">1.2.1.5.</span> <span class="toc-text"> 七、MySQL 事务与锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%AB-mysql-%E5%AE%89%E5%85%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.2.1.6.</span> <span class="toc-text"> 八、MySQL 安全注意事项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%9D-mysql-%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7"><span class="toc-number">1.2.1.7.</span> <span class="toc-text"> 九、MySQL 实用技巧</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%85%E9%A1%BB%E8%AE%B0%E4%BD%8F%E7%9A%84show%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.1.8.</span> <span class="toc-text"> 必须记住的SHOW命令</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#neo4j"><span class="toc-number">2.</span> <span class="toc-text"> Neo4j</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-neo4j%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="toc-number">2.1.</span> <span class="toc-text"> 一、Neo4j基础概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-cypher%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.</span> <span class="toc-text"> 二、Cypher查询语言结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9Ccrud"><span class="toc-number">2.3.</span> <span class="toc-text"> 三、数据操作（CRUD）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.4.</span> <span class="toc-text"> 四、高级查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E7%B4%A2%E5%BC%95%E5%92%8C%E7%BA%A6%E6%9D%9F"><span class="toc-number">2.5.</span> <span class="toc-text"> 五、索引和约束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-%E5%87%BD%E6%95%B0%E5%92%8C%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">2.6.</span> <span class="toc-text"> 六、函数和操作符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83-%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="toc-number">2.7.</span> <span class="toc-text"> 七、管理命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB-bloodhound%E4%B8%93%E7%94%A8%E6%9F%A5%E8%AF%A2%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.8.</span> <span class="toc-text"> 八、Bloodhound专用查询模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D-neo4j%E4%B8%8Emysql%E8%AF%AD%E6%B3%95%E5%AF%B9%E6%AF%94%E9%80%9F%E6%9F%A5"><span class="toc-number">2.9.</span> <span class="toc-text"> 九、Neo4j与MySQL语法对比速查</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>
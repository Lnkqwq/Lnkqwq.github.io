<!DOCTYPE html><html lang="en" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Linux操作系统 | Hexo</title><meta name="keywords" content="Linux"><meta name="description" content="Linux文件系统  一、Linux文件系统层次结构 1.1 文件系统类型总览 123456789101112131415161718192021222324Linux支持的文件系统：├── 磁盘文件系统│   ├── ext2&#x2F;ext3&#x2F;ext4 (主流)│   ├── XFS (高性能)│   ├── Btrfs (高级特性)│   └── ZFS (企业级)│├── 闪存文件系统│   ├">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux操作系统">
<meta property="og:url" content="http://example.com/2026/01/26/Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Linux文件系统  一、Linux文件系统层次结构 1.1 文件系统类型总览 123456789101112131415161718192021222324Linux支持的文件系统：├── 磁盘文件系统│   ├── ext2&#x2F;ext3&#x2F;ext4 (主流)│   ├── XFS (高性能)│   ├── Btrfs (高级特性)│   └── ZFS (企业级)│├── 闪存文件系统│   ├">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2026-01-26T12:30:39.000Z">
<meta property="article:modified_time" content="2026-03-01T11:58:35.074Z">
<meta property="article:author" content="Lnk">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" as="font" crossorigin="anonymous" href="/font/Bender.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/font/BenderLight.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/font/JetBrainsMono-Regular.woff2"><link rel="stylesheet" href="/css/arknights.css"><style>@font-face {
  font-family: Bender;
  src: local('Bender'), url("/font/Bender.ttf"), url("/font/Bender.otf");
}
@font-face {
  font-family: BenderLight;
  src: local('BenderLight'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
  font-family: 'JetBrains Mono';
  src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}
</style><meta name="page-config" content="{&quot;code_fold&quot;:null}"><script class="pjax-js">var config = {"root":"/","code_fold":15,"search":{"preload":false,"activeHolder":"Enter here","blurHolder":"Search","noResult":"Data \"$0\" not found"},"code":{"codeInfo":"$0 - $1 lines","copy":"copy"}};
var page_config = {
  code_fold: null
};
function updatePageConfig() {
  var newPageConfig = document.querySelector('meta[name="page-config"]');
  if (newPageConfig) {
    page_config = JSON.parse(newPageConfig.content);
  }
}
document.addEventListener('pjax:complete', function() { updatePageConfig(); });
updatePageConfig();</script><link type="text/css" rel="stylesheet" href="/lib/encrypt/hbe.style.css"><script src="//unpkg.com/mermaid@11.12.2/dist/mermaid.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
 menuSettings: {
   zoom: "None"
 },
 showMathMenu: false,
 jax: ["input/TeX","output/CommonHTML"],
 extensions: ["tex2jax.js"],
 TeX: {
   extensions: ["AMSmath.js","AMSsymbols.js"],
   equationNumbers: {
     autoNumber: "AMS"
   }
 },
 tex2jax: {
   inlineMath: [["\\(", "\\)"]],
   displayMath: [["\\[", "\\]"]]
 }
});</script><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lightgallery.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-zoom.css"><link type="text/css" rel="stylesheet" href="//unpkg.com/lightgallery@2.7.1/css/lg-thumbnail.css"><link type="text/css" rel="stylesheet" href="/lib/fontawesome/css/all.min.css"><script>if (window.localStorage.getItem('theme-mode') === 'light')
 document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark')
 document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.woff2") format('woff2');
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><style>:root {
 --dark-background: url('/images/BK.PNG');
 --light-background: url('/images/BK.PNG');
 --theme-encrypt-confirm: 'confirm'
}</style><script defer src="/js/arknights.js"></script><script defer src="/js/search.js"></script><script defer type="module">import mermaid from '//unpkg.com/mermaid@11.12.2/dist/mermaid.esm.min.mjs';
window.mermaid = mermaid;
code.paintMermaid();
</script><script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.6.1/MathJax.js"></script><script>MathJax.Hub.Config({
  menuSettings: {
    zoom: "None"
  },
  showMathMenu: false,
  jax: ["input/TeX","output/CommonHTML"],
  extensions: ["tex2jax.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js"],
    equationNumbers: {
      autoNumber: "AMS"
    }
  },
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]]
  }
});
</script><script async src="//unpkg.com/lightgallery@2.7.1/lightgallery.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/zoom/lg-zoom.min.js"></script><script async src="//unpkg.com/lightgallery@2.7.1/plugins/thumbnail/lg-thumbnail.min.js"></script><script async src="/lib/encrypt/hbe.js"></script><script async src="/js/pjax.js"></script><script class="pjax-js">reset= () => {document.querySelector('.lg-container')?.remove()
lightGallery(document.getElementById('post-bg'), {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.vercount','meta[name=page-config]'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><script class="pjax-js">reset= () => {window.giscusSettings = {
 repo: 'Lnkqwq/Lnkqwq.github.io',
 repoId: 'R_kgDORZSSAA',
 category: '',
 categoryId: '',
 mapping: 'pathname',
 strict: '0',
 reactionsEnabled: '1',
 emitMetadata: '0',
 inputPosition: 'bottom',
 lang: 'zh-CN',
 crossorigin: 'anonymous' , loading: 'lazy'};window.giscusThemeConfig = { theme: 'preferred_color_scheme' };MathJax.Hub.Queue(["Typeset", MathJax.Hub]);document.querySelector('.lg-container')?.remove()
const postBg = document.querySelector('#post-bg');
if (postBg) lightGallery(postBg, {
  plugins: [lgZoom,lgThumbnail],
  selector: '.item-img'})}</script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js','data-pjax','.vercount','meta[name=page-config]'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div class="loading" style="opacity: 0;"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><div class="navBtn"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><nav><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Search" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup" tabindex="0"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>Linux操作系统</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2026-01-26T12:30:39.000Z" id="date"> 2026-01-26</time></div></span><br><span>Last Update: <div class="control"><time datetime="2026-03-01T11:58:35.074Z" id="updated"> 2026-03-01</time></div></span></div></div><hr><div id="post-content"><h1 id="linux文件系统"><a href="#linux文件系统" class="headerlink" title="linux文件系统"></a><a class="markdownIt-Anchor" href="#linux文件系统"></a> Linux文件系统</h1>
<h2 id="一-linux文件系统层次结构"><a href="#一-linux文件系统层次结构" class="headerlink" title="一-linux文件系统层次结构"></a><a class="markdownIt-Anchor" href="#一-linux文件系统层次结构"></a> 一、Linux文件系统层次结构</h2>
<p>1.1 文件系统类型总览</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">Linux支持的文件系统：<br>├── 磁盘文件系统<br>│   ├── ext2/ext3/ext4 (主流)<br>│   ├── XFS (高性能)<br>│   ├── Btrfs (高级特性)<br>│   └── ZFS (企业级)<br>│<br>├── 闪存文件系统<br>│   ├── F2FS (Flash Friendly)<br>│   └── JFFS2/UBIFS (嵌入式)<br>│<br>├── 网络文件系统<br>│   ├── NFS (Unix网络)<br>│   ├── CIFS/SMB (Windows兼容)<br>│   └── 9P (分布式)<br>│<br>├── 特殊文件系统<br>│   ├── proc (进程信息)<br>│   ├── sysfs (内核对象)<br>│   ├── tmpfs (内存文件系统)<br>│   └── devtmpfs (设备文件)<br>│<br>└── 虚拟文件系统(VFS)<br>    └── 所有文件系统的抽象层<br></code></pre></td></tr></table></figure>
<h2 id="二-磁盘布局与分区结构"><a href="#二-磁盘布局与分区结构" class="headerlink" title="二-磁盘布局与分区结构"></a><a class="markdownIt-Anchor" href="#二-磁盘布局与分区结构"></a> 二、磁盘布局与分区结构</h2>
<p>2.1 物理磁盘布局</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">磁盘物理结构：<br>┌─────────────────────────────────────┐<br>│ 主引导记录(MBR) 或 GPT头部              ← 扇区0<br>├─────────────────────────────────────┤<br>│ 分区表                              <br>├─────────────────────────────────────┤<br>│ 分区1: /boot (ext4)                 <br>│   ├── 引导加载器(GRUB)              <br>│   ├── 内核镜像(vmlinuz)             <br>│   └── 初始内存盘(initramfs)         <br>├─────────────────────────────────────┤<br>│ 分区2: / (根文件系统, ext4)             ← 主要分析对象<br>├─────────────────────────────────────┤<br>│ 分区3: /home (XFS)                  <br>├─────────────────────────────────────┤<br>│ 分区4: swap (交换分区)              <br>└─────────────────────────────────────┘<br></code></pre></td></tr></table></figure>
<p>2.2 ext4文件系统详细布局</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">ext4文件系统结构（以4KB块大小为例）：<br>┌─────────────────────────────────────┐<br>│ 块组0                              <br>│ ├── 超级块(Superblock)              ← 文件系统元数据<br>│ ├── 组描述符(Group Descriptors)    <br>│ ├── 块位图(Block Bitmap)            ← 块使用情况<br>│ ├── inode位图(inode Bitmap)         ← inode使用情况<br>│ ├── inode表(inode Table)           ← 所有inode<br>│ └── 数据块(Data Blocks)             ← 文件内容<br>├─────────────────────────────────────┤<br>│ 块组1                              <br>│ ├── 备份超级块                     <br>│ ├── 组描述符                       <br>│ ├── 块位图                         <br>│ ├── inode位图                      <br>│ ├── inode表                        <br>│ └── 数据块                         <br>├─────────────────────────────────────┤<br>│ ...                                <br>├─────────────────────────────────────┤<br>│ 块组N                              <br>│ └── ...                            <br>└─────────────────────────────────────┘<br></code></pre></td></tr></table></figure>
<ol>
<li>3 /boot里面有什么？</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># &quot;可以用的文件&quot;！</span><br>$ <span class="hljs-built_in">ls</span> -lh /boot/vmlinuz-*<br>-rw-r--r-- 1 root root 12M Jan 15 10:30 /boot/vmlinuz-6.7.0-generic<br><br><span class="hljs-comment"># vmlinuz 的结构：</span><br>┌─────────────────────────────────────┐<br>│ 头部信息                            │<br>├─────────────────────────────────────┤<br>│ 解压缩代码                          │<br>├─────────────────────────────────────┤<br>│ 压缩的内核镜像（gzip压缩）          │ ← 真正的内核代码<br>├─────────────────────────────────────┤<br>│ 可能的内置initramfs                 │<br>└─────────────────────────────────────┘<br><br><span class="hljs-comment">#其他重要文件</span><br>$ <span class="hljs-built_in">ls</span> -lh /boot/<br>总用量 120M<br>-rw-r--r-- 1 root root  12M Jan 15 vmlinuz-6.7.0-generic      <span class="hljs-comment"># ★ 内核本体</span><br>-rw-r--r-- 1 root root  80M Jan 15 initrd.img-6.7.0-generic   <span class="hljs-comment"># 临时根文件系统</span><br>-rw-r--r-- 1 root root 5.5M Jan 15 System.map-6.7.0-generic   <span class="hljs-comment"># 符号地址表</span><br>-rw-r--r-- 1 root root 230K Jan 15 config-6.7.0-generic       <span class="hljs-comment"># 编译配置</span><br></code></pre></td></tr></table></figure>
<h2 id="三-关键数据结构详解"><a href="#三-关键数据结构详解" class="headerlink" title="三-关键数据结构详解"></a><a class="markdownIt-Anchor" href="#三-关键数据结构详解"></a> 三、关键数据结构详解</h2>
<p>3.1 超级块(Superblock)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// ext4超级块结构（部分）</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ext4_super_block</span> &#123;</span><br>    __le32  s_inodes_count;        <span class="hljs-comment">// inode总数</span><br>    __le32  s_blocks_count;        <span class="hljs-comment">// 块总数</span><br>    __le32  s_r_blocks_count;      <span class="hljs-comment">// 保留块数</span><br>    __le32  s_free_blocks_count;   <span class="hljs-comment">// 空闲块数</span><br>    __le32  s_free_inodes_count;   <span class="hljs-comment">// 空闲inode数</span><br>    __le32  s_first_data_block;    <span class="hljs-comment">// 第一个数据块号</span><br>    __le32  s_log_block_size;      <span class="hljs-comment">// 块大小(2^(10+s_log_block_size))</span><br>    __le32  s_blocks_per_group;    <span class="hljs-comment">// 每组块数</span><br>    __le32  s_inodes_per_group;    <span class="hljs-comment">// 每组inode数</span><br>    __le16  s_magic;               <span class="hljs-comment">// 魔数0xEF53</span><br>    __le16  s_state;               <span class="hljs-comment">// 文件系统状态</span><br>    __le32  s_first_ino;           <span class="hljs-comment">// 第一个非保留inode</span><br>    __le16  s_inode_size;          <span class="hljs-comment">// inode大小(128/256)</span><br><br>    <span class="hljs-comment">// 日志相关</span><br>    __le32  s_journal_inum;        <span class="hljs-comment">// 日志文件inode号</span><br>    __le32  s_journal_dev;         <span class="hljs-comment">// 日志设备号</span><br>    <span class="hljs-comment">// ... 更多字段</span><br>&#125;;<br></code></pre></td></tr></table></figure>
<p>超级块内容示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dumpe2fs /dev/sda1 | <span class="hljs-built_in">head</span> -50<br>Filesystem volume name:   &lt;none&gt;<br>Last mounted on:          /<br>Filesystem UUID:          12345678-1234-1234-1234-123456789abc<br>Filesystem magic number:  0xEF53<br>Filesystem revision <span class="hljs-comment">#:    1 (dynamic)</span><br>Filesystem features:      has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super large_file huge_file dir_nlink extra_isize metadata_csum<br>Inode count:              2621440<br>Block count:              10485760<br>Reserved block count:     524288<br>Free blocks:              8123456<br>Free inodes:              1987654<br>First block:              0<br>Block size:               4096<br></code></pre></td></tr></table></figure>
<p>3.2 inode结构</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// ext4 inode结构（内存中）</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ext4_inode</span> &#123;</span><br>    __le16  i_mode;           <span class="hljs-comment">// 文件类型和权限</span><br>    __le16  i_uid;            <span class="hljs-comment">// 所有者ID低位</span><br>    __le32  i_size_lo;        <span class="hljs-comment">// 文件大小（字节）</span><br>    __le32  i_atime;          <span class="hljs-comment">// 最后访问时间</span><br>    __le32  i_ctime;          <span class="hljs-comment">// 最后更改时间</span><br>    __le32  i_mtime;          <span class="hljs-comment">// 最后修改时间</span><br>    __le32  i_dtime;          <span class="hljs-comment">// 删除时间</span><br>    __le16  i_gid;            <span class="hljs-comment">// 组ID低位</span><br>    __le16  i_links_count;    <span class="hljs-comment">// 硬链接数</span><br>    __le32  i_blocks_lo;      <span class="hljs-comment">// 512字节块数</span><br>    __le32  i_flags;          <span class="hljs-comment">// 标志位</span><br>    <span class="hljs-class"><span class="hljs-keyword">union</span> &#123;</span><br>        <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>            __le32  l_i_version;<br>        &#125; linux1;<br>        <span class="hljs-comment">// ... 其他OS特定字段</span><br>    &#125; osd1;<br>    __le32  i_block[<span class="hljs-number">15</span>];      <span class="hljs-comment">// 数据块指针！</span><br>    <span class="hljs-comment">// ... 更多字段</span><br>&#125;;<br></code></pre></td></tr></table></figure>
<p>inode中的块指针数组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">i_block[15] 的布局：<br>[0-11]:  直接块指针（直接指向数据块）<br>[12]:    一级间接块指针（指向包含块指针的块）<br>[13]:    二级间接块指针<br>[14]:    三级间接块指针<br><br>容量计算（4KB块大小）：<br>- 直接块：12 × 4KB = 48KB<br>- 一级间接：每个块1024个指针 × 4KB = 4MB<br>- 二级间接：1024 × 4MB = 4GB<br>- 三级间接：1024 × 4GB = 4TB<br></code></pre></td></tr></table></figure>
<p>3.3 目录项结构</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// ext4目录项（旧格式）</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ext4_dir_entry_2</span> &#123;</span><br>    __le32  inode;           <span class="hljs-comment">// inode号</span><br>    __le16  rec_len;         <span class="hljs-comment">// 目录项长度</span><br>    __le8   name_len;        <span class="hljs-comment">// 文件名长度</span><br>    __le8   file_type;       <span class="hljs-comment">// 文件类型</span><br>    <span class="hljs-type">char</span>    name[];          <span class="hljs-comment">// 文件名（变长）</span><br>&#125;;<br><br><span class="hljs-comment">// 新格式：哈希树目录（dir_index）</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dx_entry</span> &#123;</span><br>    __le32 hash;<br>    __le32 block;<br>&#125;;<br><br><span class="hljs-comment">// 目录内容示例：</span><br>$ ls -la /bin<br>总用量 <span class="hljs-number">123456</span><br>drwxr-xr-x  <span class="hljs-number">2</span> root root    <span class="hljs-number">4096</span> <span class="hljs-number">1</span>月  <span class="hljs-number">1</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span> .<br>drwxr-xr-x <span class="hljs-number">20</span> root root    <span class="hljs-number">4096</span> <span class="hljs-number">1</span>月  <span class="hljs-number">1</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span> ..<br>-rwxr-xr-x  <span class="hljs-number">1</span> root root   <span class="hljs-number">34888</span> <span class="hljs-number">1</span>月  <span class="hljs-number">1</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span> bash    ← 每个都是一个目录项<br>-rwxr-xr-x  <span class="hljs-number">1</span> root root   <span class="hljs-number">35064</span> <span class="hljs-number">1</span>月  <span class="hljs-number">1</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span> cat<br></code></pre></td></tr></table></figure>
<p>3.4 扩展属性(xattr)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 扩展属性存储位置</span><br>1. inode内部（如果空间足够）<br>2. 单独的数据块（ibody外部的xattr块）<br>3. EA inode（大扩展属性）<br><br><span class="hljs-comment"># 查看扩展属性</span><br>$ getfattr -d /etc/passwd<br><span class="hljs-comment"># file: etc/passwd</span><br>user.myattr=<span class="hljs-string">&quot;secret&quot;</span><br>security.selinux=<span class="hljs-string">&quot;system_u:object_r:passwd_file_t:s0&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="四-文件系统操作流程"><a href="#四-文件系统操作流程" class="headerlink" title="四-文件系统操作流程"></a><a class="markdownIt-Anchor" href="#四-文件系统操作流程"></a> 四、文件系统操作流程</h2>
<p>4.1 文件读取过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">用户请求：read(&quot;/home/user/file.txt&quot;, buf, 4096)<br><br>内核处理流程：<br>1. 路径解析<br>   ├── VFS层：将路径分解为分量<br>   ├── 遍历目录项：&quot;/&quot; → &quot;home&quot; → &quot;user&quot; → &quot;file.txt&quot;<br>   └── 获取file.txt的inode号<br><br>2. 权限检查<br>   ├── 检查inode的i_mode权限位<br>   ├── 检查进程凭据（uid/gid）<br>   └── 检查SELinux/AppArmor策略<br><br>3. 数据定位<br>   ├── 计算要读取的偏移对应的块号<br>   │   └── 偏移8192 → 第2个块（8192/4096=2）<br>   ├── 查找块指针<br>   │   ├── 直接块：i_block[2]<br>   │   ├── 间接块：通过i_block[12]等查找<br>   └── 获取物理块号<br><br>4. 读取数据<br>   ├── 块设备层：将逻辑块号转换为物理扇区<br>   ├── 发送读请求到磁盘<br>   └── 数据返回用户缓冲区<br><br>5. 更新元数据<br>   └── 更新inode的i_atime（访问时间）<br></code></pre></td></tr></table></figure>
<p>4.2 文件写入过程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 文件创建流程</span><br><span class="hljs-type">int</span> fd = open(<span class="hljs-string">&quot;/tmp/newfile&quot;</span>, O_CREAT | O_WRONLY, <span class="hljs-number">0644</span>);<br><br>内核处理：<br><span class="hljs-number">1.</span> 路径查找失败（文件不存在）<br><span class="hljs-number">2.</span> 分配新inode<br>   ├── 查找空闲inode（通过inode位图）<br>   ├── 初始化inode结构<br>   │   ├── i_mode = <span class="hljs-number">0644</span> | S_IFREG<br>   │   ├── i_uid = 当前uid<br>   │   ├── i_gid = 当前gid<br>   │   ├── i_size = <span class="hljs-number">0</span><br>   │   └── i_blocks = <span class="hljs-number">0</span><br>   └── 更新inode位图<br><br><span class="hljs-number">3.</span> 创建目录项<br>   ├── 在/tmp目录中添加新条目<br>   │   ├── inode = 新分配的inode号<br>   │   ├── name_len = <span class="hljs-number">8</span> (<span class="hljs-string">&quot;newfile&quot;</span>)<br>   │   └── file_type = EXT4_FT_REG_FILE<br>   ├── 更新目录的i_size（如果需要）<br>   └── 更新目录的mtime<br><br><span class="hljs-number">4.</span> 写入数据<br>   write(fd, <span class="hljs-string">&quot;Hello&quot;</span>, <span class="hljs-number">5</span>);<br>   ├── 分配数据块（通过块位图）<br>   ├── 设置inode的i_block[<span class="hljs-number">0</span>]指向新块<br>   ├── 写入数据到块<br>   ├── 更新inode的i_size = <span class="hljs-number">5</span><br>   └── 更新inode的mtime<br></code></pre></td></tr></table></figure>
<p>4.3 文件删除过程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 删除命令</span><br>$ <span class="hljs-built_in">rm</span> /tmp/newfile<br><br>内核处理：<br>1. 减少硬链接计数<br>   inode.i_links_count--<br><br>2. 如果links_count &gt; 0<br>   └── 只删除目录项，inode保留<br><br>3. 如果links_count == 0<br>   ├── 释放数据块（标记块位图为0）<br>   ├── 释放inode（标记inode位图为0）<br>   ├── 删除所有目录项引用<br>   └── 设置inode.i_dtime为当前时间<br><br>注意：数据并未立即擦除，只是标记为可用！<br></code></pre></td></tr></table></figure>
<h2 id="五-特殊文件系统详解"><a href="#五-特殊文件系统详解" class="headerlink" title="五-特殊文件系统详解"></a><a class="markdownIt-Anchor" href="#五-特殊文件系统详解"></a> 五、特殊文件系统详解</h2>
<p>5.1 /proc文件系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/proc/ 内存中的进程信息文件系统<br><br>关键目录结构：<br>/proc/<br>├── [pid]/                    # 每个进程的目录<br>│   ├── cmdline              # 命令行参数<br>│   ├── cwd -&gt;               # 当前工作目录符号链接<br>│   ├── environ              # 环境变量<br>│   ├── exe -&gt;               # 可执行文件符号链接<br>│   ├── fd/                  # 打开的文件描述符<br>│   ├── maps                 # 内存映射<br>│   ├── mem                  # 进程内存<br>│   ├── root -&gt;              # 根目录符号链接<br>│   └── status               # 进程状态<br>├── cpuinfo                  # CPU信息<br>├── meminfo                  # 内存信息<br>├── mounts                   # 挂载信息<br>├── net/                     # 网络信息<br>├── sys/                     # 到/sys的符号链接<br>└── version                  # 内核版本<br></code></pre></td></tr></table></figure>
<p>/proc/[pid]/maps示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> /proc/self/maps<br>00400000-00401000 r-xp 00000000 08:01 1048600    /bin/cat     <span class="hljs-comment"># 代码段</span><br>00600000-00601000 r--p 00000000 08:01 1048600    /bin/cat     <span class="hljs-comment"># 只读数据</span><br>00601000-00602000 rw-p 00001000 08:01 1048600    /bin/cat     <span class="hljs-comment"># 可写数据</span><br>7ffff7a0d000-7ffff7bd0000 r-xp 00000000 08:01 524295         /lib/x86_64-linux-gnu/libc-2.31.so<br>7ffff7bd0000-7ffff7dcf000 ---p 001c3000 08:01 524295         /lib/x86_64-linux-gnu/libc-2.31.so<br>7ffff7dcf000-7ffff7dd3000 r--p 001c2000 08:01 524295         /lib/x86_64-linux-gnu/libc-2.31.so<br>7ffff7dd3000-7ffff7dd5000 rw-p 001c6000 08:01 524295         /lib/x86_64-linux-gnu/libc-2.31.so<br>7ffff7dd5000-7ffff7dd9000 rw-p 00000000 00:00 0              <span class="hljs-comment"># 匿名映射</span><br>7ffff7dd9000-7ffff7dfe000 r-xp 00000000 08:01 524291         /lib/x86_64-linux-gnu/ld-2.31.so<br>7ffff7ff8000-7ffff7ffb000 r--p 00000000 00:00 0              [vvar]<br>7ffff7ffb000-7ffff7ffc000 r-xp 00000000 00:00 0              [vdso]<br>7ffff7ffc000-7ffff7ffe000 rw-p 00000000 00:00 0              <span class="hljs-comment"># 栈</span><br>7ffff7ffe000-7ffff7fff000 r--p 00025000 08:01 524291         /lib/x86_64-linux-gnu/ld-2.31.so<br>7ffff7fff000-7ffff8000000 rw-p 00026000 08:01 524291         /lib/x86_64-linux-gnu/ld-2.31.so<br></code></pre></td></tr></table></figure>
<p>5.2 /sys文件系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/sys/ 内核对象层次结构<br><br>主要目录：<br>/sys/<br>├── block/                  # 块设备<br>├── bus/                    # 总线（pci, usb, etc.）<br>├── class/                  # 设备类（net, input, etc.）<br>├── dev/                    # 设备文件<br>├── devices/                # 系统设备树<br>└── kernel/                 # 内核参数<br>    ├── kexec_loaded<br>    ├── mm/                 # 内存管理<br>    └── security/<br><br>示例：查看CPU信息<br>$ ls /sys/devices/system/cpu/cpu0/<br>cache/    cpuidle/  topology/  crash_notes       online<br>cpufreq/  node0/    uevent     crash_notes_size  subsystem<br></code></pre></td></tr></table></figure>
<p>5.3 /dev文件系统</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">/dev/ 设备文件<br><br>设备文件类型：<br>1. 块设备（b开头） - 随机访问，有缓存<br>   /dev/sda1      # SATA硬盘第一个分区<br>   /dev/nvme0n1p1 # NVMe SSD第一个分区<br><br>2. 字符设备（c开头） - 顺序访问，无缓存<br>   /dev/tty       # 当前终端<br>   /dev/null      # 空设备<br>   /dev/zero      # 零设备<br>   /dev/random    # 随机数生成器<br><br>3. 特殊设备文件<br>   /dev/stdin -&gt; /proc/self/fd/0<br>   /dev/stdout -&gt; /proc/self/fd/1<br>   /dev/stderr -&gt; /proc/self/fd/2<br></code></pre></td></tr></table></figure>
<p>设备号查看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> -l /dev/sda<br>brw-rw---- 1 root disk 8, 0 Jan  1 00:00 /dev/sda<br><span class="hljs-comment"># 主设备号: 8 (SCSI/SATA磁盘)</span><br><span class="hljs-comment"># 次设备号: 0 (第一个磁盘)</span><br></code></pre></td></tr></table></figure>
<h2 id="六-文件系统元数据与取证"><a href="#六-文件系统元数据与取证" class="headerlink" title="六-文件系统元数据与取证"></a><a class="markdownIt-Anchor" href="#六-文件系统元数据与取证"></a> 六、文件系统元数据与取证</h2>
<p>6.1 时间戳信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># stat命令查看所有时间戳</span><br>$ <span class="hljs-built_in">stat</span> /etc/passwd<br>  File: /etc/passwd<br>  Size: 2823      	Blocks: 8          IO Block: 4096   regular file<br>Device: 801h/2049d	Inode: 133121      Links: 1<br>Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)<br>Access: 2024-01-15 10:30:00.000000000 +0800  <span class="hljs-comment"># atime</span><br>Modify: 2024-01-10 14:25:00.000000000 +0800  <span class="hljs-comment"># mtime</span><br>Change: 2024-01-10 14:25:00.000000000 +0800  <span class="hljs-comment"># ctime</span><br> Birth: 2024-01-01 00:00:00.000000000 +0800  <span class="hljs-comment"># crtime (创建时间，部分FS支持)</span><br><br><span class="hljs-comment"># 时间戳修改（注意：需要root权限）</span><br>$ <span class="hljs-built_in">touch</span> -t 202401011200.00 file.txt      <span class="hljs-comment"># 修改atime和mtime</span><br>$ <span class="hljs-built_in">touch</span> -a -t 202401011200.00 file.txt   <span class="hljs-comment"># 只修改atime</span><br>$ <span class="hljs-built_in">touch</span> -m -t 202401011200.00 file.txt   <span class="hljs-comment"># 只修改mtime</span><br><span class="hljs-comment"># ctime无法直接修改，会随inode变化自动更新</span><br></code></pre></td></tr></table></figure>
<p>6.2 文件系统取证信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 查看已删除但未覆盖的文件</span><br>$ debugfs /dev/sda1<br>debugfs: lsdel<br> Inode  Owner  Mode    Size    Blocks   Time deleted<br> 1337   root   100644  4096    1/1      Tue Jan 15 10:30:00 2024<br><br><span class="hljs-comment"># 2. 恢复删除的文件</span><br>debugfs: dump &lt;1337&gt; /tmp/recovered_file<br><br><span class="hljs-comment"># 3. 查看inode详细信息</span><br>debugfs: <span class="hljs-built_in">stat</span> &lt;133121&gt;<br>Inode: 133121   Type: regular    Mode:  0644   Flags: 0x80000<br>Generation: 1234567890    Version: 0x00000000:00000001<br>User:     0   Group:     0   Size: 2823<br>File ACL: 0    Directory ACL: 0<br>Links: 1   Blockcount: 8<br>Fragment:  Address: 0    Number: 0    Size: 0<br>ctime: 0x659f3b00:00000000 -- Mon Jan 10 14:25:00 2024<br>atime: 0x65a4a788:00000000 -- Mon Jan 15 10:30:00 2024<br>mtime: 0x659f3b00:00000000 -- Mon Jan 10 14:25:00 2024<br>crtime: 0x659f3b00:00000000 -- Mon Jan 10 14:25:00 2024<br>Size of extra inode fields: 32<br>Extended attributes stored <span class="hljs-keyword">in</span> inode body:<br>  security.selinux (37)<br>BLOCKS:<br>(0):1024001<br>TOTAL: 1<br></code></pre></td></tr></table></figure>
<p>6.3 日志(journal)分析</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ext4日志信息</span><br>$ dumpe2fs /dev/sda1 | grep -i journal<br>Filesystem features:      has_journal<br>Journal inode:            8<br>Journal backup:           inode blocks<br>Journal size:             128M<br><br><span class="hljs-comment"># 查看日志内容（需要特殊工具）</span><br>$ debugfs -R <span class="hljs-string">&quot;journal -p 0-100&quot;</span> /dev/sda1<br>Journal starts at block 1, transaction 12345<br>  Sequence: 12345, Type: descriptor, Blocks: 1-5<br>  Sequence: 12345, Type: commit, Blocks: 6<br>  Transaction 12345:<br>    Inode 133121: dirty, committing<br>    Block 1024001: written<br></code></pre></td></tr></table></figure>
<h2 id="七-文件系统性能与调优"><a href="#七-文件系统性能与调优" class="headerlink" title="七-文件系统性能与调优"></a><a class="markdownIt-Anchor" href="#七-文件系统性能与调优"></a> 七、文件系统性能与调优</h2>
<p>7.1 挂载选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># /etc/fstab示例</span><br>UUID=12345678-1234-1234-1234-123456789abc / ext4 defaults,noatime,nodiratime,errors=remount-ro 0 1<br><br><span class="hljs-comment"># 重要挂载选项：</span><br>defaults          <span class="hljs-comment"># 默认选项（rw, suid, dev, exec, auto, nouser, async）</span><br>noatime/nodiratime <span class="hljs-comment"># 不更新访问时间，提升性能</span><br>data=ordered      <span class="hljs-comment"># 数据写入顺序（ordered/journal/writeback）</span><br>barrier=1         <span class="hljs-comment"># 写入屏障，保证数据一致性</span><br>discard           <span class="hljs-comment"># 启用TRIM（SSD优化）</span><br>noacl             <span class="hljs-comment"># 禁用ACL</span><br>nouser_xattr      <span class="hljs-comment"># 禁用用户扩展属性</span><br></code></pre></td></tr></table></figure>
<p>7.2 文件系统创建参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># mkfs.ext4高级选项</span><br>mkfs.ext4 -t ext4 \\<br>  -b 4096 \\          <span class="hljs-comment"># 块大小</span><br>  -i 16384 \\         <span class="hljs-comment"># bytes/inode比率（每16KB一个inode）</span><br>  -I 256 \\           <span class="hljs-comment"># inode大小</span><br>  -J size=128M \\     <span class="hljs-comment"># 日志大小</span><br>  -O ^has_journal \\  <span class="hljs-comment"># 禁用日志（嵌入式系统）</span><br>  -E stride=16,stripe-width=64 \\  <span class="hljs-comment"># RAID优化</span><br>  -L ROOT \\          <span class="hljs-comment"># 卷标</span><br>  /dev/sda1<br></code></pre></td></tr></table></figure>
<p>7.3 性能监控工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. iostat - 磁盘I/O统计</span><br>$ iostat -x 1<br>Device     r/s     w/s     rkB/s     wkB/s   await  %util<br>sda       45.2    12.3    1234.5     567.8    2.34   12.3<br><br><span class="hljs-comment"># 2. iotop - 进程级I/O监控</span><br>$ iotop -oPa<br><br><span class="hljs-comment"># 3. vmstat - 系统整体性能</span><br>$ vmstat 1<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   <span class="hljs-keyword">in</span>   cs us sy <span class="hljs-built_in">id</span> wa st<br> 1  0      0 1234567 89012 345678    0    0    45    12  345  789 10  5 85  0  0<br><br><span class="hljs-comment"># 4. blktrace - 块层跟踪</span><br>$ blktrace -d /dev/sda -o trace<br>$ blkparse trace &gt; analysis.txt<br></code></pre></td></tr></table></figure>
<h2 id="八-安全相关文件系统位置"><a href="#八-安全相关文件系统位置" class="headerlink" title="八-安全相关文件系统位置"></a><a class="markdownIt-Anchor" href="#八-安全相关文件系统位置"></a> 八、安全相关文件系统位置</h2>
<p>8.1 敏感文件位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">系统配置文件：<br>/etc/<br>├── passwd           # 用户账户信息<br>├── shadow           # 加密密码（root可读）<br>├── group            # 组信息<br>├── sudoers          # sudo权限配置<br>├── ssh/             # SSH配置<br>│   ├── sshd_config<br>│   └── authorized_keys<br>├── pam.d/           # PAM认证配置<br>└── crontab          # 计划任务<br><br>用户数据：<br>/home/<br>├── user1/<br>│   ├── .bash_history    # 命令历史<br>│   ├── .ssh/            # SSH密钥<br>│   ├── .cache/          # 缓存文件<br>│   └── .local/share/    # 应用程序数据<br>└── user2/<br><br>日志文件：<br>/var/log/<br>├── auth.log         # 认证日志<br>├── syslog           # 系统日志<br>├── kern.log         # 内核日志<br>├── apache2/         # Web服务器日志<br>└── audit/           # 审计日志<br></code></pre></td></tr></table></figure>
<p>8.2 文件权限与属性</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 特殊权限位</span><br>-rwsr-xr-x  <span class="hljs-comment"># setuid（执行时以文件所有者权限运行）</span><br>-rwxr-sr-x  <span class="hljs-comment"># setgid（执行时以文件所属组权限运行）</span><br>drwxrwxrwt  <span class="hljs-comment"># sticky bit（目录中只有所有者能删除文件）</span><br><br><span class="hljs-comment"># ACL访问控制列表</span><br>$ setfacl -m u:alice:rwx file.txt    <span class="hljs-comment"># 给alice添加rwx权限</span><br>$ getfacl file.txt                   <span class="hljs-comment"># 查看ACL</span><br><span class="hljs-comment"># file: file.txt</span><br><span class="hljs-comment"># owner: root</span><br><span class="hljs-comment"># group: root</span><br>user::rw-<br>user:alice:rwx<br>group::r--<br>mask::rwx<br>other::r--<br><br><span class="hljs-comment"># 文件属性（chattr）</span><br>$ chattr +i important_file    <span class="hljs-comment"># 设置不可变标志（immutable）</span><br>$ chattr +a log_file          <span class="hljs-comment"># 设置只追加标志（append-only）</span><br>$ lsattr file.txt             <span class="hljs-comment"># 查看文件属性</span><br>----i----------- file.txt     <span class="hljs-comment"># i表示不可变</span><br></code></pre></td></tr></table></figure>
<h2 id="九-文件系统故障恢复"><a href="#九-文件系统故障恢复" class="headerlink" title="九-文件系统故障恢复"></a><a class="markdownIt-Anchor" href="#九-文件系统故障恢复"></a> 九、文件系统故障恢复</h2>
<p>9.1 常见问题与修复</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 文件系统损坏检测</span><br>$ fsck -f /dev/sda1<br>Pass 1: Checking inodes, blocks, and sizes<br>Pass 2: Checking directory structure<br>Pass 3: Checking directory connectivity<br>Pass 4: Checking reference counts<br>Pass 5: Checking group summary information<br><br><span class="hljs-comment"># 2. 超级块损坏恢复</span><br><span class="hljs-comment"># 使用备份超级块（每个块组一个）</span><br>$ mke2fs -n /dev/sda1          <span class="hljs-comment"># 查看备份超级块位置</span><br>$ fsck -b 32768 /dev/sda1      <span class="hljs-comment"># 使用备份超级块修复</span><br><br><span class="hljs-comment"># 3. 误删除恢复</span><br><span class="hljs-comment"># 使用extundelete</span><br>$ extundelete /dev/sda1 --restore-file /home/user/lost.txt<br>$ extundelete /dev/sda1 --restore-all<br><br><span class="hljs-comment"># 4. 文件系统只读挂载修复</span><br><span class="hljs-comment"># 常见原因：日志错误或磁盘错误</span><br>$ mount -o remount,rw /      <span class="hljs-comment"># 尝试重新挂载为读写</span><br>$ journalctl -xe             <span class="hljs-comment"># 查看系统日志</span><br>$ dmesg | <span class="hljs-built_in">tail</span> -50           <span class="hljs-comment"># 查看内核消息</span><br></code></pre></td></tr></table></figure>
<h2 id="十-文件系统检查工具速查"><a href="#十-文件系统检查工具速查" class="headerlink" title="十-文件系统检查工具速查"></a><a class="markdownIt-Anchor" href="#十-文件系统检查工具速查"></a> 十、文件系统检查工具速查</h2>
<p>10.1 信息查看工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 查看文件系统信息</span><br>$ <span class="hljs-built_in">df</span> -hT                     <span class="hljs-comment"># 磁盘使用情况</span><br>$ lsblk                      <span class="hljs-comment"># 块设备信息</span><br>$ blkid                      <span class="hljs-comment"># 块设备UUID和类型</span><br>$ mount                      <span class="hljs-comment"># 挂载信息</span><br>$ findmnt                    <span class="hljs-comment"># 树形显示挂载点</span><br><br><span class="hljs-comment"># 2. 查看inode使用情况</span><br>$ <span class="hljs-built_in">df</span> -i                      <span class="hljs-comment"># inode使用统计</span><br>$ tune2fs -l /dev/sda1 | grep -i inode<br><br><span class="hljs-comment"># 3. 文件系统详细信息</span><br>$ dumpe2fs /dev/sda1         <span class="hljs-comment"># ext2/3/4详细信息</span><br>$ xfs_info /dev/sda2         <span class="hljs-comment"># XFS信息</span><br>$ btrfs filesystem show      <span class="hljs-comment"># Btrfs信息</span><br></code></pre></td></tr></table></figure>
<p>10.2 调试与取证工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 低级磁盘查看</span><br>$ hexdump -C /dev/sda1 | <span class="hljs-built_in">head</span> -100     <span class="hljs-comment"># 查看原始磁盘内容</span><br>$ <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/sda1 bs=4096 count=1 | <span class="hljs-built_in">od</span> -Ax -tx1 -v  <span class="hljs-comment"># 查看第一个块</span><br><br><span class="hljs-comment"># 2. inode和块查看</span><br>$ debugfs /dev/sda1<br>debugfs: <span class="hljs-built_in">stat</span> &lt;inode号&gt;      <span class="hljs-comment"># 查看inode信息</span><br>debugfs: ncheck &lt;inode号&gt;    <span class="hljs-comment"># 根据inode找文件名</span><br>debugfs: icat &lt;inode号&gt;      <span class="hljs-comment"># 查看inode内容</span><br>debugfs: testb &lt;块号&gt;        <span class="hljs-comment"># 测试块是否被使用</span><br><br><span class="hljs-comment"># 3. 文件恢复工具</span><br><span class="hljs-comment"># extundelete, photorec, testdisk, foremost</span><br></code></pre></td></tr></table></figure>
<h1 id="linux内核"><a href="#linux内核" class="headerlink" title="linux内核"></a><a class="markdownIt-Anchor" href="#linux内核"></a> Linux内核</h1>
<p><a target="_blank" rel="noopener" href="https://www.notion.so/2fecbc60ae4d80b38148e68609c32cab?pvs=21">核心子系统</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">Linux内核层级结构（自底向上）：</span><br><span class="hljs-string">┌─────────────────────────────────────────────────────┐</span><br><span class="hljs-string">│</span>                   <span class="hljs-string">系统调用接口</span>                        <span class="hljs-string">←</span> <span class="hljs-string">用户空间接口</span><br><span class="hljs-string">├─────────────────────────────────────────────────────┤</span><br><span class="hljs-string">│</span>               <span class="hljs-string">进程管理</span> <span class="hljs-string">(Process)</span>                    <br><span class="hljs-string">│</span>               <span class="hljs-string">内存管理</span> <span class="hljs-string">(Memory)</span>                     <br><span class="hljs-string">│</span>               <span class="hljs-string">文件系统</span> <span class="hljs-string">(Filesystem)</span>                 <br><span class="hljs-string">│</span>               <span class="hljs-string">设备驱动</span> <span class="hljs-string">(Driver)</span>                      <span class="hljs-string">←</span> <span class="hljs-string">核心子系统</span><br><span class="hljs-string">│</span>               <span class="hljs-string">网络协议栈</span> <span class="hljs-string">(Network)</span>                  <br><span class="hljs-string">├─────────────────────────────────────────────────────┤</span><br><span class="hljs-string">│</span>             <span class="hljs-string">进程间通信</span> <span class="hljs-string">(IPC)</span>                        <br><span class="hljs-string">│</span>             <span class="hljs-string">虚拟文件系统</span> <span class="hljs-string">(VFS)</span>                      <br><span class="hljs-string">│</span>             <span class="hljs-string">设备模型</span> <span class="hljs-string">(Device</span> <span class="hljs-string">Model)</span>                  <span class="hljs-string">←</span> <span class="hljs-string">中间层</span><br><span class="hljs-string">├─────────────────────────────────────────────────────┤</span><br><span class="hljs-string">│</span>              <span class="hljs-string">体系结构相关代码</span>                       <br><span class="hljs-string">│</span>              <span class="hljs-string">中断处理</span> <span class="hljs-string">(Interrupt)</span>                  <br><span class="hljs-string">│</span>              <span class="hljs-string">定时器</span> <span class="hljs-string">(Timer)</span>                         <span class="hljs-string">←</span> <span class="hljs-string">硬件抽象</span><br><span class="hljs-string">│</span>              <span class="hljs-string">同步原语</span> <span class="hljs-string">(Synchronization)</span>            <br><span class="hljs-string">└─────────────────────────────────────────────────────┘</span><br>                     <span class="hljs-string">硬件</span><br></code></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">Linux启动的10个关键阶段：</span><br><span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">BIOS/UEFI阶段</span><br>   <span class="hljs-string">└──</span> <span class="hljs-string">硬件自检，加载引导程序</span><br><br><span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">Bootloader阶段</span> <span class="hljs-string">(GRUB)</span><br>   <span class="hljs-string">└──</span> <span class="hljs-string">加载内核镜像和initramfs</span><br><br><span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">内核入口</span> <span class="hljs-string">(arch/x86/boot/)</span><br>   <span class="hljs-string">└──</span> <span class="hljs-string">汇编代码，初始化基本环境</span><br><br><span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">早期初始化</span> <span class="hljs-string">(start_kernel())</span><br>   <span class="hljs-string">└──</span> <span class="hljs-string">初始化体系结构相关部分</span><br><br><span class="hljs-number">5</span><span class="hljs-string">.</span> <span class="hljs-string">内存初始化</span><br>   <span class="hljs-string">└──</span> <span class="hljs-string">建立页表，初始化内存管理</span><br><br><span class="hljs-number">6</span><span class="hljs-string">.</span> <span class="hljs-string">进程初始化</span><br>   <span class="hljs-string">└──</span> <span class="hljs-string">创建第一个进程</span> <span class="hljs-string">(init_task)</span><br><br><span class="hljs-number">7</span><span class="hljs-string">.</span> <span class="hljs-string">驱动初始化</span><br>   <span class="hljs-string">└──</span> <span class="hljs-string">按顺序初始化各个子系统</span><br><br><span class="hljs-number">8</span><span class="hljs-string">.</span> <span class="hljs-string">根文件系统挂载</span><br>   <span class="hljs-string">└──</span> <span class="hljs-string">从initramfs切换到真实根文件系统</span><br><br><span class="hljs-number">9</span><span class="hljs-string">.</span> <span class="hljs-string">用户空间启动</span><br>   <span class="hljs-string">└──</span> <span class="hljs-string">执行第一个用户进程</span> <span class="hljs-string">(/sbin/init)</span><br><br><span class="hljs-number">10</span><span class="hljs-string">.</span> <span class="hljs-string">系统运行</span><br>    <span class="hljs-string">└──</span> <span class="hljs-string">启动各种服务，显示登录界面</span><br></code></pre></td></tr></table></figure>
<h1 id="elf格式"><a href="#elf格式" class="headerlink" title="elf格式"></a><a class="markdownIt-Anchor" href="#elf格式"></a> ELF格式</h1>
<h2 id="一-三个阶段概述"><a href="#一-三个阶段概述" class="headerlink" title="一-三个阶段概述"></a><a class="markdownIt-Anchor" href="#一-三个阶段概述"></a> 一、三个阶段概述</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">源码 → 编译器 → 目标文件(.o) → 链接器 → 可执行文件 → 加载器 → 内存映像<br>      (阶段1)               (阶段2)             (阶段3)<br><br></code></pre></td></tr></table></figure>
<h2 id="二-阶段1目标文件o文件格式"><a href="#二-阶段1目标文件o文件格式" class="headerlink" title="二-阶段1目标文件o文件格式"></a><a class="markdownIt-Anchor" href="#二-阶段1目标文件o文件格式"></a> 二、阶段1：目标文件（.o文件）格式</h2>
<p>2.1 目标文件的用途</p>
<p>· 单个源文件编译的结果<br />
· 包含未链接的代码和数据<br />
· 等待链接器合并成可执行文件</p>
<p>2.2 目标文件的物理布局</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">目标文件磁盘布局（64位系统）：<br>偏移量     大小      内容<br>───────────────────────────────────────────────<br>0x0000     64字节    ELF头部 (Elf64_Ehdr)<br>0x0040    可变       节头表 (Elf64_Shdr数组)<br>0x00??    可变       .text节 (代码)<br>0x0???    可变       .rodata节 (只读数据)<br>0x0???    可变       .data节 (已初始化数据)<br>0x0???    可变       .bss节 (占位符，实际无内容)<br>0x0???    可变       .symtab节 (符号表)<br>0x0???    可变       .strtab节 (字符串表)<br>0x0???    可变       .shstrtab节 (节名字符串表)<br>0x0???    可变       .rela.text节 (代码重定位)<br>0x0???    可变       .rela.data节 (数据重定位)<br><br></code></pre></td></tr></table></figure>
<p>2.3 目标文件的ELF头部</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 典型目标文件的ELF头部值</span><br>Elf64_Ehdr ehdr = &#123;<br>    .e_ident = &#123;<span class="hljs-number">0x7F</span>, <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, ELFCLASS64, ...&#125;,<br>    .e_type = ET_REL,           <span class="hljs-comment">// 类型：可重定位文件</span><br>    .e_machine = EM_X86_64,     <span class="hljs-comment">// 架构：x86-64</span><br>    .e_version = EV_CURRENT,<br>    .e_entry = <span class="hljs-number">0</span>,               <span class="hljs-comment">// 无入口点（未链接）</span><br>    .e_phoff = <span class="hljs-number">0</span>,               <span class="hljs-comment">// 无程序头表</span><br>    .e_shoff = <span class="hljs-number">0x40</span>,            <span class="hljs-comment">// 节头表在0x40</span><br>    .e_flags = <span class="hljs-number">0</span>,<br>    .e_ehsize = <span class="hljs-number">64</span>,             <span class="hljs-comment">// ELF头大小64字节</span><br>    .e_phentsize = <span class="hljs-number">0</span>,           <span class="hljs-comment">// 程序头表项大小（无）</span><br>    .e_phnum = <span class="hljs-number">0</span>,               <span class="hljs-comment">// 程序头表项数量（无）</span><br>    .e_shentsize = <span class="hljs-number">64</span>,          <span class="hljs-comment">// 节头表项大小64字节</span><br>    .e_shnum = <span class="hljs-number">12</span>,              <span class="hljs-comment">// 有12个节</span><br>    .e_shstrndx = <span class="hljs-number">11</span>,           <span class="hljs-comment">// 节名字符串表是第11个节</span><br>&#125;;<br><br></code></pre></td></tr></table></figure>
<p>2.4 目标文件的节头表示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看目标文件的节</span><br>$ readelf -S hello.o<br>Section Headers:<br>  [Nr] Name              Type            Address          Offset    Size<br>  [ 0]                   NULL            0000000000000000 00000000 000000<br>  [ 1] .text             PROGBITS        0000000000000000 00000040 00001a<br>  [ 2] .data             PROGBITS        0000000000000000 0000005a 000004<br>  [ 3] .bss              NOBITS          0000000000000000 0000005e 000004<br>  [ 4] .rodata           PROGBITS        0000000000000000 0000005e 000006<br>  [ 5] .comment          PROGBITS        0000000000000000 00000064 00002e<br>  [ 6] .note.GNU-stack   PROGBITS        0000000000000000 00000092 000000<br>  [ 7] .eh_frame         PROGBITS        0000000000000000 00000098 000038<br>  [ 8] .rela.text        RELA            0000000000000000 000000d0 000030<br>  [ 9] .symtab           SYMTAB          0000000000000000 00000100 0000a8<br>  [10] .strtab           STRTAB          0000000000000000 000001a8 00003d<br>  [11] .shstrtab         STRTAB          0000000000000000 000001e5 000061<br><br></code></pre></td></tr></table></figure>
<p>2.5 目标文件的符号表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看目标文件的符号</span><br>$ readelf -s hello.o<br>Symbol table <span class="hljs-string">&#x27;.symtab&#x27;</span> contains 7 entries:<br>   Num:    Value          Size Type    Bind   Vis      Ndx Name<br>     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND<br>     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS hello.c<br>     2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1 .text<br>     3: 0000000000000000     0 SECTION LOCAL  DEFAULT    4 .rodata<br>     4: 0000000000000000     8 OBJECT  GLOBAL DEFAULT    4 msg<br>     5: 0000000000000000     4 OBJECT  GLOBAL DEFAULT    2 global<br>     6: 0000000000000000    26 FUNC    GLOBAL DEFAULT    1 main<br><br></code></pre></td></tr></table></figure>
<h2 id="三-阶段2可执行文件格式"><a href="#三-阶段2可执行文件格式" class="headerlink" title="三-阶段2可执行文件格式"></a><a class="markdownIt-Anchor" href="#三-阶段2可执行文件格式"></a> 三、阶段2：可执行文件格式</h2>
<p>3.1 可执行文件的用途</p>
<p>· 链接后的完整程序<br />
· 可以直接由操作系统加载执行<br />
· 包含所有需要的代码和数据</p>
<p>3.2 可执行文件的物理布局</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">可执行文件磁盘布局：<br>偏移量     大小      内容<br>───────────────────────────────────────────────<br>0x0000     64字节    ELF头部 (Elf64_Ehdr)<br>0x0040     56×N字节  程序头表 (Elf64_Phdr数组，N=e_phnum)<br>0x0???     可变       解释器路径(.interp节)<br>0x0???     可变       代码段(包含.text, .plt, .rodata等节)<br>0x????     可变       数据段(包含.data, .got, .dynamic等节)<br>0x????     可变       节头表 (Elf64_Shdr数组) ← 可选，可去掉<br>0x????     可变       节名字符串表(.shstrtab) ← 可选<br><br></code></pre></td></tr></table></figure>
<p>3.3 可执行文件的ELF头部</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 典型可执行文件的ELF头部</span><br>Elf64_Ehdr ehdr = &#123;<br>    .e_ident = &#123;<span class="hljs-number">0x7F</span>, <span class="hljs-string">&#x27;E&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, ELFCLASS64, ...&#125;,<br>    .e_type = ET_EXEC,          <span class="hljs-comment">// 类型：可执行文件</span><br>    .e_machine = EM_X86_64,<br>    .e_version = EV_CURRENT,<br>    .e_entry = <span class="hljs-number">0x4004d0</span>,        <span class="hljs-comment">// 入口点地址</span><br>    .e_phoff = <span class="hljs-number">0x40</span>,            <span class="hljs-comment">// 程序头表在0x40</span><br>    .e_shoff = <span class="hljs-number">0x1c00</span>,          <span class="hljs-comment">// 节头表在0x1c00（调试信息）</span><br>    .e_flags = <span class="hljs-number">0</span>,<br>    .e_ehsize = <span class="hljs-number">64</span>,<br>    .e_phentsize = <span class="hljs-number">56</span>,          <span class="hljs-comment">// 程序头表项大小56字节</span><br>    .e_phnum = <span class="hljs-number">9</span>,               <span class="hljs-comment">// 有9个程序头</span><br>    .e_shentsize = <span class="hljs-number">64</span>,<br>    .e_shnum = <span class="hljs-number">28</span>,              <span class="hljs-comment">// 有28个节（调试用）</span><br>    .e_shstrndx = <span class="hljs-number">27</span>,<br>&#125;;<br><br></code></pre></td></tr></table></figure>
<p>3.4 可执行文件的程序头表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看可执行文件的段</span><br>$ readelf -l /bin/ls<br>Program Headers:<br>  Type           Offset   VirtAddr           PhysAddr           FileSiz  MemSiz   Flg Align<br>  PHDR           0x000040 0x0000000000400040 0x0000000000400040 0x0001f8 0x0001f8 R   0x8<br>  INTERP         0x000238 0x0000000000400238 0x0000000000400238 0x00001c 0x00001c R   0x1<br>      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]<br>  LOAD           0x000000 0x0000000000400000 0x0000000000400000 0x01e584 0x01e584 R E 0x200000<br>  LOAD           0x01ee10 0x000000000061ee10 0x000000000061ee10 0x0008fc 0x001558 RW  0x200000<br>  DYNAMIC        0x01ee28 0x000000000061ee28 0x000000000061ee28 0x0001d0 0x0001d0 RW  0x8<br>  NOTE           0x000254 0x0000000000400254 0x0000000000400254 0x000044 0x000044 R   0x4<br>  GNU_EH_FRAME   0x01c4f0 0x00000000005fc4f0 0x00000000005fc4f0 0x000a7c 0x000a7c R   0x4<br>  GNU_STACK      0x000000 0x0000000000000000 0x0000000000000000 0x000000 0x000000 RW  0x10<br>  GNU_RELRO      0x01ee10 0x000000000061ee10 0x000000000061ee10 0x0005f0 0x0005f0 R   0x1<br><br></code></pre></td></tr></table></figure>
<p>3.5 段与节的映射关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看段包含哪些节</span><br>$ readelf -l /bin/ls | grep -A20 <span class="hljs-string">&quot;Section to Segment&quot;</span><br><br>Section to Segment mapping:<br>  Segment Sections...<br>   00<br>   01     .interp<br>   02     .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr<br>           .gnu.version .gnu.version_r .rela.dyn .rela.plt .init .plt .plt.got<br>           .text .fini .rodata .eh_frame_hdr .eh_frame<br>   03     .init_array .fini_array .dynamic .got .data .bss<br>   04     .dynamic<br>   05     .note.ABI-tag .note.gnu.build-id<br>   06     .eh_frame_hdr<br>   07<br>   08     .init_array .fini_array .dynamic .got<br><br></code></pre></td></tr></table></figure>
<h2 id="四-阶段3内存映像格式"><a href="#四-阶段3内存映像格式" class="headerlink" title="四-阶段3内存映像格式"></a><a class="markdownIt-Anchor" href="#四-阶段3内存映像格式"></a> 四、阶段3：内存映像格式</h2>
<p>4.1 内存映像的用途</p>
<p>· 程序在内存中的运行状态<br />
· 由操作系统根据可执行文件创建<br />
· 包含栈、堆等运行时内存区域</p>
<p>4.2 进程虚拟内存布局（64位Linux）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">高地址 0x7fffffffffff<br>      ┌─────────────────┐<br>      │    内核空间        (用户不可访问)<br>      ├─────────────────┤ 0x7fffffffffff<br>      │   栈(stack)       (向下增长)<br>      │      ↓          <br>      ├─────────────────┤<br>      │      ↓          <br>      │   (未映射区域)   <br>      │      ↑          <br>      ├─────────────────┤<br>      │   堆(heap)        (向上增长)<br>      │      ↑          <br>      ├─────────────────┤<br>      │   共享库           (libc.so等)<br>      ├─────────────────┤<br>      │  数据段            (.data, .bss)<br>      │  权限: RW       <br>      ├─────────────────┤<br>      │  只读数据段        (.rodata)<br>      │  权限: R        <br>      ├─────────────────┤<br>      │  代码段           (.text, .plt)<br>      │  权限: R-X      <br>      └─────────────────┘<br>低地址 0x400000<br></code></pre></td></tr></table></figure>
<p>4.3 内存中的关键数据结构</p>
<p>4.3.1 进程控制块（内核中）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">task_struct</span> &#123;</span>          <span class="hljs-comment">// 每个进程一个</span><br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mm_struct</span> *<span class="hljs-title">mm</span>;</span>     <span class="hljs-comment">// 内存管理结构</span><br><br>    <span class="hljs-comment">// ELF相关信息</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> start_code, end_code;   <span class="hljs-comment">// 代码段范围</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> start_data, end_data;   <span class="hljs-comment">// 数据段范围</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> start_brk, brk;         <span class="hljs-comment">// 堆范围</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> start_stack;            <span class="hljs-comment">// 栈底</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg_start, arg_end;     <span class="hljs-comment">// 参数区</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> env_start, env_end;     <span class="hljs-comment">// 环境变量区</span><br>&#125;;<br><br></code></pre></td></tr></table></figure>
<p>4.3.2 内存区域（VMA）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vm_area_struct</span> &#123;</span>       <span class="hljs-comment">// 每个内存区域一个</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> vm_start;    <span class="hljs-comment">// 区域起始地址</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> vm_end;      <span class="hljs-comment">// 区域结束地址</span><br><br>    <span class="hljs-comment">// 权限和属性</span><br>    <span class="hljs-type">pgprot_t</span> vm_page_prot;     <span class="hljs-comment">// 页保护位</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> vm_flags;    <span class="hljs-comment">// VM_READ, VM_WRITE, VM_EXEC</span><br><br>    <span class="hljs-comment">// 映射的文件</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">vm_file</span>;</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> vm_pgoff;    <span class="hljs-comment">// 文件内偏移（页单位）</span><br><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vm_area_struct</span> *<span class="hljs-title">vm_next</span>;</span>  <span class="hljs-comment">// 链表下一个</span><br>&#125;;<br><br></code></pre></td></tr></table></figure>
<p>4.4 从文件到内存的映射示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看运行中进程的内存映射</span><br>$ <span class="hljs-built_in">cat</span> /proc/self/maps  <span class="hljs-comment"># 查看cat进程自身的内存</span><br>00400000-0040c000 r-xp 00000000 fd:01 656402     /bin/cat       <span class="hljs-comment"># 代码段</span><br>0060b000-0060c000 r--p 0000b000 fd:01 656402     /bin/cat       <span class="hljs-comment"># 只读数据</span><br>0060c000-0060d000 rw-p 0000c000 fd:01 656402     /bin/cat       <span class="hljs-comment"># 数据段</span><br>7ffff7a0e000-7ffff7bd0000 r-xp 00000000 fd:01 656398           /lib/x86_64-linux-gnu/libc-2.27.so  <span class="hljs-comment"># libc代码</span><br>7ffff7bd0000-7ffff7dd0000 ---p 001c2000 fd:01 656398           <span class="hljs-comment"># 保护间隙</span><br>7ffff7dd0000-7ffff7dd4000 r--p 001c2000 fd:01 656398           /lib/x86_64-linux-gnu/libc-2.27.so  <span class="hljs-comment"># libc只读数据</span><br>7ffff7dd4000-7ffff7dd6000 rw-p 001c6000 fd:01 656398           /lib/x86_64-linux-gnu/libc-2.27.so  <span class="hljs-comment"># libc数据</span><br>7ffff7dd6000-7ffff7dda000 rw-p 00000000 00:00 0                <span class="hljs-comment"># 匿名映射</span><br>7ffff7dda000-7ffff7dfd000 r-xp 00000000 fd:01 656399           /lib/x86_64-linux-gnu/ld-2.27.so    <span class="hljs-comment"># 动态链接器</span><br>7ffff7ff8000-7ffff7ffb000 r--p 00000000 00:00 0                [vvar]<br>7ffff7ffb000-7ffff7ffc000 r-xp 00000000 00:00 0                [vdso]<br>7ffff7ffc000-7ffff7ffd000 r--p 00022000 fd:01 656399           /lib/x86_64-linux-gnu/ld-2.27.so<br>7ffff7ffd000-7ffff7ffe000 rw-p 00023000 fd:01 656399           /lib/x86_64-linux-gnu/ld-2.27.so<br>7ffff7ffe000-7ffff7fff000 rw-p 00000000 00:00 0                <span class="hljs-comment"># 匿名映射</span><br>7ffffffde000-7ffffffff000 rw-p 00000000 00:00 0                [stack]  <span class="hljs-comment"># 栈</span><br>ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0        [vsyscall]<br><br></code></pre></td></tr></table></figure>
<h2 id="五-关键数据流示例"><a href="#五-关键数据流示例" class="headerlink" title="五-关键数据流示例"></a><a class="markdownIt-Anchor" href="#五-关键数据流示例"></a> 五、关键数据流示例</h2>
<p>5.1 代码地址的演变</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">源码中的函数地址：<br>main()在hello.c中（无具体地址）<br><br>↓ 编译后（目标文件）<br>main在.text节偏移0x0处（相对地址）<br><br>↓ 链接后（可执行文件）<br>main在虚拟地址0x4004d0处（绝对地址）<br><br>↓ 加载后（内存映像）<br>main在进程地址空间0x4004d0处（实际映射）<br><br></code></pre></td></tr></table></figure>
<p>5.2 数据地址的演变</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">源码中的全局变量：<br>int global = 42;<br><br>↓ 编译后<br>global在.data节偏移0x0处，值42<br><br>↓ 链接后<br>global在虚拟地址0x601028处，值42<br><br>↓ 加载后<br>global在内存地址0x601028处，可读写<br><br></code></pre></td></tr></table></figure>
<h1 id="内存分区"><a href="#内存分区" class="headerlink" title="内存分区"></a><a class="markdownIt-Anchor" href="#内存分区"></a> 内存分区</h1>
<h2 id="一-内存分区概述"><a href="#一-内存分区概述" class="headerlink" title="一-内存分区概述"></a><a class="markdownIt-Anchor" href="#一-内存分区概述"></a> 一、内存分区概述</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">┌─────────────────────────────────────────────┐<br>│ **1. 内核空间**                              <br>│    用户程序不可直接访问                        <br>├─────────────────────────────────────────────┤<br>│ **2. 栈区 (Stack)**                          <br>│    增长方向：向低地址扩展（向下增长）           <br>│    特性：后调用的函数栈帧地址更低                <br>│    内容：局部变量、函数参数、返回地址            <br>│              <br>├─────────────────────────────────────────────┤<br>│ **3. 内存映射区域**     （libc）                      <br>│    动态库、mmap分配、文件映射、线程栈           <br>│    关键：堆栈间的&quot;缓冲地带&quot;，ASLR随机化重点区域   <br>├─────────────────────────────────────────────┤<br>│ **4. 堆区 (Heap) - 重点详解见第二部分**        <br>│    增长方向：向高地址扩展（向上增长）           <br>│    起始：紧接.bss段向高地址方向                <br>├─────────────────────────────────────────────┤<br>│ **5. 未初始化数据区 (.bss段)**                <br>│    内容：未初始化的全局/静态变量                <br>│                   <br>├─────────────────────────────────────────────┤<br>│ **6. 已初始化数据区 (.data段)**               <br>│    内容：已初始化的全局/静态变量                <br>│                      <br>├─────────────────────────────────────────────┤<br>│ **7. 只读数据区 (.rodata段)**                 <br>│    内容：字符串常量、const全局变量             <br>│              <br>├─────────────────────────────────────────────┤<br>│ **8. 代码区 (.text段)**                       <br>│    内容：程序执行代码、函数体                  <br>│    CPU从此读取指令执行                        <br>└─────────────────────────────────────────────┘<br>**低地址 0x400000**<br></code></pre></td></tr></table></figure>
<h2 id="二-堆区详解"><a href="#二-堆区详解" class="headerlink" title="二-堆区详解"></a><a class="markdownIt-Anchor" href="#二-堆区详解"></a> 二、堆区详解</h2>
<h3 id="一-堆区本质与操作"><a href="#一-堆区本质与操作" class="headerlink" title="一-堆区本质与操作"></a><a class="markdownIt-Anchor" href="#一-堆区本质与操作"></a> 一、堆区本质与操作</h3>
<p>1.1 堆区是什么</p>
<p>动态内存仓库，程序运行时按需分配/释放，生命周期由程序员控制（需手动free）。</p>
<p>1.2 核心操作函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span>* <span class="hljs-title function_">malloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span>;      <span class="hljs-comment">// 分配（不初始化）</span><br><span class="hljs-type">void</span>* <span class="hljs-title function_">calloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> n, <span class="hljs-type">size_t</span> s)</span>; <span class="hljs-comment">// 分配并清零</span><br><span class="hljs-type">void</span>* <span class="hljs-title function_">realloc</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr, <span class="hljs-type">size_t</span> s)</span>; <span class="hljs-comment">// 调整大小</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">free</span><span class="hljs-params">(<span class="hljs-type">void</span>* ptr)</span>;           <span class="hljs-comment">// 释放（free(NULL)安全）</span><br></code></pre></td></tr></table></figure>
<hr />
<h3 id="二-堆块chunk结构与对齐"><a href="#二-堆块chunk结构与对齐" class="headerlink" title="二-堆块chunk结构与对齐"></a><a class="markdownIt-Anchor" href="#二-堆块chunk结构与对齐"></a> 二、堆块（Chunk）结构与对齐</h3>
<p>2.1 Chunk物理布局（64位系统示例）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">一个已分配的堆块（chunk）在内存中：<br>┌─────────────────────────────────────────┐<br>│ chunk头 (16字节)                         <br>│   prev_size (8字节): 前一块大小（若空闲）   <br>│   size (8字节): 本块大小+标志位(P,A,M)        ← malloc管理区<br>├─────────────────────────────────────────┤ ← malloc()返回给用户的指针<br>│ 用户数据区 (分配的大小)                       ← 程序实际使用区<br>├─────────────────────────────────────────┤<br>│ 对齐填充区 (可能0-N字节)                      ← 关键的“浪费”区域<br>└─────────────────────────────────────────┘<br></code></pre></td></tr></table></figure>
<p>2.2 对齐的根源与计算</p>
<p>根本原因：CPU/内存控制器硬件要求，不对齐访问会导致性能暴跌或崩溃。</p>
<p>实际分配大小计算（64位Linux，glibc）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">请求大小 = N 字节<br>实际分配 = ((N + <span class="hljs-number">16</span> + <span class="hljs-number">15</span>) &amp; ~<span class="hljs-number">15</span>)  <span class="hljs-comment">// 16字节对齐（含头部）</span><br></code></pre></td></tr></table></figure>
<p>示例：</p>
<p>· malloc(1) → 实际分配 32字节（头部16+用户1+填充15）<br />
· malloc(24) → 实际分配 48字节（头部16+用户24+填充8）</p>
<p>2.3 对齐填充区的关键特性</p>
<p>· 内容不确定：通常是上次使用的残留数据（信息泄露源）<br />
· 无法被用户直接寻址：位于返回指针指向的用户区之外<br />
· 攻击利用点：可隐藏shellcode片段或遗留敏感数据</p>
<hr />
<h3 id="三-堆管理器ptmalloc2组织结构"><a href="#三-堆管理器ptmalloc2组织结构" class="headerlink" title="三-堆管理器ptmalloc2组织结构"></a><a class="markdownIt-Anchor" href="#三-堆管理器ptmalloc2组织结构"></a> 三、堆管理器（ptmalloc2）组织结构</h3>
<p>3.1 按大小分级管理的“货架系统”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">快速抽屉 (fastbins) - 放小件，不整理<br>├─ 32字节抽屉： [空闲块1]→[空闲块2]→NULL<br>├─ 48字节抽屉： [空闲块3]→NULL<br>├─ 64字节抽屉： 空<br>└─ ... (共10个，到160字节)<br><br>个人抽屉 (tcache) - 每线程独立，最快<br>├─ 抽屉0 (16字节)： 最多存7个块<br>├─ 抽屉1 (32字节)： [块A]→[块B]→[块C]<br>├─ 抽屉2 (48字节)： 空<br>└─ ... (共64个抽屉，到1032字节)<br><br>整齐抽屉 (smallbins) - 中等物品，整理有序  <br>├─ 32字节抽屉： ↔[块X]↔[块Y]↔[块Z]↔ (双向链表)<br>├─ 48字节抽屉： ↔[块M]↔[块N]↔<br>└─ ... (62个，到1008字节)<br><br>大件仓库 (largebins) - 放大东西，找起来慢<br>├─ 512-576字节区： 按大小排序<br>├─ 576-672字节区： 空<br>└─ ... (63个大小范围)<br><br> top chunk           ← 堆顶备用空间<br><br>临时堆放区 (unsorted bin) - 刚free的块先放这<br>└─ 混在一起，等待分类到上面抽屉<br></code></pre></td></tr></table></figure>
<p>3.2 堆块重用规则（堆风水基础）<br />
大小匹配      只从相同大小的bin中分配          精确预测成为可能<br />
tcache优先    优先使用线程缓存                 最容易控制的攻击入口<br />
LIFO/FIFO     tcache/fastbins后进先出；        smallbins先进先出   控制分配顺序<br />
不合并        fastbins释放后不立即合并         维持空洞，延长攻击窗口</p>
<h2 id="栈区详解"><a href="#栈区详解" class="headerlink" title="栈区详解"></a><a class="markdownIt-Anchor" href="#栈区详解"></a> 栈区详解</h2>
<p>一、栈的本质与特性</p>
<p>函数调用的实时工作区，用于存放函数参数、局部变量和调用上下文。自动管理（编译器分配/释放）、后进先出、与函数生命周期严格绑定。</p>
<p>特点：动态扩张，静态计算</p>
<p>· 动态扩张：运行时根据函数调用实时向下扩展<br />
· 静态计算：编译器在编译时精确计算每个函数所需的栈空间大小</p>
<hr />
<p>二、栈帧结构与编译器对齐</p>
<p>2.1 完整栈帧布局（x86-64，调用后）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">高地址<br>├─────────────────┤<br>│ 调用者栈帧        <br>├─────────────────┤<br>│ 参数7~n（若需要）   ← 通过寄存器传递优先<br>├─────────────────┤<br>│ 返回地址           ← 8字节，call指令压入（关键攻击目标！）<br>├─────────────────┤<br>│ 保存的RBP          ← 上一个栈帧基址<br>├─────────────────┤ ← RBP通常指向这里<br>│ 局部变量区          ← 编译器精心布局的区域<br>│   char buf[10]   <br>│   int auth_flag  <br>│   ...            <br>├─────────────────┤<br>│ 对齐填充区         ← 编译器自动插入的“隐形”区域<br>├─────────────────┤ ← RSP指向这里<br>│ 可能有的临时空间   <br>└─────────────────┘低地址<br></code></pre></td></tr></table></figure>
<p>2.2 编译器的“自动对齐填充”机制</p>
<p>根本原因：CPU硬件强制要求。例如：</p>
<p>· x86-64 System V ABI规定：栈指针必须保持16字节对齐<br />
· SSE/AVX指令要求：movaps等指令操作的内存地址必须16/32字节对齐</p>
<p>编译器实际操作：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// 你写的代码</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">char</span> a = <span class="hljs-string">&#x27;A&#x27;</span>;      <span class="hljs-comment">// 1字节</span><br>    <span class="hljs-type">int</span>  b = <span class="hljs-number">100</span>;      <span class="hljs-comment">// 4字节（需4字节对齐）</span><br>    <span class="hljs-type">long</span> c = <span class="hljs-number">1000</span>;     <span class="hljs-comment">// 8字节（需8字节对齐）</span><br>&#125;<br><br><span class="hljs-comment">// 编译器实际布局（64位Linux）：</span><br>地址         内容<br>rbp<span class="hljs-number">-1</span>        <span class="hljs-type">char</span> <span class="hljs-title function_">a</span>     <span class="hljs-params">(<span class="hljs-number">1</span>字节)</span><br>rbp-8        <span class="hljs-type">long</span> <span class="hljs-title function_">c</span>     <span class="hljs-params">(<span class="hljs-number">8</span>字节对齐地址)</span> ← 为了对齐c，中间有7字节填充！<br>rbp-12       <span class="hljs-type">int</span> <span class="hljs-title function_">b</span>      <span class="hljs-params">(<span class="hljs-number">4</span>字节)</span><br>             <span class="hljs-comment">// 编译器可能再插入4字节填充，保证函数开始/结束时RSP对齐</span><br></code></pre></td></tr></table></figure>
<p>关键点：这些填充字节是编译器自动插入的，内容通常是随机的（上次函数调用遗留的数据）。</p>
<hr />
<p>三、栈溢出攻击的核心原理</p>
<p>3.1 核心攻击路径：覆盖</p>
<p>栈溢出的本质是：用连续的输入数据，暴力覆盖编译器精心构建的栈帧结构。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">正常栈帧：<br>[局部变量][对齐填充][保存的RBP][返回地址]<br><br>溢出覆盖顺序（假设从局部变量开始溢出）：<br>1. 填满局部变量区<br>2. 覆盖对齐填充区<br>3. 覆盖保存的RBP<br>4. 覆盖返回地址 ← 🎯 控制程序执行流！<br>5. 继续向上覆盖调用者栈帧...<br></code></pre></td></tr></table></figure>
<p>3.2 为什么“对齐填充区”如此关键？</p>
<ol>
<li>信息泄露渠道：填充区包含随机遗留数据，可能含有敏感信息（指针、之前函数的局部变量等）。</li>
<li>攻击跳板：为攻击payload提供额外的写入空间，特别是当局部变量空间不足时。</li>
<li>偏移计算的干扰项：攻击者必须准确计算到返回地址的偏移，需要考虑所有编译器插入的填充。</li>
</ol>
<hr />
<p>四、编译器视角 vs 攻击者视角</p>
<p>4.1 编译器的“精心设计”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">编译器目标：<br>1. 保证所有数据访问对齐 → 插入填充字节<br>2. 维持栈指针对齐 → 在函数头尾调整RSP<br>3. 优化访问速度 → 重排局部变量顺序<br>4. 生成高效代码 → 假设栈结构不会被破坏<br></code></pre></td></tr></table></figure>
<p>4.2 攻击者的“暴力破坏”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">攻击者操作：<br>1. 无视所有对齐和布局 → 用数据流淹没一切<br>2. 利用填充区内容 → 可能泄露信息或藏payload<br>3. 精确计算偏移 → 必须逆向编译器布局<br>4. 目标明确：覆盖返回地址或关键变量<br></code></pre></td></tr></table></figure>
<p>4.3 关键对抗：Stack Canary（栈金丝雀）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">现代编译器防护：<br>┌─────────────────┐<br>│ 局部变量         <br>├─────────────────┤<br>│ 栈金丝雀          ← 编译器插入的随机值<br>├─────────────────┤<br>│ 保存的RBP        <br>├─────────────────┤<br>│ 返回地址         <br>└─────────────────┘<br><br>函数返回前检查金丝雀值是否被改变，<br>若改变 → 立即终止程序（Stack Smashing Detected）<br></code></pre></td></tr></table></figure>
<hr />
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2026/02/27/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">← Next 汇编语言</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2026/01/26/linux%E6%8C%87%E4%BB%A4-shell%E8%84%9A%E6%9C%AC/">linux指令&amp;shell脚本 Prev →</a></div></div></div><details id="reward"><summary>reward</summary><div><span>微信 | Wechat</span><br><img src="/images/WeChat.png"></div><div><span>支付宝 | Alipay</span><br><img src="/images/Alipay.png"></div></details><div id="comments"><div id="giscus"></div></div></div><div class="bottom-btn"><div><a class="i-top" id="to-top" onClick="scrolls.scrolltop();" title="To Top" style="opacity: 0; display: none;">∧ </a><a class="i-index" id="to-index" onClick="tocControl.change()" title="To Catalog"><span class="tocBtnIconBar"></span><span class="tocBtnIconBar"></span><span class="tocBtnIconBar"></span></a><a class="i-color" id="color-mode" onClick="colorMode.change()" title="Change Theme"></a><a onclick="BgmControl()"><svg id="bgm-control" viewBox="0 0 30 34" fill="#18d1ff" style="width: 24px; transition: transform .3s;margin-top: 4px"><path d="M25.998 23.422V11.29h3.999v12.132h-3.999zM19.497 6.234h4.001v22.243h-4.001V6.234zM12.998.867h4v32.978h-4V.867zm-6.5 5.367h4.001v22.243H6.498V6.234zm-6.5 5.056h4v12.132h-4V11.29z"></path></svg><audio id="bgm" src="/audio/bgm.mp3" autoplay loop crossorigin="anonymous"> </audio></a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/images/1.jpg" alt="Logo" style="margin:0;border-radius:0;"></a><h1 id="Dr"><a href="/">Lnk</a></h1><div id="description"><p></p></div><div id="social-links"><a class="social" target="_blank" rel="noopener" href="https://github.com/Lnkqwq"><i class="fab fa-github" alt="GitHub"></i></a><a class="social" href="3403583728@qq.com"><i class="fa fa-envelope" alt="E-Mail"></i></a></div></div><div id="aside-block"><div id="toc-div"><h1>Catalog</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.</span> <span class="toc-text"> Linux文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text"> 一、Linux文件系统层次结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E7%A3%81%E7%9B%98%E5%B8%83%E5%B1%80%E4%B8%8E%E5%88%86%E5%8C%BA%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text"> 二、磁盘布局与分区结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E5%85%B3%E9%94%AE%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.3.</span> <span class="toc-text"> 三、关键数据结构详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text"> 四、文件系统操作流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E7%89%B9%E6%AE%8A%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.5.</span> <span class="toc-text"> 五、特殊文件系统详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%85%83%E6%95%B0%E6%8D%AE%E4%B8%8E%E5%8F%96%E8%AF%81"><span class="toc-number">1.6.</span> <span class="toc-text"> 六、文件系统元数据与取证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E4%B8%8E%E8%B0%83%E4%BC%98"><span class="toc-number">1.7.</span> <span class="toc-text"> 七、文件系统性能与调优</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB-%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.8.</span> <span class="toc-text"> 八、安全相关文件系统位置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%95%85%E9%9A%9C%E6%81%A2%E5%A4%8D"><span class="toc-number">1.9.</span> <span class="toc-text"> 九、文件系统故障恢复</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A3%80%E6%9F%A5%E5%B7%A5%E5%85%B7%E9%80%9F%E6%9F%A5"><span class="toc-number">1.10.</span> <span class="toc-text"> 十、文件系统检查工具速查</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#linux%E5%86%85%E6%A0%B8"><span class="toc-number">2.</span> <span class="toc-text"> Linux内核</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#elf%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text"> ELF格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E4%B8%89%E4%B8%AA%E9%98%B6%E6%AE%B5%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text"> 一、三个阶段概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E9%98%B6%E6%AE%B51%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6o%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text"> 二、阶段1：目标文件（.o文件）格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E9%98%B6%E6%AE%B52%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.3.</span> <span class="toc-text"> 三、阶段2：可执行文件格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E9%98%B6%E6%AE%B53%E5%86%85%E5%AD%98%E6%98%A0%E5%83%8F%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.4.</span> <span class="toc-text"> 四、阶段3：内存映像格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E5%85%B3%E9%94%AE%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.5.</span> <span class="toc-text"> 五、关键数据流示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA"><span class="toc-number">4.</span> <span class="toc-text"> 内存分区</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text"> 一、内存分区概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E5%A0%86%E5%8C%BA%E8%AF%A6%E8%A7%A3"><span class="toc-number">4.2.</span> <span class="toc-text"> 二、堆区详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E5%A0%86%E5%8C%BA%E6%9C%AC%E8%B4%A8%E4%B8%8E%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.1.</span> <span class="toc-text"> 一、堆区本质与操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E5%A0%86%E5%9D%97chunk%E7%BB%93%E6%9E%84%E4%B8%8E%E5%AF%B9%E9%BD%90"><span class="toc-number">4.2.2.</span> <span class="toc-text"> 二、堆块（Chunk）结构与对齐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-%E5%A0%86%E7%AE%A1%E7%90%86%E5%99%A8ptmalloc2%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.3.</span> <span class="toc-text"> 三、堆管理器（ptmalloc2）组织结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%88%E5%8C%BA%E8%AF%A6%E8%A7%A3"><span class="toc-number">4.3.</span> <span class="toc-text"> 栈区详解</span></a></li></ol></li></ol></div></div><footer><nobr>Published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr> by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas></body></html>